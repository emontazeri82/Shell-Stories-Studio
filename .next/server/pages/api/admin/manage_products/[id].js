"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/admin/manage_products/[id]";
exports.ids = ["pages/api/admin/manage_products/[id]"];
exports.modules = {

/***/ "(api-node)/./lib/api.js":
/*!********************!*\
  !*** ./lib/api.js ***!
  \********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   __utils: () => (/* binding */ __utils),\n/* harmony export */   searchProducts: () => (/* binding */ searchProducts),\n/* harmony export */   sendErrorResponse: () => (/* binding */ sendErrorResponse),\n/* harmony export */   sendSuccessResponse: () => (/* binding */ sendSuccessResponse),\n/* harmony export */   validateProductData: () => (/* binding */ validateProductData)\n/* harmony export */ });\n// lib/api.js\n/** ---------------------------\n * Small, reuseable utilities\n * --------------------------*/ const isFiniteNumber = (v)=>typeof v === 'number' && Number.isFinite(v);\nconst isHttpUrl = (s)=>{\n    if (typeof s !== 'string' || s.trim() === '') return false;\n    try {\n        const u = new URL(s);\n        return u.protocol === 'http:' || u.protocol === 'https:';\n    } catch  {\n        return false;\n    }\n};\n/** -------------------------------------------------------\n * Standardized JSON responses (never leak HTML to clients)\n * ------------------------------------------------------*/ const sendSuccessResponse = (res, statusCode, message, data = {})=>{\n    // Ensure we always spread a plain object (avoid null/array surprises)\n    const payload = data && typeof data === 'object' && !Array.isArray(data) ? data : {};\n    res.status(statusCode).json({\n        success: true,\n        message,\n        ...payload\n    });\n};\nconst sendErrorResponse = (res, statusCode, message, error = null)=>{\n    // Normalize non-serializable errors\n    let errOut = error;\n    if (error instanceof Error) {\n        errOut = {\n            name: error.name,\n            message: error.message,\n            stack:  true ? error.stack : 0\n        };\n    } else if (error && typeof error === 'object') {\n        try {\n            JSON.stringify(error);\n        } catch  {\n            errOut = String(error);\n        }\n    }\n    res.status(statusCode).json({\n        success: false,\n        message,\n        error: errOut\n    });\n};\n/** -------------------------------------------------------\n * Product payload validation (partial-safe, used for PATCH)\n * Pass only fields you intend to change.\n * Returns `null` when valid, or a string message on error.\n * ------------------------------------------------------*/ const validateProductData = (data)=>{\n    // Guard against non-objects\n    if (!data || typeof data !== 'object') return 'Payload must be an object';\n    const { name, description, price, stock, image_url, category, is_active, is_favorite } = data;\n    // name: optional, if present must be non-empty <= 100\n    if (name !== undefined) {\n        if (typeof name !== 'string' || name.trim().length === 0) {\n            return 'Name must be a non-empty string';\n        }\n        if (name.length > 100) return 'Name is too long (max 100 chars)';\n    }\n    // description: optional string <= 1000\n    if (description !== undefined) {\n        if (typeof description !== 'string') return 'Description must be a string';\n        if (description.length > 1000) return 'Description is too long (max 1000 chars)';\n    }\n    // price: number > 0\n    if (price !== undefined) {\n        if (!isFiniteNumber(price) || price <= 0) return 'Price must be a positive number';\n    }\n    // stock: number >= 0 (integers preferred; DB has CHECK >= 0)\n    if (stock !== undefined) {\n        if (!isFiniteNumber(stock) || stock < 0) return 'Stock must be a non-negative number';\n    }\n    // image_url: allow empty/omitted; if present and non-empty must be http(s)\n    if (image_url !== undefined) {\n        if (image_url === '' || image_url === null) {\n        // allow blank (main image can come from media gallery)\n        } else if (!isHttpUrl(image_url)) {\n            return 'Image URL must be a valid http(s) URL';\n        }\n    }\n    // category: optional string <= 50\n    if (category !== undefined) {\n        if (typeof category !== 'string' || category.length > 50) {\n            return 'Category must be a string under 50 characters';\n        }\n    }\n    // is_active: must be 0 or 1 (null permitted if you intentionally clear it)\n    if (is_active !== undefined) {\n        if (![\n            0,\n            1,\n            null\n        ].includes(is_active)) return 'is_active must be 0, 1, or null';\n    }\n    // is_favorite: must be 0 or 1\n    if (is_favorite !== undefined) {\n        if (![\n            0,\n            1\n        ].includes(is_favorite)) return 'is_favorite must be 0 or 1';\n    }\n    return null; // âœ… valid\n};\n/** -------------------------------------------------------\n * Server-only search helper (lazy imports so client bundles are safe)\n * ------------------------------------------------------*/ const searchProducts = async (query)=>{\n    const { open } = await Promise.resolve(/*! import() */).then(__webpack_require__.bind(__webpack_require__, /*! sqlite */ \"sqlite\"));\n    const sqlite3 = (await Promise.resolve(/*! import() */).then(__webpack_require__.t.bind(__webpack_require__, /*! sqlite3 */ \"sqlite3\", 23))).default;\n    const path = (await Promise.resolve(/*! import() */).then(__webpack_require__.t.bind(__webpack_require__, /*! path */ \"path\", 23))).default;\n    const dbPath = path.join(process.cwd(), 'data', 'shells_shop.db');\n    const db = await open({\n        filename: dbPath,\n        driver: sqlite3.Database\n    });\n    try {\n        // Use parameterized LIKE to avoid injection; wrap in % on both sides\n        const q = String(query ?? '').trim();\n        if (!q) return [];\n        return await db.all(`SELECT * FROM products\n       WHERE name LIKE ? OR description LIKE ?\n       ORDER BY id DESC`, [\n            `%${q}%`,\n            `%${q}%`\n        ]);\n    } catch (err) {\n        console.error('âŒ searchProducts failed:', err);\n        throw new Error('Failed to search products');\n    } finally{\n        try {\n            await db.close();\n        } catch  {}\n    }\n};\n// (Optionally) export the tiny helpers if you want to reuse elsewhere:\nconst __utils = {\n    isFiniteNumber,\n    isHttpUrl\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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S0FBSztRQUNaQyxRQUFRcEMsS0FBSyxDQUFDLDRCQUE0Qm1DO1FBQzFDLE1BQU0sSUFBSWpDLE1BQU07SUFDbEIsU0FBVTtRQUNSLElBQUk7WUFBRSxNQUFNMkIsR0FBR1EsS0FBSztRQUFJLEVBQUUsT0FBTSxDQUFDO0lBQ25DO0FBQ0YsRUFBRTtBQUVGLHVFQUF1RTtBQUNoRSxNQUFNQyxVQUFVO0lBQUU1RDtJQUFnQkk7QUFBVSxFQUFFIiwic291cmNlcyI6WyIvVXNlcnMvZW1vbnRhemVyaS9Eb2N1bWVudHMvcHJvamVjdHMvc2hlbGwtc3Rvcmllcy1zdHVkaW8vbGliL2FwaS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBsaWIvYXBpLmpzXG5cbi8qKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAqIFNtYWxsLCByZXVzZWFibGUgdXRpbGl0aWVzXG4gKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5jb25zdCBpc0Zpbml0ZU51bWJlciA9ICh2KSA9PiB0eXBlb2YgdiA9PT0gJ251bWJlcicgJiYgTnVtYmVyLmlzRmluaXRlKHYpO1xuY29uc3QgaXNIdHRwVXJsID0gKHMpID0+IHtcbiAgaWYgKHR5cGVvZiBzICE9PSAnc3RyaW5nJyB8fCBzLnRyaW0oKSA9PT0gJycpIHJldHVybiBmYWxzZTtcbiAgdHJ5IHtcbiAgICBjb25zdCB1ID0gbmV3IFVSTChzKTtcbiAgICByZXR1cm4gdS5wcm90b2NvbCA9PT0gJ2h0dHA6JyB8fCB1LnByb3RvY29sID09PSAnaHR0cHM6JztcbiAgfSBjYXRjaCB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG59O1xuXG4vKiogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICogU3RhbmRhcmRpemVkIEpTT04gcmVzcG9uc2VzIChuZXZlciBsZWFrIEhUTUwgdG8gY2xpZW50cylcbiAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5leHBvcnQgY29uc3Qgc2VuZFN1Y2Nlc3NSZXNwb25zZSA9IChyZXMsIHN0YXR1c0NvZGUsIG1lc3NhZ2UsIGRhdGEgPSB7fSkgPT4ge1xuICAvLyBFbnN1cmUgd2UgYWx3YXlzIHNwcmVhZCBhIHBsYWluIG9iamVjdCAoYXZvaWQgbnVsbC9hcnJheSBzdXJwcmlzZXMpXG4gIGNvbnN0IHBheWxvYWQgPSAoZGF0YSAmJiB0eXBlb2YgZGF0YSA9PT0gJ29iamVjdCcgJiYgIUFycmF5LmlzQXJyYXkoZGF0YSkpID8gZGF0YSA6IHt9O1xuICByZXMuc3RhdHVzKHN0YXR1c0NvZGUpLmpzb24oe1xuICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgbWVzc2FnZSxcbiAgICAuLi5wYXlsb2FkLFxuICB9KTtcbn07XG5cbmV4cG9ydCBjb25zdCBzZW5kRXJyb3JSZXNwb25zZSA9IChyZXMsIHN0YXR1c0NvZGUsIG1lc3NhZ2UsIGVycm9yID0gbnVsbCkgPT4ge1xuICAvLyBOb3JtYWxpemUgbm9uLXNlcmlhbGl6YWJsZSBlcnJvcnNcbiAgbGV0IGVyck91dCA9IGVycm9yO1xuICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBFcnJvcikge1xuICAgIGVyck91dCA9IHsgbmFtZTogZXJyb3IubmFtZSwgbWVzc2FnZTogZXJyb3IubWVzc2FnZSwgc3RhY2s6IHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnID8gZXJyb3Iuc3RhY2sgOiB1bmRlZmluZWQgfTtcbiAgfSBlbHNlIGlmIChlcnJvciAmJiB0eXBlb2YgZXJyb3IgPT09ICdvYmplY3QnKSB7XG4gICAgdHJ5IHsgSlNPTi5zdHJpbmdpZnkoZXJyb3IpOyB9IGNhdGNoIHsgZXJyT3V0ID0gU3RyaW5nKGVycm9yKTsgfVxuICB9XG4gIHJlcy5zdGF0dXMoc3RhdHVzQ29kZSkuanNvbih7XG4gICAgc3VjY2VzczogZmFsc2UsXG4gICAgbWVzc2FnZSxcbiAgICBlcnJvcjogZXJyT3V0LFxuICB9KTtcbn07XG5cbi8qKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gKiBQcm9kdWN0IHBheWxvYWQgdmFsaWRhdGlvbiAocGFydGlhbC1zYWZlLCB1c2VkIGZvciBQQVRDSClcbiAqIFBhc3Mgb25seSBmaWVsZHMgeW91IGludGVuZCB0byBjaGFuZ2UuXG4gKiBSZXR1cm5zIGBudWxsYCB3aGVuIHZhbGlkLCBvciBhIHN0cmluZyBtZXNzYWdlIG9uIGVycm9yLlxuICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cbmV4cG9ydCBjb25zdCB2YWxpZGF0ZVByb2R1Y3REYXRhID0gKGRhdGEpID0+IHtcbiAgLy8gR3VhcmQgYWdhaW5zdCBub24tb2JqZWN0c1xuICBpZiAoIWRhdGEgfHwgdHlwZW9mIGRhdGEgIT09ICdvYmplY3QnKSByZXR1cm4gJ1BheWxvYWQgbXVzdCBiZSBhbiBvYmplY3QnO1xuXG4gIGNvbnN0IHtcbiAgICBuYW1lLFxuICAgIGRlc2NyaXB0aW9uLFxuICAgIHByaWNlLFxuICAgIHN0b2NrLFxuICAgIGltYWdlX3VybCxcbiAgICBjYXRlZ29yeSxcbiAgICBpc19hY3RpdmUsXG4gICAgaXNfZmF2b3JpdGUsXG4gIH0gPSBkYXRhO1xuXG4gIC8vIG5hbWU6IG9wdGlvbmFsLCBpZiBwcmVzZW50IG11c3QgYmUgbm9uLWVtcHR5IDw9IDEwMFxuICBpZiAobmFtZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgaWYgKHR5cGVvZiBuYW1lICE9PSAnc3RyaW5nJyB8fCBuYW1lLnRyaW0oKS5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiAnTmFtZSBtdXN0IGJlIGEgbm9uLWVtcHR5IHN0cmluZyc7XG4gICAgfVxuICAgIGlmIChuYW1lLmxlbmd0aCA+IDEwMCkgcmV0dXJuICdOYW1lIGlzIHRvbyBsb25nIChtYXggMTAwIGNoYXJzKSc7XG4gIH1cblxuICAvLyBkZXNjcmlwdGlvbjogb3B0aW9uYWwgc3RyaW5nIDw9IDEwMDBcbiAgaWYgKGRlc2NyaXB0aW9uICE9PSB1bmRlZmluZWQpIHtcbiAgICBpZiAodHlwZW9mIGRlc2NyaXB0aW9uICE9PSAnc3RyaW5nJykgcmV0dXJuICdEZXNjcmlwdGlvbiBtdXN0IGJlIGEgc3RyaW5nJztcbiAgICBpZiAoZGVzY3JpcHRpb24ubGVuZ3RoID4gMTAwMCkgcmV0dXJuICdEZXNjcmlwdGlvbiBpcyB0b28gbG9uZyAobWF4IDEwMDAgY2hhcnMpJztcbiAgfVxuXG4gIC8vIHByaWNlOiBudW1iZXIgPiAwXG4gIGlmIChwcmljZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgaWYgKCFpc0Zpbml0ZU51bWJlcihwcmljZSkgfHwgcHJpY2UgPD0gMCkgcmV0dXJuICdQcmljZSBtdXN0IGJlIGEgcG9zaXRpdmUgbnVtYmVyJztcbiAgfVxuXG4gIC8vIHN0b2NrOiBudW1iZXIgPj0gMCAoaW50ZWdlcnMgcHJlZmVycmVkOyBEQiBoYXMgQ0hFQ0sgPj0gMClcbiAgaWYgKHN0b2NrICE9PSB1bmRlZmluZWQpIHtcbiAgICBpZiAoIWlzRmluaXRlTnVtYmVyKHN0b2NrKSB8fCBzdG9jayA8IDApIHJldHVybiAnU3RvY2sgbXVzdCBiZSBhIG5vbi1uZWdhdGl2ZSBudW1iZXInO1xuICB9XG5cbiAgLy8gaW1hZ2VfdXJsOiBhbGxvdyBlbXB0eS9vbWl0dGVkOyBpZiBwcmVzZW50IGFuZCBub24tZW1wdHkgbXVzdCBiZSBodHRwKHMpXG4gIGlmIChpbWFnZV91cmwgIT09IHVuZGVmaW5lZCkge1xuICAgIGlmIChpbWFnZV91cmwgPT09ICcnIHx8IGltYWdlX3VybCA9PT0gbnVsbCkge1xuICAgICAgLy8gYWxsb3cgYmxhbmsgKG1haW4gaW1hZ2UgY2FuIGNvbWUgZnJvbSBtZWRpYSBnYWxsZXJ5KVxuICAgIH0gZWxzZSBpZiAoIWlzSHR0cFVybChpbWFnZV91cmwpKSB7XG4gICAgICByZXR1cm4gJ0ltYWdlIFVSTCBtdXN0IGJlIGEgdmFsaWQgaHR0cChzKSBVUkwnO1xuICAgIH1cbiAgfVxuXG4gIC8vIGNhdGVnb3J5OiBvcHRpb25hbCBzdHJpbmcgPD0gNTBcbiAgaWYgKGNhdGVnb3J5ICE9PSB1bmRlZmluZWQpIHtcbiAgICBpZiAodHlwZW9mIGNhdGVnb3J5ICE9PSAnc3RyaW5nJyB8fCBjYXRlZ29yeS5sZW5ndGggPiA1MCkge1xuICAgICAgcmV0dXJuICdDYXRlZ29yeSBtdXN0IGJlIGEgc3RyaW5nIHVuZGVyIDUwIGNoYXJhY3RlcnMnO1xuICAgIH1cbiAgfVxuXG4gIC8vIGlzX2FjdGl2ZTogbXVzdCBiZSAwIG9yIDEgKG51bGwgcGVybWl0dGVkIGlmIHlvdSBpbnRlbnRpb25hbGx5IGNsZWFyIGl0KVxuICBpZiAoaXNfYWN0aXZlICE9PSB1bmRlZmluZWQpIHtcbiAgICBpZiAoIVswLCAxLCBudWxsXS5pbmNsdWRlcyhpc19hY3RpdmUpKSByZXR1cm4gJ2lzX2FjdGl2ZSBtdXN0IGJlIDAsIDEsIG9yIG51bGwnO1xuICB9XG5cbiAgLy8gaXNfZmF2b3JpdGU6IG11c3QgYmUgMCBvciAxXG4gIGlmIChpc19mYXZvcml0ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgaWYgKCFbMCwgMV0uaW5jbHVkZXMoaXNfZmF2b3JpdGUpKSByZXR1cm4gJ2lzX2Zhdm9yaXRlIG11c3QgYmUgMCBvciAxJztcbiAgfVxuXG4gIHJldHVybiBudWxsOyAvLyDinIUgdmFsaWRcbn07XG5cbi8qKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gKiBTZXJ2ZXItb25seSBzZWFyY2ggaGVscGVyIChsYXp5IGltcG9ydHMgc28gY2xpZW50IGJ1bmRsZXMgYXJlIHNhZmUpXG4gKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuZXhwb3J0IGNvbnN0IHNlYXJjaFByb2R1Y3RzID0gYXN5bmMgKHF1ZXJ5KSA9PiB7XG4gIGNvbnN0IHsgb3BlbiB9ID0gYXdhaXQgaW1wb3J0KCdzcWxpdGUnKTtcbiAgY29uc3Qgc3FsaXRlMyA9IChhd2FpdCBpbXBvcnQoJ3NxbGl0ZTMnKSkuZGVmYXVsdDtcbiAgY29uc3QgcGF0aCA9IChhd2FpdCBpbXBvcnQoJ3BhdGgnKSkuZGVmYXVsdDtcblxuICBjb25zdCBkYlBhdGggPSBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgJ2RhdGEnLCAnc2hlbGxzX3Nob3AuZGInKTtcbiAgY29uc3QgZGIgPSBhd2FpdCBvcGVuKHsgZmlsZW5hbWU6IGRiUGF0aCwgZHJpdmVyOiBzcWxpdGUzLkRhdGFiYXNlIH0pO1xuXG4gIHRyeSB7XG4gICAgLy8gVXNlIHBhcmFtZXRlcml6ZWQgTElLRSB0byBhdm9pZCBpbmplY3Rpb247IHdyYXAgaW4gJSBvbiBib3RoIHNpZGVzXG4gICAgY29uc3QgcSA9IFN0cmluZyhxdWVyeSA/PyAnJykudHJpbSgpO1xuICAgIGlmICghcSkgcmV0dXJuIFtdO1xuICAgIHJldHVybiBhd2FpdCBkYi5hbGwoXG4gICAgICBgU0VMRUNUICogRlJPTSBwcm9kdWN0c1xuICAgICAgIFdIRVJFIG5hbWUgTElLRSA/IE9SIGRlc2NyaXB0aW9uIExJS0UgP1xuICAgICAgIE9SREVSIEJZIGlkIERFU0NgLFxuICAgICAgW2AlJHtxfSVgLCBgJSR7cX0lYF1cbiAgICApO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBjb25zb2xlLmVycm9yKCfinYwgc2VhcmNoUHJvZHVjdHMgZmFpbGVkOicsIGVycik7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgdG8gc2VhcmNoIHByb2R1Y3RzJyk7XG4gIH0gZmluYWxseSB7XG4gICAgdHJ5IHsgYXdhaXQgZGIuY2xvc2UoKTsgfSBjYXRjaCB7fVxuICB9XG59O1xuXG4vLyAoT3B0aW9uYWxseSkgZXhwb3J0IHRoZSB0aW55IGhlbHBlcnMgaWYgeW91IHdhbnQgdG8gcmV1c2UgZWxzZXdoZXJlOlxuZXhwb3J0IGNvbnN0IF9fdXRpbHMgPSB7IGlzRmluaXRlTnVtYmVyLCBpc0h0dHBVcmwgfTtcblxuIl0sIm5hbWVzIjpbImlzRmluaXRlTnVtYmVyIiwidiIsIk51bWJlciIsImlzRmluaXRlIiwiaXNIdHRwVXJsIiwicyIsInRyaW0iLCJ1IiwiVVJMIiwicHJvdG9jb2wiLCJzZW5kU3VjY2Vzc1Jlc3BvbnNlIiwicmVzIiwic3RhdHVzQ29kZSIsIm1lc3NhZ2UiLCJkYXRhIiwicGF5bG9hZCIsIkFycmF5IiwiaXNBcnJheSIsInN0YXR1cyIsImpzb24iLCJzdWNjZXNzIiwic2VuZEVycm9yUmVzcG9uc2UiLCJlcnJvciIsImVyck91dCIsIkVycm9yIiwibmFtZSIsInN0YWNrIiwicHJvY2VzcyIsInVuZGVmaW5lZCIsIkpTT04iLCJzdHJpbmdpZnkiLCJTdHJpbmciLCJ2YWxpZGF0ZVByb2R1Y3REYXRhIiwiZGVzY3JpcHRpb24iLCJwcmljZSIsInN0b2NrIiwiaW1hZ2VfdXJsIiwiY2F0ZWdvcnkiLCJpc19hY3RpdmUiLCJpc19mYXZvcml0ZSIsImxlbmd0aCIsImluY2x1ZGVzIiwic2VhcmNoUHJvZHVjdHMiLCJxdWVyeSIsIm9wZW4iLCJzcWxpdGUzIiwiZGVmYXVsdCIsInBhdGgiLCJkYlBhdGgiLCJqb2luIiwiY3dkIiwiZGIiLCJmaWxlbmFtZSIsImRyaXZlciIsIkRhdGFiYXNlIiwicSIsImFsbCIsImVyciIsImNvbnNvbGUiLCJjbG9zZSIsIl9fdXRpbHMiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api-node)/./lib/api.js\n");

/***/ }),

/***/ "(api-node)/./lib/auth/authorizeAdmin.js":
/*!************************************!*\
  !*** ./lib/auth/authorizeAdmin.js ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ROLES: () => (/* binding */ ROLES),\n/* harmony export */   authorizeAdmin: () => (/* binding */ authorizeAdmin),\n/* harmony export */   withAdmin: () => (/* binding */ withAdmin)\n/* harmony export */ });\n/* harmony import */ var next_auth_jwt__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next-auth/jwt */ \"next-auth/jwt\");\n/* harmony import */ var next_auth_jwt__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_auth_jwt__WEBPACK_IMPORTED_MODULE_0__);\n// lib/auth/authorizeAdmin.js\n\nconst ROLES = {\n    ADMIN: 'ADMIN',\n    USER: 'USER'\n};\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n// Helper utilities\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nfunction wantsJson(req) {\n    const url = req.url || '';\n    const accept = String(req.headers?.accept || '').toLowerCase();\n    const xrw = String(req.headers?.['x-requested-with'] || '').toLowerCase();\n    return url.startsWith('/api/') || accept.includes('application/json') || xrw === 'xmlhttprequest';\n}\nfunction safeCallbackUrl(req) {\n    try {\n        const u = new URL(req.url, `http://${req.headers.host || 'localhost'}`);\n        return u.pathname + u.search; // same-origin path only\n    } catch  {\n        return '/';\n    }\n}\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n// Core middleware\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nfunction authorizeAdmin(loginPath = '/admin/login') {\n    console.log('[authorizeAdmin] middleware initialized');\n    return async function guard(req, res, next) {\n        const rid = req.rid || '-';\n        const t0 = Date.now();\n        console.log('[authorizeAdmin]', rid, 'ENTER for', req.method, req.url);\n        try {\n            console.log('[authorizeAdmin]', 'EXECUTION ENTERED for', req.method, req.url);\n            // ðŸ”‘ Try reading the session token\n            const token = await (0,next_auth_jwt__WEBPACK_IMPORTED_MODULE_0__.getToken)({\n                req,\n                secret: process.env.NEXTAUTH_SECRET\n            });\n            console.log('[authorizeAdmin]', rid, 'token check â†’', token ? 'FOUND' : 'MISSING', 'role:', token?.role);\n            if (!token) {\n                console.warn('[authorizeAdmin]', rid, 'NO TOKEN (unauthenticated)');\n                if (wantsJson(req)) {\n                    console.log('[authorizeAdmin]', rid, 'â†’ returning 401 JSON');\n                    return res.status(401).json({\n                        ok: false,\n                        code: 'UNAUTHENTICATED',\n                        error: 'Unauthorized'\n                    });\n                }\n                const cb = encodeURIComponent(safeCallbackUrl(req));\n                console.log('[authorizeAdmin]', rid, 'â†’ redirecting to login');\n                return res.redirect(`${loginPath}?callbackUrl=${cb}`);\n            }\n            // Normalize role (e.g. \"admin\" â†’ \"ADMIN\")\n            const role = String(token.role || 'USER').toUpperCase();\n            console.log('[authorizeAdmin]', rid, 'normalized role:', role);\n            if (role !== ROLES.ADMIN) {\n                console.warn('[authorizeAdmin]', rid, 'role not admin â†’ forbidden');\n                if (wantsJson(req)) {\n                    console.log('[authorizeAdmin]', rid, 'â†’ returning 403 JSON');\n                    return res.status(403).json({\n                        ok: false,\n                        code: 'FORBIDDEN',\n                        error: 'Forbidden'\n                    });\n                }\n                return res.redirect('/403');\n            }\n            // âœ… Authorized\n            req.user = {\n                id: token.sub || null,\n                email: token.email || null,\n                role\n            };\n            console.log('[authorizeAdmin]', rid, 'AUTHORIZED â†’ calling next() | user:', JSON.stringify(req.user), 'in', Date.now() - t0, 'ms');\n            return next(); // <--- this ensures the middleware chain continues\n        } catch (err) {\n            console.error('[authorizeAdmin]', rid, 'ERROR â†’', err?.message || err);\n            if (wantsJson(req)) {\n                console.log('[authorizeAdmin]', rid, 'â†’ returning 401 JSON (token error)');\n                return res.status(401).json({\n                    ok: false,\n                    code: 'TOKEN_ERROR',\n                    error: 'Unauthorized'\n                });\n            }\n            console.log('[authorizeAdmin]', rid, 'â†’ redirecting to login (exception)');\n            return res.redirect(loginPath);\n        }\n    };\n}\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n// Wrapper for standalone Next.js API routes\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nfunction withAdmin(handler, loginPath = '/admin/login') {\n    const mw = authorizeAdmin(loginPath);\n    return async (req, res)=>{\n        const rid = req.rid || '-';\n        console.log('[withAdmin]', rid, 'ENTER â†’ wrapping handler for', req.url);\n        await mw(req, res, async ()=>{\n            console.log('[withAdmin]', rid, 'AUTH OK â†’ executing handler');\n            await handler(req, res);\n            console.log('[withAdmin]', rid, 'HANDLER COMPLETE');\n        });\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RCxHQUFHckQsS0FBS29CLEtBQUs7WUFDakJILFFBQVFDLEdBQUcsQ0FBQyxlQUFlSSxLQUFLO1lBQ2hDLE1BQU04QixRQUFRcEQsS0FBS29CO1lBQ25CSCxRQUFRQyxHQUFHLENBQUMsZUFBZUksS0FBSztRQUNsQztJQUNGO0FBQ0YiLCJzb3VyY2VzIjpbIi9Vc2Vycy9lbW9udGF6ZXJpL0RvY3VtZW50cy9wcm9qZWN0cy9zaGVsbC1zdG9yaWVzLXN0dWRpby9saWIvYXV0aC9hdXRob3JpemVBZG1pbi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBsaWIvYXV0aC9hdXRob3JpemVBZG1pbi5qc1xuaW1wb3J0IHsgZ2V0VG9rZW4gfSBmcm9tICduZXh0LWF1dGgvand0JztcblxuZXhwb3J0IGNvbnN0IFJPTEVTID0geyBBRE1JTjogJ0FETUlOJywgVVNFUjogJ1VTRVInIH07XG5cbi8vIOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFxuLy8gSGVscGVyIHV0aWxpdGllc1xuLy8g4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXG5mdW5jdGlvbiB3YW50c0pzb24ocmVxKSB7XG4gIGNvbnN0IHVybCA9IHJlcS51cmwgfHwgJyc7XG4gIGNvbnN0IGFjY2VwdCA9IFN0cmluZyhyZXEuaGVhZGVycz8uYWNjZXB0IHx8ICcnKS50b0xvd2VyQ2FzZSgpO1xuICBjb25zdCB4cncgPSBTdHJpbmcocmVxLmhlYWRlcnM/LlsneC1yZXF1ZXN0ZWQtd2l0aCddIHx8ICcnKS50b0xvd2VyQ2FzZSgpO1xuICByZXR1cm4gdXJsLnN0YXJ0c1dpdGgoJy9hcGkvJykgfHwgYWNjZXB0LmluY2x1ZGVzKCdhcHBsaWNhdGlvbi9qc29uJykgfHwgeHJ3ID09PSAneG1saHR0cHJlcXVlc3QnO1xufVxuXG5mdW5jdGlvbiBzYWZlQ2FsbGJhY2tVcmwocmVxKSB7XG4gIHRyeSB7XG4gICAgY29uc3QgdSA9IG5ldyBVUkwocmVxLnVybCwgYGh0dHA6Ly8ke3JlcS5oZWFkZXJzLmhvc3QgfHwgJ2xvY2FsaG9zdCd9YCk7XG4gICAgcmV0dXJuIHUucGF0aG5hbWUgKyB1LnNlYXJjaDsgLy8gc2FtZS1vcmlnaW4gcGF0aCBvbmx5XG4gIH0gY2F0Y2gge1xuICAgIHJldHVybiAnLyc7XG4gIH1cbn1cblxuLy8g4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXG4vLyBDb3JlIG1pZGRsZXdhcmVcbi8vIOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFxuZXhwb3J0IGZ1bmN0aW9uIGF1dGhvcml6ZUFkbWluKGxvZ2luUGF0aCA9ICcvYWRtaW4vbG9naW4nKSB7XG4gIGNvbnNvbGUubG9nKCdbYXV0aG9yaXplQWRtaW5dIG1pZGRsZXdhcmUgaW5pdGlhbGl6ZWQnKTtcblxuICByZXR1cm4gYXN5bmMgZnVuY3Rpb24gZ3VhcmQocmVxLCByZXMsIG5leHQpIHtcbiAgICBjb25zdCByaWQgPSByZXEucmlkIHx8ICctJztcbiAgICBjb25zdCB0MCA9IERhdGUubm93KCk7XG5cbiAgICBjb25zb2xlLmxvZygnW2F1dGhvcml6ZUFkbWluXScsIHJpZCwgJ0VOVEVSIGZvcicsIHJlcS5tZXRob2QsIHJlcS51cmwpO1xuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnNvbGUubG9nKCdbYXV0aG9yaXplQWRtaW5dJywgJ0VYRUNVVElPTiBFTlRFUkVEIGZvcicsIHJlcS5tZXRob2QsIHJlcS51cmwpO1xuXG4gICAgICAvLyDwn5SRIFRyeSByZWFkaW5nIHRoZSBzZXNzaW9uIHRva2VuXG4gICAgICBjb25zdCB0b2tlbiA9IGF3YWl0IGdldFRva2VuKHsgcmVxLCBzZWNyZXQ6IHByb2Nlc3MuZW52Lk5FWFRBVVRIX1NFQ1JFVCB9KTtcbiAgICAgIGNvbnNvbGUubG9nKCdbYXV0aG9yaXplQWRtaW5dJywgcmlkLCAndG9rZW4gY2hlY2sg4oaSJywgdG9rZW4gPyAnRk9VTkQnIDogJ01JU1NJTkcnLCAncm9sZTonLCB0b2tlbj8ucm9sZSk7XG5cbiAgICAgIGlmICghdG9rZW4pIHtcbiAgICAgICAgY29uc29sZS53YXJuKCdbYXV0aG9yaXplQWRtaW5dJywgcmlkLCAnTk8gVE9LRU4gKHVuYXV0aGVudGljYXRlZCknKTtcbiAgICAgICAgaWYgKHdhbnRzSnNvbihyZXEpKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ1thdXRob3JpemVBZG1pbl0nLCByaWQsICfihpIgcmV0dXJuaW5nIDQwMSBKU09OJyk7XG4gICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcbiAgICAgICAgICAgIG9rOiBmYWxzZSxcbiAgICAgICAgICAgIGNvZGU6ICdVTkFVVEhFTlRJQ0FURUQnLFxuICAgICAgICAgICAgZXJyb3I6ICdVbmF1dGhvcml6ZWQnLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGNiID0gZW5jb2RlVVJJQ29tcG9uZW50KHNhZmVDYWxsYmFja1VybChyZXEpKTtcbiAgICAgICAgY29uc29sZS5sb2coJ1thdXRob3JpemVBZG1pbl0nLCByaWQsICfihpIgcmVkaXJlY3RpbmcgdG8gbG9naW4nKTtcbiAgICAgICAgcmV0dXJuIHJlcy5yZWRpcmVjdChgJHtsb2dpblBhdGh9P2NhbGxiYWNrVXJsPSR7Y2J9YCk7XG4gICAgICB9XG5cbiAgICAgIC8vIE5vcm1hbGl6ZSByb2xlIChlLmcuIFwiYWRtaW5cIiDihpIgXCJBRE1JTlwiKVxuICAgICAgY29uc3Qgcm9sZSA9IFN0cmluZyh0b2tlbi5yb2xlIHx8ICdVU0VSJykudG9VcHBlckNhc2UoKTtcbiAgICAgIGNvbnNvbGUubG9nKCdbYXV0aG9yaXplQWRtaW5dJywgcmlkLCAnbm9ybWFsaXplZCByb2xlOicsIHJvbGUpO1xuXG4gICAgICBpZiAocm9sZSAhPT0gUk9MRVMuQURNSU4pIHtcbiAgICAgICAgY29uc29sZS53YXJuKCdbYXV0aG9yaXplQWRtaW5dJywgcmlkLCAncm9sZSBub3QgYWRtaW4g4oaSIGZvcmJpZGRlbicpO1xuICAgICAgICBpZiAod2FudHNKc29uKHJlcSkpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZygnW2F1dGhvcml6ZUFkbWluXScsIHJpZCwgJ+KGkiByZXR1cm5pbmcgNDAzIEpTT04nKTtcbiAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oe1xuICAgICAgICAgICAgb2s6IGZhbHNlLFxuICAgICAgICAgICAgY29kZTogJ0ZPUkJJRERFTicsXG4gICAgICAgICAgICBlcnJvcjogJ0ZvcmJpZGRlbicsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlcy5yZWRpcmVjdCgnLzQwMycpO1xuICAgICAgfVxuXG4gICAgICAvLyDinIUgQXV0aG9yaXplZFxuICAgICAgcmVxLnVzZXIgPSB7XG4gICAgICAgIGlkOiB0b2tlbi5zdWIgfHwgbnVsbCxcbiAgICAgICAgZW1haWw6IHRva2VuLmVtYWlsIHx8IG51bGwsXG4gICAgICAgIHJvbGUsXG4gICAgICB9O1xuXG4gICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgJ1thdXRob3JpemVBZG1pbl0nLFxuICAgICAgICByaWQsXG4gICAgICAgICdBVVRIT1JJWkVEIOKGkiBjYWxsaW5nIG5leHQoKSB8IHVzZXI6JyxcbiAgICAgICAgSlNPTi5zdHJpbmdpZnkocmVxLnVzZXIpLFxuICAgICAgICAnaW4nLFxuICAgICAgICBEYXRlLm5vdygpIC0gdDAsXG4gICAgICAgICdtcydcbiAgICAgICk7XG5cbiAgICAgIHJldHVybiBuZXh0KCk7IC8vIDwtLS0gdGhpcyBlbnN1cmVzIHRoZSBtaWRkbGV3YXJlIGNoYWluIGNvbnRpbnVlc1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgY29uc29sZS5lcnJvcignW2F1dGhvcml6ZUFkbWluXScsIHJpZCwgJ0VSUk9SIOKGkicsIGVycj8ubWVzc2FnZSB8fCBlcnIpO1xuICAgICAgaWYgKHdhbnRzSnNvbihyZXEpKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdbYXV0aG9yaXplQWRtaW5dJywgcmlkLCAn4oaSIHJldHVybmluZyA0MDEgSlNPTiAodG9rZW4gZXJyb3IpJyk7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7XG4gICAgICAgICAgb2s6IGZhbHNlLFxuICAgICAgICAgIGNvZGU6ICdUT0tFTl9FUlJPUicsXG4gICAgICAgICAgZXJyb3I6ICdVbmF1dGhvcml6ZWQnLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGNvbnNvbGUubG9nKCdbYXV0aG9yaXplQWRtaW5dJywgcmlkLCAn4oaSIHJlZGlyZWN0aW5nIHRvIGxvZ2luIChleGNlcHRpb24pJyk7XG4gICAgICByZXR1cm4gcmVzLnJlZGlyZWN0KGxvZ2luUGF0aCk7XG4gICAgfVxuICB9O1xufVxuXG4vLyDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcbi8vIFdyYXBwZXIgZm9yIHN0YW5kYWxvbmUgTmV4dC5qcyBBUEkgcm91dGVzXG4vLyDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcbmV4cG9ydCBmdW5jdGlvbiB3aXRoQWRtaW4oaGFuZGxlciwgbG9naW5QYXRoID0gJy9hZG1pbi9sb2dpbicpIHtcbiAgY29uc3QgbXcgPSBhdXRob3JpemVBZG1pbihsb2dpblBhdGgpO1xuICByZXR1cm4gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gICAgY29uc3QgcmlkID0gcmVxLnJpZCB8fCAnLSc7XG4gICAgY29uc29sZS5sb2coJ1t3aXRoQWRtaW5dJywgcmlkLCAnRU5URVIg4oaSIHdyYXBwaW5nIGhhbmRsZXIgZm9yJywgcmVxLnVybCk7XG4gICAgYXdhaXQgbXcocmVxLCByZXMsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKCdbd2l0aEFkbWluXScsIHJpZCwgJ0FVVEggT0sg4oaSIGV4ZWN1dGluZyBoYW5kbGVyJyk7XG4gICAgICBhd2FpdCBoYW5kbGVyKHJlcSwgcmVzKTtcbiAgICAgIGNvbnNvbGUubG9nKCdbd2l0aEFkbWluXScsIHJpZCwgJ0hBTkRMRVIgQ09NUExFVEUnKTtcbiAgICB9KTtcbiAgfTtcbn1cblxuXG5cblxuXG4iXSwibmFtZXMiOlsiZ2V0VG9rZW4iLCJST0xFUyIsIkFETUlOIiwiVVNFUiIsIndhbnRzSnNvbiIsInJlcSIsInVybCIsImFjY2VwdCIsIlN0cmluZyIsImhlYWRlcnMiLCJ0b0xvd2VyQ2FzZSIsInhydyIsInN0YXJ0c1dpdGgiLCJpbmNsdWRlcyIsInNhZmVDYWxsYmFja1VybCIsInUiLCJVUkwiLCJob3N0IiwicGF0aG5hbWUiLCJzZWFyY2giLCJhdXRob3JpemVBZG1pbiIsImxvZ2luUGF0aCIsImNvbnNvbGUiLCJsb2ciLCJndWFyZCIsInJlcyIsIm5leHQiLCJyaWQiLCJ0MCIsIkRhdGUiLCJub3ciLCJtZXRob2QiLCJ0b2tlbiIsInNlY3JldCIsInByb2Nlc3MiLCJlbnYiLCJORVhUQVVUSF9TRUNSRVQiLCJyb2xlIiwid2FybiIsInN0YXR1cyIsImpzb24iLCJvayIsImNvZGUiLCJlcnJvciIsImNiIiwiZW5jb2RlVVJJQ29tcG9uZW50IiwicmVkaXJlY3QiLCJ0b1VwcGVyQ2FzZSIsInVzZXIiLCJpZCIsInN1YiIsImVtYWlsIiwiSlNPTiIsInN0cmluZ2lmeSIsImVyciIsIm1lc3NhZ2UiLCJ3aXRoQWRtaW4iLCJoYW5kbGVyIiwibXciXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api-node)/./lib/auth/authorizeAdmin.js\n");

/***/ }),

/***/ "(api-node)/./lib/constant.js":
/*!*************************!*\
  !*** ./lib/constant.js ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ADMIN_FAVORITES_MAX: () => (/* binding */ ADMIN_FAVORITES_MAX),\n/* harmony export */   FREE_SHIP_THRESHOLD: () => (/* binding */ FREE_SHIP_THRESHOLD),\n/* harmony export */   SHOW_FREE_SHIP_BAR: () => (/* binding */ SHOW_FREE_SHIP_BAR)\n/* harmony export */ });\nconst ADMIN_FAVORITES_MAX = 15;\nconst SHOW_FREE_SHIP_BAR = false;\nconst FREE_SHIP_THRESHOLD = 120;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL2xpYi9jb25zdGFudC5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBTyxNQUFNQSxzQkFBc0IsR0FBRztBQUMvQixNQUFNQyxxQkFBcUIsTUFBTTtBQUNqQyxNQUFNQyxzQkFBc0IsSUFBSSIsInNvdXJjZXMiOlsiL1VzZXJzL2Vtb250YXplcmkvRG9jdW1lbnRzL3Byb2plY3RzL3NoZWxsLXN0b3JpZXMtc3R1ZGlvL2xpYi9jb25zdGFudC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgY29uc3QgQURNSU5fRkFWT1JJVEVTX01BWCA9IDE1O1xuZXhwb3J0IGNvbnN0IFNIT1dfRlJFRV9TSElQX0JBUiA9IGZhbHNlO1xuZXhwb3J0IGNvbnN0IEZSRUVfU0hJUF9USFJFU0hPTEQgPSAxMjA7XG4iXSwibmFtZXMiOlsiQURNSU5fRkFWT1JJVEVTX01BWCIsIlNIT1dfRlJFRV9TSElQX0JBUiIsIkZSRUVfU0hJUF9USFJFU0hPTEQiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api-node)/./lib/constant.js\n");

/***/ }),

/***/ "(api-node)/./lib/db.js":
/*!*******************!*\
  !*** ./lib/db.js ***!
  \*******************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getAllProductIds: () => (/* binding */ getAllProductIds),\n/* harmony export */   getAllProducts: () => (/* binding */ getAllProducts),\n/* harmony export */   getAllProductsForList: () => (/* binding */ getAllProductsForList),\n/* harmony export */   getAllProductsSummary: () => (/* binding */ getAllProductsForList),\n/* harmony export */   getProductById: () => (/* binding */ getProductById),\n/* harmony export */   getProductByIdWithMedia: () => (/* binding */ getProductWithMediaById),\n/* harmony export */   getProductWithMediaById: () => (/* binding */ getProductWithMediaById),\n/* harmony export */   openDB: () => (/* binding */ openDB)\n/* harmony export */ });\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var sqlite__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! sqlite */ \"sqlite\");\n/* harmony import */ var sqlite3__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! sqlite3 */ \"sqlite3\");\n/* harmony import */ var sqlite3__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(sqlite3__WEBPACK_IMPORTED_MODULE_2__);\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([sqlite__WEBPACK_IMPORTED_MODULE_1__]);\nsqlite__WEBPACK_IMPORTED_MODULE_1__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n// lib/db.js\n\n\n\nconst dbPath = path__WEBPACK_IMPORTED_MODULE_0___default().join(process.cwd(), 'data', 'shells_shop.db');\nconst openDB = ()=>(0,sqlite__WEBPACK_IMPORTED_MODULE_1__.open)({\n        filename: dbPath,\n        driver: (sqlite3__WEBPACK_IMPORTED_MODULE_2___default().Database)\n    });\n// --- Existing helpers (kept for compatibility) ---\nasync function getAllProducts() {\n    const db = await openDB();\n    return db.all('SELECT * FROM products');\n}\nasync function getProductById(id) {\n    const db = await openDB();\n    return db.get('SELECT * FROM products WHERE id = ?', id);\n}\n// --- Public detail page helper: product + full media (only active products) ---\nasync function getProductWithMediaById(id) {\n    const db = await openDB();\n    const product = await db.get(`SELECT id, name, description, price, stock, image_url, image_public_id,\n            category, is_active, is_favorite, created_at, updated_at\n       FROM products\n      WHERE id = ? AND is_active = 1`, id);\n    if (!product) return null;\n    const mediaRows = await db.all(`SELECT id, product_id, kind, public_id, secure_url, format,\n            width, height, duration, sort_order, is_primary, created_at\n       FROM product_media\n      WHERE product_id = ?\n      ORDER BY is_primary DESC, sort_order ASC, id ASC`, id);\n    return {\n        ...product,\n        price: Number(product.price),\n        stock: Number.isFinite(Number(product.stock)) ? Number(product.stock) : null,\n        is_active: Number(product.is_active) === 1,\n        is_favorite: Number(product.is_favorite) === 1,\n        media: mediaRows.map((m)=>({\n                id: m.id,\n                kind: m.kind,\n                secure_url: m.secure_url,\n                public_id: m.public_id,\n                format: m.format,\n                width: Number.isFinite(Number(m.width)) ? Number(m.width) : null,\n                height: Number.isFinite(Number(m.height)) ? Number(m.height) : null,\n                duration: Number.isFinite(Number(m.duration)) ? Number(m.duration) : null,\n                sort_order: Number.isFinite(Number(m.sort_order)) ? Number(m.sort_order) : 0,\n                is_primary: Number(m.is_primary) === 1,\n                created_at: m.created_at\n            }))\n    };\n}\n// --- Listing helper for product cards (active only) with primary media fallback ---\nasync function getAllProductsForList() {\n    const db = await openDB();\n    const rows = await db.all(`\n    SELECT\n      p.id, p.name, p.description, p.price, p.stock, p.image_url,\n      p.category, p.is_active, p.is_favorite, p.created_at,\n      pm.secure_url   AS primary_media_url,\n      pm.kind         AS primary_media_kind,\n      pm.public_id    AS primary_media_public_id\n    FROM products p\n    LEFT JOIN product_media pm\n      ON pm.id = (\n        SELECT id FROM product_media\n        WHERE product_id = p.id\n        ORDER BY is_primary DESC, sort_order ASC, id ASC\n        LIMIT 1\n      )\n    WHERE p.is_active = 1\n    ORDER BY p.created_at DESC\n  `);\n    return rows.map((r)=>({\n            id: r.id,\n            name: r.name,\n            description: r.description,\n            price: Number(r.price),\n            stock: Number.isFinite(Number(r.stock)) ? Number(r.stock) : null,\n            category: r.category,\n            is_active: Number(r.is_active) === 1,\n            is_favorite: Number(r.is_favorite) === 1,\n            created_at: r.created_at,\n            // âœ… reliable image for cards & previews:\n            image_url: r.primary_media_url || r.image_url || null,\n            // Optional richer meta (useful for components that prefer explicit primary media):\n            primaryMedia: r.primary_media_url ? {\n                url: r.primary_media_url,\n                kind: r.primary_media_kind,\n                public_id: r.primary_media_public_id\n            } : null\n        }));\n}\n// --- IDs for getStaticPaths (only active products) ---\nasync function getAllProductIds() {\n    const db = await openDB();\n    const rows = await db.all(`SELECT id FROM products WHERE is_active = 1`);\n    return rows.map((r)=>r.id);\n}\n// --- Aliases to keep your existing imports working ---\n\n\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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V0FBVyxNQUFNO1lBQ3ZDYSxZQUFZRyxFQUFFSCxVQUFVO1lBRXhCLHlDQUF5QztZQUN6Q08sV0FBV0osRUFBRUssaUJBQWlCLElBQUlMLEVBQUVJLFNBQVMsSUFBSTtZQUVqRCxtRkFBbUY7WUFDbkZFLGNBQWNOLEVBQUVLLGlCQUFpQixHQUM3QjtnQkFDRUUsS0FBS1AsRUFBRUssaUJBQWlCO2dCQUN4QmpCLE1BQU1ZLEVBQUVRLGtCQUFrQjtnQkFDMUJsQixXQUFXVSxFQUFFUyx1QkFBdUI7WUFDdEMsSUFDQTtRQUNOO0FBQ0Y7QUFFQSx3REFBd0Q7QUFDakQsZUFBZUM7SUFDcEIsTUFBTXZDLEtBQUssTUFBTUw7SUFDakIsTUFBTWlDLE9BQU8sTUFBTTVCLEdBQUdDLEdBQUcsQ0FBQyxDQUFDLDJDQUEyQyxDQUFDO0lBQ3ZFLE9BQU8yQixLQUFLYixHQUFHLENBQUNjLENBQUFBLElBQUtBLEVBQUUxQixFQUFFO0FBQzNCO0FBRUEsd0RBQXdEO0FBQ0U7QUFDSSIsInNvdXJjZXMiOlsiL1VzZXJzL2Vtb250YXplcmkvRG9jdW1lbnRzL3Byb2plY3RzL3NoZWxsLXN0b3JpZXMtc3R1ZGlvL2xpYi9kYi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBsaWIvZGIuanNcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IHsgb3BlbiB9IGZyb20gJ3NxbGl0ZSc7XG5pbXBvcnQgc3FsaXRlMyBmcm9tICdzcWxpdGUzJztcblxuY29uc3QgZGJQYXRoID0gcGF0aC5qb2luKHByb2Nlc3MuY3dkKCksICdkYXRhJywgJ3NoZWxsc19zaG9wLmRiJyk7XG5leHBvcnQgY29uc3Qgb3BlbkRCID0gKCkgPT4gb3Blbih7IGZpbGVuYW1lOiBkYlBhdGgsIGRyaXZlcjogc3FsaXRlMy5EYXRhYmFzZSB9KTtcblxuLy8gLS0tIEV4aXN0aW5nIGhlbHBlcnMgKGtlcHQgZm9yIGNvbXBhdGliaWxpdHkpIC0tLVxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEFsbFByb2R1Y3RzKCkge1xuICBjb25zdCBkYiA9IGF3YWl0IG9wZW5EQigpO1xuICByZXR1cm4gZGIuYWxsKCdTRUxFQ1QgKiBGUk9NIHByb2R1Y3RzJyk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRQcm9kdWN0QnlJZChpZCkge1xuICBjb25zdCBkYiA9IGF3YWl0IG9wZW5EQigpO1xuICByZXR1cm4gZGIuZ2V0KCdTRUxFQ1QgKiBGUk9NIHByb2R1Y3RzIFdIRVJFIGlkID0gPycsIGlkKTtcbn1cblxuLy8gLS0tIFB1YmxpYyBkZXRhaWwgcGFnZSBoZWxwZXI6IHByb2R1Y3QgKyBmdWxsIG1lZGlhIChvbmx5IGFjdGl2ZSBwcm9kdWN0cykgLS0tXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0UHJvZHVjdFdpdGhNZWRpYUJ5SWQoaWQpIHtcbiAgY29uc3QgZGIgPSBhd2FpdCBvcGVuREIoKTtcblxuICBjb25zdCBwcm9kdWN0ID0gYXdhaXQgZGIuZ2V0KFxuICAgIGBTRUxFQ1QgaWQsIG5hbWUsIGRlc2NyaXB0aW9uLCBwcmljZSwgc3RvY2ssIGltYWdlX3VybCwgaW1hZ2VfcHVibGljX2lkLFxuICAgICAgICAgICAgY2F0ZWdvcnksIGlzX2FjdGl2ZSwgaXNfZmF2b3JpdGUsIGNyZWF0ZWRfYXQsIHVwZGF0ZWRfYXRcbiAgICAgICBGUk9NIHByb2R1Y3RzXG4gICAgICBXSEVSRSBpZCA9ID8gQU5EIGlzX2FjdGl2ZSA9IDFgLFxuICAgIGlkXG4gICk7XG4gIGlmICghcHJvZHVjdCkgcmV0dXJuIG51bGw7XG5cbiAgY29uc3QgbWVkaWFSb3dzID0gYXdhaXQgZGIuYWxsKFxuICAgIGBTRUxFQ1QgaWQsIHByb2R1Y3RfaWQsIGtpbmQsIHB1YmxpY19pZCwgc2VjdXJlX3VybCwgZm9ybWF0LFxuICAgICAgICAgICAgd2lkdGgsIGhlaWdodCwgZHVyYXRpb24sIHNvcnRfb3JkZXIsIGlzX3ByaW1hcnksIGNyZWF0ZWRfYXRcbiAgICAgICBGUk9NIHByb2R1Y3RfbWVkaWFcbiAgICAgIFdIRVJFIHByb2R1Y3RfaWQgPSA/XG4gICAgICBPUkRFUiBCWSBpc19wcmltYXJ5IERFU0MsIHNvcnRfb3JkZXIgQVNDLCBpZCBBU0NgLFxuICAgIGlkXG4gICk7XG5cbiAgcmV0dXJuIHtcbiAgICAuLi5wcm9kdWN0LFxuICAgIHByaWNlOiBOdW1iZXIocHJvZHVjdC5wcmljZSksXG4gICAgc3RvY2s6IE51bWJlci5pc0Zpbml0ZShOdW1iZXIocHJvZHVjdC5zdG9jaykpID8gTnVtYmVyKHByb2R1Y3Quc3RvY2spIDogbnVsbCxcbiAgICBpc19hY3RpdmU6IE51bWJlcihwcm9kdWN0LmlzX2FjdGl2ZSkgPT09IDEsXG4gICAgaXNfZmF2b3JpdGU6IE51bWJlcihwcm9kdWN0LmlzX2Zhdm9yaXRlKSA9PT0gMSxcbiAgICBtZWRpYTogbWVkaWFSb3dzLm1hcChtID0+ICh7XG4gICAgICBpZDogbS5pZCxcbiAgICAgIGtpbmQ6IG0ua2luZCwgICAgICAgICAgICAgICAgIC8vIFwiaW1hZ2VcIiB8IFwidmlkZW9cIlxuICAgICAgc2VjdXJlX3VybDogbS5zZWN1cmVfdXJsLFxuICAgICAgcHVibGljX2lkOiBtLnB1YmxpY19pZCxcbiAgICAgIGZvcm1hdDogbS5mb3JtYXQsXG4gICAgICB3aWR0aDogTnVtYmVyLmlzRmluaXRlKE51bWJlcihtLndpZHRoKSkgPyBOdW1iZXIobS53aWR0aCkgOiBudWxsLFxuICAgICAgaGVpZ2h0OiBOdW1iZXIuaXNGaW5pdGUoTnVtYmVyKG0uaGVpZ2h0KSkgPyBOdW1iZXIobS5oZWlnaHQpIDogbnVsbCxcbiAgICAgIGR1cmF0aW9uOiBOdW1iZXIuaXNGaW5pdGUoTnVtYmVyKG0uZHVyYXRpb24pKSA/IE51bWJlcihtLmR1cmF0aW9uKSA6IG51bGwsXG4gICAgICBzb3J0X29yZGVyOiBOdW1iZXIuaXNGaW5pdGUoTnVtYmVyKG0uc29ydF9vcmRlcikpID8gTnVtYmVyKG0uc29ydF9vcmRlcikgOiAwLFxuICAgICAgaXNfcHJpbWFyeTogTnVtYmVyKG0uaXNfcHJpbWFyeSkgPT09IDEsXG4gICAgICBjcmVhdGVkX2F0OiBtLmNyZWF0ZWRfYXQsXG4gICAgfSkpLFxuICB9O1xufVxuXG4vLyAtLS0gTGlzdGluZyBoZWxwZXIgZm9yIHByb2R1Y3QgY2FyZHMgKGFjdGl2ZSBvbmx5KSB3aXRoIHByaW1hcnkgbWVkaWEgZmFsbGJhY2sgLS0tXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0QWxsUHJvZHVjdHNGb3JMaXN0KCkge1xuICBjb25zdCBkYiA9IGF3YWl0IG9wZW5EQigpO1xuXG4gIGNvbnN0IHJvd3MgPSBhd2FpdCBkYi5hbGwoYFxuICAgIFNFTEVDVFxuICAgICAgcC5pZCwgcC5uYW1lLCBwLmRlc2NyaXB0aW9uLCBwLnByaWNlLCBwLnN0b2NrLCBwLmltYWdlX3VybCxcbiAgICAgIHAuY2F0ZWdvcnksIHAuaXNfYWN0aXZlLCBwLmlzX2Zhdm9yaXRlLCBwLmNyZWF0ZWRfYXQsXG4gICAgICBwbS5zZWN1cmVfdXJsICAgQVMgcHJpbWFyeV9tZWRpYV91cmwsXG4gICAgICBwbS5raW5kICAgICAgICAgQVMgcHJpbWFyeV9tZWRpYV9raW5kLFxuICAgICAgcG0ucHVibGljX2lkICAgIEFTIHByaW1hcnlfbWVkaWFfcHVibGljX2lkXG4gICAgRlJPTSBwcm9kdWN0cyBwXG4gICAgTEVGVCBKT0lOIHByb2R1Y3RfbWVkaWEgcG1cbiAgICAgIE9OIHBtLmlkID0gKFxuICAgICAgICBTRUxFQ1QgaWQgRlJPTSBwcm9kdWN0X21lZGlhXG4gICAgICAgIFdIRVJFIHByb2R1Y3RfaWQgPSBwLmlkXG4gICAgICAgIE9SREVSIEJZIGlzX3ByaW1hcnkgREVTQywgc29ydF9vcmRlciBBU0MsIGlkIEFTQ1xuICAgICAgICBMSU1JVCAxXG4gICAgICApXG4gICAgV0hFUkUgcC5pc19hY3RpdmUgPSAxXG4gICAgT1JERVIgQlkgcC5jcmVhdGVkX2F0IERFU0NcbiAgYCk7XG5cbiAgcmV0dXJuIHJvd3MubWFwKHIgPT4gKHtcbiAgICBpZDogci5pZCxcbiAgICBuYW1lOiByLm5hbWUsXG4gICAgZGVzY3JpcHRpb246IHIuZGVzY3JpcHRpb24sXG4gICAgcHJpY2U6IE51bWJlcihyLnByaWNlKSxcbiAgICBzdG9jazogTnVtYmVyLmlzRmluaXRlKE51bWJlcihyLnN0b2NrKSkgPyBOdW1iZXIoci5zdG9jaykgOiBudWxsLFxuICAgIGNhdGVnb3J5OiByLmNhdGVnb3J5LFxuICAgIGlzX2FjdGl2ZTogTnVtYmVyKHIuaXNfYWN0aXZlKSA9PT0gMSxcbiAgICBpc19mYXZvcml0ZTogTnVtYmVyKHIuaXNfZmF2b3JpdGUpID09PSAxLFxuICAgIGNyZWF0ZWRfYXQ6IHIuY3JlYXRlZF9hdCxcblxuICAgIC8vIOKchSByZWxpYWJsZSBpbWFnZSBmb3IgY2FyZHMgJiBwcmV2aWV3czpcbiAgICBpbWFnZV91cmw6IHIucHJpbWFyeV9tZWRpYV91cmwgfHwgci5pbWFnZV91cmwgfHwgbnVsbCxcblxuICAgIC8vIE9wdGlvbmFsIHJpY2hlciBtZXRhICh1c2VmdWwgZm9yIGNvbXBvbmVudHMgdGhhdCBwcmVmZXIgZXhwbGljaXQgcHJpbWFyeSBtZWRpYSk6XG4gICAgcHJpbWFyeU1lZGlhOiByLnByaW1hcnlfbWVkaWFfdXJsXG4gICAgICA/IHtcbiAgICAgICAgICB1cmw6IHIucHJpbWFyeV9tZWRpYV91cmwsXG4gICAgICAgICAga2luZDogci5wcmltYXJ5X21lZGlhX2tpbmQsICAgICAgICAgICAgLy8gXCJpbWFnZVwiIHwgXCJ2aWRlb1wiXG4gICAgICAgICAgcHVibGljX2lkOiByLnByaW1hcnlfbWVkaWFfcHVibGljX2lkLFxuICAgICAgICB9XG4gICAgICA6IG51bGwsXG4gIH0pKTtcbn1cblxuLy8gLS0tIElEcyBmb3IgZ2V0U3RhdGljUGF0aHMgKG9ubHkgYWN0aXZlIHByb2R1Y3RzKSAtLS1cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBbGxQcm9kdWN0SWRzKCkge1xuICBjb25zdCBkYiA9IGF3YWl0IG9wZW5EQigpO1xuICBjb25zdCByb3dzID0gYXdhaXQgZGIuYWxsKGBTRUxFQ1QgaWQgRlJPTSBwcm9kdWN0cyBXSEVSRSBpc19hY3RpdmUgPSAxYCk7XG4gIHJldHVybiByb3dzLm1hcChyID0+IHIuaWQpO1xufVxuXG4vLyAtLS0gQWxpYXNlcyB0byBrZWVwIHlvdXIgZXhpc3RpbmcgaW1wb3J0cyB3b3JraW5nIC0tLVxuZXhwb3J0IHsgZ2V0QWxsUHJvZHVjdHNGb3JMaXN0IGFzIGdldEFsbFByb2R1Y3RzU3VtbWFyeSB9O1xuZXhwb3J0IHsgZ2V0UHJvZHVjdFdpdGhNZWRpYUJ5SWQgYXMgZ2V0UHJvZHVjdEJ5SWRXaXRoTWVkaWEgfTtcblxuXG4iXSwibmFtZXMiOlsicGF0aCIsIm9wZW4iLCJzcWxpdGUzIiwiZGJQYXRoIiwiam9pbiIsInByb2Nlc3MiLCJjd2QiLCJvcGVuREIiLCJmaWxlbmFtZSIsImRyaXZlciIsIkRhdGFiYXNlIiwiZ2V0QWxsUHJvZHVjdHMiLCJkYiIsImFsbCIsImdldFByb2R1Y3RCeUlkIiwiaWQiLCJnZXQiLCJnZXRQcm9kdWN0V2l0aE1lZGlhQnlJZCIsInByb2R1Y3QiLCJtZWRpYVJvd3MiLCJwcmljZSIsIk51bWJlciIsInN0b2NrIiwiaXNGaW5pdGUiLCJpc19hY3RpdmUiLCJpc19mYXZvcml0ZSIsIm1lZGlhIiwibWFwIiwibSIsImtpbmQiLCJzZWN1cmVfdXJsIiwicHVibGljX2lkIiwiZm9ybWF0Iiwid2lkdGgiLCJoZWlnaHQiLCJkdXJhdGlvbiIsInNvcnRfb3JkZXIiLCJpc19wcmltYXJ5IiwiY3JlYXRlZF9hdCIsImdldEFsbFByb2R1Y3RzRm9yTGlzdCIsInJvd3MiLCJyIiwibmFtZSIsImRlc2NyaXB0aW9uIiwiY2F0ZWdvcnkiLCJpbWFnZV91cmwiLCJwcmltYXJ5X21lZGlhX3VybCIsInByaW1hcnlNZWRpYSIsInVybCIsInByaW1hcnlfbWVkaWFfa2luZCIsInByaW1hcnlfbWVkaWFfcHVibGljX2lkIiwiZ2V0QWxsUHJvZHVjdElkcyIsImdldEFsbFByb2R1Y3RzU3VtbWFyeSIsImdldFByb2R1Y3RCeUlkV2l0aE1lZGlhIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api-node)/./lib/db.js\n");

/***/ }),

/***/ "(api-node)/./lib/middleware/createAdminHandler.js":
/*!**********************************************!*\
  !*** ./lib/middleware/createAdminHandler.js ***!
  \**********************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createAdminHandler: () => (/* binding */ createAdminHandler)\n/* harmony export */ });\n/* harmony import */ var next_connect__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next-connect */ \"next-connect\");\n/* harmony import */ var _lib_auth_authorizeAdmin__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/auth/authorizeAdmin */ \"(api-node)/./lib/auth/authorizeAdmin.js\");\n/* harmony import */ var _lib_middleware_rateLimiter__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/middleware/rateLimiter */ \"(api-node)/./lib/middleware/rateLimiter.js\");\n/* harmony import */ var _requestId__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./requestId */ \"(api-node)/./lib/middleware/requestId.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([next_connect__WEBPACK_IMPORTED_MODULE_0__]);\nnext_connect__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n// lib/middleware/createAdminHandler.js\n\n\n\n\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n// Helper utilities\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nconst isObj = (v)=>v && typeof v === 'object';\nconst toInt = (v, d)=>{\n    const n = Number(v);\n    return Number.isFinite(n) && n >= 0 ? Math.trunc(n) : d;\n};\n// Wrap rate limiter into safe Express middleware form\nfunction wrapRateLimiter(rateLimiterFn, rateLimitOpts) {\n    return async (req, res, next)=>{\n        const rid = req.rid || '-';\n        const t0 = Date.now();\n        console.log('[admin]', rid, 'mw:rateLimiter ENTER', {\n            limit: rateLimitOpts?.limit,\n            window: rateLimitOpts?.window\n        });\n        try {\n            let passed = false;\n            await new Promise((resolve)=>{\n                // signature: (req, res, next, options)\n                rateLimiterFn(req, res, ()=>{\n                    passed = true;\n                    resolve(true);\n                }, rateLimitOpts);\n            });\n            if (res.headersSent) {\n                console.log('[admin]', rid, 'mw:rateLimiter RESPONDED (e.g., 429) in', Date.now() - t0, 'ms');\n                return; // short-circuited by limiter\n            }\n            if (passed) {\n                console.log('[admin]', rid, 'mw:rateLimiter PASS in', Date.now() - t0, 'ms');\n                return next();\n            }\n            // Defensive: continue even if no signal\n            console.warn('[admin]', rid, 'mw:rateLimiter NO-SIGNAL â†’ allowing through in', Date.now() - t0, 'ms');\n            return next();\n        } catch (e) {\n            console.error('[admin]', rid, 'mw:rateLimiter ERROR', e?.message || e);\n            if (!res.headersSent) res.status(429).json({\n                error: 'Rate limit error'\n            });\n        }\n    };\n}\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n// Main factory function\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nfunction createAdminHandler(options = {}) {\n    // Normalize options\n    const rawRL = isObj(options.rateLimit) ? options.rateLimit : {};\n    const rateLimit = {\n        limit: toInt(rawRL.limit, 60),\n        window: toInt(rawRL.window, 60)\n    };\n    // Global error handler\n    const onError = options.onError || ((err, req, res)=>{\n        const rid = req?.rid || '-';\n        const status = Number(err?.statusCode ?? err?.status ?? 500) || 500;\n        const message = typeof err?.message === 'string' && err.message || 'Internal Server Error';\n        if (!res.headersSent) {\n            res.setHeader('Content-Type', 'application/json; charset=utf-8');\n            res.setHeader('Cache-Control', 'no-store');\n        }\n        console.error('âŒ Admin API Error [rid=' + rid + ']:', message, '| detail:', err);\n        res.status(status).json({\n            error: message\n        });\n    });\n    // â€œNo matchâ€ handler\n    const onNoMatch = options.onNoMatch || ((req, res)=>{\n        const rid = req?.rid || '-';\n        console.warn('[admin]', rid, 'onNoMatch', req.method, req.url);\n        res.status(405).json({\n            error: `Method ${req.method} not allowed`\n        });\n    });\n    // Create next-connect handler\n    const handler = (0,next_connect__WEBPACK_IMPORTED_MODULE_0__[\"default\"])({\n        onError,\n        onNoMatch\n    });\n    // Add unique Request ID (FIRST)\n    handler.use({\n        \"createAdminHandler.use\": (req, res, next)=>{\n            const t0 = Date.now();\n            (0,_requestId__WEBPACK_IMPORTED_MODULE_3__.withRequestId)(req, res, {\n                \"createAdminHandler.use\": ()=>{\n                    req._adminStart = t0;\n                    console.log('[admin]', req.rid, 'mw:requestId SET');\n                    next();\n                }\n            }[\"createAdminHandler.use\"]);\n        }\n    }[\"createAdminHandler.use\"]);\n    // Dev logger\n    if (true) {\n        handler.use({\n            \"createAdminHandler.use\": (req, _res, next)=>{\n                const method = String(req.method || '').toUpperCase();\n                if (!req.url?.startsWith('/_next')) {\n                    console.log(`[admin] ${method} ${req.url} [rid=${req.rid}] ENTER`);\n                }\n                next();\n            }\n        }[\"createAdminHandler.use\"]);\n    }\n    // Preflight (OPTIONS)\n    handler.use({\n        \"createAdminHandler.use\": (req, res, next)=>{\n            const rid = req.rid || '-';\n            if (req.method === 'OPTIONS') {\n                res.setHeader('Allow', 'GET,POST,PUT,PATCH,DELETE,OPTIONS');\n                console.log('[admin]', rid, 'mw:preflight 204');\n                return res.status(204).end();\n            }\n            console.log('[admin]', rid, 'mw:preflight SKIP');\n            next();\n        }\n    }[\"createAdminHandler.use\"]);\n    // Default JSON headers\n    handler.use({\n        \"createAdminHandler.use\": (req, res, next)=>{\n            const rid = req.rid || '-';\n            if (!res.getHeader('Content-Type')) {\n                res.setHeader('Content-Type', 'application/json; charset=utf-8');\n            }\n            res.setHeader('Cache-Control', 'no-store');\n            res.setHeader('Vary', 'X-Requested-With');\n            console.log('[admin]', rid, 'mw:headers SET');\n            next();\n        }\n    }[\"createAdminHandler.use\"]);\n    // Rate limiting (skip safe methods; normalize method casing defensively)\n    handler.use({\n        \"createAdminHandler.use\": (req, res, next)=>{\n            const rid = req.rid || '-';\n            const method = String(req.method || '').toUpperCase();\n            if (method === 'GET' || method === 'HEAD' || method === 'OPTIONS') {\n                console.log('[admin]', rid, 'mw:rateLimiter SKIP for', method);\n                return next();\n            }\n            console.log('[admin]', rid, 'mw:rateLimiter APPLY for', method);\n            return wrapRateLimiter(_lib_middleware_rateLimiter__WEBPACK_IMPORTED_MODULE_2__.rateLimiter, rateLimit)(req, res, next);\n        }\n    }[\"createAdminHandler.use\"]);\n    // Authorization guard\n    handler.use({\n        \"createAdminHandler.use\": async (req, res, next)=>{\n            const rid = req.rid || '-';\n            const t0 = Date.now();\n            console.log('[admin]', rid, 'mw:authorize START');\n            try {\n                await (0,_lib_auth_authorizeAdmin__WEBPACK_IMPORTED_MODULE_1__.authorizeAdmin)()(req, res, {\n                    \"createAdminHandler.use\": async ()=>{\n                        console.log('[admin]', rid, 'mw:authorize OK in', Date.now() - t0, 'ms');\n                        next();\n                    }\n                }[\"createAdminHandler.use\"]);\n            } catch (err) {\n                console.log('[admin]', rid, 'mw:authorize ERROR in', Date.now() - t0, 'ms', err?.message || err);\n                const status = Number(err?.status ?? 401) || 401;\n                if (!res.headersSent) {\n                    return res.status(status).json({\n                        error: err?.message || 'Unauthorized'\n                    });\n                }\n            }\n        }\n    }[\"createAdminHandler.use\"]);\n    // Final lifecycle footer (only runs if a route handler calls res.end/json)\n    handler.use({\n        \"createAdminHandler.use\": (req, _res, next)=>{\n            const rid = req.rid || '-';\n            const started = req._adminStart || Date.now();\n            console.log('[admin]', rid, 'mw:chain CONTINUE (route next) chainMs=', Date.now() - started);\n            next();\n        }\n    }[\"createAdminHandler.use\"]);\n    return handler;\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL2xpYi9taWRkbGV3YXJlL2NyZWF0ZUFkbWluSGFuZGxlci5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFBLHVDQUF1QztBQUNUO0FBQzZCO0FBQ0E7QUFDZjtBQUU1QyxnREFBZ0Q7QUFDaEQsbUJBQW1CO0FBQ25CLGdEQUFnRDtBQUNoRCxNQUFNSSxRQUFRLENBQUNDLElBQU1BLEtBQUssT0FBT0EsTUFBTTtBQUN2QyxNQUFNQyxRQUFRLENBQUNELEdBQUdFO0lBQ2hCLE1BQU1DLElBQUlDLE9BQU9KO0lBQ2pCLE9BQU9JLE9BQU9DLFFBQVEsQ0FBQ0YsTUFBTUEsS0FBSyxJQUFJRyxLQUFLQyxLQUFLLENBQUNKLEtBQUtEO0FBQ3hEO0FBRUEsc0RBQXNEO0FBQ3RELFNBQVNNLGdCQUFnQkMsYUFBYSxFQUFFQyxhQUFhO0lBQ25ELE9BQU8sT0FBT0MsS0FBS0MsS0FBS0M7UUFDdEIsTUFBTUMsTUFBTUgsSUFBSUcsR0FBRyxJQUFJO1FBQ3ZCLE1BQU1DLEtBQUtDLEtBQUtDLEdBQUc7UUFDbkJDLFFBQVFDLEdBQUcsQ0FBQyxXQUFXTCxLQUFLLHdCQUF3QjtZQUFFTSxPQUFPVixlQUFlVTtZQUFPQyxRQUFRWCxlQUFlVztRQUFPO1FBRWpILElBQUk7WUFDRixJQUFJQyxTQUFTO1lBQ2IsTUFBTSxJQUFJQyxRQUFRLENBQUNDO2dCQUNqQix1Q0FBdUM7Z0JBQ3ZDZixjQUFjRSxLQUFLQyxLQUFLO29CQUN0QlUsU0FBUztvQkFDVEUsUUFBUTtnQkFDVixHQUFHZDtZQUNMO1lBRUEsSUFBSUUsSUFBSWEsV0FBVyxFQUFFO2dCQUNuQlAsUUFBUUMsR0FBRyxDQUFDLFdBQVdMLEtBQUssMkNBQTJDRSxLQUFLQyxHQUFHLEtBQUtGLElBQUk7Z0JBQ3hGLFFBQVEsNkJBQTZCO1lBQ3ZDO1lBRUEsSUFBSU8sUUFBUTtnQkFDVkosUUFBUUMsR0FBRyxDQUFDLFdBQVdMLEtBQUssMEJBQTBCRSxLQUFLQyxHQUFHLEtBQUtGLElBQUk7Z0JBQ3ZF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QUFXeEIsS0FBS0MsS0FBS0M7UUFDM0Q7O0lBRUEsc0JBQXNCO0lBQ3RCOEIsUUFBUUMsR0FBRztrQ0FBQyxPQUFPakMsS0FBS0MsS0FBS0M7WUFDM0IsTUFBTUMsTUFBTUgsSUFBSUcsR0FBRyxJQUFJO1lBQ3ZCLE1BQU1DLEtBQUtDLEtBQUtDLEdBQUc7WUFDbkJDLFFBQVFDLEdBQUcsQ0FBQyxXQUFXTCxLQUFLO1lBRTVCLElBQUk7Z0JBQ0YsTUFBTWxCLHdFQUFjQSxHQUFHZSxLQUFLQzs4Q0FBSzt3QkFDL0JNLFFBQVFDLEdBQUcsQ0FBQyxXQUFXTCxLQUFLLHNCQUFzQkUsS0FBS0MsR0FBRyxLQUFLRixJQUFJO3dCQUNuRUY7b0JBQ0Y7O1lBQ0YsRUFBRSxPQUFPd0IsS0FBSztnQkFDWm5CLFFBQVFDLEdBQUcsQ0FBQyxXQUFXTCxLQUFLLHlCQUF5QkUsS0FBS0MsR0FBRyxLQUFLRixJQUFJLE1BQU1zQixLQUFLUixXQUFXUTtnQkFDNUYsTUFBTVAsU0FBUzFCLE9BQU9pQyxLQUFLUCxVQUFVLFFBQVE7Z0JBQzdDLElBQUksQ0FBQ2xCLElBQUlhLFdBQVcsRUFBRTtvQkFDcEIsT0FBT2IsSUFBSWtCLE1BQU0sQ0FBQ0EsUUFBUUMsSUFBSSxDQUFDO3dCQUFFSCxPQUFPUyxLQUFLUixXQUFXO29CQUFlO2dCQUN6RTtZQUNGO1FBQ0Y7O0lBRUEsMkVBQTJFO0lBQzNFYyxRQUFRQyxHQUFHO2tDQUFDLENBQUNqQyxLQUFLb0MsTUFBTWxDO1lBQ3RCLE1BQU1DLE1BQU1ILElBQUlHLEdBQUcsSUFBSTtZQUN2QixNQUFNdUMsVUFBVTFDLElBQUlrQyxXQUFXLElBQUk3QixLQUFLQyxHQUFHO1lBQzNDQyxRQUFRQyxHQUFHLENBQUMsV0FBV0wsS0FBSywyQ0FBMkNFLEtBQUtDLEdBQUcsS0FBS29DO1lBQ3BGeEM7UUFDRjs7SUFFQSxPQUFPOEI7QUFDVCIsInNvdXJjZXMiOlsiL1VzZXJzL2Vtb250YXplcmkvRG9jdW1lbnRzL3Byb2plY3RzL3NoZWxsLXN0b3JpZXMtc3R1ZGlvL2xpYi9taWRkbGV3YXJlL2NyZWF0ZUFkbWluSGFuZGxlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBsaWIvbWlkZGxld2FyZS9jcmVhdGVBZG1pbkhhbmRsZXIuanNcbmltcG9ydCBuYyBmcm9tICduZXh0LWNvbm5lY3QnO1xuaW1wb3J0IHsgYXV0aG9yaXplQWRtaW4gfSBmcm9tICdAL2xpYi9hdXRoL2F1dGhvcml6ZUFkbWluJztcbmltcG9ydCB7IHJhdGVMaW1pdGVyIH0gZnJvbSAnQC9saWIvbWlkZGxld2FyZS9yYXRlTGltaXRlcic7XG5pbXBvcnQgeyB3aXRoUmVxdWVzdElkIH0gZnJvbSAnLi9yZXF1ZXN0SWQnO1xuXG4vLyDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcbi8vIEhlbHBlciB1dGlsaXRpZXNcbi8vIOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFxuY29uc3QgaXNPYmogPSAodikgPT4gdiAmJiB0eXBlb2YgdiA9PT0gJ29iamVjdCc7XG5jb25zdCB0b0ludCA9ICh2LCBkKSA9PiB7XG4gIGNvbnN0IG4gPSBOdW1iZXIodik7XG4gIHJldHVybiBOdW1iZXIuaXNGaW5pdGUobikgJiYgbiA+PSAwID8gTWF0aC50cnVuYyhuKSA6IGQ7XG59O1xuXG4vLyBXcmFwIHJhdGUgbGltaXRlciBpbnRvIHNhZmUgRXhwcmVzcyBtaWRkbGV3YXJlIGZvcm1cbmZ1bmN0aW9uIHdyYXBSYXRlTGltaXRlcihyYXRlTGltaXRlckZuLCByYXRlTGltaXRPcHRzKSB7XG4gIHJldHVybiBhc3luYyAocmVxLCByZXMsIG5leHQpID0+IHtcbiAgICBjb25zdCByaWQgPSByZXEucmlkIHx8ICctJztcbiAgICBjb25zdCB0MCA9IERhdGUubm93KCk7XG4gICAgY29uc29sZS5sb2coJ1thZG1pbl0nLCByaWQsICdtdzpyYXRlTGltaXRlciBFTlRFUicsIHsgbGltaXQ6IHJhdGVMaW1pdE9wdHM/LmxpbWl0LCB3aW5kb3c6IHJhdGVMaW1pdE9wdHM/LndpbmRvdyB9KTtcblxuICAgIHRyeSB7XG4gICAgICBsZXQgcGFzc2VkID0gZmFsc2U7XG4gICAgICBhd2FpdCBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAgICAgICAvLyBzaWduYXR1cmU6IChyZXEsIHJlcywgbmV4dCwgb3B0aW9ucylcbiAgICAgICAgcmF0ZUxpbWl0ZXJGbihyZXEsIHJlcywgKCkgPT4ge1xuICAgICAgICAgIHBhc3NlZCA9IHRydWU7XG4gICAgICAgICAgcmVzb2x2ZSh0cnVlKTtcbiAgICAgICAgfSwgcmF0ZUxpbWl0T3B0cyk7XG4gICAgICB9KTtcblxuICAgICAgaWYgKHJlcy5oZWFkZXJzU2VudCkge1xuICAgICAgICBjb25zb2xlLmxvZygnW2FkbWluXScsIHJpZCwgJ213OnJhdGVMaW1pdGVyIFJFU1BPTkRFRCAoZS5nLiwgNDI5KSBpbicsIERhdGUubm93KCkgLSB0MCwgJ21zJyk7XG4gICAgICAgIHJldHVybjsgLy8gc2hvcnQtY2lyY3VpdGVkIGJ5IGxpbWl0ZXJcbiAgICAgIH1cblxuICAgICAgaWYgKHBhc3NlZCkge1xuICAgICAgICBjb25zb2xlLmxvZygnW2FkbWluXScsIHJpZCwgJ213OnJhdGVMaW1pdGVyIFBBU1MgaW4nLCBEYXRlLm5vdygpIC0gdDAsICdtcycpO1xuICAgICAgICByZXR1cm4gbmV4dCgpO1xuICAgICAgfVxuXG4gICAgICAvLyBEZWZlbnNpdmU6IGNvbnRpbnVlIGV2ZW4gaWYgbm8gc2lnbmFsXG4gICAgICBjb25zb2xlLndhcm4oJ1thZG1pbl0nLCByaWQsICdtdzpyYXRlTGltaXRlciBOTy1TSUdOQUwg4oaSIGFsbG93aW5nIHRocm91Z2ggaW4nLCBEYXRlLm5vdygpIC0gdDAsICdtcycpO1xuICAgICAgcmV0dXJuIG5leHQoKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdbYWRtaW5dJywgcmlkLCAnbXc6cmF0ZUxpbWl0ZXIgRVJST1InLCBlPy5tZXNzYWdlIHx8IGUpO1xuICAgICAgaWYgKCFyZXMuaGVhZGVyc1NlbnQpIHJlcy5zdGF0dXMoNDI5KS5qc29uKHsgZXJyb3I6ICdSYXRlIGxpbWl0IGVycm9yJyB9KTtcbiAgICB9XG4gIH07XG59XG5cbi8vIOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFxuLy8gTWFpbiBmYWN0b3J5IGZ1bmN0aW9uXG4vLyDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVBZG1pbkhhbmRsZXIob3B0aW9ucyA9IHt9KSB7XG4gIC8vIE5vcm1hbGl6ZSBvcHRpb25zXG4gIGNvbnN0IHJhd1JMID0gaXNPYmoob3B0aW9ucy5yYXRlTGltaXQpID8gb3B0aW9ucy5yYXRlTGltaXQgOiB7fTtcbiAgY29uc3QgcmF0ZUxpbWl0ID0ge1xuICAgIGxpbWl0OiB0b0ludChyYXdSTC5saW1pdCwgNjApLFxuICAgIHdpbmRvdzogdG9JbnQocmF3Ukwud2luZG93LCA2MCksXG4gIH07XG5cbiAgLy8gR2xvYmFsIGVycm9yIGhhbmRsZXJcbiAgY29uc3Qgb25FcnJvciA9XG4gICAgb3B0aW9ucy5vbkVycm9yIHx8XG4gICAgKChlcnIsIHJlcSwgcmVzKSA9PiB7XG4gICAgICBjb25zdCByaWQgPSByZXE/LnJpZCB8fCAnLSc7XG4gICAgICBjb25zdCBzdGF0dXMgPSBOdW1iZXIoZXJyPy5zdGF0dXNDb2RlID8/IGVycj8uc3RhdHVzID8/IDUwMCkgfHwgNTAwO1xuICAgICAgY29uc3QgbWVzc2FnZSA9XG4gICAgICAgICh0eXBlb2YgZXJyPy5tZXNzYWdlID09PSAnc3RyaW5nJyAmJiBlcnIubWVzc2FnZSkgfHxcbiAgICAgICAgJ0ludGVybmFsIFNlcnZlciBFcnJvcic7XG5cbiAgICAgIGlmICghcmVzLmhlYWRlcnNTZW50KSB7XG4gICAgICAgIHJlcy5zZXRIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uOyBjaGFyc2V0PXV0Zi04Jyk7XG4gICAgICAgIHJlcy5zZXRIZWFkZXIoJ0NhY2hlLUNvbnRyb2wnLCAnbm8tc3RvcmUnKTtcbiAgICAgIH1cblxuICAgICAgY29uc29sZS5lcnJvcign4p2MIEFkbWluIEFQSSBFcnJvciBbcmlkPScgKyByaWQgKyAnXTonLCBtZXNzYWdlLCAnfCBkZXRhaWw6JywgZXJyKTtcbiAgICAgIHJlcy5zdGF0dXMoc3RhdHVzKS5qc29uKHsgZXJyb3I6IG1lc3NhZ2UgfSk7XG4gICAgfSk7XG5cbiAgLy8g4oCcTm8gbWF0Y2jigJ0gaGFuZGxlclxuICBjb25zdCBvbk5vTWF0Y2ggPVxuICAgIG9wdGlvbnMub25Ob01hdGNoIHx8XG4gICAgKChyZXEsIHJlcykgPT4ge1xuICAgICAgY29uc3QgcmlkID0gcmVxPy5yaWQgfHwgJy0nO1xuICAgICAgY29uc29sZS53YXJuKCdbYWRtaW5dJywgcmlkLCAnb25Ob01hdGNoJywgcmVxLm1ldGhvZCwgcmVxLnVybCk7XG4gICAgICByZXMuc3RhdHVzKDQwNSkuanNvbih7IGVycm9yOiBgTWV0aG9kICR7cmVxLm1ldGhvZH0gbm90IGFsbG93ZWRgIH0pO1xuICAgIH0pO1xuXG4gIC8vIENyZWF0ZSBuZXh0LWNvbm5lY3QgaGFuZGxlclxuICBjb25zdCBoYW5kbGVyID0gbmMoeyBvbkVycm9yLCBvbk5vTWF0Y2ggfSk7XG5cbiAgLy8gQWRkIHVuaXF1ZSBSZXF1ZXN0IElEIChGSVJTVClcbiAgaGFuZGxlci51c2UoKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gICAgY29uc3QgdDAgPSBEYXRlLm5vdygpO1xuICAgIHdpdGhSZXF1ZXN0SWQocmVxLCByZXMsICgpID0+IHtcbiAgICAgIHJlcS5fYWRtaW5TdGFydCA9IHQwO1xuICAgICAgY29uc29sZS5sb2coJ1thZG1pbl0nLCByZXEucmlkLCAnbXc6cmVxdWVzdElkIFNFVCcpO1xuICAgICAgbmV4dCgpO1xuICAgIH0pO1xuICB9KTtcblxuICAvLyBEZXYgbG9nZ2VyXG4gIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7XG4gICAgaGFuZGxlci51c2UoKHJlcSwgX3JlcywgbmV4dCkgPT4ge1xuICAgICAgY29uc3QgbWV0aG9kID0gU3RyaW5nKHJlcS5tZXRob2QgfHwgJycpLnRvVXBwZXJDYXNlKCk7XG4gICAgICBpZiAoIXJlcS51cmw/LnN0YXJ0c1dpdGgoJy9fbmV4dCcpKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGBbYWRtaW5dICR7bWV0aG9kfSAke3JlcS51cmx9IFtyaWQ9JHtyZXEucmlkfV0gRU5URVJgKTtcbiAgICAgIH1cbiAgICAgIG5leHQoKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8vIFByZWZsaWdodCAoT1BUSU9OUylcbiAgaGFuZGxlci51c2UoKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gICAgY29uc3QgcmlkID0gcmVxLnJpZCB8fCAnLSc7XG4gICAgaWYgKHJlcS5tZXRob2QgPT09ICdPUFRJT05TJykge1xuICAgICAgcmVzLnNldEhlYWRlcignQWxsb3cnLCAnR0VULFBPU1QsUFVULFBBVENILERFTEVURSxPUFRJT05TJyk7XG4gICAgICBjb25zb2xlLmxvZygnW2FkbWluXScsIHJpZCwgJ213OnByZWZsaWdodCAyMDQnKTtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwNCkuZW5kKCk7XG4gICAgfVxuICAgIGNvbnNvbGUubG9nKCdbYWRtaW5dJywgcmlkLCAnbXc6cHJlZmxpZ2h0IFNLSVAnKTtcbiAgICBuZXh0KCk7XG4gIH0pO1xuXG4gIC8vIERlZmF1bHQgSlNPTiBoZWFkZXJzXG4gIGhhbmRsZXIudXNlKChyZXEsIHJlcywgbmV4dCkgPT4ge1xuICAgIGNvbnN0IHJpZCA9IHJlcS5yaWQgfHwgJy0nO1xuICAgIGlmICghcmVzLmdldEhlYWRlcignQ29udGVudC1UeXBlJykpIHtcbiAgICAgIHJlcy5zZXRIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uOyBjaGFyc2V0PXV0Zi04Jyk7XG4gICAgfVxuICAgIHJlcy5zZXRIZWFkZXIoJ0NhY2hlLUNvbnRyb2wnLCAnbm8tc3RvcmUnKTtcbiAgICByZXMuc2V0SGVhZGVyKCdWYXJ5JywgJ1gtUmVxdWVzdGVkLVdpdGgnKTtcbiAgICBjb25zb2xlLmxvZygnW2FkbWluXScsIHJpZCwgJ213OmhlYWRlcnMgU0VUJyk7XG4gICAgbmV4dCgpO1xuICB9KTtcblxuICAvLyBSYXRlIGxpbWl0aW5nIChza2lwIHNhZmUgbWV0aG9kczsgbm9ybWFsaXplIG1ldGhvZCBjYXNpbmcgZGVmZW5zaXZlbHkpXG4gIGhhbmRsZXIudXNlKChyZXEsIHJlcywgbmV4dCkgPT4ge1xuICAgIGNvbnN0IHJpZCA9IHJlcS5yaWQgfHwgJy0nO1xuICAgIGNvbnN0IG1ldGhvZCA9IFN0cmluZyhyZXEubWV0aG9kIHx8ICcnKS50b1VwcGVyQ2FzZSgpO1xuXG4gICAgaWYgKG1ldGhvZCA9PT0gJ0dFVCcgfHwgbWV0aG9kID09PSAnSEVBRCcgfHwgbWV0aG9kID09PSAnT1BUSU9OUycpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdbYWRtaW5dJywgcmlkLCAnbXc6cmF0ZUxpbWl0ZXIgU0tJUCBmb3InLCBtZXRob2QpO1xuICAgICAgcmV0dXJuIG5leHQoKTtcbiAgICB9XG5cbiAgICBjb25zb2xlLmxvZygnW2FkbWluXScsIHJpZCwgJ213OnJhdGVMaW1pdGVyIEFQUExZIGZvcicsIG1ldGhvZCk7XG4gICAgcmV0dXJuIHdyYXBSYXRlTGltaXRlcihyYXRlTGltaXRlciwgcmF0ZUxpbWl0KShyZXEsIHJlcywgbmV4dCk7XG4gIH0pO1xuXG4gIC8vIEF1dGhvcml6YXRpb24gZ3VhcmRcbiAgaGFuZGxlci51c2UoYXN5bmMgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gICAgY29uc3QgcmlkID0gcmVxLnJpZCB8fCAnLSc7XG4gICAgY29uc3QgdDAgPSBEYXRlLm5vdygpO1xuICAgIGNvbnNvbGUubG9nKCdbYWRtaW5dJywgcmlkLCAnbXc6YXV0aG9yaXplIFNUQVJUJyk7XG5cbiAgICB0cnkge1xuICAgICAgYXdhaXQgYXV0aG9yaXplQWRtaW4oKShyZXEsIHJlcywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZygnW2FkbWluXScsIHJpZCwgJ213OmF1dGhvcml6ZSBPSyBpbicsIERhdGUubm93KCkgLSB0MCwgJ21zJyk7XG4gICAgICAgIG5leHQoKTtcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgY29uc29sZS5sb2coJ1thZG1pbl0nLCByaWQsICdtdzphdXRob3JpemUgRVJST1IgaW4nLCBEYXRlLm5vdygpIC0gdDAsICdtcycsIGVycj8ubWVzc2FnZSB8fCBlcnIpO1xuICAgICAgY29uc3Qgc3RhdHVzID0gTnVtYmVyKGVycj8uc3RhdHVzID8/IDQwMSkgfHwgNDAxO1xuICAgICAgaWYgKCFyZXMuaGVhZGVyc1NlbnQpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoc3RhdHVzKS5qc29uKHsgZXJyb3I6IGVycj8ubWVzc2FnZSB8fCAnVW5hdXRob3JpemVkJyB9KTtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuXG4gIC8vIEZpbmFsIGxpZmVjeWNsZSBmb290ZXIgKG9ubHkgcnVucyBpZiBhIHJvdXRlIGhhbmRsZXIgY2FsbHMgcmVzLmVuZC9qc29uKVxuICBoYW5kbGVyLnVzZSgocmVxLCBfcmVzLCBuZXh0KSA9PiB7XG4gICAgY29uc3QgcmlkID0gcmVxLnJpZCB8fCAnLSc7XG4gICAgY29uc3Qgc3RhcnRlZCA9IHJlcS5fYWRtaW5TdGFydCB8fCBEYXRlLm5vdygpO1xuICAgIGNvbnNvbGUubG9nKCdbYWRtaW5dJywgcmlkLCAnbXc6Y2hhaW4gQ09OVElOVUUgKHJvdXRlIG5leHQpIGNoYWluTXM9JywgRGF0ZS5ub3coKSAtIHN0YXJ0ZWQpO1xuICAgIG5leHQoKTtcbiAgfSk7XG5cbiAgcmV0dXJuIGhhbmRsZXI7XG59XG5cblxuXG4iXSwibmFtZXMiOlsibmMiLCJhdXRob3JpemVBZG1pbiIsInJhdGVMaW1pdGVyIiwid2l0aFJlcXVlc3RJZCIsImlzT2JqIiwidiIsInRvSW50IiwiZCIsIm4iLCJOdW1iZXIiLCJpc0Zpbml0ZSIsIk1hdGgiLCJ0cnVuYyIsIndyYXBSYXRlTGltaXRlciIsInJhdGVMaW1pdGVyRm4iLCJyYXRlTGltaXRPcHRzIiwicmVxIiwicmVzIiwibmV4dCIsInJpZCIsInQwIiwiRGF0ZSIsIm5vdyIsImNvbnNvbGUiLCJsb2ciLCJsaW1pdCIsIndpbmRvdyIsInBhc3NlZCIsIlByb21pc2UiLCJyZXNvbHZlIiwiaGVhZGVyc1NlbnQiLCJ3YXJuIiwiZSIsImVycm9yIiwibWVzc2FnZSIsInN0YXR1cyIsImpzb24iLCJjcmVhdGVBZG1pbkhhbmRsZXIiLCJvcHRpb25zIiwicmF3UkwiLCJyYXRlTGltaXQiLCJvbkVycm9yIiwiZXJyIiwic3RhdHVzQ29kZSIsInNldEhlYWRlciIsIm9uTm9NYXRjaCIsIm1ldGhvZCIsInVybCIsImhhbmRsZXIiLCJ1c2UiLCJfYWRtaW5TdGFydCIsInByb2Nlc3MiLCJfcmVzIiwiU3RyaW5nIiwidG9VcHBlckNhc2UiLCJzdGFydHNXaXRoIiwiZW5kIiwiZ2V0SGVhZGVyIiwic3RhcnRlZCJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api-node)/./lib/middleware/createAdminHandler.js\n");

/***/ }),

/***/ "(api-node)/./lib/middleware/rateLimiter.js":
/*!***************************************!*\
  !*** ./lib/middleware/rateLimiter.js ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   rateLimiter: () => (/* binding */ rateLimiter)\n/* harmony export */ });\n/* harmony import */ var _lib_redis__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/redis */ \"(api-node)/./lib/redis.js\");\n// lib/middleware/rateLimiter.js\n\nasync function rateLimiter(req, res, next, options = {}) {\n    try {\n        const redis = await (0,_lib_redis__WEBPACK_IMPORTED_MODULE_0__.getRedisClient)();\n        const ip = req.headers['x-forwarded-for'] || req.socket.remoteAddress || 'unknown';\n        const key = `rate-limit:${ip}`;\n        const limit = options.limit || 60;\n        const windowSeconds = options.window || 60;\n        const count = await redis.incr(key);\n        if (count === 1) await redis.expire(key, windowSeconds);\n        if (count > limit) {\n            return res.status(429).json({\n                error: 'Too many requests. Please try again later.'\n            });\n        }\n        res.setHeader('X-RateLimit-Limit', limit);\n        res.setHeader('X-RateLimit-Remaining', Math.max(0, limit - count));\n        res.setHeader('X-RateLimit-Reset', windowSeconds);\n        return next();\n    } catch (err) {\n        console.error('âš ï¸ Rate limiter failed, allowing request to proceed:', err);\n        return next(); // âœ… Allow request even if Redis fails\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL2xpYi9taWRkbGV3YXJlL3JhdGVMaW1pdGVyLmpzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsZ0NBQWdDO0FBRWE7QUFFdEMsZUFBZUMsWUFBWUMsR0FBRyxFQUFFQyxHQUFHLEVBQUVDLElBQUksRUFBRUMsVUFBVSxDQUFDLENBQUM7SUFDMUQsSUFBSTtRQUNGLE1BQU1DLFFBQVEsTUFBTU4sMERBQWNBO1FBRWxDLE1BQU1PLEtBQUtMLElBQUlNLE9BQU8sQ0FBQyxrQkFBa0IsSUFBSU4sSUFBSU8sTUFBTSxDQUFDQyxhQUFhLElBQUk7UUFDekUsTUFBTUMsTUFBTSxDQUFDLFdBQVcsRUFBRUosSUFBSTtRQUU5QixNQUFNSyxRQUFRUCxRQUFRTyxLQUFLLElBQUk7UUFDL0IsTUFBTUMsZ0JBQWdCUixRQUFRUyxNQUFNLElBQUk7UUFFeEMsTUFBTUMsUUFBUSxNQUFNVCxNQUFNVSxJQUFJLENBQUNMO1FBRS9CLElBQUlJLFVBQVUsR0FBRyxNQUFNVCxNQUFNVyxNQUFNLENBQUNOLEtBQUtFO1FBQ3pDLElBQUlFLFFBQVFILE9BQU87WUFDakIsT0FBT1QsSUFBSWUsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztnQkFBRUMsT0FBTztZQUE2QztRQUNwRjtRQUVBakIsSUFBSWtCLFNBQVMsQ0FBQyxxQkFBcUJUO1FBQ25DVCxJQUFJa0IsU0FBUyxDQUFDLHlCQUF5QkMsS0FBS0MsR0FBRyxDQUFDLEdBQUdYLFFBQVFHO1FBQzNEWixJQUFJa0IsU0FBUyxDQUFDLHFCQUFxQlI7UUFFbkMsT0FBT1Q7SUFDVCxFQUFFLE9BQU9vQixLQUFLO1FBQ1pDLFFBQVFMLEtBQUssQ0FBQyx3REFBd0RJO1FBQ3RFLE9BQU9wQixRQUFRLHNDQUFzQztJQUN2RDtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvZW1vbnRhemVyaS9Eb2N1bWVudHMvcHJvamVjdHMvc2hlbGwtc3Rvcmllcy1zdHVkaW8vbGliL21pZGRsZXdhcmUvcmF0ZUxpbWl0ZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gbGliL21pZGRsZXdhcmUvcmF0ZUxpbWl0ZXIuanNcblxuaW1wb3J0IHsgZ2V0UmVkaXNDbGllbnQgfSBmcm9tICdAL2xpYi9yZWRpcyc7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiByYXRlTGltaXRlcihyZXEsIHJlcywgbmV4dCwgb3B0aW9ucyA9IHt9KSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlZGlzID0gYXdhaXQgZ2V0UmVkaXNDbGllbnQoKTtcbiAgXG4gICAgICBjb25zdCBpcCA9IHJlcS5oZWFkZXJzWyd4LWZvcndhcmRlZC1mb3InXSB8fCByZXEuc29ja2V0LnJlbW90ZUFkZHJlc3MgfHwgJ3Vua25vd24nO1xuICAgICAgY29uc3Qga2V5ID0gYHJhdGUtbGltaXQ6JHtpcH1gO1xuICAgICAgXG4gICAgICBjb25zdCBsaW1pdCA9IG9wdGlvbnMubGltaXQgfHwgNjA7XG4gICAgICBjb25zdCB3aW5kb3dTZWNvbmRzID0gb3B0aW9ucy53aW5kb3cgfHwgNjA7XG4gIFxuICAgICAgY29uc3QgY291bnQgPSBhd2FpdCByZWRpcy5pbmNyKGtleSk7XG4gIFxuICAgICAgaWYgKGNvdW50ID09PSAxKSBhd2FpdCByZWRpcy5leHBpcmUoa2V5LCB3aW5kb3dTZWNvbmRzKTtcbiAgICAgIGlmIChjb3VudCA+IGxpbWl0KSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQyOSkuanNvbih7IGVycm9yOiAnVG9vIG1hbnkgcmVxdWVzdHMuIFBsZWFzZSB0cnkgYWdhaW4gbGF0ZXIuJyB9KTtcbiAgICAgIH1cbiAgXG4gICAgICByZXMuc2V0SGVhZGVyKCdYLVJhdGVMaW1pdC1MaW1pdCcsIGxpbWl0KTtcbiAgICAgIHJlcy5zZXRIZWFkZXIoJ1gtUmF0ZUxpbWl0LVJlbWFpbmluZycsIE1hdGgubWF4KDAsIGxpbWl0IC0gY291bnQpKTtcbiAgICAgIHJlcy5zZXRIZWFkZXIoJ1gtUmF0ZUxpbWl0LVJlc2V0Jywgd2luZG93U2Vjb25kcyk7XG4gIFxuICAgICAgcmV0dXJuIG5leHQoKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KaoO+4jyBSYXRlIGxpbWl0ZXIgZmFpbGVkLCBhbGxvd2luZyByZXF1ZXN0IHRvIHByb2NlZWQ6JywgZXJyKTtcbiAgICAgIHJldHVybiBuZXh0KCk7IC8vIOKchSBBbGxvdyByZXF1ZXN0IGV2ZW4gaWYgUmVkaXMgZmFpbHNcbiAgICB9XG4gIH1cbiAgIl0sIm5hbWVzIjpbImdldFJlZGlzQ2xpZW50IiwicmF0ZUxpbWl0ZXIiLCJyZXEiLCJyZXMiLCJuZXh0Iiwib3B0aW9ucyIsInJlZGlzIiwiaXAiLCJoZWFkZXJzIiwic29ja2V0IiwicmVtb3RlQWRkcmVzcyIsImtleSIsImxpbWl0Iiwid2luZG93U2Vjb25kcyIsIndpbmRvdyIsImNvdW50IiwiaW5jciIsImV4cGlyZSIsInN0YXR1cyIsImpzb24iLCJlcnJvciIsInNldEhlYWRlciIsIk1hdGgiLCJtYXgiLCJlcnIiLCJjb25zb2xlIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api-node)/./lib/middleware/rateLimiter.js\n");

/***/ }),

/***/ "(api-node)/./lib/middleware/requestId.js":
/*!*************************************!*\
  !*** ./lib/middleware/requestId.js ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   withRequestId: () => (/* binding */ withRequestId)\n/* harmony export */ });\n// lib/middleware/requestId.js\nfunction withRequestId(req, res, next) {\n    // Node 18+: crypto.randomUUID(); fallback if unavailable\n    const rid = typeof crypto?.randomUUID === 'function' ? crypto.randomUUID() : `${Date.now().toString(36)}-${Math.random().toString(16).slice(2, 10)}`;\n    req.rid = rid;\n    res.setHeader('X-Request-Id', rid);\n    next();\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL2xpYi9taWRkbGV3YXJlL3JlcXVlc3RJZC5qcyIsIm1hcHBpbmdzIjoiOzs7O0FBQUEsOEJBQThCO0FBQ3ZCLFNBQVNBLGNBQWNDLEdBQUcsRUFBRUMsR0FBRyxFQUFFQyxJQUFJO0lBQ3hDLHlEQUF5RDtJQUN6RCxNQUFNQyxNQUFNLE9BQVFDLFFBQVFDLGVBQWUsYUFDdkNELE9BQU9DLFVBQVUsS0FDakIsR0FBR0MsS0FBS0MsR0FBRyxHQUFHQyxRQUFRLENBQUMsSUFBSSxDQUFDLEVBQUVDLEtBQUtDLE1BQU0sR0FBR0YsUUFBUSxDQUFDLElBQUlHLEtBQUssQ0FBQyxHQUFHLEtBQUs7SUFFM0VYLElBQUlHLEdBQUcsR0FBR0E7SUFDVkYsSUFBSVcsU0FBUyxDQUFDLGdCQUFnQlQ7SUFDOUJEO0FBQ0YiLCJzb3VyY2VzIjpbIi9Vc2Vycy9lbW9udGF6ZXJpL0RvY3VtZW50cy9wcm9qZWN0cy9zaGVsbC1zdG9yaWVzLXN0dWRpby9saWIvbWlkZGxld2FyZS9yZXF1ZXN0SWQuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gbGliL21pZGRsZXdhcmUvcmVxdWVzdElkLmpzXG5leHBvcnQgZnVuY3Rpb24gd2l0aFJlcXVlc3RJZChyZXEsIHJlcywgbmV4dCkge1xuICAgIC8vIE5vZGUgMTgrOiBjcnlwdG8ucmFuZG9tVVVJRCgpOyBmYWxsYmFjayBpZiB1bmF2YWlsYWJsZVxuICAgIGNvbnN0IHJpZCA9ICh0eXBlb2YgY3J5cHRvPy5yYW5kb21VVUlEID09PSAnZnVuY3Rpb24nKVxuICAgICAgPyBjcnlwdG8ucmFuZG9tVVVJRCgpXG4gICAgICA6IGAke0RhdGUubm93KCkudG9TdHJpbmcoMzYpfS0ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMTYpLnNsaWNlKDIsIDEwKX1gO1xuICBcbiAgICByZXEucmlkID0gcmlkO1xuICAgIHJlcy5zZXRIZWFkZXIoJ1gtUmVxdWVzdC1JZCcsIHJpZCk7XG4gICAgbmV4dCgpO1xuICB9XG4gICJdLCJuYW1lcyI6WyJ3aXRoUmVxdWVzdElkIiwicmVxIiwicmVzIiwibmV4dCIsInJpZCIsImNyeXB0byIsInJhbmRvbVVVSUQiLCJEYXRlIiwibm93IiwidG9TdHJpbmciLCJNYXRoIiwicmFuZG9tIiwic2xpY2UiLCJzZXRIZWFkZXIiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api-node)/./lib/middleware/requestId.js\n");

/***/ }),

/***/ "(api-node)/./lib/productApiUtils.js":
/*!********************************!*\
  !*** ./lib/productApiUtils.js ***!
  \********************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getPaginatedProducts: () => (/* binding */ getPaginatedProducts),\n/* harmony export */   insertProduct: () => (/* binding */ insertProduct),\n/* harmony export */   updateProductStatus: () => (/* binding */ updateProductStatus)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./db */ \"(api-node)/./lib/db.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_db__WEBPACK_IMPORTED_MODULE_0__]);\n_db__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\nasync function insertProduct(product) {\n    const db = await (0,_db__WEBPACK_IMPORTED_MODULE_0__.openDB)();\n    const { name, description, price, stock, image_url, category } = product;\n    return await db.run(`INSERT INTO products (name, description, price, stock, image_url, category)\n     VALUES (?, ?, ?, ?, ?, ?)`, [\n        name,\n        description,\n        price,\n        stock,\n        image_url,\n        category\n    ]);\n}\n// ðŸ§¾ Get Paginated Products\nasync function getPaginatedProducts(page = 1, limit = 20, sortSQL = 'created_at DESC', q = '') {\n    const rid = Math.random().toString(36).slice(2, 8);\n    console.log(`[db] [${rid}] start getPaginatedProducts`, {\n        page,\n        limit,\n        sortSQL,\n        q\n    });\n    const db = await (0,_db__WEBPACK_IMPORTED_MODULE_0__.openDB)();\n    const offset = (page - 1) * limit;\n    const countStart = Date.now();\n    const countResult = await db.get(`SELECT COUNT(*) as count FROM products`);\n    const totalCount = countResult.count;\n    const countMs = Date.now() - countStart;\n    console.log(`[db] [${rid}] count query done in ${countMs}ms total=${totalCount}`);\n    const selectStart = Date.now();\n    const rawproducts = await db.all(`SELECT id, name, description, price, stock, image_url, category, is_favorite, is_active, created_at\n     FROM products\n     ORDER BY ${sortSQL}\n     LIMIT ? OFFSET ?`, [\n        parseInt(limit),\n        parseInt(offset)\n    ]);\n    const selectMs = Date.now() - selectStart;\n    // Normalize\n    const products = rawproducts.map((p)=>({\n            ...p,\n            is_favorite: Number(p.is_favorite || 0)\n        }));\n    console.log(`[db] [${rid}] select done in ${selectMs}ms rows=${products.length}`);\n    return {\n        products,\n        total: totalCount,\n        page: parseInt(page),\n        totalPages: Math.ceil(totalCount / limit)\n    };\n}\nasync function updateProductStatus(id, is_active) {\n    const db = await (0,_db__WEBPACK_IMPORTED_MODULE_0__.openDB)();\n    return db.run(`UPDATE products SET is_active = ? WHERE id = ?`, [\n        is_active,\n        id\n    ]);\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL2xpYi9wcm9kdWN0QXBpVXRpbHMuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUE4QjtBQUV2QixlQUFlQyxjQUFjQyxPQUFPO0lBQ3pDLE1BQU1DLEtBQUssTUFBTUgsMkNBQU1BO0lBQ3ZCLE1BQU0sRUFBRUksSUFBSSxFQUFFQyxXQUFXLEVBQUVDLEtBQUssRUFBRUMsS0FBSyxFQUFFQyxTQUFTLEVBQUVDLFFBQVEsRUFBRSxHQUFHUDtJQUVqRSxPQUFPLE1BQU1DLEdBQUdPLEdBQUcsQ0FDakIsQ0FBQzs4QkFDeUIsQ0FBQyxFQUMzQjtRQUFDTjtRQUFNQztRQUFhQztRQUFPQztRQUFPQztRQUFXQztLQUFTO0FBRTFEO0FBRUEsNEJBQTRCO0FBQ3JCLGVBQWVFLHFCQUFxQkMsT0FBTyxDQUFDLEVBQUVDLFFBQVEsRUFBRSxFQUFFQyxVQUFVLGlCQUFpQixFQUFFQyxJQUFJLEVBQUU7SUFDbEcsTUFBTUMsTUFBTUMsS0FBS0MsTUFBTSxHQUFHQyxRQUFRLENBQUMsSUFBSUMsS0FBSyxDQUFDLEdBQUc7SUFDaERDLFFBQVFDLEdBQUcsQ0FBQyxDQUFDLE1BQU0sRUFBRU4sSUFBSSw0QkFBNEIsQ0FBQyxFQUFFO1FBQUVKO1FBQU1DO1FBQU9DO1FBQVNDO0lBQUU7SUFFbEYsTUFBTVosS0FBSyxNQUFNSCwyQ0FBTUE7SUFDdkIsTUFBTXVCLFNBQVMsQ0FBQ1gsT0FBTyxLQUFLQztJQUM1QixNQUFNVyxhQUFhQyxLQUFLQyxHQUFHO0lBRTNCLE1BQU1DLGNBQWMsTUFBTXhCLEdBQUd5QixHQUFHLENBQUMsQ0FBQyxzQ0FBc0MsQ0FBQztJQUN6RSxNQUFNQyxhQUFhRixZQUFZRyxLQUFLO0lBQ3BDLE1BQU1DLFVBQVVOLEtBQUtDLEdBQUcsS0FBS0Y7SUFFN0JILFFBQVFDLEdBQUcsQ0FBQyxDQUFDLE1BQU0sRUFBRU4sSUFBSSxzQkFBc0IsRUFBRWUsUUFBUSxTQUFTLEVBQUVGLFlBQVk7SUFFaEYsTUFBTUcsY0FBY1AsS0FBS0MsR0FBRztJQUM1QixNQUFNTyxjQUFjLE1BQU05QixHQUFHK0IsR0FBRyxDQUM5QixDQUFDOztjQUVTLEVBQUVwQixRQUFRO3FCQUNILENBQUMsRUFDbEI7UUFBQ3FCLFNBQVN0QjtRQUFRc0IsU0FBU1o7S0FBUTtJQUVyQyxNQUFNYSxXQUFXWCxLQUFLQyxHQUFHLEtBQUtNO0lBRTlCLFlBQVk7SUFDWixNQUFNSyxXQUFXSixZQUFZSyxHQUFHLENBQUMsQ0FBQ0MsSUFBTztZQUN2QyxHQUFHQSxDQUFDO1lBQ0pDLGFBQWFDLE9BQU9GLEVBQUVDLFdBQVcsSUFBSTtRQUN2QztJQUVBbkIsUUFBUUMsR0FBRyxDQUFDLENBQUMsTUFBTSxFQUFFTixJQUFJLGlCQUFpQixFQUFFb0IsU0FBUyxRQUFRLEVBQUVDLFNBQVNLLE1BQU0sRUFBRTtJQUVoRixPQUFPO1FBQ0xMO1FBQ0FNLE9BQU9kO1FBQ1BqQixNQUFNdUIsU0FBU3ZCO1FBQ2ZnQyxZQUFZM0IsS0FBSzRCLElBQUksQ0FBQ2hCLGFBQWFoQjtJQUNyQztBQUNGO0FBRU8sZUFBZWlDLG9CQUFvQkMsRUFBRSxFQUFFQyxTQUFTO0lBQ3JELE1BQU03QyxLQUFLLE1BQU1ILDJDQUFNQTtJQUN2QixPQUFPRyxHQUFHTyxHQUFHLENBQUMsQ0FBQyw4Q0FBOEMsQ0FBQyxFQUFFO1FBQUNzQztRQUFXRDtLQUFHO0FBQ2pGIiwic291cmNlcyI6WyIvVXNlcnMvZW1vbnRhemVyaS9Eb2N1bWVudHMvcHJvamVjdHMvc2hlbGwtc3Rvcmllcy1zdHVkaW8vbGliL3Byb2R1Y3RBcGlVdGlscy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBvcGVuREIgfSBmcm9tICcuL2RiJztcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGluc2VydFByb2R1Y3QocHJvZHVjdCkge1xuICBjb25zdCBkYiA9IGF3YWl0IG9wZW5EQigpO1xuICBjb25zdCB7IG5hbWUsIGRlc2NyaXB0aW9uLCBwcmljZSwgc3RvY2ssIGltYWdlX3VybCwgY2F0ZWdvcnkgfSA9IHByb2R1Y3Q7XG5cbiAgcmV0dXJuIGF3YWl0IGRiLnJ1bihcbiAgICBgSU5TRVJUIElOVE8gcHJvZHVjdHMgKG5hbWUsIGRlc2NyaXB0aW9uLCBwcmljZSwgc3RvY2ssIGltYWdlX3VybCwgY2F0ZWdvcnkpXG4gICAgIFZBTFVFUyAoPywgPywgPywgPywgPywgPylgLFxuICAgIFtuYW1lLCBkZXNjcmlwdGlvbiwgcHJpY2UsIHN0b2NrLCBpbWFnZV91cmwsIGNhdGVnb3J5XVxuICApO1xufVxuXG4vLyDwn6e+IEdldCBQYWdpbmF0ZWQgUHJvZHVjdHNcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRQYWdpbmF0ZWRQcm9kdWN0cyhwYWdlID0gMSwgbGltaXQgPSAyMCwgc29ydFNRTCA9ICdjcmVhdGVkX2F0IERFU0MnLCBxID0gJycpIHtcbiAgY29uc3QgcmlkID0gTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiwgOCk7XG4gIGNvbnNvbGUubG9nKGBbZGJdIFske3JpZH1dIHN0YXJ0IGdldFBhZ2luYXRlZFByb2R1Y3RzYCwgeyBwYWdlLCBsaW1pdCwgc29ydFNRTCwgcSB9KTtcblxuICBjb25zdCBkYiA9IGF3YWl0IG9wZW5EQigpO1xuICBjb25zdCBvZmZzZXQgPSAocGFnZSAtIDEpICogbGltaXQ7XG4gIGNvbnN0IGNvdW50U3RhcnQgPSBEYXRlLm5vdygpO1xuXG4gIGNvbnN0IGNvdW50UmVzdWx0ID0gYXdhaXQgZGIuZ2V0KGBTRUxFQ1QgQ09VTlQoKikgYXMgY291bnQgRlJPTSBwcm9kdWN0c2ApO1xuICBjb25zdCB0b3RhbENvdW50ID0gY291bnRSZXN1bHQuY291bnQ7XG4gIGNvbnN0IGNvdW50TXMgPSBEYXRlLm5vdygpIC0gY291bnRTdGFydDtcblxuICBjb25zb2xlLmxvZyhgW2RiXSBbJHtyaWR9XSBjb3VudCBxdWVyeSBkb25lIGluICR7Y291bnRNc31tcyB0b3RhbD0ke3RvdGFsQ291bnR9YCk7XG5cbiAgY29uc3Qgc2VsZWN0U3RhcnQgPSBEYXRlLm5vdygpO1xuICBjb25zdCByYXdwcm9kdWN0cyA9IGF3YWl0IGRiLmFsbChcbiAgICBgU0VMRUNUIGlkLCBuYW1lLCBkZXNjcmlwdGlvbiwgcHJpY2UsIHN0b2NrLCBpbWFnZV91cmwsIGNhdGVnb3J5LCBpc19mYXZvcml0ZSwgaXNfYWN0aXZlLCBjcmVhdGVkX2F0XG4gICAgIEZST00gcHJvZHVjdHNcbiAgICAgT1JERVIgQlkgJHtzb3J0U1FMfVxuICAgICBMSU1JVCA/IE9GRlNFVCA/YCxcbiAgICBbcGFyc2VJbnQobGltaXQpLCBwYXJzZUludChvZmZzZXQpXVxuICApO1xuICBjb25zdCBzZWxlY3RNcyA9IERhdGUubm93KCkgLSBzZWxlY3RTdGFydDtcblxuICAvLyBOb3JtYWxpemVcbiAgY29uc3QgcHJvZHVjdHMgPSByYXdwcm9kdWN0cy5tYXAoKHApID0+ICh7XG4gICAgLi4ucCxcbiAgICBpc19mYXZvcml0ZTogTnVtYmVyKHAuaXNfZmF2b3JpdGUgfHwgMCksXG4gIH0pKTtcblxuICBjb25zb2xlLmxvZyhgW2RiXSBbJHtyaWR9XSBzZWxlY3QgZG9uZSBpbiAke3NlbGVjdE1zfW1zIHJvd3M9JHtwcm9kdWN0cy5sZW5ndGh9YCk7XG5cbiAgcmV0dXJuIHtcbiAgICBwcm9kdWN0cyxcbiAgICB0b3RhbDogdG90YWxDb3VudCxcbiAgICBwYWdlOiBwYXJzZUludChwYWdlKSxcbiAgICB0b3RhbFBhZ2VzOiBNYXRoLmNlaWwodG90YWxDb3VudCAvIGxpbWl0KSxcbiAgfTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHVwZGF0ZVByb2R1Y3RTdGF0dXMoaWQsIGlzX2FjdGl2ZSkge1xuICBjb25zdCBkYiA9IGF3YWl0IG9wZW5EQigpO1xuICByZXR1cm4gZGIucnVuKGBVUERBVEUgcHJvZHVjdHMgU0VUIGlzX2FjdGl2ZSA9ID8gV0hFUkUgaWQgPSA/YCwgW2lzX2FjdGl2ZSwgaWRdKTtcbn1cbiJdLCJuYW1lcyI6WyJvcGVuREIiLCJpbnNlcnRQcm9kdWN0IiwicHJvZHVjdCIsImRiIiwibmFtZSIsImRlc2NyaXB0aW9uIiwicHJpY2UiLCJzdG9jayIsImltYWdlX3VybCIsImNhdGVnb3J5IiwicnVuIiwiZ2V0UGFnaW5hdGVkUHJvZHVjdHMiLCJwYWdlIiwibGltaXQiLCJzb3J0U1FMIiwicSIsInJpZCIsIk1hdGgiLCJyYW5kb20iLCJ0b1N0cmluZyIsInNsaWNlIiwiY29uc29sZSIsImxvZyIsIm9mZnNldCIsImNvdW50U3RhcnQiLCJEYXRlIiwibm93IiwiY291bnRSZXN1bHQiLCJnZXQiLCJ0b3RhbENvdW50IiwiY291bnQiLCJjb3VudE1zIiwic2VsZWN0U3RhcnQiLCJyYXdwcm9kdWN0cyIsImFsbCIsInBhcnNlSW50Iiwic2VsZWN0TXMiLCJwcm9kdWN0cyIsIm1hcCIsInAiLCJpc19mYXZvcml0ZSIsIk51bWJlciIsImxlbmd0aCIsInRvdGFsIiwidG90YWxQYWdlcyIsImNlaWwiLCJ1cGRhdGVQcm9kdWN0U3RhdHVzIiwiaWQiLCJpc19hY3RpdmUiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api-node)/./lib/productApiUtils.js\n");

/***/ }),

/***/ "(api-node)/./lib/productHelpers.js":
/*!*******************************!*\
  !*** ./lib/productHelpers.js ***!
  \*******************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   bulkCreateProducts: () => (/* binding */ bulkCreateProducts),\n/* harmony export */   deleteProductById: () => (/* binding */ deleteProductById),\n/* harmony export */   getProductById: () => (/* binding */ getProductById),\n/* harmony export */   toggleFavorite: () => (/* binding */ toggleFavorite),\n/* harmony export */   updateProductById: () => (/* binding */ updateProductById)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./db */ \"(api-node)/./lib/db.js\");\n/* harmony import */ var _constant__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./constant */ \"(api-node)/./lib/constant.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_db__WEBPACK_IMPORTED_MODULE_0__]);\n_db__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n// lib/productHelpers.js\n // Assuming your openDB function is in lib/db.js\n\n// Fetch a product by ID\nasync function getProductById(id) {\n    const db = await (0,_db__WEBPACK_IMPORTED_MODULE_0__.openDB)();\n    try {\n        const product = await db.get('SELECT * FROM products WHERE id = ?', [\n            id\n        ]);\n        console.log(\"ðŸ” Found product in DB?\", product);\n        return product;\n    } catch (err) {\n        console.error('Error fetching product:', err);\n        throw new Error('Failed to fetch product');\n    }\n}\n// lib/productHelpers.js\nasync function updateProductById(id, patch) {\n    const db = await (0,_db__WEBPACK_IMPORTED_MODULE_0__.openDB)();\n    // Columns we allow to be updated\n    const ALLOWED = new Set([\n        'name',\n        'description',\n        'price',\n        'stock',\n        'image_url',\n        'image_public_id',\n        'category',\n        'is_active',\n        'is_favorite'\n    ]);\n    // Keep only allowed keys with defined values\n    const entries = Object.entries(patch).filter(([k, v])=>ALLOWED.has(k) && v !== undefined);\n    if (entries.length === 0) return {\n        changes: 0\n    };\n    // Optional: coerce some types defensively (safe no-ops if already correct)\n    const coerced = entries.map(([k, v])=>{\n        if (k === 'price') return [\n            k,\n            Number(v)\n        ];\n        if (k === 'stock') return [\n            k,\n            Number(v)\n        ];\n        if (k === 'is_active' || k === 'is_favorite') return [\n            k,\n            Number(v) === 1 ? 1 : 0\n        ];\n        return [\n            k,\n            v\n        ];\n    });\n    const cols = coerced.map(([k])=>`${k} = ?`).join(', ');\n    const vals = coerced.map(([, v])=>v);\n    // Debug: see exactly what you are updating\n    // console.log('ðŸ§© UPDATE products SET', cols, 'WHERE id =', id, 'vals =', vals);\n    try {\n        const result = await db.run(`UPDATE products SET ${cols} WHERE id = ?`, [\n            ...vals,\n            id\n        ]);\n        return result; // { changes, lastID }\n    } catch (err) {\n        console.error('âŒ Error updating product:', err);\n        throw new Error('Failed to update product');\n    }\n}\n// Delete product by ID\nasync function deleteProductById(id) {\n    const db = await (0,_db__WEBPACK_IMPORTED_MODULE_0__.openDB)();\n    console.log('ðŸ—‘ï¸ Trying to delete product from DB with id:', id);\n    try {\n        const result = await db.run('DELETE FROM products WHERE id = ?', [\n            id\n        ]);\n        console.log('ðŸ§¾ SQLite delete result:', result);\n        return result;\n    } catch (err) {\n        console.error('Error deleting product:', err);\n        throw new Error('Failed to delete product');\n    }\n}\n// Toggle favorite status for a product\nasync function toggleFavorite(id, isFavorite) {\n    const db = await (0,_db__WEBPACK_IMPORTED_MODULE_0__.openDB)();\n    try {\n        const currentFavoriteCount = await db.get('SELECT COUNT(*) as count FROM products WHERE is_favorite = 1');\n        // Limit favorites to 8 products\n        if (currentFavoriteCount.count >= _constant__WEBPACK_IMPORTED_MODULE_1__.ADMIN_FAVORITES_MAX && isFavorite === 1) {\n            throw new Error(`You can only have ${_constant__WEBPACK_IMPORTED_MODULE_1__.ADMIN_FAVORITES_MAX} favorite products.`);\n        }\n        const result = await db.run('UPDATE products SET is_favorite = ? WHERE id = ?', [\n            isFavorite,\n            id\n        ]);\n        return result;\n    } catch (err) {\n        console.error('Error toggling favorite:', err);\n        throw new Error('Failed to update favorite status');\n    }\n}\n// Bulk create products (inserts multiple products at once)\nasync function bulkCreateProducts(products) {\n    const db = await (0,_db__WEBPACK_IMPORTED_MODULE_0__.openDB)();\n    try {\n        const stmt = await db.prepare(`\n      INSERT INTO products (name, description, price, stock, image_url, category, is_active)\n      VALUES (?, ?, ?, ?, ?, ?, ?)\n    `);\n        for (const product of products){\n            const { name, description, price, stock, image_url, category, is_active } = product;\n            await stmt.run(name, description, price, stock, image_url, category, is_active);\n        }\n        await stmt.finalize();\n        return {\n            message: 'Products created successfully'\n        };\n    } catch (err) {\n        console.error('Error bulk creating products:', err);\n        throw new Error('Failed to bulk create products');\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QixNQUFNaEMsR0FBR0UsR0FBRyxDQUFDO1FBRTFDLGdDQUFnQztRQUNoQyxJQUFJOEIscUJBQXFCQyxLQUFLLElBQUlwQywwREFBbUJBLElBQUlrQyxlQUFlLEdBQUc7WUFDekUsTUFBTSxJQUFJeEIsTUFBTSxDQUFDLGtCQUFrQixFQUFFViwwREFBbUJBLENBQUMsbUJBQW1CLENBQUM7UUFDL0U7UUFFQSxNQUFNOEIsU0FBUyxNQUFNM0IsR0FBRzRCLEdBQUcsQ0FBQyxvREFBb0Q7WUFBQ0c7WUFBWWhDO1NBQUc7UUFDaEcsT0FBTzRCO0lBQ1QsRUFBRSxPQUFPdEIsS0FBSztRQUNaRixRQUFRRyxLQUFLLENBQUMsNEJBQTRCRDtRQUMxQyxNQUFNLElBQUlFLE1BQU07SUFDbEI7QUFDRjtBQUVBLDJEQUEyRDtBQUNwRCxlQUFlMkIsbUJBQW1CQyxRQUFRO0lBQy9DLE1BQU1uQyxLQUFLLE1BQU1KLDJDQUFNQTtJQUN2QixJQUFJO1FBQ0YsTUFBTXdDLE9BQU8sTUFBTXBDLEdBQUdxQyxPQUFPLENBQUMsQ0FBQzs7O0lBRy9CLENBQUM7UUFFRCxLQUFLLE1BQU1wQyxXQUFXa0MsU0FBVTtZQUM5QixNQUFNLEVBQUVHLElBQUksRUFBRUMsV0FBVyxFQUFFQyxLQUFLLEVBQUVDLEtBQUssRUFBRUMsU0FBUyxFQUFFQyxRQUFRLEVBQUVDLFNBQVMsRUFBRSxHQUFHM0M7WUFDNUUsTUFBTW1DLEtBQUtSLEdBQUcsQ0FBQ1UsTUFBTUMsYUFBYUMsT0FBT0MsT0FBT0MsV0FBV0MsVUFBVUM7UUFDdkU7UUFDQSxNQUFNUixLQUFLUyxRQUFRO1FBQ25CLE9BQU87WUFBRUMsU0FBUztRQUFnQztJQUNwRCxFQUFFLE9BQU96QyxLQUFLO1FBQ1pGLFFBQVFHLEtBQUssQ0FBQyxpQ0FBaUNEO1FBQy9DLE1BQU0sSUFBSUUsTUFBTTtJQUNsQjtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvZW1vbnRhemVyaS9Eb2N1bWVudHMvcHJvamVjdHMvc2hlbGwtc3Rvcmllcy1zdHVkaW8vbGliL3Byb2R1Y3RIZWxwZXJzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIGxpYi9wcm9kdWN0SGVscGVycy5qc1xuaW1wb3J0IHsgb3BlbkRCIH0gZnJvbSAnLi9kYic7IC8vIEFzc3VtaW5nIHlvdXIgb3BlbkRCIGZ1bmN0aW9uIGlzIGluIGxpYi9kYi5qc1xuaW1wb3J0IHsgQURNSU5fRkFWT1JJVEVTX01BWCB9IGZyb20gJy4vY29uc3RhbnQnO1xuLy8gRmV0Y2ggYSBwcm9kdWN0IGJ5IElEXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0UHJvZHVjdEJ5SWQoaWQpIHtcbiAgY29uc3QgZGIgPSBhd2FpdCBvcGVuREIoKTtcbiAgdHJ5IHtcbiAgICBjb25zdCBwcm9kdWN0ID0gYXdhaXQgZGIuZ2V0KCdTRUxFQ1QgKiBGUk9NIHByb2R1Y3RzIFdIRVJFIGlkID0gPycsIFtpZF0pO1xuICAgIGNvbnNvbGUubG9nKFwi8J+UjSBGb3VuZCBwcm9kdWN0IGluIERCP1wiLCBwcm9kdWN0KTtcbiAgICByZXR1cm4gcHJvZHVjdDtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgcHJvZHVjdDonLCBlcnIpO1xuICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIHRvIGZldGNoIHByb2R1Y3QnKTtcbiAgfVxufVxuXG4vLyBsaWIvcHJvZHVjdEhlbHBlcnMuanNcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHVwZGF0ZVByb2R1Y3RCeUlkKGlkLCBwYXRjaCkge1xuICBjb25zdCBkYiA9IGF3YWl0IG9wZW5EQigpO1xuXG4gIC8vIENvbHVtbnMgd2UgYWxsb3cgdG8gYmUgdXBkYXRlZFxuICBjb25zdCBBTExPV0VEID0gbmV3IFNldChbXG4gICAgJ25hbWUnLFxuICAgICdkZXNjcmlwdGlvbicsXG4gICAgJ3ByaWNlJyxcbiAgICAnc3RvY2snLFxuICAgICdpbWFnZV91cmwnLFxuICAgICdpbWFnZV9wdWJsaWNfaWQnLFxuICAgICdjYXRlZ29yeScsXG4gICAgJ2lzX2FjdGl2ZScsXG4gICAgJ2lzX2Zhdm9yaXRlJyxcbiAgXSk7XG5cbiAgLy8gS2VlcCBvbmx5IGFsbG93ZWQga2V5cyB3aXRoIGRlZmluZWQgdmFsdWVzXG4gIGNvbnN0IGVudHJpZXMgPSBPYmplY3QuZW50cmllcyhwYXRjaCkuZmlsdGVyKFxuICAgIChbaywgdl0pID0+IEFMTE9XRUQuaGFzKGspICYmIHYgIT09IHVuZGVmaW5lZFxuICApO1xuXG4gIGlmIChlbnRyaWVzLmxlbmd0aCA9PT0gMCkgcmV0dXJuIHsgY2hhbmdlczogMCB9O1xuXG4gIC8vIE9wdGlvbmFsOiBjb2VyY2Ugc29tZSB0eXBlcyBkZWZlbnNpdmVseSAoc2FmZSBuby1vcHMgaWYgYWxyZWFkeSBjb3JyZWN0KVxuICBjb25zdCBjb2VyY2VkID0gZW50cmllcy5tYXAoKFtrLCB2XSkgPT4ge1xuICAgIGlmIChrID09PSAncHJpY2UnKSByZXR1cm4gW2ssIE51bWJlcih2KV07XG4gICAgaWYgKGsgPT09ICdzdG9jaycpIHJldHVybiBbaywgTnVtYmVyKHYpXTtcbiAgICBpZiAoayA9PT0gJ2lzX2FjdGl2ZScgfHwgayA9PT0gJ2lzX2Zhdm9yaXRlJykgcmV0dXJuIFtrLCBOdW1iZXIodikgPT09IDEgPyAxIDogMF07XG4gICAgcmV0dXJuIFtrLCB2XTtcbiAgfSk7XG5cbiAgY29uc3QgY29scyA9IGNvZXJjZWQubWFwKChba10pID0+IGAke2t9ID0gP2ApLmpvaW4oJywgJyk7XG4gIGNvbnN0IHZhbHMgPSBjb2VyY2VkLm1hcCgoWywgdl0pID0+IHYpO1xuXG4gIC8vIERlYnVnOiBzZWUgZXhhY3RseSB3aGF0IHlvdSBhcmUgdXBkYXRpbmdcbiAgLy8gY29uc29sZS5sb2coJ/Cfp6kgVVBEQVRFIHByb2R1Y3RzIFNFVCcsIGNvbHMsICdXSEVSRSBpZCA9JywgaWQsICd2YWxzID0nLCB2YWxzKTtcblxuICB0cnkge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiLnJ1bihcbiAgICAgIGBVUERBVEUgcHJvZHVjdHMgU0VUICR7Y29sc30gV0hFUkUgaWQgPSA/YCxcbiAgICAgIFsuLi52YWxzLCBpZF1cbiAgICApO1xuICAgIHJldHVybiByZXN1bHQ7IC8vIHsgY2hhbmdlcywgbGFzdElEIH1cbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIHVwZGF0aW5nIHByb2R1Y3Q6JywgZXJyKTtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZhaWxlZCB0byB1cGRhdGUgcHJvZHVjdCcpO1xuICB9XG59XG5cblxuLy8gRGVsZXRlIHByb2R1Y3QgYnkgSURcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBkZWxldGVQcm9kdWN0QnlJZChpZCkge1xuICBjb25zdCBkYiA9IGF3YWl0IG9wZW5EQigpO1xuICBjb25zb2xlLmxvZygn8J+Xke+4jyBUcnlpbmcgdG8gZGVsZXRlIHByb2R1Y3QgZnJvbSBEQiB3aXRoIGlkOicsIGlkKTtcblxuICB0cnkge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiLnJ1bignREVMRVRFIEZST00gcHJvZHVjdHMgV0hFUkUgaWQgPSA/JywgW2lkXSk7XG4gICAgY29uc29sZS5sb2coJ/Cfp74gU1FMaXRlIGRlbGV0ZSByZXN1bHQ6JywgcmVzdWx0KTtcblxuICAgIHJldHVybiByZXN1bHQ7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGRlbGV0aW5nIHByb2R1Y3Q6JywgZXJyKTtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZhaWxlZCB0byBkZWxldGUgcHJvZHVjdCcpO1xuICB9XG59XG5cbi8vIFRvZ2dsZSBmYXZvcml0ZSBzdGF0dXMgZm9yIGEgcHJvZHVjdFxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHRvZ2dsZUZhdm9yaXRlKGlkLCBpc0Zhdm9yaXRlKSB7XG4gIGNvbnN0IGRiID0gYXdhaXQgb3BlbkRCKCk7XG4gIHRyeSB7XG4gICAgY29uc3QgY3VycmVudEZhdm9yaXRlQ291bnQgPSBhd2FpdCBkYi5nZXQoJ1NFTEVDVCBDT1VOVCgqKSBhcyBjb3VudCBGUk9NIHByb2R1Y3RzIFdIRVJFIGlzX2Zhdm9yaXRlID0gMScpO1xuXG4gICAgLy8gTGltaXQgZmF2b3JpdGVzIHRvIDggcHJvZHVjdHNcbiAgICBpZiAoY3VycmVudEZhdm9yaXRlQ291bnQuY291bnQgPj0gQURNSU5fRkFWT1JJVEVTX01BWCAmJiBpc0Zhdm9yaXRlID09PSAxKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFlvdSBjYW4gb25seSBoYXZlICR7QURNSU5fRkFWT1JJVEVTX01BWH0gZmF2b3JpdGUgcHJvZHVjdHMuYCk7XG4gICAgfVxuXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGIucnVuKCdVUERBVEUgcHJvZHVjdHMgU0VUIGlzX2Zhdm9yaXRlID0gPyBXSEVSRSBpZCA9ID8nLCBbaXNGYXZvcml0ZSwgaWRdKTtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciB0b2dnbGluZyBmYXZvcml0ZTonLCBlcnIpO1xuICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIHRvIHVwZGF0ZSBmYXZvcml0ZSBzdGF0dXMnKTtcbiAgfVxufVxuXG4vLyBCdWxrIGNyZWF0ZSBwcm9kdWN0cyAoaW5zZXJ0cyBtdWx0aXBsZSBwcm9kdWN0cyBhdCBvbmNlKVxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGJ1bGtDcmVhdGVQcm9kdWN0cyhwcm9kdWN0cykge1xuICBjb25zdCBkYiA9IGF3YWl0IG9wZW5EQigpO1xuICB0cnkge1xuICAgIGNvbnN0IHN0bXQgPSBhd2FpdCBkYi5wcmVwYXJlKGBcbiAgICAgIElOU0VSVCBJTlRPIHByb2R1Y3RzIChuYW1lLCBkZXNjcmlwdGlvbiwgcHJpY2UsIHN0b2NrLCBpbWFnZV91cmwsIGNhdGVnb3J5LCBpc19hY3RpdmUpXG4gICAgICBWQUxVRVMgKD8sID8sID8sID8sID8sID8sID8pXG4gICAgYCk7XG5cbiAgICBmb3IgKGNvbnN0IHByb2R1Y3Qgb2YgcHJvZHVjdHMpIHtcbiAgICAgIGNvbnN0IHsgbmFtZSwgZGVzY3JpcHRpb24sIHByaWNlLCBzdG9jaywgaW1hZ2VfdXJsLCBjYXRlZ29yeSwgaXNfYWN0aXZlIH0gPSBwcm9kdWN0O1xuICAgICAgYXdhaXQgc3RtdC5ydW4obmFtZSwgZGVzY3JpcHRpb24sIHByaWNlLCBzdG9jaywgaW1hZ2VfdXJsLCBjYXRlZ29yeSwgaXNfYWN0aXZlKTtcbiAgICB9XG4gICAgYXdhaXQgc3RtdC5maW5hbGl6ZSgpO1xuICAgIHJldHVybiB7IG1lc3NhZ2U6ICdQcm9kdWN0cyBjcmVhdGVkIHN1Y2Nlc3NmdWxseScgfTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgYnVsayBjcmVhdGluZyBwcm9kdWN0czonLCBlcnIpO1xuICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIHRvIGJ1bGsgY3JlYXRlIHByb2R1Y3RzJyk7XG4gIH1cbn1cblxuIl0sIm5hbWVzIjpbIm9wZW5EQiIsIkFETUlOX0ZBVk9SSVRFU19NQVgiLCJnZXRQcm9kdWN0QnlJZCIsImlkIiwiZGIiLCJwcm9kdWN0IiwiZ2V0IiwiY29uc29sZSIsImxvZyIsImVyciIsImVycm9yIiwiRXJyb3IiLCJ1cGRhdGVQcm9kdWN0QnlJZCIsInBhdGNoIiwiQUxMT1dFRCIsIlNldCIsImVudHJpZXMiLCJPYmplY3QiLCJmaWx0ZXIiLCJrIiwidiIsImhhcyIsInVuZGVmaW5lZCIsImxlbmd0aCIsImNoYW5nZXMiLCJjb2VyY2VkIiwibWFwIiwiTnVtYmVyIiwiY29scyIsImpvaW4iLCJ2YWxzIiwicmVzdWx0IiwicnVuIiwiZGVsZXRlUHJvZHVjdEJ5SWQiLCJ0b2dnbGVGYXZvcml0ZSIsImlzRmF2b3JpdGUiLCJjdXJyZW50RmF2b3JpdGVDb3VudCIsImNvdW50IiwiYnVsa0NyZWF0ZVByb2R1Y3RzIiwicHJvZHVjdHMiLCJzdG10IiwicHJlcGFyZSIsIm5hbWUiLCJkZXNjcmlwdGlvbiIsInByaWNlIiwic3RvY2siLCJpbWFnZV91cmwiLCJjYXRlZ29yeSIsImlzX2FjdGl2ZSIsImZpbmFsaXplIiwibWVzc2FnZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api-node)/./lib/productHelpers.js\n");

/***/ }),

/***/ "(api-node)/./lib/redis.js":
/*!**********************!*\
  !*** ./lib/redis.js ***!
  \**********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getRedisClient: () => (/* binding */ getRedisClient),\n/* harmony export */   redisPromise: () => (/* binding */ redisPromise)\n/* harmony export */ });\n// /lib/redis.js\nlet client = null;\n/** Normalize options like { EX: 60 } -> { ex: 60 } */ function normalizeSetOpts(opts = {}) {\n    if (!opts) return undefined;\n    const ex = opts.ex ?? opts.EX ?? undefined;\n    const px = opts.px ?? opts.PX ?? undefined;\n    const out = {};\n    if (ex != null) out.ex = ex;\n    if (px != null) out.px = px;\n    return Object.keys(out).length ? out : undefined;\n}\n// Wrap Upstash client to match a minimal common API\nfunction wrapUpstash(upstash) {\n    return {\n        get: (k)=>upstash.get(k),\n        set: (k, v, opts)=>upstash.set(k, v, normalizeSetOpts(opts)),\n        del: (k)=>upstash.del(k),\n        incr: (k)=>upstash.incr(k),\n        expire: (k, s)=>upstash.expire(k, s)\n    };\n}\n// Wrap node-redis (TCP) to match the same API\nfunction wrapTcp(nodeClient) {\n    return {\n        get: (k)=>nodeClient.get(k),\n        set: (k, v, opts)=>nodeClient.set(k, v, normalizeSetOpts(opts)),\n        del: (k)=>nodeClient.del(k),\n        incr: (k)=>nodeClient.incr(k),\n        expire: (k, s)=>nodeClient.expire(k, s)\n    };\n}\nasync function getRedisClient() {\n    if (client) return client;\n    // Prefer Upstash REST if present\n    if (process.env.UPSTASH_REDIS_REST_URL && process.env.UPSTASH_REDIS_REST_TOKEN) {\n        const { Redis } = await Promise.resolve(/*! import() */).then(__webpack_require__.bind(__webpack_require__, /*! @upstash/redis */ \"@upstash/redis\"));\n        const upstash = new Redis({\n            url: process.env.UPSTASH_REDIS_REST_URL,\n            token: process.env.UPSTASH_REDIS_REST_TOKEN\n        });\n        client = wrapUpstash(upstash);\n        return client;\n    }\n    // Fallback to TCP Redis via node-redis (requires REDIS_URL)\n    const { createClient } = await Promise.resolve(/*! import() */).then(__webpack_require__.t.bind(__webpack_require__, /*! redis */ \"redis\", 23));\n    const raw = createClient({\n        url: process.env.REDIS_URL || 'redis://localhost:6379',\n        socket: {\n            reconnectStrategy: (retries)=>retries > 5 ? new Error('Max reconnect attempts reached') : 1000\n        }\n    });\n    raw.on('error', (err)=>console.error('âŒ Redis Error:', err));\n    try {\n        await raw.connect();\n        console.log('âœ… Connected to Redis (TCP)');\n    } catch (err) {\n        console.warn('âš ï¸ Redis connection failed:', err.message);\n    }\n    client = wrapTcp(raw);\n    return client;\n}\n// Export a promise you can await where needed (no top-level await)\nconst redisPromise = getRedisClient();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QyxlQUFldkIsaUJBQWlCIiwic291cmNlcyI6WyIvVXNlcnMvZW1vbnRhemVyaS9Eb2N1bWVudHMvcHJvamVjdHMvc2hlbGwtc3Rvcmllcy1zdHVkaW8vbGliL3JlZGlzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIC9saWIvcmVkaXMuanNcblxubGV0IGNsaWVudCA9IG51bGw7XG5cbi8qKiBOb3JtYWxpemUgb3B0aW9ucyBsaWtlIHsgRVg6IDYwIH0gLT4geyBleDogNjAgfSAqL1xuZnVuY3Rpb24gbm9ybWFsaXplU2V0T3B0cyhvcHRzID0ge30pIHtcbiAgaWYgKCFvcHRzKSByZXR1cm4gdW5kZWZpbmVkO1xuICBjb25zdCBleCA9IG9wdHMuZXggPz8gb3B0cy5FWCA/PyB1bmRlZmluZWQ7XG4gIGNvbnN0IHB4ID0gb3B0cy5weCA/PyBvcHRzLlBYID8/IHVuZGVmaW5lZDtcbiAgY29uc3Qgb3V0ID0ge307XG4gIGlmIChleCAhPSBudWxsKSBvdXQuZXggPSBleDtcbiAgaWYgKHB4ICE9IG51bGwpIG91dC5weCA9IHB4O1xuICByZXR1cm4gT2JqZWN0LmtleXMob3V0KS5sZW5ndGggPyBvdXQgOiB1bmRlZmluZWQ7XG59XG5cbi8vIFdyYXAgVXBzdGFzaCBjbGllbnQgdG8gbWF0Y2ggYSBtaW5pbWFsIGNvbW1vbiBBUElcbmZ1bmN0aW9uIHdyYXBVcHN0YXNoKHVwc3Rhc2gpIHtcbiAgcmV0dXJuIHtcbiAgICBnZXQ6IChrKSA9PiB1cHN0YXNoLmdldChrKSxcbiAgICBzZXQ6IChrLCB2LCBvcHRzKSA9PiB1cHN0YXNoLnNldChrLCB2LCBub3JtYWxpemVTZXRPcHRzKG9wdHMpKSxcbiAgICBkZWw6IChrKSA9PiB1cHN0YXNoLmRlbChrKSxcbiAgICBpbmNyOiAoaykgPT4gdXBzdGFzaC5pbmNyKGspLFxuICAgIGV4cGlyZTogKGssIHMpID0+IHVwc3Rhc2guZXhwaXJlKGssIHMpLFxuICB9O1xufVxuXG4vLyBXcmFwIG5vZGUtcmVkaXMgKFRDUCkgdG8gbWF0Y2ggdGhlIHNhbWUgQVBJXG5mdW5jdGlvbiB3cmFwVGNwKG5vZGVDbGllbnQpIHtcbiAgcmV0dXJuIHtcbiAgICBnZXQ6IChrKSA9PiBub2RlQ2xpZW50LmdldChrKSxcbiAgICBzZXQ6IChrLCB2LCBvcHRzKSA9PiBub2RlQ2xpZW50LnNldChrLCB2LCBub3JtYWxpemVTZXRPcHRzKG9wdHMpKSxcbiAgICBkZWw6IChrKSA9PiBub2RlQ2xpZW50LmRlbChrKSxcbiAgICBpbmNyOiAoaykgPT4gbm9kZUNsaWVudC5pbmNyKGspLFxuICAgIGV4cGlyZTogKGssIHMpID0+IG5vZGVDbGllbnQuZXhwaXJlKGssIHMpLFxuICB9O1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0UmVkaXNDbGllbnQoKSB7XG4gIGlmIChjbGllbnQpIHJldHVybiBjbGllbnQ7XG5cbiAgLy8gUHJlZmVyIFVwc3Rhc2ggUkVTVCBpZiBwcmVzZW50XG4gIGlmIChwcm9jZXNzLmVudi5VUFNUQVNIX1JFRElTX1JFU1RfVVJMICYmIHByb2Nlc3MuZW52LlVQU1RBU0hfUkVESVNfUkVTVF9UT0tFTikge1xuICAgIGNvbnN0IHsgUmVkaXMgfSA9IGF3YWl0IGltcG9ydCgnQHVwc3Rhc2gvcmVkaXMnKTtcbiAgICBjb25zdCB1cHN0YXNoID0gbmV3IFJlZGlzKHtcbiAgICAgIHVybDogcHJvY2Vzcy5lbnYuVVBTVEFTSF9SRURJU19SRVNUX1VSTCxcbiAgICAgIHRva2VuOiBwcm9jZXNzLmVudi5VUFNUQVNIX1JFRElTX1JFU1RfVE9LRU4sXG4gICAgfSk7XG4gICAgY2xpZW50ID0gd3JhcFVwc3Rhc2godXBzdGFzaCk7XG4gICAgcmV0dXJuIGNsaWVudDtcbiAgfVxuXG4gIC8vIEZhbGxiYWNrIHRvIFRDUCBSZWRpcyB2aWEgbm9kZS1yZWRpcyAocmVxdWlyZXMgUkVESVNfVVJMKVxuICBjb25zdCB7IGNyZWF0ZUNsaWVudCB9ID0gYXdhaXQgaW1wb3J0KCdyZWRpcycpO1xuXG4gIGNvbnN0IHJhdyA9IGNyZWF0ZUNsaWVudCh7XG4gICAgdXJsOiBwcm9jZXNzLmVudi5SRURJU19VUkwgfHwgJ3JlZGlzOi8vbG9jYWxob3N0OjYzNzknLFxuICAgIHNvY2tldDoge1xuICAgICAgcmVjb25uZWN0U3RyYXRlZ3k6IChyZXRyaWVzKSA9PiAocmV0cmllcyA+IDUgPyBuZXcgRXJyb3IoJ01heCByZWNvbm5lY3QgYXR0ZW1wdHMgcmVhY2hlZCcpIDogMTAwMCksXG4gICAgfSxcbiAgfSk7XG5cbiAgcmF3Lm9uKCdlcnJvcicsIChlcnIpID0+IGNvbnNvbGUuZXJyb3IoJ+KdjCBSZWRpcyBFcnJvcjonLCBlcnIpKTtcblxuICB0cnkge1xuICAgIGF3YWl0IHJhdy5jb25uZWN0KCk7XG4gICAgY29uc29sZS5sb2coJ+KchSBDb25uZWN0ZWQgdG8gUmVkaXMgKFRDUCknKTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgY29uc29sZS53YXJuKCfimqDvuI8gUmVkaXMgY29ubmVjdGlvbiBmYWlsZWQ6JywgZXJyLm1lc3NhZ2UpO1xuICB9XG5cbiAgY2xpZW50ID0gd3JhcFRjcChyYXcpO1xuICByZXR1cm4gY2xpZW50O1xufVxuXG4vLyBFeHBvcnQgYSBwcm9taXNlIHlvdSBjYW4gYXdhaXQgd2hlcmUgbmVlZGVkIChubyB0b3AtbGV2ZWwgYXdhaXQpXG5leHBvcnQgY29uc3QgcmVkaXNQcm9taXNlID0gZ2V0UmVkaXNDbGllbnQoKTtcblxuXG5cblxuIl0sIm5hbWVzIjpbImNsaWVudCIsIm5vcm1hbGl6ZVNldE9wdHMiLCJvcHRzIiwidW5kZWZpbmVkIiwiZXgiLCJFWCIsInB4IiwiUFgiLCJvdXQiLCJPYmplY3QiLCJrZXlzIiwibGVuZ3RoIiwid3JhcFVwc3Rhc2giLCJ1cHN0YXNoIiwiZ2V0IiwiayIsInNldCIsInYiLCJkZWwiLCJpbmNyIiwiZXhwaXJlIiwicyIsIndyYXBUY3AiLCJub2RlQ2xpZW50IiwiZ2V0UmVkaXNDbGllbnQiLCJwcm9jZXNzIiwiZW52IiwiVVBTVEFTSF9SRURJU19SRVNUX1VSTCIsIlVQU1RBU0hfUkVESVNfUkVTVF9UT0tFTiIsIlJlZGlzIiwidXJsIiwidG9rZW4iLCJjcmVhdGVDbGllbnQiLCJyYXciLCJSRURJU19VUkwiLCJzb2NrZXQiLCJyZWNvbm5lY3RTdHJhdGVneSIsInJldHJpZXMiLCJFcnJvciIsIm9uIiwiZXJyIiwiY29uc29sZSIsImVycm9yIiwiY29ubmVjdCIsImxvZyIsIndhcm4iLCJtZXNzYWdlIiwicmVkaXNQcm9taXNlIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api-node)/./lib/redis.js\n");

/***/ }),

/***/ "(api-node)/./lib/redis/formatkey.js":
/*!********************************!*\
  !*** ./lib/redis/formatkey.js ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   safeRedisKey: () => (/* binding */ safeRedisKey)\n/* harmony export */ });\n// lib/redis/formatKey.js\n/**\n * Safely formats an array of strings or values into a sanitized Redis key.\n * It removes dangerous characters and limits each segment to 64 characters.\n * @param {string[]} parts - Array of key segments\n * @returns {string} - Safe Redis key\n */ function safeRedisKey(parts = []) {\n    return parts.map((p)=>String(p || '').trim().replace(/[^a-zA-Z0-9:_-]/g, '') // remove unsafe characters\n        .slice(0, 64) // limit each part\n    ).join(':');\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL2xpYi9yZWRpcy9mb3JtYXRrZXkuanMiLCJtYXBwaW5ncyI6Ijs7OztBQUFBLHlCQUF5QjtBQUV6Qjs7Ozs7Q0FLQyxHQUNNLFNBQVNBLGFBQWFDLFFBQVEsRUFBRTtJQUNuQyxPQUFPQSxNQUNKQyxHQUFHLENBQUNDLENBQUFBLElBQ0hDLE9BQU9ELEtBQUssSUFDVEUsSUFBSSxHQUNKQyxPQUFPLENBQUMsb0JBQW9CLElBQUksMkJBQTJCO1NBQzNEQyxLQUFLLENBQUMsR0FBRyxJQUF1QixrQkFBa0I7TUFFdERDLElBQUksQ0FBQztBQUNWIiwic291cmNlcyI6WyIvVXNlcnMvZW1vbnRhemVyaS9Eb2N1bWVudHMvcHJvamVjdHMvc2hlbGwtc3Rvcmllcy1zdHVkaW8vbGliL3JlZGlzL2Zvcm1hdGtleS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBsaWIvcmVkaXMvZm9ybWF0S2V5LmpzXG5cbi8qKlxuICogU2FmZWx5IGZvcm1hdHMgYW4gYXJyYXkgb2Ygc3RyaW5ncyBvciB2YWx1ZXMgaW50byBhIHNhbml0aXplZCBSZWRpcyBrZXkuXG4gKiBJdCByZW1vdmVzIGRhbmdlcm91cyBjaGFyYWN0ZXJzIGFuZCBsaW1pdHMgZWFjaCBzZWdtZW50IHRvIDY0IGNoYXJhY3RlcnMuXG4gKiBAcGFyYW0ge3N0cmluZ1tdfSBwYXJ0cyAtIEFycmF5IG9mIGtleSBzZWdtZW50c1xuICogQHJldHVybnMge3N0cmluZ30gLSBTYWZlIFJlZGlzIGtleVxuICovXG5leHBvcnQgZnVuY3Rpb24gc2FmZVJlZGlzS2V5KHBhcnRzID0gW10pIHtcbiAgICByZXR1cm4gcGFydHNcbiAgICAgIC5tYXAocCA9PlxuICAgICAgICBTdHJpbmcocCB8fCAnJylcbiAgICAgICAgICAudHJpbSgpXG4gICAgICAgICAgLnJlcGxhY2UoL1teYS16QS1aMC05Ol8tXS9nLCAnJykgLy8gcmVtb3ZlIHVuc2FmZSBjaGFyYWN0ZXJzXG4gICAgICAgICAgLnNsaWNlKDAsIDY0KSAgICAgICAgICAgICAgICAgICAgLy8gbGltaXQgZWFjaCBwYXJ0XG4gICAgICApXG4gICAgICAuam9pbignOicpO1xuICB9XG4gIFxuICAiXSwibmFtZXMiOlsic2FmZVJlZGlzS2V5IiwicGFydHMiLCJtYXAiLCJwIiwiU3RyaW5nIiwidHJpbSIsInJlcGxhY2UiLCJzbGljZSIsImpvaW4iXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api-node)/./lib/redis/formatkey.js\n");

/***/ }),

/***/ "(api-node)/./lib/utils/sanitizeProductFields.js":
/*!********************************************!*\
  !*** ./lib/utils/sanitizeProductFields.js ***!
  \********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   sanitizeProductFields: () => (/* binding */ sanitizeProductFields)\n/* harmony export */ });\n/* harmony import */ var sanitize_html__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! sanitize-html */ \"sanitize-html\");\n/* harmony import */ var sanitize_html__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(sanitize_html__WEBPACK_IMPORTED_MODULE_0__);\n// lib/sanitize/sanitizeProductFields.js\n\nfunction sanitizeProductFields(input) {\n    return {\n        name: sanitizeText(input.name),\n        description: sanitize_html__WEBPACK_IMPORTED_MODULE_0___default()(input.description || '', {\n            allowedTags: [],\n            allowedAttributes: {}\n        }),\n        price: sanitizeNumber(input.price),\n        stock: sanitizeInteger(input.stock),\n        image_url: sanitizeUrl(input.image_url),\n        image_public_id: sanitizeText(input.image_public_id),\n        category: sanitizeText(input.category),\n        is_active: input.is_active === 1 ? 1 : 0,\n        is_favorite: input.is_favorite === 1 ? 1 : 0\n    };\n}\nfunction sanitizeText(text) {\n    return String(text || '').trim().slice(0, 255);\n}\nfunction sanitizeNumber(value) {\n    const num = parseFloat(value);\n    return isNaN(num) || num < 0 ? 0 : num;\n}\nfunction sanitizeInteger(value) {\n    const int = parseInt(value, 10);\n    return isNaN(int) || int < 0 ? 0 : int;\n}\nfunction sanitizeUrl(url) {\n    try {\n        const u = new URL(url);\n        return u.href;\n    } catch  {\n        return '';\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL2xpYi91dGlscy9zYW5pdGl6ZVByb2R1Y3RGaWVsZHMuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsd0NBQXdDO0FBQ0M7QUFFbEMsU0FBU0Msc0JBQXNCQyxLQUFLO0lBQ3pDLE9BQU87UUFDTEMsTUFBTUMsYUFBYUYsTUFBTUMsSUFBSTtRQUM3QkUsYUFBYUwsb0RBQVlBLENBQUNFLE1BQU1HLFdBQVcsSUFBSSxJQUFJO1lBQ2pEQyxhQUFhLEVBQUU7WUFDZkMsbUJBQW1CLENBQUM7UUFDdEI7UUFDQUMsT0FBT0MsZUFBZVAsTUFBTU0sS0FBSztRQUNqQ0UsT0FBT0MsZ0JBQWdCVCxNQUFNUSxLQUFLO1FBQ2xDRSxXQUFXQyxZQUFZWCxNQUFNVSxTQUFTO1FBQ3RDRSxpQkFBaUJWLGFBQWFGLE1BQU1ZLGVBQWU7UUFDbkRDLFVBQVVYLGFBQWFGLE1BQU1hLFFBQVE7UUFDckNDLFdBQVdkLE1BQU1jLFNBQVMsS0FBSyxJQUFJLElBQUk7UUFDdkNDLGFBQWFmLE1BQU1lLFdBQVcsS0FBSyxJQUFJLElBQUk7SUFDN0M7QUFDRjtBQUVBLFNBQVNiLGFBQWFjLElBQUk7SUFDeEIsT0FBT0MsT0FBT0QsUUFBUSxJQUFJRSxJQUFJLEdBQUdDLEtBQUssQ0FBQyxHQUFHO0FBQzVDO0FBRUEsU0FBU1osZUFBZWEsS0FBSztJQUMzQixNQUFNQyxNQUFNQyxXQUFXRjtJQUN2QixPQUFPRyxNQUFNRixRQUFRQSxNQUFNLElBQUksSUFBSUE7QUFDckM7QUFFQSxTQUFTWixnQkFBZ0JXLEtBQUs7SUFDNUIsTUFBTUksTUFBTUMsU0FBU0wsT0FBTztJQUM1QixPQUFPRyxNQUFNQyxRQUFRQSxNQUFNLElBQUksSUFBSUE7QUFDckM7QUFFQSxTQUFTYixZQUFZZSxHQUFHO0lBQ3RCLElBQUk7UUFDRixNQUFNQyxJQUFJLElBQUlDLElBQUlGO1FBQ2xCLE9BQU9DLEVBQUVFLElBQUk7SUFDZixFQUFFLE9BQU07UUFDTixPQUFPO0lBQ1Q7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL2Vtb250YXplcmkvRG9jdW1lbnRzL3Byb2plY3RzL3NoZWxsLXN0b3JpZXMtc3R1ZGlvL2xpYi91dGlscy9zYW5pdGl6ZVByb2R1Y3RGaWVsZHMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gbGliL3Nhbml0aXplL3Nhbml0aXplUHJvZHVjdEZpZWxkcy5qc1xuaW1wb3J0IHNhbml0aXplSHRtbCBmcm9tICdzYW5pdGl6ZS1odG1sJztcblxuZXhwb3J0IGZ1bmN0aW9uIHNhbml0aXplUHJvZHVjdEZpZWxkcyhpbnB1dCkge1xuICByZXR1cm4ge1xuICAgIG5hbWU6IHNhbml0aXplVGV4dChpbnB1dC5uYW1lKSxcbiAgICBkZXNjcmlwdGlvbjogc2FuaXRpemVIdG1sKGlucHV0LmRlc2NyaXB0aW9uIHx8ICcnLCB7XG4gICAgICBhbGxvd2VkVGFnczogW10sXG4gICAgICBhbGxvd2VkQXR0cmlidXRlczoge30sXG4gICAgfSksXG4gICAgcHJpY2U6IHNhbml0aXplTnVtYmVyKGlucHV0LnByaWNlKSxcbiAgICBzdG9jazogc2FuaXRpemVJbnRlZ2VyKGlucHV0LnN0b2NrKSxcbiAgICBpbWFnZV91cmw6IHNhbml0aXplVXJsKGlucHV0LmltYWdlX3VybCksXG4gICAgaW1hZ2VfcHVibGljX2lkOiBzYW5pdGl6ZVRleHQoaW5wdXQuaW1hZ2VfcHVibGljX2lkKSxcbiAgICBjYXRlZ29yeTogc2FuaXRpemVUZXh0KGlucHV0LmNhdGVnb3J5KSxcbiAgICBpc19hY3RpdmU6IGlucHV0LmlzX2FjdGl2ZSA9PT0gMSA/IDEgOiAwLFxuICAgIGlzX2Zhdm9yaXRlOiBpbnB1dC5pc19mYXZvcml0ZSA9PT0gMSA/IDEgOiAwLFxuICB9O1xufVxuXG5mdW5jdGlvbiBzYW5pdGl6ZVRleHQodGV4dCkge1xuICByZXR1cm4gU3RyaW5nKHRleHQgfHwgJycpLnRyaW0oKS5zbGljZSgwLCAyNTUpO1xufVxuXG5mdW5jdGlvbiBzYW5pdGl6ZU51bWJlcih2YWx1ZSkge1xuICBjb25zdCBudW0gPSBwYXJzZUZsb2F0KHZhbHVlKTtcbiAgcmV0dXJuIGlzTmFOKG51bSkgfHwgbnVtIDwgMCA/IDAgOiBudW07XG59XG5cbmZ1bmN0aW9uIHNhbml0aXplSW50ZWdlcih2YWx1ZSkge1xuICBjb25zdCBpbnQgPSBwYXJzZUludCh2YWx1ZSwgMTApO1xuICByZXR1cm4gaXNOYU4oaW50KSB8fCBpbnQgPCAwID8gMCA6IGludDtcbn1cblxuZnVuY3Rpb24gc2FuaXRpemVVcmwodXJsKSB7XG4gIHRyeSB7XG4gICAgY29uc3QgdSA9IG5ldyBVUkwodXJsKTtcbiAgICByZXR1cm4gdS5ocmVmO1xuICB9IGNhdGNoIHtcbiAgICByZXR1cm4gJyc7XG4gIH1cbn1cblxuIl0sIm5hbWVzIjpbInNhbml0aXplSHRtbCIsInNhbml0aXplUHJvZHVjdEZpZWxkcyIsImlucHV0IiwibmFtZSIsInNhbml0aXplVGV4dCIsImRlc2NyaXB0aW9uIiwiYWxsb3dlZFRhZ3MiLCJhbGxvd2VkQXR0cmlidXRlcyIsInByaWNlIiwic2FuaXRpemVOdW1iZXIiLCJzdG9jayIsInNhbml0aXplSW50ZWdlciIsImltYWdlX3VybCIsInNhbml0aXplVXJsIiwiaW1hZ2VfcHVibGljX2lkIiwiY2F0ZWdvcnkiLCJpc19hY3RpdmUiLCJpc19mYXZvcml0ZSIsInRleHQiLCJTdHJpbmciLCJ0cmltIiwic2xpY2UiLCJ2YWx1ZSIsIm51bSIsInBhcnNlRmxvYXQiLCJpc05hTiIsImludCIsInBhcnNlSW50IiwidXJsIiwidSIsIlVSTCIsImhyZWYiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api-node)/./lib/utils/sanitizeProductFields.js\n");

/***/ }),

/***/ "(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fadmin%2Fmanage_products%2F%5Bid%5D&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fadmin%2Fmanage_products%2F%5Bid%5D.js&middlewareConfigBase64=e30%3D!":
/*!**************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fadmin%2Fmanage_products%2F%5Bid%5D&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fadmin%2Fmanage_products%2F%5Bid%5D.js&middlewareConfigBase64=e30%3D! ***!
  \**************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   handler: () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_api_utils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/api-utils */ \"(api-node)/./node_modules/next/dist/server/api-utils/index.js\");\n/* harmony import */ var next_dist_server_api_utils__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_api_utils__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/route-kind */ \"(api-node)/./node_modules/next/dist/server/route-kind.js\");\n/* harmony import */ var next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/route-modules/pages-api/module.compiled */ \"(api-node)/./node_modules/next/dist/server/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api-node)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_admin_manage_products_id_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./pages/api/admin/manage_products/[id].js */ \"(api-node)/./pages/api/admin/manage_products/[id].js\");\n/* harmony import */ var next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! next/dist/server/lib/trace/tracer */ \"(api-node)/./node_modules/next/dist/server/lib/trace/tracer.js\");\n/* harmony import */ var next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_5__);\n/* harmony import */ var next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! next/dist/server/lib/trace/constants */ \"(api-node)/./node_modules/next/dist/server/lib/trace/constants.js\");\n/* harmony import */ var next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_6___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_6__);\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_pages_api_admin_manage_products_id_js__WEBPACK_IMPORTED_MODULE_4__]);\n_pages_api_admin_manage_products_id_js__WEBPACK_IMPORTED_MODULE_4__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\n// Import the userland code.\n\n\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_3__.hoist)(_pages_api_admin_manage_products_id_js__WEBPACK_IMPORTED_MODULE_4__, 'default'));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_3__.hoist)(_pages_api_admin_manage_products_id_js__WEBPACK_IMPORTED_MODULE_4__, 'config');\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_2__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/admin/manage_products/[id]\",\n        pathname: \"/api/admin/manage_products/[id]\",\n        // The following aren't used in production.\n        bundlePath: '',\n        filename: ''\n    },\n    userland: _pages_api_admin_manage_products_id_js__WEBPACK_IMPORTED_MODULE_4__,\n    distDir: \".next\" || 0,\n    relativeProjectDir:  false || ''\n});\nasync function handler(req, res, ctx) {\n    let srcPage = \"/api/admin/manage_products/[id]\";\n    // turbopack doesn't normalize `/index` in the page name\n    // so we need to to process dynamic routes properly\n    // TODO: fix turbopack providing differing value from webpack\n    if (false) {}\n    const prepareResult = await routeModule.prepare(req, res, {\n        srcPage\n    });\n    if (!prepareResult) {\n        res.statusCode = 400;\n        res.end('Bad Request');\n        ctx.waitUntil == null ? void 0 : ctx.waitUntil.call(ctx, Promise.resolve());\n        return;\n    }\n    const { query, params, prerenderManifest, routerServerContext } = prepareResult;\n    try {\n        const method = req.method || 'GET';\n        const tracer = (0,next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_5__.getTracer)();\n        const activeSpan = tracer.getActiveScopeSpan();\n        const onRequestError = routeModule.instrumentationOnRequestError.bind(routeModule);\n        const invokeRouteModule = async (span)=>routeModule.render(req, res, {\n                query: {\n                    ...query,\n                    ...params\n                },\n                params,\n                allowedRevalidateHeaderKeys: [],\n                multiZoneDraftMode: Boolean(false),\n                trustHostHeader: false,\n                // TODO: get this from from runtime env so manifest\n                // doesn't need to load\n                previewProps: prerenderManifest.preview,\n                propagateError: false,\n                dev: routeModule.isDev,\n                page: \"/api/admin/manage_products/[id]\",\n                internalRevalidate: routerServerContext == null ? void 0 : routerServerContext.revalidate,\n                onError: (...args)=>onRequestError(req, ...args)\n            }).finally(()=>{\n                if (!span) return;\n                span.setAttributes({\n                    'http.status_code': res.statusCode,\n                    'next.rsc': false\n                });\n                const rootSpanAttributes = tracer.getRootSpanAttributes();\n                // We were unable to get attributes, probably OTEL is not enabled\n                if (!rootSpanAttributes) {\n                    return;\n                }\n                if (rootSpanAttributes.get('next.span_type') !== next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_6__.BaseServerSpan.handleRequest) {\n                    console.warn(`Unexpected root span type '${rootSpanAttributes.get('next.span_type')}'. Please report this Next.js issue https://github.com/vercel/next.js`);\n                    return;\n                }\n                const route = rootSpanAttributes.get('next.route');\n                if (route) {\n                    const name = `${method} ${route}`;\n                    span.setAttributes({\n                        'next.route': route,\n                        'http.route': route,\n                        'next.span_name': name\n                    });\n                    span.updateName(name);\n                } else {\n                    span.updateName(`${method} ${req.url}`);\n                }\n            });\n        // TODO: activeSpan code path is for when wrapped by\n        // next-server can be removed when this is no longer used\n        if (activeSpan) {\n            await invokeRouteModule(activeSpan);\n        } else {\n            await tracer.withPropagatedContext(req.headers, ()=>tracer.trace(next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_6__.BaseServerSpan.handleRequest, {\n                    spanName: `${method} ${req.url}`,\n                    kind: next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_5__.SpanKind.SERVER,\n                    attributes: {\n                        'http.method': method,\n                        'http.target': req.url\n                    }\n                }, invokeRouteModule));\n        }\n    } catch (err) {\n        // we re-throw in dev to show the error overlay\n        if (routeModule.isDev) {\n            throw err;\n        }\n        // this is technically an invariant as error handling\n        // should be done inside of api-resolver onError\n        (0,next_dist_server_api_utils__WEBPACK_IMPORTED_MODULE_0__.sendError)(res, 500, 'Internal Server Error');\n    } finally{\n        // We don't allow any waitUntil work in pages API routes currently\n        // so if callback is present return with resolved promise since no\n        // pending work\n        ctx.waitUntil == null ? void 0 : ctx.waitUntil.call(ctx, Promise.resolve());\n    }\n}\n\n//# sourceMappingURL=pages-api.js.map\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL25vZGVfbW9kdWxlcy9uZXh0L2Rpc3QvYnVpbGQvd2VicGFjay9sb2FkZXJzL25leHQtcm91dGUtbG9hZGVyL2luZGV4LmpzP2tpbmQ9UEFHRVNfQVBJJnBhZ2U9JTJGYXBpJTJGYWRtaW4lMkZtYW5hZ2VfcHJvZHVjdHMlMkYlNUJpZCU1RCZwcmVmZXJyZWRSZWdpb249JmFic29sdXRlUGFnZVBhdGg9LiUyRnBhZ2VzJTJGYXBpJTJGYWRtaW4lMkZtYW5hZ2VfcHJvZHVjdHMlMkYlNUJpZCU1RC5qcyZtaWRkbGV3YXJlQ29uZmlnQmFzZTY0PWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBdUQ7QUFDQztBQUN1QztBQUNyQztBQUMxRDtBQUNzRTtBQUNFO0FBQ0Y7QUFDdEU7QUFDQSxpRUFBZSx3RUFBSyxDQUFDLG1FQUFRLFlBQVksRUFBQztBQUMxQztBQUNPLGVBQWUsd0VBQUssQ0FBQyxtRUFBUTtBQUNwQztBQUNBLHdCQUF3Qix5R0FBbUI7QUFDM0M7QUFDQSxjQUFjLGtFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsWUFBWTtBQUNaLGFBQWEsT0FBb0MsSUFBSSxDQUFFO0FBQ3ZELHdCQUF3QixNQUF1QztBQUMvRCxDQUFDO0FBQ007QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVEsS0FBcUIsRUFBRSxFQUUxQjtBQUNMO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSx3REFBd0Q7QUFDcEU7QUFDQTtBQUNBLHVCQUF1Qiw0RUFBUztBQUNoQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQSw2Q0FBNkMsRUFBNkM7QUFDMUYsNENBQTRDLEtBQXdDO0FBQ3BGLGlDQUFpQyxLQUFvQztBQUNyRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpRUFBaUUsZ0ZBQWM7QUFDL0UsK0RBQStELHlDQUF5QztBQUN4RztBQUNBO0FBQ0E7QUFDQTtBQUNBLG9DQUFvQyxRQUFRLEVBQUUsTUFBTTtBQUNwRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBLGtCQUFrQjtBQUNsQix1Q0FBdUMsUUFBUSxFQUFFLFFBQVE7QUFDekQ7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1YsNkVBQTZFLGdGQUFjO0FBQzNGLGlDQUFpQyxRQUFRLEVBQUUsUUFBUTtBQUNuRCwwQkFBMEIsdUVBQVE7QUFDbEM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUSxxRUFBUztBQUNqQixNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBIiwic291cmNlcyI6WyIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgc2VuZEVycm9yIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvYXBpLXV0aWxzXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBQYWdlc0FQSVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvcm91dGUtbW9kdWxlcy9wYWdlcy1hcGkvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBob2lzdCB9IGZyb20gXCJuZXh0L2Rpc3QvYnVpbGQvdGVtcGxhdGVzL2hlbHBlcnNcIjtcbi8vIEltcG9ydCB0aGUgdXNlcmxhbmQgY29kZS5cbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIuL3BhZ2VzL2FwaS9hZG1pbi9tYW5hZ2VfcHJvZHVjdHMvW2lkXS5qc1wiO1xuaW1wb3J0IHsgZ2V0VHJhY2VyLCBTcGFuS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi90cmFjZS90cmFjZXJcIjtcbmltcG9ydCB7IEJhc2VTZXJ2ZXJTcGFuIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3RyYWNlL2NvbnN0YW50c1wiO1xuLy8gUmUtZXhwb3J0IHRoZSBoYW5kbGVyIChzaG91bGQgYmUgdGhlIGRlZmF1bHQgZXhwb3J0KS5cbmV4cG9ydCBkZWZhdWx0IGhvaXN0KHVzZXJsYW5kLCAnZGVmYXVsdCcpO1xuLy8gUmUtZXhwb3J0IGNvbmZpZy5cbmV4cG9ydCBjb25zdCBjb25maWcgPSBob2lzdCh1c2VybGFuZCwgJ2NvbmZpZycpO1xuLy8gQ3JlYXRlIGFuZCBleHBvcnQgdGhlIHJvdXRlIG1vZHVsZSB0aGF0IHdpbGwgYmUgY29uc3VtZWQuXG5jb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBQYWdlc0FQSVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5QQUdFU19BUEksXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9hZG1pbi9tYW5hZ2VfcHJvZHVjdHMvW2lkXVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL2FkbWluL21hbmFnZV9wcm9kdWN0cy9baWRdXCIsXG4gICAgICAgIC8vIFRoZSBmb2xsb3dpbmcgYXJlbid0IHVzZWQgaW4gcHJvZHVjdGlvbi5cbiAgICAgICAgYnVuZGxlUGF0aDogJycsXG4gICAgICAgIGZpbGVuYW1lOiAnJ1xuICAgIH0sXG4gICAgdXNlcmxhbmQsXG4gICAgZGlzdERpcjogcHJvY2Vzcy5lbnYuX19ORVhUX1JFTEFUSVZFX0RJU1RfRElSIHx8ICcnLFxuICAgIHJlbGF0aXZlUHJvamVjdERpcjogcHJvY2Vzcy5lbnYuX19ORVhUX1JFTEFUSVZFX1BST0pFQ1RfRElSIHx8ICcnXG59KTtcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBoYW5kbGVyKHJlcSwgcmVzLCBjdHgpIHtcbiAgICBsZXQgc3JjUGFnZSA9IFwiL2FwaS9hZG1pbi9tYW5hZ2VfcHJvZHVjdHMvW2lkXVwiO1xuICAgIC8vIHR1cmJvcGFjayBkb2Vzbid0IG5vcm1hbGl6ZSBgL2luZGV4YCBpbiB0aGUgcGFnZSBuYW1lXG4gICAgLy8gc28gd2UgbmVlZCB0byB0byBwcm9jZXNzIGR5bmFtaWMgcm91dGVzIHByb3Blcmx5XG4gICAgLy8gVE9ETzogZml4IHR1cmJvcGFjayBwcm92aWRpbmcgZGlmZmVyaW5nIHZhbHVlIGZyb20gd2VicGFja1xuICAgIGlmIChwcm9jZXNzLmVudi5UVVJCT1BBQ0spIHtcbiAgICAgICAgc3JjUGFnZSA9IHNyY1BhZ2UucmVwbGFjZSgvXFwvaW5kZXgkLywgJycpIHx8ICcvJztcbiAgICB9XG4gICAgY29uc3QgcHJlcGFyZVJlc3VsdCA9IGF3YWl0IHJvdXRlTW9kdWxlLnByZXBhcmUocmVxLCByZXMsIHtcbiAgICAgICAgc3JjUGFnZVxuICAgIH0pO1xuICAgIGlmICghcHJlcGFyZVJlc3VsdCkge1xuICAgICAgICByZXMuc3RhdHVzQ29kZSA9IDQwMDtcbiAgICAgICAgcmVzLmVuZCgnQmFkIFJlcXVlc3QnKTtcbiAgICAgICAgY3R4LndhaXRVbnRpbCA9PSBudWxsID8gdm9pZCAwIDogY3R4LndhaXRVbnRpbC5jYWxsKGN0eCwgUHJvbWlzZS5yZXNvbHZlKCkpO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IHsgcXVlcnksIHBhcmFtcywgcHJlcmVuZGVyTWFuaWZlc3QsIHJvdXRlclNlcnZlckNvbnRleHQgfSA9IHByZXBhcmVSZXN1bHQ7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgbWV0aG9kID0gcmVxLm1ldGhvZCB8fCAnR0VUJztcbiAgICAgICAgY29uc3QgdHJhY2VyID0gZ2V0VHJhY2VyKCk7XG4gICAgICAgIGNvbnN0IGFjdGl2ZVNwYW4gPSB0cmFjZXIuZ2V0QWN0aXZlU2NvcGVTcGFuKCk7XG4gICAgICAgIGNvbnN0IG9uUmVxdWVzdEVycm9yID0gcm91dGVNb2R1bGUuaW5zdHJ1bWVudGF0aW9uT25SZXF1ZXN0RXJyb3IuYmluZChyb3V0ZU1vZHVsZSk7XG4gICAgICAgIGNvbnN0IGludm9rZVJvdXRlTW9kdWxlID0gYXN5bmMgKHNwYW4pPT5yb3V0ZU1vZHVsZS5yZW5kZXIocmVxLCByZXMsIHtcbiAgICAgICAgICAgICAgICBxdWVyeToge1xuICAgICAgICAgICAgICAgICAgICAuLi5xdWVyeSxcbiAgICAgICAgICAgICAgICAgICAgLi4ucGFyYW1zXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBwYXJhbXMsXG4gICAgICAgICAgICAgICAgYWxsb3dlZFJldmFsaWRhdGVIZWFkZXJLZXlzOiBwcm9jZXNzLmVudi5fX05FWFRfQUxMT1dFRF9SRVZBTElEQVRFX0hFQURFUlMsXG4gICAgICAgICAgICAgICAgbXVsdGlab25lRHJhZnRNb2RlOiBCb29sZWFuKHByb2Nlc3MuZW52Ll9fTkVYVF9NVUxUSV9aT05FX0RSQUZUX01PREUpLFxuICAgICAgICAgICAgICAgIHRydXN0SG9zdEhlYWRlcjogcHJvY2Vzcy5lbnYuX19ORVhUX1RSVVNUX0hPU1RfSEVBREVSLFxuICAgICAgICAgICAgICAgIC8vIFRPRE86IGdldCB0aGlzIGZyb20gZnJvbSBydW50aW1lIGVudiBzbyBtYW5pZmVzdFxuICAgICAgICAgICAgICAgIC8vIGRvZXNuJ3QgbmVlZCB0byBsb2FkXG4gICAgICAgICAgICAgICAgcHJldmlld1Byb3BzOiBwcmVyZW5kZXJNYW5pZmVzdC5wcmV2aWV3LFxuICAgICAgICAgICAgICAgIHByb3BhZ2F0ZUVycm9yOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBkZXY6IHJvdXRlTW9kdWxlLmlzRGV2LFxuICAgICAgICAgICAgICAgIHBhZ2U6IFwiL2FwaS9hZG1pbi9tYW5hZ2VfcHJvZHVjdHMvW2lkXVwiLFxuICAgICAgICAgICAgICAgIGludGVybmFsUmV2YWxpZGF0ZTogcm91dGVyU2VydmVyQ29udGV4dCA9PSBudWxsID8gdm9pZCAwIDogcm91dGVyU2VydmVyQ29udGV4dC5yZXZhbGlkYXRlLFxuICAgICAgICAgICAgICAgIG9uRXJyb3I6ICguLi5hcmdzKT0+b25SZXF1ZXN0RXJyb3IocmVxLCAuLi5hcmdzKVxuICAgICAgICAgICAgfSkuZmluYWxseSgoKT0+e1xuICAgICAgICAgICAgICAgIGlmICghc3BhbikgcmV0dXJuO1xuICAgICAgICAgICAgICAgIHNwYW4uc2V0QXR0cmlidXRlcyh7XG4gICAgICAgICAgICAgICAgICAgICdodHRwLnN0YXR1c19jb2RlJzogcmVzLnN0YXR1c0NvZGUsXG4gICAgICAgICAgICAgICAgICAgICduZXh0LnJzYyc6IGZhbHNlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgY29uc3Qgcm9vdFNwYW5BdHRyaWJ1dGVzID0gdHJhY2VyLmdldFJvb3RTcGFuQXR0cmlidXRlcygpO1xuICAgICAgICAgICAgICAgIC8vIFdlIHdlcmUgdW5hYmxlIHRvIGdldCBhdHRyaWJ1dGVzLCBwcm9iYWJseSBPVEVMIGlzIG5vdCBlbmFibGVkXG4gICAgICAgICAgICAgICAgaWYgKCFyb290U3BhbkF0dHJpYnV0ZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAocm9vdFNwYW5BdHRyaWJ1dGVzLmdldCgnbmV4dC5zcGFuX3R5cGUnKSAhPT0gQmFzZVNlcnZlclNwYW4uaGFuZGxlUmVxdWVzdCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oYFVuZXhwZWN0ZWQgcm9vdCBzcGFuIHR5cGUgJyR7cm9vdFNwYW5BdHRyaWJ1dGVzLmdldCgnbmV4dC5zcGFuX3R5cGUnKX0nLiBQbGVhc2UgcmVwb3J0IHRoaXMgTmV4dC5qcyBpc3N1ZSBodHRwczovL2dpdGh1Yi5jb20vdmVyY2VsL25leHQuanNgKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb25zdCByb3V0ZSA9IHJvb3RTcGFuQXR0cmlidXRlcy5nZXQoJ25leHQucm91dGUnKTtcbiAgICAgICAgICAgICAgICBpZiAocm91dGUpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbmFtZSA9IGAke21ldGhvZH0gJHtyb3V0ZX1gO1xuICAgICAgICAgICAgICAgICAgICBzcGFuLnNldEF0dHJpYnV0ZXMoe1xuICAgICAgICAgICAgICAgICAgICAgICAgJ25leHQucm91dGUnOiByb3V0ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICdodHRwLnJvdXRlJzogcm91dGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAnbmV4dC5zcGFuX25hbWUnOiBuYW1lXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBzcGFuLnVwZGF0ZU5hbWUobmFtZSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgc3Bhbi51cGRhdGVOYW1lKGAke21ldGhvZH0gJHtyZXEudXJsfWApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAvLyBUT0RPOiBhY3RpdmVTcGFuIGNvZGUgcGF0aCBpcyBmb3Igd2hlbiB3cmFwcGVkIGJ5XG4gICAgICAgIC8vIG5leHQtc2VydmVyIGNhbiBiZSByZW1vdmVkIHdoZW4gdGhpcyBpcyBubyBsb25nZXIgdXNlZFxuICAgICAgICBpZiAoYWN0aXZlU3Bhbikge1xuICAgICAgICAgICAgYXdhaXQgaW52b2tlUm91dGVNb2R1bGUoYWN0aXZlU3Bhbik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBhd2FpdCB0cmFjZXIud2l0aFByb3BhZ2F0ZWRDb250ZXh0KHJlcS5oZWFkZXJzLCAoKT0+dHJhY2VyLnRyYWNlKEJhc2VTZXJ2ZXJTcGFuLmhhbmRsZVJlcXVlc3QsIHtcbiAgICAgICAgICAgICAgICAgICAgc3Bhbk5hbWU6IGAke21ldGhvZH0gJHtyZXEudXJsfWAsXG4gICAgICAgICAgICAgICAgICAgIGtpbmQ6IFNwYW5LaW5kLlNFUlZFUixcbiAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgJ2h0dHAubWV0aG9kJzogbWV0aG9kLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ2h0dHAudGFyZ2V0JzogcmVxLnVybFxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSwgaW52b2tlUm91dGVNb2R1bGUpKTtcbiAgICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAvLyB3ZSByZS10aHJvdyBpbiBkZXYgdG8gc2hvdyB0aGUgZXJyb3Igb3ZlcmxheVxuICAgICAgICBpZiAocm91dGVNb2R1bGUuaXNEZXYpIHtcbiAgICAgICAgICAgIHRocm93IGVycjtcbiAgICAgICAgfVxuICAgICAgICAvLyB0aGlzIGlzIHRlY2huaWNhbGx5IGFuIGludmFyaWFudCBhcyBlcnJvciBoYW5kbGluZ1xuICAgICAgICAvLyBzaG91bGQgYmUgZG9uZSBpbnNpZGUgb2YgYXBpLXJlc29sdmVyIG9uRXJyb3JcbiAgICAgICAgc2VuZEVycm9yKHJlcywgNTAwLCAnSW50ZXJuYWwgU2VydmVyIEVycm9yJyk7XG4gICAgfSBmaW5hbGx5e1xuICAgICAgICAvLyBXZSBkb24ndCBhbGxvdyBhbnkgd2FpdFVudGlsIHdvcmsgaW4gcGFnZXMgQVBJIHJvdXRlcyBjdXJyZW50bHlcbiAgICAgICAgLy8gc28gaWYgY2FsbGJhY2sgaXMgcHJlc2VudCByZXR1cm4gd2l0aCByZXNvbHZlZCBwcm9taXNlIHNpbmNlIG5vXG4gICAgICAgIC8vIHBlbmRpbmcgd29ya1xuICAgICAgICBjdHgud2FpdFVudGlsID09IG51bGwgPyB2b2lkIDAgOiBjdHgud2FpdFVudGlsLmNhbGwoY3R4LCBQcm9taXNlLnJlc29sdmUoKSk7XG4gICAgfVxufVxuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1wYWdlcy1hcGkuanMubWFwXG4iXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fadmin%2Fmanage_products%2F%5Bid%5D&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fadmin%2Fmanage_products%2F%5Bid%5D.js&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api-node)/./pages/api/admin/manage_products/[id].js":
/*!*************************************************!*\
  !*** ./pages/api/admin/manage_products/[id].js ***!
  \*************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _lib_middleware_createAdminHandler__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/middleware/createAdminHandler */ \"(api-node)/./lib/middleware/createAdminHandler.js\");\n/* harmony import */ var _lib_productHelpers__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/productHelpers */ \"(api-node)/./lib/productHelpers.js\");\n/* harmony import */ var _lib_api__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/api */ \"(api-node)/./lib/api.js\");\n/* harmony import */ var _lib_redis__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/redis */ \"(api-node)/./lib/redis.js\");\n/* harmony import */ var _lib_productApiUtils__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/lib/productApiUtils */ \"(api-node)/./lib/productApiUtils.js\");\n/* harmony import */ var _lib_utils_sanitizeProductFields__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @/lib/utils/sanitizeProductFields */ \"(api-node)/./lib/utils/sanitizeProductFields.js\");\n/* harmony import */ var _lib_redis_formatkey__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @/lib/redis/formatkey */ \"(api-node)/./lib/redis/formatkey.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_lib_middleware_createAdminHandler__WEBPACK_IMPORTED_MODULE_0__, _lib_productHelpers__WEBPACK_IMPORTED_MODULE_1__, _lib_productApiUtils__WEBPACK_IMPORTED_MODULE_4__]);\n([_lib_middleware_createAdminHandler__WEBPACK_IMPORTED_MODULE_0__, _lib_productHelpers__WEBPACK_IMPORTED_MODULE_1__, _lib_productApiUtils__WEBPACK_IMPORTED_MODULE_4__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n// pages/api/admin/manage_products/[id].js\n\n\n\n\n\n\n\n// ---------- small helpers ----------\nconst isPosInt = (v)=>Number.isInteger(v) && v > 0;\nconst asInt = (v)=>{\n    const n = Number(v);\n    return Number.isInteger(n) ? n : NaN;\n};\nconst asNumber = (v)=>{\n    const n = Number(v);\n    return Number.isFinite(n) ? n : NaN;\n};\nconst asTinyint = (v)=>Number(v) === 1 || v === true ? 1 : 0;\nasync function invalidateProductsCache() {\n    try {\n        const redis = await (0,_lib_redis__WEBPACK_IMPORTED_MODULE_3__.getRedisClient)();\n        const pattern = `${(0,_lib_redis_formatkey__WEBPACK_IMPORTED_MODULE_6__.safeRedisKey)([\n            'products'\n        ])}:*`;\n        const keys = await redis.keys(pattern);\n        if (keys.length) await redis.del(...keys);\n    } catch (e) {\n        // non-fatal\n        console.warn('âš ï¸ Redis invalidate skipped:', e?.message || e);\n    }\n}\nconst handler = (0,_lib_middleware_createAdminHandler__WEBPACK_IMPORTED_MODULE_0__.createAdminHandler)({\n    rateLimit: {\n        limit: 60,\n        window: 60\n    }\n});\n// ---------- GET /api/admin/manage_products/:id ----------\nhandler.get(async (req, res)=>{\n    res.setHeader('Content-Type', 'application/json; charset=utf-8');\n    const idNum = asInt(req.query.id);\n    if (!isPosInt(idNum)) return (0,_lib_api__WEBPACK_IMPORTED_MODULE_2__.sendErrorResponse)(res, 400, 'Invalid id');\n    try {\n        const product = await (0,_lib_productHelpers__WEBPACK_IMPORTED_MODULE_1__.getProductById)(idNum);\n        if (!product) return (0,_lib_api__WEBPACK_IMPORTED_MODULE_2__.sendErrorResponse)(res, 404, 'Product not found');\n        return (0,_lib_api__WEBPACK_IMPORTED_MODULE_2__.sendSuccessResponse)(res, 200, 'Product fetched successfully', {\n            product\n        });\n    } catch (err) {\n        console.error('âŒ Failed to fetch product by ID:', req.query.id, err);\n        return (0,_lib_api__WEBPACK_IMPORTED_MODULE_2__.sendErrorResponse)(res, 500, 'Failed to fetch product');\n    }\n});\n// ---------- PUT /api/admin/manage_products/:id ----------\n// Partial update â€” only fields provided are patched.\nhandler.put(async (req, res)=>{\n    res.setHeader('Content-Type', 'application/json; charset=utf-8');\n    const idNum = asInt(req.query.id);\n    if (!isPosInt(idNum)) return (0,_lib_api__WEBPACK_IMPORTED_MODULE_2__.sendErrorResponse)(res, 400, 'Invalid id');\n    try {\n        const current = await (0,_lib_productHelpers__WEBPACK_IMPORTED_MODULE_1__.getProductById)(idNum);\n        if (!current) return (0,_lib_api__WEBPACK_IMPORTED_MODULE_2__.sendErrorResponse)(res, 404, 'Product not found');\n        const input = req.body ?? {};\n        // whitelist patchable fields\n        const patch = {};\n        if ('name' in input) patch.name = String(input.name);\n        if ('description' in input) patch.description = String(input.description);\n        if ('price' in input) patch.price = asNumber(input.price);\n        if ('stock' in input) patch.stock = asInt(input.stock);\n        if ('image_url' in input) patch.image_url = String(input.image_url || '');\n        if ('image_public_id' in input) patch.image_public_id = String(input.image_public_id || '');\n        if ('category' in input) patch.category = String(input.category || 'decor');\n        if ('is_active' in input) patch.is_active = asTinyint(input.is_active);\n        if ('is_favorite' in input) patch.is_favorite = asTinyint(input.is_favorite);\n        // basic sanitization hook (no-op if your util just returns input)\n        const sanitized = _lib_utils_sanitizeProductFields__WEBPACK_IMPORTED_MODULE_5__.sanitizeProductFields ? (0,_lib_utils_sanitizeProductFields__WEBPACK_IMPORTED_MODULE_5__.sanitizeProductFields)(patch) : patch;\n        // validate *only* provided fields\n        const hasKeys = Object.keys(sanitized).length > 0;\n        if (!hasKeys) return (0,_lib_api__WEBPACK_IMPORTED_MODULE_2__.sendErrorResponse)(res, 400, 'Nothing to update');\n        const validationError = (0,_lib_api__WEBPACK_IMPORTED_MODULE_2__.validateProductData)(sanitized);\n        if (validationError) return (0,_lib_api__WEBPACK_IMPORTED_MODULE_2__.sendErrorResponse)(res, 400, validationError);\n        // apply update\n        const result = await (0,_lib_productHelpers__WEBPACK_IMPORTED_MODULE_1__.updateProductById)(idNum, sanitized);\n        if (!result || result.changes === 0) {\n            return (0,_lib_api__WEBPACK_IMPORTED_MODULE_2__.sendErrorResponse)(res, 404, 'Product not found');\n        }\n        await invalidateProductsCache();\n        return (0,_lib_api__WEBPACK_IMPORTED_MODULE_2__.sendSuccessResponse)(res, 200, 'Product updated successfully', {\n            product: {\n                id: idNum,\n                ...sanitized\n            }\n        });\n    } catch (err) {\n        console.error('âŒ Failed to update:', err);\n        return (0,_lib_api__WEBPACK_IMPORTED_MODULE_2__.sendErrorResponse)(res, 500, 'Failed to update product');\n    }\n});\n// ---------- DELETE /api/admin/manage_products/:id ----------\nhandler.delete(async (req, res)=>{\n    res.setHeader('Content-Type', 'application/json; charset=utf-8');\n    const idNum = asInt(req.query.id);\n    if (!isPosInt(idNum)) return (0,_lib_api__WEBPACK_IMPORTED_MODULE_2__.sendErrorResponse)(res, 400, 'Invalid id');\n    try {\n        const result = await (0,_lib_productHelpers__WEBPACK_IMPORTED_MODULE_1__.deleteProductById)(idNum);\n        if (!result || result.changes === 0) {\n            return (0,_lib_api__WEBPACK_IMPORTED_MODULE_2__.sendErrorResponse)(res, 404, 'Product not found');\n        }\n        await invalidateProductsCache();\n        return (0,_lib_api__WEBPACK_IMPORTED_MODULE_2__.sendSuccessResponse)(res, 200, 'Product deleted successfully');\n    } catch (err) {\n        console.error('âŒ Failed to delete product:', err);\n        return (0,_lib_api__WEBPACK_IMPORTED_MODULE_2__.sendErrorResponse)(res, 500, 'Failed to delete product');\n    }\n});\n// ---------- PATCH /api/admin/manage_products/:id ----------\n// Dedicated quick-toggle for is_active only.\nhandler.patch(async (req, res)=>{\n    res.setHeader('Content-Type', 'application/json; charset=utf-8');\n    const idNum = asInt(req.query.id);\n    if (!isPosInt(idNum)) return (0,_lib_api__WEBPACK_IMPORTED_MODULE_2__.sendErrorResponse)(res, 400, 'Invalid id');\n    const { is_active } = req.body ?? {};\n    const toggle = Number(is_active);\n    if (!Number.isFinite(toggle)) return (0,_lib_api__WEBPACK_IMPORTED_MODULE_2__.sendErrorResponse)(res, 400, 'Missing or invalid is_active');\n    try {\n        await (0,_lib_productApiUtils__WEBPACK_IMPORTED_MODULE_4__.updateProductStatus)(idNum, asTinyint(toggle));\n        await invalidateProductsCache();\n        return (0,_lib_api__WEBPACK_IMPORTED_MODULE_2__.sendSuccessResponse)(res, 200, 'Status updated', {\n            success: true\n        });\n    } catch (error) {\n        console.error('âŒ Failed to update status:', error);\n        return (0,_lib_api__WEBPACK_IMPORTED_MODULE_2__.sendErrorResponse)(res, 500, 'Internal Server Error');\n    }\n});\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (handler);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL3BhZ2VzL2FwaS9hZG1pbi9tYW5hZ2VfcHJvZHVjdHMvW2lkXS5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7OztBQUFBLDBDQUEwQztBQUMrQjtBQUszQztBQUtYO0FBQzBCO0FBQ2U7QUFDYztBQUNyQjtBQUVyRCxzQ0FBc0M7QUFDdEMsTUFBTVcsV0FBVyxDQUFDQyxJQUFNQyxPQUFPQyxTQUFTLENBQUNGLE1BQU1BLElBQUk7QUFDbkQsTUFBTUcsUUFBUSxDQUFDSDtJQUNiLE1BQU1JLElBQUlILE9BQU9EO0lBQ2pCLE9BQU9DLE9BQU9DLFNBQVMsQ0FBQ0UsS0FBS0EsSUFBSUM7QUFDbkM7QUFDQSxNQUFNQyxXQUFXLENBQUNOO0lBQ2hCLE1BQU1JLElBQUlILE9BQU9EO0lBQ2pCLE9BQU9DLE9BQU9NLFFBQVEsQ0FBQ0gsS0FBS0EsSUFBSUM7QUFDbEM7QUFDQSxNQUFNRyxZQUFZLENBQUNSLElBQU9DLE9BQU9ELE9BQU8sS0FBS0EsTUFBTSxPQUFPLElBQUk7QUFFOUQsZUFBZVM7SUFDYixJQUFJO1FBQ0YsTUFBTUMsUUFBUSxNQUFNZiwwREFBY0E7UUFDbEMsTUFBTWdCLFVBQVUsR0FBR2Isa0VBQVlBLENBQUM7WUFBQztTQUFXLEVBQUUsRUFBRSxDQUFDO1FBQ2pELE1BQU1jLE9BQU8sTUFBTUYsTUFBTUUsSUFBSSxDQUFDRDtRQUM5QixJQUFJQyxLQUFLQyxNQUFNLEVBQUUsTUFBTUgsTUFBTUksR0FBRyxJQUFJRjtJQUN0QyxFQUFFLE9BQU9HLEdBQUc7UUFDVixZQUFZO1FBQ1pDLFFBQVFDLElBQUksQ0FBQyxnQ0FBZ0NGLEdBQUdHLFdBQVdIO0lBQzdEO0FBQ0Y7QUFFQSxNQUFNSSxVQUFVL0Isc0ZBQWtCQSxDQUFDO0lBQ2pDZ0MsV0FBVztRQUFFQyxPQUFPO1FBQUlDLFFBQVE7SUFBRztBQUNyQztBQUVBLDJEQUEyRDtBQUMzREgsUUFBUUksR0FBRyxDQUFDLE9BQU9DLEtBQUtDO0lBQ3RCQSxJQUFJQyxTQUFTLENB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Q25DLE1BQU1tQixTQUFTdEQsT0FBTzZDO0lBQ3RCLElBQUksQ0FBQzdDLE9BQU9NLFFBQVEsQ0FBQ2dELFNBQ25CLE9BQU85RCwyREFBaUJBLENBQUNnQyxLQUFLLEtBQUs7SUFFckMsSUFBSTtRQUNGLE1BQU03Qix5RUFBbUJBLENBQUMrQixPQUFPbkIsVUFBVStDO1FBQzNDLE1BQU05QztRQUNOLE9BQU9qQiw2REFBbUJBLENBQUNpQyxLQUFLLEtBQUssa0JBQWtCO1lBQUUrQixTQUFTO1FBQUs7SUFDekUsRUFBRSxPQUFPeEIsT0FBTztRQUNkaEIsUUFBUWdCLEtBQUssQ0FBQyw4QkFBOEJBO1FBQzVDLE9BQU92QywyREFBaUJBLENBQUNnQyxLQUFLLEtBQUs7SUFDckM7QUFDRjtBQUVBLGlFQUFlTixPQUFPQSxFQUFDIiwic291cmNlcyI6WyIvVXNlcnMvZW1vbnRhemVyaS9Eb2N1bWVudHMvcHJvamVjdHMvc2hlbGwtc3Rvcmllcy1zdHVkaW8vcGFnZXMvYXBpL2FkbWluL21hbmFnZV9wcm9kdWN0cy9baWRdLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIHBhZ2VzL2FwaS9hZG1pbi9tYW5hZ2VfcHJvZHVjdHMvW2lkXS5qc1xuaW1wb3J0IHsgY3JlYXRlQWRtaW5IYW5kbGVyIH0gZnJvbSAnQC9saWIvbWlkZGxld2FyZS9jcmVhdGVBZG1pbkhhbmRsZXInO1xuaW1wb3J0IHtcbiAgZ2V0UHJvZHVjdEJ5SWQsXG4gIHVwZGF0ZVByb2R1Y3RCeUlkLFxuICBkZWxldGVQcm9kdWN0QnlJZCxcbn0gZnJvbSAnQC9saWIvcHJvZHVjdEhlbHBlcnMnO1xuaW1wb3J0IHtcbiAgc2VuZFN1Y2Nlc3NSZXNwb25zZSxcbiAgc2VuZEVycm9yUmVzcG9uc2UsXG4gIHZhbGlkYXRlUHJvZHVjdERhdGEsXG59IGZyb20gJ0AvbGliL2FwaSc7XG5pbXBvcnQgeyBnZXRSZWRpc0NsaWVudCB9IGZyb20gJ0AvbGliL3JlZGlzJztcbmltcG9ydCB7IHVwZGF0ZVByb2R1Y3RTdGF0dXMgfSBmcm9tICdAL2xpYi9wcm9kdWN0QXBpVXRpbHMnO1xuaW1wb3J0IHsgc2FuaXRpemVQcm9kdWN0RmllbGRzIH0gZnJvbSAnQC9saWIvdXRpbHMvc2FuaXRpemVQcm9kdWN0RmllbGRzJztcbmltcG9ydCB7IHNhZmVSZWRpc0tleSB9IGZyb20gJ0AvbGliL3JlZGlzL2Zvcm1hdGtleSc7XG5cbi8vIC0tLS0tLS0tLS0gc21hbGwgaGVscGVycyAtLS0tLS0tLS0tXG5jb25zdCBpc1Bvc0ludCA9ICh2KSA9PiBOdW1iZXIuaXNJbnRlZ2VyKHYpICYmIHYgPiAwO1xuY29uc3QgYXNJbnQgPSAodikgPT4ge1xuICBjb25zdCBuID0gTnVtYmVyKHYpO1xuICByZXR1cm4gTnVtYmVyLmlzSW50ZWdlcihuKSA/IG4gOiBOYU47XG59O1xuY29uc3QgYXNOdW1iZXIgPSAodikgPT4ge1xuICBjb25zdCBuID0gTnVtYmVyKHYpO1xuICByZXR1cm4gTnVtYmVyLmlzRmluaXRlKG4pID8gbiA6IE5hTjtcbn07XG5jb25zdCBhc1RpbnlpbnQgPSAodikgPT4gKE51bWJlcih2KSA9PT0gMSB8fCB2ID09PSB0cnVlID8gMSA6IDApO1xuXG5hc3luYyBmdW5jdGlvbiBpbnZhbGlkYXRlUHJvZHVjdHNDYWNoZSgpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCByZWRpcyA9IGF3YWl0IGdldFJlZGlzQ2xpZW50KCk7XG4gICAgY29uc3QgcGF0dGVybiA9IGAke3NhZmVSZWRpc0tleShbJ3Byb2R1Y3RzJ10pfToqYDtcbiAgICBjb25zdCBrZXlzID0gYXdhaXQgcmVkaXMua2V5cyhwYXR0ZXJuKTtcbiAgICBpZiAoa2V5cy5sZW5ndGgpIGF3YWl0IHJlZGlzLmRlbCguLi5rZXlzKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIC8vIG5vbi1mYXRhbFxuICAgIGNvbnNvbGUud2Fybign4pqg77iPIFJlZGlzIGludmFsaWRhdGUgc2tpcHBlZDonLCBlPy5tZXNzYWdlIHx8IGUpO1xuICB9XG59XG5cbmNvbnN0IGhhbmRsZXIgPSBjcmVhdGVBZG1pbkhhbmRsZXIoe1xuICByYXRlTGltaXQ6IHsgbGltaXQ6IDYwLCB3aW5kb3c6IDYwIH0sXG59KTtcblxuLy8gLS0tLS0tLS0tLSBHRVQgL2FwaS9hZG1pbi9tYW5hZ2VfcHJvZHVjdHMvOmlkIC0tLS0tLS0tLS1cbmhhbmRsZXIuZ2V0KGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICByZXMuc2V0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD11dGYtOCcpO1xuICBjb25zdCBpZE51bSA9IGFzSW50KHJlcS5xdWVyeS5pZCk7XG4gIGlmICghaXNQb3NJbnQoaWROdW0pKSByZXR1cm4gc2VuZEVycm9yUmVzcG9uc2UocmVzLCA0MDAsICdJbnZhbGlkIGlkJyk7XG5cbiAgdHJ5IHtcbiAgICBjb25zdCBwcm9kdWN0ID0gYXdhaXQgZ2V0UHJvZHVjdEJ5SWQoaWROdW0pO1xuICAgIGlmICghcHJvZHVjdCkgcmV0dXJuIHNlbmRFcnJvclJlc3BvbnNlKHJlcywgNDA0LCAnUHJvZHVjdCBub3QgZm91bmQnKTtcbiAgICByZXR1cm4gc2VuZFN1Y2Nlc3NSZXNwb25zZShyZXMsIDIwMCwgJ1Byb2R1Y3QgZmV0Y2hlZCBzdWNjZXNzZnVsbHknLCB7XG4gICAgICBwcm9kdWN0LFxuICAgIH0pO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBjb25zb2xlLmVycm9yKCfinYwgRmFpbGVkIHRvIGZldGNoIHByb2R1Y3QgYnkgSUQ6JywgcmVxLnF1ZXJ5LmlkLCBlcnIpO1xuICAgIHJldHVybiBzZW5kRXJyb3JSZXNwb25zZShyZXMsIDUwMCwgJ0ZhaWxlZCB0byBmZXRjaCBwcm9kdWN0Jyk7XG4gIH1cbn0pO1xuXG4vLyAtLS0tLS0tLS0tIFBVVCAvYXBpL2FkbWluL21hbmFnZV9wcm9kdWN0cy86aWQgLS0tLS0tLS0tLVxuLy8gUGFydGlhbCB1cGRhdGUg4oCUIG9ubHkgZmllbGRzIHByb3ZpZGVkIGFyZSBwYXRjaGVkLlxuaGFuZGxlci5wdXQoYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIHJlcy5zZXRIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uOyBjaGFyc2V0PXV0Zi04Jyk7XG4gIGNvbnN0IGlkTnVtID0gYXNJbnQocmVxLnF1ZXJ5LmlkKTtcbiAgaWYgKCFpc1Bvc0ludChpZE51bSkpIHJldHVybiBzZW5kRXJyb3JSZXNwb25zZShyZXMsIDQwMCwgJ0ludmFsaWQgaWQnKTtcblxuICB0cnkge1xuICAgIGNvbnN0IGN1cnJlbnQgPSBhd2FpdCBnZXRQcm9kdWN0QnlJZChpZE51bSk7XG4gICAgaWYgKCFjdXJyZW50KSByZXR1cm4gc2VuZEVycm9yUmVzcG9uc2UocmVzLCA0MDQsICdQcm9kdWN0IG5vdCBmb3VuZCcpO1xuXG4gICAgY29uc3QgaW5wdXQgPSByZXEuYm9keSA/PyB7fTtcbiAgICAvLyB3aGl0ZWxpc3QgcGF0Y2hhYmxlIGZpZWxkc1xuICAgIGNvbnN0IHBhdGNoID0ge307XG5cbiAgICBpZiAoJ25hbWUnIGluIGlucHV0KSBwYXRjaC5uYW1lID0gU3RyaW5nKGlucHV0Lm5hbWUpO1xuICAgIGlmICgnZGVzY3JpcHRpb24nIGluIGlucHV0KSBwYXRjaC5kZXNjcmlwdGlvbiA9IFN0cmluZyhpbnB1dC5kZXNjcmlwdGlvbik7XG4gICAgaWYgKCdwcmljZScgaW4gaW5wdXQpIHBhdGNoLnByaWNlID0gYXNOdW1iZXIoaW5wdXQucHJpY2UpO1xuICAgIGlmICgnc3RvY2snIGluIGlucHV0KSBwYXRjaC5zdG9jayA9IGFzSW50KGlucHV0LnN0b2NrKTtcbiAgICBpZiAoJ2ltYWdlX3VybCcgaW4gaW5wdXQpIHBhdGNoLmltYWdlX3VybCA9IFN0cmluZyhpbnB1dC5pbWFnZV91cmwgfHwgJycpO1xuICAgIGlmICgnaW1hZ2VfcHVibGljX2lkJyBpbiBpbnB1dClcbiAgICAgIHBhdGNoLmltYWdlX3B1YmxpY19pZCA9IFN0cmluZyhpbnB1dC5pbWFnZV9wdWJsaWNfaWQgfHwgJycpO1xuICAgIGlmICgnY2F0ZWdvcnknIGluIGlucHV0KSBwYXRjaC5jYXRlZ29yeSA9IFN0cmluZyhpbnB1dC5jYXRlZ29yeSB8fCAnZGVjb3InKTtcbiAgICBpZiAoJ2lzX2FjdGl2ZScgaW4gaW5wdXQpIHBhdGNoLmlzX2FjdGl2ZSA9IGFzVGlueWludChpbnB1dC5pc19hY3RpdmUpO1xuICAgIGlmICgnaXNfZmF2b3JpdGUnIGluIGlucHV0KSBwYXRjaC5pc19mYXZvcml0ZSA9IGFzVGlueWludChpbnB1dC5pc19mYXZvcml0ZSk7XG5cbiAgICAvLyBiYXNpYyBzYW5pdGl6YXRpb24gaG9vayAobm8tb3AgaWYgeW91ciB1dGlsIGp1c3QgcmV0dXJucyBpbnB1dClcbiAgICBjb25zdCBzYW5pdGl6ZWQgPSBzYW5pdGl6ZVByb2R1Y3RGaWVsZHNcbiAgICAgID8gc2FuaXRpemVQcm9kdWN0RmllbGRzKHBhdGNoKVxuICAgICAgOiBwYXRjaDtcblxuICAgIC8vIHZhbGlkYXRlICpvbmx5KiBwcm92aWRlZCBmaWVsZHNcbiAgICBjb25zdCBoYXNLZXlzID0gT2JqZWN0LmtleXMoc2FuaXRpemVkKS5sZW5ndGggPiAwO1xuICAgIGlmICghaGFzS2V5cykgcmV0dXJuIHNlbmRFcnJvclJlc3BvbnNlKHJlcywgNDAwLCAnTm90aGluZyB0byB1cGRhdGUnKTtcblxuICAgIGNvbnN0IHZhbGlkYXRpb25FcnJvciA9IHZhbGlkYXRlUHJvZHVjdERhdGEoc2FuaXRpemVkKTtcbiAgICBpZiAodmFsaWRhdGlvbkVycm9yKSByZXR1cm4gc2VuZEVycm9yUmVzcG9uc2UocmVzLCA0MDAsIHZhbGlkYXRpb25FcnJvcik7XG5cbiAgICAvLyBhcHBseSB1cGRhdGVcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB1cGRhdGVQcm9kdWN0QnlJZChpZE51bSwgc2FuaXRpemVkKTtcbiAgICBpZiAoIXJlc3VsdCB8fCByZXN1bHQuY2hhbmdlcyA9PT0gMCkge1xuICAgICAgcmV0dXJuIHNlbmRFcnJvclJlc3BvbnNlKHJlcywgNDA0LCAnUHJvZHVjdCBub3QgZm91bmQnKTtcbiAgICB9XG5cbiAgICBhd2FpdCBpbnZhbGlkYXRlUHJvZHVjdHNDYWNoZSgpO1xuXG4gICAgcmV0dXJuIHNlbmRTdWNjZXNzUmVzcG9uc2UocmVzLCAyMDAsICdQcm9kdWN0IHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5Jywge1xuICAgICAgcHJvZHVjdDogeyBpZDogaWROdW0sIC4uLnNhbml0aXplZCB9LFxuICAgIH0pO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBjb25zb2xlLmVycm9yKCfinYwgRmFpbGVkIHRvIHVwZGF0ZTonLCBlcnIpO1xuICAgIHJldHVybiBzZW5kRXJyb3JSZXNwb25zZShyZXMsIDUwMCwgJ0ZhaWxlZCB0byB1cGRhdGUgcHJvZHVjdCcpO1xuICB9XG59KTtcblxuLy8gLS0tLS0tLS0tLSBERUxFVEUgL2FwaS9hZG1pbi9tYW5hZ2VfcHJvZHVjdHMvOmlkIC0tLS0tLS0tLS1cbmhhbmRsZXIuZGVsZXRlKGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICByZXMuc2V0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD11dGYtOCcpO1xuICBjb25zdCBpZE51bSA9IGFzSW50KHJlcS5xdWVyeS5pZCk7XG4gIGlmICghaXNQb3NJbnQoaWROdW0pKSByZXR1cm4gc2VuZEVycm9yUmVzcG9uc2UocmVzLCA0MDAsICdJbnZhbGlkIGlkJyk7XG5cbiAgdHJ5IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkZWxldGVQcm9kdWN0QnlJZChpZE51bSk7XG4gICAgaWYgKCFyZXN1bHQgfHwgcmVzdWx0LmNoYW5nZXMgPT09IDApIHtcbiAgICAgIHJldHVybiBzZW5kRXJyb3JSZXNwb25zZShyZXMsIDQwNCwgJ1Byb2R1Y3Qgbm90IGZvdW5kJyk7XG4gICAgfVxuXG4gICAgYXdhaXQgaW52YWxpZGF0ZVByb2R1Y3RzQ2FjaGUoKTtcblxuICAgIHJldHVybiBzZW5kU3VjY2Vzc1Jlc3BvbnNlKHJlcywgMjAwLCAnUHJvZHVjdCBkZWxldGVkIHN1Y2Nlc3NmdWxseScpO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBjb25zb2xlLmVycm9yKCfinYwgRmFpbGVkIHRvIGRlbGV0ZSBwcm9kdWN0OicsIGVycik7XG4gICAgcmV0dXJuIHNlbmRFcnJvclJlc3BvbnNlKHJlcywgNTAwLCAnRmFpbGVkIHRvIGRlbGV0ZSBwcm9kdWN0Jyk7XG4gIH1cbn0pO1xuXG4vLyAtLS0tLS0tLS0tIFBBVENIIC9hcGkvYWRtaW4vbWFuYWdlX3Byb2R1Y3RzLzppZCAtLS0tLS0tLS0tXG4vLyBEZWRpY2F0ZWQgcXVpY2stdG9nZ2xlIGZvciBpc19hY3RpdmUgb25seS5cbmhhbmRsZXIucGF0Y2goYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIHJlcy5zZXRIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uOyBjaGFyc2V0PXV0Zi04Jyk7XG4gIGNvbnN0IGlkTnVtID0gYXNJbnQocmVxLnF1ZXJ5LmlkKTtcbiAgaWYgKCFpc1Bvc0ludChpZE51bSkpIHJldHVybiBzZW5kRXJyb3JSZXNwb25zZShyZXMsIDQwMCwgJ0ludmFsaWQgaWQnKTtcblxuICBjb25zdCB7IGlzX2FjdGl2ZSB9ID0gcmVxLmJvZHkgPz8ge307XG4gIGNvbnN0IHRvZ2dsZSA9IE51bWJlcihpc19hY3RpdmUpO1xuICBpZiAoIU51bWJlci5pc0Zpbml0ZSh0b2dnbGUpKVxuICAgIHJldHVybiBzZW5kRXJyb3JSZXNwb25zZShyZXMsIDQwMCwgJ01pc3Npbmcgb3IgaW52YWxpZCBpc19hY3RpdmUnKTtcblxuICB0cnkge1xuICAgIGF3YWl0IHVwZGF0ZVByb2R1Y3RTdGF0dXMoaWROdW0sIGFzVGlueWludCh0b2dnbGUpKTtcbiAgICBhd2FpdCBpbnZhbGlkYXRlUHJvZHVjdHNDYWNoZSgpO1xuICAgIHJldHVybiBzZW5kU3VjY2Vzc1Jlc3BvbnNlKHJlcywgMjAwLCAnU3RhdHVzIHVwZGF0ZWQnLCB7IHN1Y2Nlc3M6IHRydWUgfSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcign4p2MIEZhaWxlZCB0byB1cGRhdGUgc3RhdHVzOicsIGVycm9yKTtcbiAgICByZXR1cm4gc2VuZEVycm9yUmVzcG9uc2UocmVzLCA1MDAsICdJbnRlcm5hbCBTZXJ2ZXIgRXJyb3InKTtcbiAgfVxufSk7XG5cbmV4cG9ydCBkZWZhdWx0IGhhbmRsZXI7XG5cblxuXG5cblxuXG4iXSwibmFtZXMiOlsiY3JlYXRlQWRtaW5IYW5kbGVyIiwiZ2V0UHJvZHVjdEJ5SWQiLCJ1cGRhdGVQcm9kdWN0QnlJZCIsImRlbGV0ZVByb2R1Y3RCeUlkIiwic2VuZFN1Y2Nlc3NSZXNwb25zZSIsInNlbmRFcnJvclJlc3BvbnNlIiwidmFsaWRhdGVQcm9kdWN0RGF0YSIsImdldFJlZGlzQ2xpZW50IiwidXBkYXRlUHJvZHVjdFN0YXR1cyIsInNhbml0aXplUHJvZHVjdEZpZWxkcyIsInNhZmVSZWRpc0tleSIsImlzUG9zSW50IiwidiIsIk51bWJlciIsImlzSW50ZWdlciIsImFzSW50IiwibiIsIk5hTiIsImFzTnVtYmVyIiwiaXNGaW5pdGUiLCJhc1RpbnlpbnQiLCJpbnZhbGlkYXRlUHJvZHVjdHNDYWNoZSIsInJlZGlzIiwicGF0dGVybiIsImtleXMiLCJsZW5ndGgiLCJkZWwiLCJlIiwiY29uc29sZSIsIndhcm4iLCJtZXNzYWdlIiwiaGFuZGxlciIsInJhdGVMaW1pdCIsImxpbWl0Iiwid2luZG93IiwiZ2V0IiwicmVxIiwicmVzIiwic2V0SGVhZGVyIiwiaWROdW0iLCJxdWVyeSIsImlkIiwicHJvZHVjdCIsImVyciIsImVycm9yIiwicHV0IiwiY3VycmVudCIsImlucHV0IiwiYm9keSIsInBhdGNoIiwibmFtZSIsIlN0cmluZyIsImRlc2NyaXB0aW9uIiwicHJpY2UiLCJzdG9jayIsImltYWdlX3VybCIsImltYWdlX3B1YmxpY19pZCIsImNhdGVnb3J5IiwiaXNfYWN0aXZlIiwiaXNfZmF2b3JpdGUiLCJzYW5pdGl6ZWQiLCJoYXNLZXlzIiwiT2JqZWN0IiwidmFsaWRhdGlvbkVycm9yIiwicmVzdWx0IiwiY2hhbmdlcyIsImRlbGV0ZSIsInRvZ2dsZSIsInN1Y2Nlc3MiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api-node)/./pages/api/admin/manage_products/[id].js\n");

/***/ }),

/***/ "@upstash/redis":
/*!*********************************!*\
  !*** external "@upstash/redis" ***!
  \*********************************/
/***/ ((module) => {

module.exports = import("@upstash/redis");;

/***/ }),

/***/ "next-auth/jwt":
/*!********************************!*\
  !*** external "next-auth/jwt" ***!
  \********************************/
/***/ ((module) => {

module.exports = require("next-auth/jwt");

/***/ }),

/***/ "next-connect":
/*!*******************************!*\
  !*** external "next-connect" ***!
  \*******************************/
/***/ ((module) => {

module.exports = import("next-connect");;

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "redis":
/*!************************!*\
  !*** external "redis" ***!
  \************************/
/***/ ((module) => {

module.exports = require("redis");

/***/ }),

/***/ "sanitize-html":
/*!********************************!*\
  !*** external "sanitize-html" ***!
  \********************************/
/***/ ((module) => {

module.exports = require("sanitize-html");

/***/ }),

/***/ "sqlite":
/*!*************************!*\
  !*** external "sqlite" ***!
  \*************************/
/***/ ((module) => {

module.exports = import("sqlite");;

/***/ }),

/***/ "sqlite3":
/*!**************************!*\
  !*** external "sqlite3" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("sqlite3");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fadmin%2Fmanage_products%2F%5Bid%5D&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fadmin%2Fmanage_products%2F%5Bid%5D.js&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();