"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/admin/manage_products";
exports.ids = ["pages/api/admin/manage_products"];
exports.modules = {

/***/ "(api-node)/./lib/adminApiHandlers/getPaginatedProductsHandler.js":
/*!*************************************************************!*\
  !*** ./lib/adminApiHandlers/getPaginatedProductsHandler.js ***!
  \*************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   handleGetPaginatedProducts: () => (/* binding */ handleGetPaginatedProducts)\n/* harmony export */ });\n/* harmony import */ var _lib_redis__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/redis */ \"(api-node)/./lib/redis.js\");\n/* harmony import */ var _lib_productApiUtils__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/productApiUtils */ \"(api-node)/./lib/productApiUtils.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_lib_productApiUtils__WEBPACK_IMPORTED_MODULE_1__]);\n_lib_productApiUtils__WEBPACK_IMPORTED_MODULE_1__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\nconst sortMap = {\n    created_at_desc: 'created_at DESC',\n    created_at_asc: 'created_at ASC',\n    price_asc: 'price ASC',\n    price_desc: 'price DESC',\n    name_asc: 'name COLLATE NOCASE ASC',\n    name_desc: 'name COLLATE NOCASE DESC',\n    stock_desc: 'stock DESC'\n};\n// tiny helper to prevent blocking Redis\nfunction withTimeout(promise, ms, label) {\n    return Promise.race([\n        promise,\n        new Promise((_, reject)=>setTimeout(()=>reject(new Error(`${label} timeout after ${ms}ms`)), ms))\n    ]);\n}\nasync function handleGetPaginatedProducts(req, res) {\n    const rid = req.rid || '-';\n    const t0 = Date.now();\n    const { page = 1, limit = 20, sort = 'created_at_desc', q = '' } = req.query || {};\n    const sortSQL = sortMap[sort] || sortMap.created_at_desc;\n    console.log(`[products] [${rid}] START handleGetPaginatedProducts`, {\n        page,\n        limit,\n        sort,\n        q\n    });\n    const useCache = process.env.USE_PRODUCTS_CACHE === '1';\n    const cacheTimeout = Number(process.env.CACHE_TIMEOUT_MS || 300);\n    const cacheKey = `products:v1:page=${page}:limit=${limit}:sort=${sort}:q=${String(q || '').trim()}`;\n    let redis = null;\n    if (useCache) {\n        try {\n            const c0 = Date.now();\n            redis = await (0,_lib_redis__WEBPACK_IMPORTED_MODULE_0__.getRedisClient)();\n            console.log(`[products] [${rid}] Redis connected in ${Date.now() - c0}ms`);\n        } catch (e) {\n            console.warn(`[products] [${rid}] âš ï¸ Redis unavailable:`, e?.message || e);\n        }\n    }\n    // 1ï¸âƒ£ Try cache\n    if (redis && useCache) {\n        try {\n            const c1 = Date.now();\n            const cached = await withTimeout(redis.get(cacheKey), cacheTimeout, 'redis.get');\n            const cMs = Date.now() - c1;\n            console.log(`[products] [${rid}] redis.get ${cacheKey} took ${cMs}ms hit?`, !!cached);\n            if (cached) {\n                const payload = JSON.parse(cached);\n                console.log(`[products] [${rid}] âœ… Redis HIT totalMs=${Date.now() - t0}`);\n                return res.status(200).json(payload);\n            }\n            console.log(`[products] [${rid}] ðŸ“¦ Redis MISS`);\n        } catch (e) {\n            console.warn(`[products] [${rid}] âš ï¸ Cache skipped:`, e?.message || e);\n        }\n    } else if (useCache) {\n        console.warn(`[products] [${rid}] âš ï¸ Cache enabled but redis client missing`);\n    }\n    // 2ï¸âƒ£ DB query\n    try {\n        console.log(`[products] [${rid}] running DB query...`);\n        const dbStart = Date.now();\n        const result = await (0,_lib_productApiUtils__WEBPACK_IMPORTED_MODULE_1__.getPaginatedProducts)(page, limit, sortSQL, q);\n        const dbMs = Date.now() - dbStart;\n        console.log(`[products] [${rid}] DB returned ${result.products?.length || 0} rows in ${dbMs}ms`);\n        // Normalize shape\n        const response = {\n            ok: true,\n            total: result.total,\n            page: Number(result.page),\n            pageSize: Number(limit),\n            products: result.products,\n            totalPages: result.totalPages\n        };\n        // 3ï¸âƒ£ Cache write\n        if (redis && useCache) {\n            try {\n                const s0 = Date.now();\n                await withTimeout(redis.set(cacheKey, JSON.stringify(response), {\n                    EX: 60\n                }), cacheTimeout, 'redis.set');\n                console.log(`[products] [${rid}] redis.set done in ${Date.now() - s0}ms`);\n            } catch (e) {\n                console.warn(`[products] [${rid}] âš ï¸ Cache set skipped:`, e?.message || e);\n            }\n        }\n        console.log(`[products] [${rid}] âœ… DONE total=${response.total} rows=${response.products.length} totalMs=${Date.now() - t0}`);\n        return res.status(200).json(response);\n    } catch (err) {\n        console.error(`[products] [${rid}] âŒ Get Error:`, err);\n        return res.status(500).json({\n            ok: false,\n            error: 'Internal Error'\n        });\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL2xpYi9hZG1pbkFwaUhhbmRsZXJzL2dldFBhZ2luYXRlZFByb2R1Y3RzSGFuZGxlci5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBNkM7QUFDZ0I7QUFFN0QsTUFBTUUsVUFBVTtJQUNkQyxpQkFBaUI7SUFDakJDLGdCQUFpQjtJQUNqQkMsV0FBaUI7SUFDakJDLFlBQWlCO0lBQ2pCQyxVQUFpQjtJQUNqQkMsV0FBaUI7SUFDakJDLFlBQWlCO0FBQ25CO0FBRUEsd0NBQXdDO0FBQ3hDLFNBQVNDLFlBQVlDLE9BQU8sRUFBRUMsRUFBRSxFQUFFQyxLQUFLO0lBQ3JDLE9BQU9DLFFBQVFDLElBQUksQ0FBQztRQUNsQko7UUFDQSxJQUFJRyxRQUFRLENBQUNFLEdBQUdDLFNBQ2RDLFdBQVcsSUFBTUQsT0FBTyxJQUFJRSxNQUFNLEdBQUdOLE1BQU0sZUFBZSxFQUFFRCxHQUFHLEVBQUUsQ0FBQyxJQUFJQTtLQUV6RTtBQUNIO0FBRU8sZUFBZVEsMkJBQTJCQyxHQUFHLEVBQUVDLEdBQUc7SUFDdkQsTUFBTUMsTUFBTUYsSUFBSUUsR0FBRyxJQUFJO0lBQ3ZCLE1BQU1DLEtBQUtDLEtBQUtDLEdBQUc7SUFDbkIsTUFBTSxFQUFFQyxPQUFPLENBQUMsRUFBRUMsUUFBUSxFQUFFLEVBQUVDLE9BQU8saUJBQWlCLEVBQUVDLElBQUksRUFBRSxFQUFFLEdBQUdULElBQUlVLEtBQUssSUFBSSxDQUFDO0lBQ2pGLE1BQU1DLFVBQVU5QixPQUFPLENBQUMyQixLQUFLLElBQUkzQixRQUFRQyxlQUFlO0lBRXhEOEIsUUFBUUMsR0FBRyxDQUFDLENBQUMsWUFBWSxFQUFFWCxJQUFJLGtDQUFrQyxDQUFDLEVBQUU7UUFBRUk7UUFBTUM7UUFBT0M7UUFBTUM7SUFBRTtJQUUzRixNQUFNSyxXQUFXQyxRQUFRQyxHQUFHLENBQUNDLGtCQUFrQixLQUFLO0lBQ3BELE1BQU1DLGVBQWVDLE9BQU9KLFFBQVFDLEdBQUcsQ0FBQ0ksZ0JBQWdCLElBQUk7SUFDNUQs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WSxFQUFFWCxJQUFJLG9CQUFvQixFQUFFRSxLQUFLQyxHQUFHLEtBQUsyQyxHQUFHLEVBQUUsQ0FBQztZQUMxRSxFQUFFLE9BQU90QixHQUFHO2dCQUNWZCxRQUFRZSxJQUFJLENBQUMsQ0FBQyxZQUFZLEVBQUV6QixJQUFJLHVCQUF1QixDQUFDLEVBQUV3QixHQUFHRSxXQUFXRjtZQUMxRTtRQUNGO1FBRUFkLFFBQVFDLEdBQUcsQ0FBQyxDQUFDLFlBQVksRUFBRVgsSUFBSSxlQUFlLEVBQUV5QyxTQUFTRSxLQUFLLENBQUMsTUFBTSxFQUFFRixTQUFTRixRQUFRLENBQUNDLE1BQU0sQ0FBQyxTQUFTLEVBQUV0QyxLQUFLQyxHQUFHLEtBQUtGLElBQUk7UUFDNUgsT0FBT0YsSUFBSW1DLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUNNO0lBQzlCLEVBQUUsT0FBT1MsS0FBSztRQUNaeEMsUUFBUXlDLEtBQUssQ0FBQyxDQUFDLFlBQVksRUFBRW5ELElBQUksY0FBYyxDQUFDLEVBQUVrRDtRQUNsRCxPQUFPbkQsSUFBSW1DLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7WUFBRU8sSUFBSTtZQUFPUyxPQUFPO1FBQWlCO0lBQ25FO0FBQ0YiLCJzb3VyY2VzIjpbIi9Vc2Vycy9lbW9udGF6ZXJpL0RvY3VtZW50cy9wcm9qZWN0cy9zaGVsbC1zdG9yaWVzLXN0dWRpby9saWIvYWRtaW5BcGlIYW5kbGVycy9nZXRQYWdpbmF0ZWRQcm9kdWN0c0hhbmRsZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZ2V0UmVkaXNDbGllbnQgfSBmcm9tICdAL2xpYi9yZWRpcyc7XG5pbXBvcnQgeyBnZXRQYWdpbmF0ZWRQcm9kdWN0cyB9IGZyb20gJ0AvbGliL3Byb2R1Y3RBcGlVdGlscyc7XG5cbmNvbnN0IHNvcnRNYXAgPSB7XG4gIGNyZWF0ZWRfYXRfZGVzYzogJ2NyZWF0ZWRfYXQgREVTQycsXG4gIGNyZWF0ZWRfYXRfYXNjIDogJ2NyZWF0ZWRfYXQgQVNDJyxcbiAgcHJpY2VfYXNjICAgICAgOiAncHJpY2UgQVNDJyxcbiAgcHJpY2VfZGVzYyAgICAgOiAncHJpY2UgREVTQycsXG4gIG5hbWVfYXNjICAgICAgIDogJ25hbWUgQ09MTEFURSBOT0NBU0UgQVNDJyxcbiAgbmFtZV9kZXNjICAgICAgOiAnbmFtZSBDT0xMQVRFIE5PQ0FTRSBERVNDJyxcbiAgc3RvY2tfZGVzYyAgICAgOiAnc3RvY2sgREVTQycsXG59O1xuXG4vLyB0aW55IGhlbHBlciB0byBwcmV2ZW50IGJsb2NraW5nIFJlZGlzXG5mdW5jdGlvbiB3aXRoVGltZW91dChwcm9taXNlLCBtcywgbGFiZWwpIHtcbiAgcmV0dXJuIFByb21pc2UucmFjZShbXG4gICAgcHJvbWlzZSxcbiAgICBuZXcgUHJvbWlzZSgoXywgcmVqZWN0KSA9PlxuICAgICAgc2V0VGltZW91dCgoKSA9PiByZWplY3QobmV3IEVycm9yKGAke2xhYmVsfSB0aW1lb3V0IGFmdGVyICR7bXN9bXNgKSksIG1zKVxuICAgICksXG4gIF0pO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gaGFuZGxlR2V0UGFnaW5hdGVkUHJvZHVjdHMocmVxLCByZXMpIHtcbiAgY29uc3QgcmlkID0gcmVxLnJpZCB8fCAnLSc7XG4gIGNvbnN0IHQwID0gRGF0ZS5ub3coKTtcbiAgY29uc3QgeyBwYWdlID0gMSwgbGltaXQgPSAyMCwgc29ydCA9ICdjcmVhdGVkX2F0X2Rlc2MnLCBxID0gJycgfSA9IHJlcS5xdWVyeSB8fCB7fTtcbiAgY29uc3Qgc29ydFNRTCA9IHNvcnRNYXBbc29ydF0gfHwgc29ydE1hcC5jcmVhdGVkX2F0X2Rlc2M7XG5cbiAgY29uc29sZS5sb2coYFtwcm9kdWN0c10gWyR7cmlkfV0gU1RBUlQgaGFuZGxlR2V0UGFnaW5hdGVkUHJvZHVjdHNgLCB7IHBhZ2UsIGxpbWl0LCBzb3J0LCBxIH0pO1xuXG4gIGNvbnN0IHVzZUNhY2hlID0gcHJvY2Vzcy5lbnYuVVNFX1BST0RVQ1RTX0NBQ0hFID09PSAnMSc7XG4gIGNvbnN0IGNhY2hlVGltZW91dCA9IE51bWJlcihwcm9jZXNzLmVudi5DQUNIRV9USU1FT1VUX01TIHx8IDMwMCk7XG4gIGNvbnN0IGNhY2hlS2V5ID0gYHByb2R1Y3RzOnYxOnBhZ2U9JHtwYWdlfTpsaW1pdD0ke2xpbWl0fTpzb3J0PSR7c29ydH06cT0ke1N0cmluZyhxIHx8ICcnKS50cmltKCl9YDtcblxuICBsZXQgcmVkaXMgPSBudWxsO1xuICBpZiAodXNlQ2FjaGUpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgYzAgPSBEYXRlLm5vdygpO1xuICAgICAgcmVkaXMgPSBhd2FpdCBnZXRSZWRpc0NsaWVudCgpO1xuICAgICAgY29uc29sZS5sb2coYFtwcm9kdWN0c10gWyR7cmlkfV0gUmVkaXMgY29ubmVjdGVkIGluICR7RGF0ZS5ub3coKSAtIGMwfW1zYCk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgY29uc29sZS53YXJuKGBbcHJvZHVjdHNdIFske3JpZH1dIOKaoO+4jyBSZWRpcyB1bmF2YWlsYWJsZTpgLCBlPy5tZXNzYWdlIHx8IGUpO1xuICAgIH1cbiAgfVxuXG4gIC8vIDHvuI/ig6MgVHJ5IGNhY2hlXG4gIGlmIChyZWRpcyAmJiB1c2VDYWNoZSkge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBjMSA9IERhdGUubm93KCk7XG4gICAgICBjb25zdCBjYWNoZWQgPSBhd2FpdCB3aXRoVGltZW91dChyZWRpcy5nZXQoY2FjaGVLZXkpLCBjYWNoZVRpbWVvdXQsICdyZWRpcy5nZXQnKTtcbiAgICAgIGNvbnN0IGNNcyA9IERhdGUubm93KCkgLSBjMTtcbiAgICAgIGNvbnNvbGUubG9nKGBbcHJvZHVjdHNdIFske3JpZH1dIHJlZGlzLmdldCAke2NhY2hlS2V5fSB0b29rICR7Y01zfW1zIGhpdD9gLCAhIWNhY2hlZCk7XG4gICAgICBpZiAoY2FjaGVkKSB7XG4gICAgICAgIGNvbnN0IHBheWxvYWQgPSBKU09OLnBhcnNlKGNhY2hlZCk7XG4gICAgICAgIGNvbnNvbGUubG9nKGBbcHJvZHVjdHNdIFske3JpZH1dIOKchSBSZWRpcyBISVQgdG90YWxNcz0ke0RhdGUubm93KCkgLSB0MH1gKTtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHBheWxvYWQpO1xuICAgICAgfVxuICAgICAgY29uc29sZS5sb2coYFtwcm9kdWN0c10gWyR7cmlkfV0g8J+TpiBSZWRpcyBNSVNTYCk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgY29uc29sZS53YXJuKGBbcHJvZHVjdHNdIFske3JpZH1dIOKaoO+4jyBDYWNoZSBza2lwcGVkOmAsIGU/Lm1lc3NhZ2UgfHwgZSk7XG4gICAgfVxuICB9IGVsc2UgaWYgKHVzZUNhY2hlKSB7XG4gICAgY29uc29sZS53YXJuKGBbcHJvZHVjdHNdIFske3JpZH1dIOKaoO+4jyBDYWNoZSBlbmFibGVkIGJ1dCByZWRpcyBjbGllbnQgbWlzc2luZ2ApO1xuICB9XG5cbiAgLy8gMu+4j+KDoyBEQiBxdWVyeVxuICB0cnkge1xuICAgIGNvbnNvbGUubG9nKGBbcHJvZHVjdHNdIFske3JpZH1dIHJ1bm5pbmcgREIgcXVlcnkuLi5gKTtcbiAgICBjb25zdCBkYlN0YXJ0ID0gRGF0ZS5ub3coKTtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBnZXRQYWdpbmF0ZWRQcm9kdWN0cyhwYWdlLCBsaW1pdCwgc29ydFNRTCwgcSk7XG4gICAgY29uc3QgZGJNcyA9IERhdGUubm93KCkgLSBkYlN0YXJ0O1xuICAgIGNvbnNvbGUubG9nKGBbcHJvZHVjdHNdIFske3JpZH1dIERCIHJldHVybmVkICR7cmVzdWx0LnByb2R1Y3RzPy5sZW5ndGggfHwgMH0gcm93cyBpbiAke2RiTXN9bXNgKTtcblxuICAgIC8vIE5vcm1hbGl6ZSBzaGFwZVxuICAgIGNvbnN0IHJlc3BvbnNlID0ge1xuICAgICAgb2s6IHRydWUsXG4gICAgICB0b3RhbDogcmVzdWx0LnRvdGFsLFxuICAgICAgcGFnZTogTnVtYmVyKHJlc3VsdC5wYWdlKSxcbiAgICAgIHBhZ2VTaXplOiBOdW1iZXIobGltaXQpLFxuICAgICAgcHJvZHVjdHM6IHJlc3VsdC5wcm9kdWN0cyxcbiAgICAgIHRvdGFsUGFnZXM6IHJlc3VsdC50b3RhbFBhZ2VzLFxuICAgIH07XG5cbiAgICAvLyAz77iP4oOjIENhY2hlIHdyaXRlXG4gICAgaWYgKHJlZGlzICYmIHVzZUNhY2hlKSB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBzMCA9IERhdGUubm93KCk7XG4gICAgICAgIGF3YWl0IHdpdGhUaW1lb3V0KFxuICAgICAgICAgIHJlZGlzLnNldChjYWNoZUtleSwgSlNPTi5zdHJpbmdpZnkocmVzcG9uc2UpLCB7IEVYOiA2MCB9KSxcbiAgICAgICAgICBjYWNoZVRpbWVvdXQsXG4gICAgICAgICAgJ3JlZGlzLnNldCdcbiAgICAgICAgKTtcbiAgICAgICAgY29uc29sZS5sb2coYFtwcm9kdWN0c10gWyR7cmlkfV0gcmVkaXMuc2V0IGRvbmUgaW4gJHtEYXRlLm5vdygpIC0gczB9bXNgKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgY29uc29sZS53YXJuKGBbcHJvZHVjdHNdIFske3JpZH1dIOKaoO+4jyBDYWNoZSBzZXQgc2tpcHBlZDpgLCBlPy5tZXNzYWdlIHx8IGUpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnNvbGUubG9nKGBbcHJvZHVjdHNdIFske3JpZH1dIOKchSBET05FIHRvdGFsPSR7cmVzcG9uc2UudG90YWx9IHJvd3M9JHtyZXNwb25zZS5wcm9kdWN0cy5sZW5ndGh9IHRvdGFsTXM9JHtEYXRlLm5vdygpIC0gdDB9YCk7XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHJlc3BvbnNlKTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgY29uc29sZS5lcnJvcihgW3Byb2R1Y3RzXSBbJHtyaWR9XSDinYwgR2V0IEVycm9yOmAsIGVycik7XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgb2s6IGZhbHNlLCBlcnJvcjogJ0ludGVybmFsIEVycm9yJyB9KTtcbiAgfVxufVxuXG4iXSwibmFtZXMiOlsiZ2V0UmVkaXNDbGllbnQiLCJnZXRQYWdpbmF0ZWRQcm9kdWN0cyIsInNvcnRNYXAiLCJjcmVhdGVkX2F0X2Rlc2MiLCJjcmVhdGVkX2F0X2FzYyIsInByaWNlX2FzYyIsInByaWNlX2Rlc2MiLCJuYW1lX2FzYyIsIm5hbWVfZGVzYyIsInN0b2NrX2Rlc2MiLCJ3aXRoVGltZW91dCIsInByb21pc2UiLCJtcyIsImxhYmVsIiwiUHJvbWlzZSIsInJhY2UiLCJfIiwicmVqZWN0Iiwic2V0VGltZW91dCIsIkVycm9yIiwiaGFuZGxlR2V0UGFnaW5hdGVkUHJvZHVjdHMiLCJyZXEiLCJyZXMiLCJyaWQiLCJ0MCIsIkRhdGUiLCJub3ciLCJwYWdlIiwibGltaXQiLCJzb3J0IiwicSIsInF1ZXJ5Iiwic29ydFNRTCIsImNvbnNvbGUiLCJsb2ciLCJ1c2VDYWNoZSIsInByb2Nlc3MiLCJlbnYiLCJVU0VfUFJPRFVDVFNfQ0FDSEUiLCJjYWNoZVRpbWVvdXQiLCJOdW1iZXIiLCJDQUNIRV9USU1FT1VUX01TIiwiY2FjaGVLZXkiLCJTdHJpbmciLCJ0cmltIiwicmVkaXMiLCJjMCIsImUiLCJ3YXJuIiwibWVzc2FnZSIsImMxIiwiY2FjaGVkIiwiZ2V0IiwiY01zIiwicGF5bG9hZCIsIkpTT04iLCJwYXJzZSIsInN0YXR1cyIsImpzb24iLCJkYlN0YXJ0IiwicmVzdWx0IiwiZGJNcyIsInByb2R1Y3RzIiwibGVuZ3RoIiwicmVzcG9uc2UiLCJvayIsInRvdGFsIiwicGFnZVNpemUiLCJ0b3RhbFBhZ2VzIiwiczAiLCJzZXQiLCJzdHJpbmdpZnkiLCJFWCIsImVyciIsImVycm9yIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api-node)/./lib/adminApiHandlers/getPaginatedProductsHandler.js\n");

/***/ }),

/***/ "(api-node)/./lib/api.js":
/*!********************!*\
  !*** ./lib/api.js ***!
  \********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   __utils: () => (/* binding */ __utils),\n/* harmony export */   searchProducts: () => (/* binding */ searchProducts),\n/* harmony export */   sendErrorResponse: () => (/* binding */ sendErrorResponse),\n/* harmony export */   sendSuccessResponse: () => (/* binding */ sendSuccessResponse),\n/* harmony export */   validateProductData: () => (/* binding */ validateProductData)\n/* harmony export */ });\n// lib/api.js\n/** ---------------------------\n * Small, reuseable utilities\n * --------------------------*/ const isFiniteNumber = (v)=>typeof v === 'number' && Number.isFinite(v);\nconst isHttpUrl = (s)=>{\n    if (typeof s !== 'string' || s.trim() === '') return false;\n    try {\n        const u = new URL(s);\n        return u.protocol === 'http:' || u.protocol === 'https:';\n    } catch  {\n        return false;\n    }\n};\n/** -------------------------------------------------------\n * Standardized JSON responses (never leak HTML to clients)\n * ------------------------------------------------------*/ const sendSuccessResponse = (res, statusCode, message, data = {})=>{\n    // Ensure we always spread a plain object (avoid null/array surprises)\n    const payload = data && typeof data === 'object' && !Array.isArray(data) ? data : {};\n    res.status(statusCode).json({\n        success: true,\n        message,\n        ...payload\n    });\n};\nconst sendErrorResponse = (res, statusCode, message, error = null)=>{\n    // Normalize non-serializable errors\n    let errOut = error;\n    if (error instanceof Error) {\n        errOut = {\n            name: error.name,\n            message: error.message,\n            stack:  true ? error.stack : 0\n        };\n    } else if (error && typeof error === 'object') {\n        try {\n            JSON.stringify(error);\n        } catch  {\n            errOut = String(error);\n        }\n    }\n    res.status(statusCode).json({\n        success: false,\n        message,\n        error: errOut\n    });\n};\n/** -------------------------------------------------------\n * Product payload validation (partial-safe, used for PATCH)\n * Pass only fields you intend to change.\n * Returns `null` when valid, or a string message on error.\n * ------------------------------------------------------*/ const validateProductData = (data)=>{\n    // Guard against non-objects\n    if (!data || typeof data !== 'object') return 'Payload must be an object';\n    const { name, description, price, stock, image_url, category, is_active, is_favorite } = data;\n    // name: optional, if present must be non-empty <= 100\n    if (name !== undefined) {\n        if (typeof name !== 'string' || name.trim().length === 0) {\n            return 'Name must be a non-empty string';\n        }\n        if (name.length > 100) return 'Name is too long (max 100 chars)';\n    }\n    // description: optional string <= 1000\n    if (description !== undefined) {\n        if (typeof description !== 'string') return 'Description must be a string';\n        if (description.length > 1000) return 'Description is too long (max 1000 chars)';\n    }\n    // price: number > 0\n    if (price !== undefined) {\n        if (!isFiniteNumber(price) || price <= 0) return 'Price must be a positive number';\n    }\n    // stock: number >= 0 (integers preferred; DB has CHECK >= 0)\n    if (stock !== undefined) {\n        if (!isFiniteNumber(stock) || stock < 0) return 'Stock must be a non-negative number';\n    }\n    // image_url: allow empty/omitted; if present and non-empty must be http(s)\n    if (image_url !== undefined) {\n        if (image_url === '' || image_url === null) {\n        // allow blank (main image can come from media gallery)\n        } else if (!isHttpUrl(image_url)) {\n            return 'Image URL must be a valid http(s) URL';\n        }\n    }\n    // category: optional string <= 50\n    if (category !== undefined) {\n        if (typeof category !== 'string' || category.length > 50) {\n            return 'Category must be a string under 50 characters';\n        }\n    }\n    // is_active: must be 0 or 1 (null permitted if you intentionally clear it)\n    if (is_active !== undefined) {\n        if (![\n            0,\n            1,\n            null\n        ].includes(is_active)) return 'is_active must be 0, 1, or null';\n    }\n    // is_favorite: must be 0 or 1\n    if (is_favorite !== undefined) {\n        if (![\n            0,\n            1\n        ].includes(is_favorite)) return 'is_favorite must be 0 or 1';\n    }\n    return null; // âœ… valid\n};\n/** -------------------------------------------------------\n * Server-only search helper (lazy imports so client bundles are safe)\n * ------------------------------------------------------*/ const searchProducts = async (query)=>{\n    const { open } = await Promise.resolve(/*! import() */).then(__webpack_require__.bind(__webpack_require__, /*! sqlite */ \"sqlite\"));\n    const sqlite3 = (await Promise.resolve(/*! import() */).then(__webpack_require__.t.bind(__webpack_require__, /*! sqlite3 */ \"sqlite3\", 23))).default;\n    const path = (await Promise.resolve(/*! import() */).then(__webpack_require__.t.bind(__webpack_require__, /*! path */ \"path\", 23))).default;\n    const dbPath = path.join(process.cwd(), 'data', 'shells_shop.db');\n    const db = await open({\n        filename: dbPath,\n        driver: sqlite3.Database\n    });\n    try {\n        // Use parameterized LIKE to avoid injection; wrap in % on both sides\n        const q = String(query ?? '').trim();\n        if (!q) return [];\n        return await db.all(`SELECT * FROM products\n       WHERE name LIKE ? OR description LIKE ?\n       ORDER BY id DESC`, [\n            `%${q}%`,\n            `%${q}%`\n        ]);\n    } catch (err) {\n        console.error('âŒ searchProducts failed:', err);\n        throw new Error('Failed to search products');\n    } finally{\n        try {\n            await db.close();\n        } catch  {}\n    }\n};\n// (Optionally) export the tiny helpers if you want to reuse elsewhere:\nconst __utils = {\n    isFiniteNumber,\n    isHttpUrl\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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S0FBSztRQUNaQyxRQUFRcEMsS0FBSyxDQUFDLDRCQUE0Qm1DO1FBQzFDLE1BQU0sSUFBSWpDLE1BQU07SUFDbEIsU0FBVTtRQUNSLElBQUk7WUFBRSxNQUFNMkIsR0FBR1EsS0FBSztRQUFJLEVBQUUsT0FBTSxDQUFDO0lBQ25DO0FBQ0YsRUFBRTtBQUVGLHVFQUF1RTtBQUNoRSxNQUFNQyxVQUFVO0lBQUU1RDtJQUFnQkk7QUFBVSxFQUFFIiwic291cmNlcyI6WyIvVXNlcnMvZW1vbnRhemVyaS9Eb2N1bWVudHMvcHJvamVjdHMvc2hlbGwtc3Rvcmllcy1zdHVkaW8vbGliL2FwaS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBsaWIvYXBpLmpzXG5cbi8qKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAqIFNtYWxsLCByZXVzZWFibGUgdXRpbGl0aWVzXG4gKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5jb25zdCBpc0Zpbml0ZU51bWJlciA9ICh2KSA9PiB0eXBlb2YgdiA9PT0gJ251bWJlcicgJiYgTnVtYmVyLmlzRmluaXRlKHYpO1xuY29uc3QgaXNIdHRwVXJsID0gKHMpID0+IHtcbiAgaWYgKHR5cGVvZiBzICE9PSAnc3RyaW5nJyB8fCBzLnRyaW0oKSA9PT0gJycpIHJldHVybiBmYWxzZTtcbiAgdHJ5IHtcbiAgICBjb25zdCB1ID0gbmV3IFVSTChzKTtcbiAgICByZXR1cm4gdS5wcm90b2NvbCA9PT0gJ2h0dHA6JyB8fCB1LnByb3RvY29sID09PSAnaHR0cHM6JztcbiAgfSBjYXRjaCB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG59O1xuXG4vKiogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICogU3RhbmRhcmRpemVkIEpTT04gcmVzcG9uc2VzIChuZXZlciBsZWFrIEhUTUwgdG8gY2xpZW50cylcbiAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5leHBvcnQgY29uc3Qgc2VuZFN1Y2Nlc3NSZXNwb25zZSA9IChyZXMsIHN0YXR1c0NvZGUsIG1lc3NhZ2UsIGRhdGEgPSB7fSkgPT4ge1xuICAvLyBFbnN1cmUgd2UgYWx3YXlzIHNwcmVhZCBhIHBsYWluIG9iamVjdCAoYXZvaWQgbnVsbC9hcnJheSBzdXJwcmlzZXMpXG4gIGNvbnN0IHBheWxvYWQgPSAoZGF0YSAmJiB0eXBlb2YgZGF0YSA9PT0gJ29iamVjdCcgJiYgIUFycmF5LmlzQXJyYXkoZGF0YSkpID8gZGF0YSA6IHt9O1xuICByZXMuc3RhdHVzKHN0YXR1c0NvZGUpLmpzb24oe1xuICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgbWVzc2FnZSxcbiAgICAuLi5wYXlsb2FkLFxuICB9KTtcbn07XG5cbmV4cG9ydCBjb25zdCBzZW5kRXJyb3JSZXNwb25zZSA9IChyZXMsIHN0YXR1c0NvZGUsIG1lc3NhZ2UsIGVycm9yID0gbnVsbCkgPT4ge1xuICAvLyBOb3JtYWxpemUgbm9uLXNlcmlhbGl6YWJsZSBlcnJvcnNcbiAgbGV0IGVyck91dCA9IGVycm9yO1xuICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBFcnJvcikge1xuICAgIGVyck91dCA9IHsgbmFtZTogZXJyb3IubmFtZSwgbWVzc2FnZTogZXJyb3IubWVzc2FnZSwgc3RhY2s6IHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnID8gZXJyb3Iuc3RhY2sgOiB1bmRlZmluZWQgfTtcbiAgfSBlbHNlIGlmIChlcnJvciAmJiB0eXBlb2YgZXJyb3IgPT09ICdvYmplY3QnKSB7XG4gICAgdHJ5IHsgSlNPTi5zdHJpbmdpZnkoZXJyb3IpOyB9IGNhdGNoIHsgZXJyT3V0ID0gU3RyaW5nKGVycm9yKTsgfVxuICB9XG4gIHJlcy5zdGF0dXMoc3RhdHVzQ29kZSkuanNvbih7XG4gICAgc3VjY2VzczogZmFsc2UsXG4gICAgbWVzc2FnZSxcbiAgICBlcnJvcjogZXJyT3V0LFxuICB9KTtcbn07XG5cbi8qKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gKiBQcm9kdWN0IHBheWxvYWQgdmFsaWRhdGlvbiAocGFydGlhbC1zYWZlLCB1c2VkIGZvciBQQVRDSClcbiAqIFBhc3Mgb25seSBmaWVsZHMgeW91IGludGVuZCB0byBjaGFuZ2UuXG4gKiBSZXR1cm5zIGBudWxsYCB3aGVuIHZhbGlkLCBvciBhIHN0cmluZyBtZXNzYWdlIG9uIGVycm9yLlxuICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cbmV4cG9ydCBjb25zdCB2YWxpZGF0ZVByb2R1Y3REYXRhID0gKGRhdGEpID0+IHtcbiAgLy8gR3VhcmQgYWdhaW5zdCBub24tb2JqZWN0c1xuICBpZiAoIWRhdGEgfHwgdHlwZW9mIGRhdGEgIT09ICdvYmplY3QnKSByZXR1cm4gJ1BheWxvYWQgbXVzdCBiZSBhbiBvYmplY3QnO1xuXG4gIGNvbnN0IHtcbiAgICBuYW1lLFxuICAgIGRlc2NyaXB0aW9uLFxuICAgIHByaWNlLFxuICAgIHN0b2NrLFxuICAgIGltYWdlX3VybCxcbiAgICBjYXRlZ29yeSxcbiAgICBpc19hY3RpdmUsXG4gICAgaXNfZmF2b3JpdGUsXG4gIH0gPSBkYXRhO1xuXG4gIC8vIG5hbWU6IG9wdGlvbmFsLCBpZiBwcmVzZW50IG11c3QgYmUgbm9uLWVtcHR5IDw9IDEwMFxuICBpZiAobmFtZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgaWYgKHR5cGVvZiBuYW1lICE9PSAnc3RyaW5nJyB8fCBuYW1lLnRyaW0oKS5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiAnTmFtZSBtdXN0IGJlIGEgbm9uLWVtcHR5IHN0cmluZyc7XG4gICAgfVxuICAgIGlmIChuYW1lLmxlbmd0aCA+IDEwMCkgcmV0dXJuICdOYW1lIGlzIHRvbyBsb25nIChtYXggMTAwIGNoYXJzKSc7XG4gIH1cblxuICAvLyBkZXNjcmlwdGlvbjogb3B0aW9uYWwgc3RyaW5nIDw9IDEwMDBcbiAgaWYgKGRlc2NyaXB0aW9uICE9PSB1bmRlZmluZWQpIHtcbiAgICBpZiAodHlwZW9mIGRlc2NyaXB0aW9uICE9PSAnc3RyaW5nJykgcmV0dXJuICdEZXNjcmlwdGlvbiBtdXN0IGJlIGEgc3RyaW5nJztcbiAgICBpZiAoZGVzY3JpcHRpb24ubGVuZ3RoID4gMTAwMCkgcmV0dXJuICdEZXNjcmlwdGlvbiBpcyB0b28gbG9uZyAobWF4IDEwMDAgY2hhcnMpJztcbiAgfVxuXG4gIC8vIHByaWNlOiBudW1iZXIgPiAwXG4gIGlmIChwcmljZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgaWYgKCFpc0Zpbml0ZU51bWJlcihwcmljZSkgfHwgcHJpY2UgPD0gMCkgcmV0dXJuICdQcmljZSBtdXN0IGJlIGEgcG9zaXRpdmUgbnVtYmVyJztcbiAgfVxuXG4gIC8vIHN0b2NrOiBudW1iZXIgPj0gMCAoaW50ZWdlcnMgcHJlZmVycmVkOyBEQiBoYXMgQ0hFQ0sgPj0gMClcbiAgaWYgKHN0b2NrICE9PSB1bmRlZmluZWQpIHtcbiAgICBpZiAoIWlzRmluaXRlTnVtYmVyKHN0b2NrKSB8fCBzdG9jayA8IDApIHJldHVybiAnU3RvY2sgbXVzdCBiZSBhIG5vbi1uZWdhdGl2ZSBudW1iZXInO1xuICB9XG5cbiAgLy8gaW1hZ2VfdXJsOiBhbGxvdyBlbXB0eS9vbWl0dGVkOyBpZiBwcmVzZW50IGFuZCBub24tZW1wdHkgbXVzdCBiZSBodHRwKHMpXG4gIGlmIChpbWFnZV91cmwgIT09IHVuZGVmaW5lZCkge1xuICAgIGlmIChpbWFnZV91cmwgPT09ICcnIHx8IGltYWdlX3VybCA9PT0gbnVsbCkge1xuICAgICAgLy8gYWxsb3cgYmxhbmsgKG1haW4gaW1hZ2UgY2FuIGNvbWUgZnJvbSBtZWRpYSBnYWxsZXJ5KVxuICAgIH0gZWxzZSBpZiAoIWlzSHR0cFVybChpbWFnZV91cmwpKSB7XG4gICAgICByZXR1cm4gJ0ltYWdlIFVSTCBtdXN0IGJlIGEgdmFsaWQgaHR0cChzKSBVUkwnO1xuICAgIH1cbiAgfVxuXG4gIC8vIGNhdGVnb3J5OiBvcHRpb25hbCBzdHJpbmcgPD0gNTBcbiAgaWYgKGNhdGVnb3J5ICE9PSB1bmRlZmluZWQpIHtcbiAgICBpZiAodHlwZW9mIGNhdGVnb3J5ICE9PSAnc3RyaW5nJyB8fCBjYXRlZ29yeS5sZW5ndGggPiA1MCkge1xuICAgICAgcmV0dXJuICdDYXRlZ29yeSBtdXN0IGJlIGEgc3RyaW5nIHVuZGVyIDUwIGNoYXJhY3RlcnMnO1xuICAgIH1cbiAgfVxuXG4gIC8vIGlzX2FjdGl2ZTogbXVzdCBiZSAwIG9yIDEgKG51bGwgcGVybWl0dGVkIGlmIHlvdSBpbnRlbnRpb25hbGx5IGNsZWFyIGl0KVxuICBpZiAoaXNfYWN0aXZlICE9PSB1bmRlZmluZWQpIHtcbiAgICBpZiAoIVswLCAxLCBudWxsXS5pbmNsdWRlcyhpc19hY3RpdmUpKSByZXR1cm4gJ2lzX2FjdGl2ZSBtdXN0IGJlIDAsIDEsIG9yIG51bGwnO1xuICB9XG5cbiAgLy8gaXNfZmF2b3JpdGU6IG11c3QgYmUgMCBvciAxXG4gIGlmIChpc19mYXZvcml0ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgaWYgKCFbMCwgMV0uaW5jbHVkZXMoaXNfZmF2b3JpdGUpKSByZXR1cm4gJ2lzX2Zhdm9yaXRlIG11c3QgYmUgMCBvciAxJztcbiAgfVxuXG4gIHJldHVybiBudWxsOyAvLyDinIUgdmFsaWRcbn07XG5cbi8qKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gKiBTZXJ2ZXItb25seSBzZWFyY2ggaGVscGVyIChsYXp5IGltcG9ydHMgc28gY2xpZW50IGJ1bmRsZXMgYXJlIHNhZmUpXG4gKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuZXhwb3J0IGNvbnN0IHNlYXJjaFByb2R1Y3RzID0gYXN5bmMgKHF1ZXJ5KSA9PiB7XG4gIGNvbnN0IHsgb3BlbiB9ID0gYXdhaXQgaW1wb3J0KCdzcWxpdGUnKTtcbiAgY29uc3Qgc3FsaXRlMyA9IChhd2FpdCBpbXBvcnQoJ3NxbGl0ZTMnKSkuZGVmYXVsdDtcbiAgY29uc3QgcGF0aCA9IChhd2FpdCBpbXBvcnQoJ3BhdGgnKSkuZGVmYXVsdDtcblxuICBjb25zdCBkYlBhdGggPSBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgJ2RhdGEnLCAnc2hlbGxzX3Nob3AuZGInKTtcbiAgY29uc3QgZGIgPSBhd2FpdCBvcGVuKHsgZmlsZW5hbWU6IGRiUGF0aCwgZHJpdmVyOiBzcWxpdGUzLkRhdGFiYXNlIH0pO1xuXG4gIHRyeSB7XG4gICAgLy8gVXNlIHBhcmFtZXRlcml6ZWQgTElLRSB0byBhdm9pZCBpbmplY3Rpb247IHdyYXAgaW4gJSBvbiBib3RoIHNpZGVzXG4gICAgY29uc3QgcSA9IFN0cmluZyhxdWVyeSA/PyAnJykudHJpbSgpO1xuICAgIGlmICghcSkgcmV0dXJuIFtdO1xuICAgIHJldHVybiBhd2FpdCBkYi5hbGwoXG4gICAgICBgU0VMRUNUICogRlJPTSBwcm9kdWN0c1xuICAgICAgIFdIRVJFIG5hbWUgTElLRSA/IE9SIGRlc2NyaXB0aW9uIExJS0UgP1xuICAgICAgIE9SREVSIEJZIGlkIERFU0NgLFxuICAgICAgW2AlJHtxfSVgLCBgJSR7cX0lYF1cbiAgICApO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBjb25zb2xlLmVycm9yKCfinYwgc2VhcmNoUHJvZHVjdHMgZmFpbGVkOicsIGVycik7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgdG8gc2VhcmNoIHByb2R1Y3RzJyk7XG4gIH0gZmluYWxseSB7XG4gICAgdHJ5IHsgYXdhaXQgZGIuY2xvc2UoKTsgfSBjYXRjaCB7fVxuICB9XG59O1xuXG4vLyAoT3B0aW9uYWxseSkgZXhwb3J0IHRoZSB0aW55IGhlbHBlcnMgaWYgeW91IHdhbnQgdG8gcmV1c2UgZWxzZXdoZXJlOlxuZXhwb3J0IGNvbnN0IF9fdXRpbHMgPSB7IGlzRmluaXRlTnVtYmVyLCBpc0h0dHBVcmwgfTtcblxuIl0sIm5hbWVzIjpbImlzRmluaXRlTnVtYmVyIiwidiIsIk51bWJlciIsImlzRmluaXRlIiwiaXNIdHRwVXJsIiwicyIsInRyaW0iLCJ1IiwiVVJMIiwicHJvdG9jb2wiLCJzZW5kU3VjY2Vzc1Jlc3BvbnNlIiwicmVzIiwic3RhdHVzQ29kZSIsIm1lc3NhZ2UiLCJkYXRhIiwicGF5bG9hZCIsIkFycmF5IiwiaXNBcnJheSIsInN0YXR1cyIsImpzb24iLCJzdWNjZXNzIiwic2VuZEVycm9yUmVzcG9uc2UiLCJlcnJvciIsImVyck91dCIsIkVycm9yIiwibmFtZSIsInN0YWNrIiwicHJvY2VzcyIsInVuZGVmaW5lZCIsIkpTT04iLCJzdHJpbmdpZnkiLCJTdHJpbmciLCJ2YWxpZGF0ZVByb2R1Y3REYXRhIiwiZGVzY3JpcHRpb24iLCJwcmljZSIsInN0b2NrIiwiaW1hZ2VfdXJsIiwiY2F0ZWdvcnkiLCJpc19hY3RpdmUiLCJpc19mYXZvcml0ZSIsImxlbmd0aCIsImluY2x1ZGVzIiwic2VhcmNoUHJvZHVjdHMiLCJxdWVyeSIsIm9wZW4iLCJzcWxpdGUzIiwiZGVmYXVsdCIsInBhdGgiLCJkYlBhdGgiLCJqb2luIiwiY3dkIiwiZGIiLCJmaWxlbmFtZSIsImRyaXZlciIsIkRhdGFiYXNlIiwicSIsImFsbCIsImVyciIsImNvbnNvbGUiLCJjbG9zZSIsIl9fdXRpbHMiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api-node)/./lib/api.js\n");

/***/ }),

/***/ "(api-node)/./lib/auth/authorizeAdmin.js":
/*!************************************!*\
  !*** ./lib/auth/authorizeAdmin.js ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ROLES: () => (/* binding */ ROLES),\n/* harmony export */   authorizeAdmin: () => (/* binding */ authorizeAdmin),\n/* harmony export */   withAdmin: () => (/* binding */ withAdmin)\n/* harmony export */ });\n/* harmony import */ var next_auth_jwt__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next-auth/jwt */ \"next-auth/jwt\");\n/* harmony import */ var next_auth_jwt__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_auth_jwt__WEBPACK_IMPORTED_MODULE_0__);\n// lib/auth/authorizeAdmin.js\n\nconst ROLES = {\n    ADMIN: 'ADMIN',\n    USER: 'USER'\n};\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n// Helper utilities\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nfunction wantsJson(req) {\n    const url = req.url || '';\n    const accept = String(req.headers?.accept || '').toLowerCase();\n    const xrw = String(req.headers?.['x-requested-with'] || '').toLowerCase();\n    return url.startsWith('/api/') || accept.includes('application/json') || xrw === 'xmlhttprequest';\n}\nfunction safeCallbackUrl(req) {\n    try {\n        const u = new URL(req.url, `http://${req.headers.host || 'localhost'}`);\n        return u.pathname + u.search; // same-origin path only\n    } catch  {\n        return '/';\n    }\n}\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n// Core middleware\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nfunction authorizeAdmin(loginPath = '/admin/login') {\n    console.log('[authorizeAdmin] middleware initialized');\n    return async function guard(req, res, next) {\n        const rid = req.rid || '-';\n        const t0 = Date.now();\n        console.log('[authorizeAdmin]', rid, 'ENTER for', req.method, req.url);\n        try {\n            console.log('[authorizeAdmin]', 'EXECUTION ENTERED for', req.method, req.url);\n            // ðŸ”‘ Try reading the session token\n            const token = await (0,next_auth_jwt__WEBPACK_IMPORTED_MODULE_0__.getToken)({\n                req,\n                secret: process.env.NEXTAUTH_SECRET\n            });\n            console.log('[authorizeAdmin]', rid, 'token check â†’', token ? 'FOUND' : 'MISSING', 'role:', token?.role);\n            if (!token) {\n                console.warn('[authorizeAdmin]', rid, 'NO TOKEN (unauthenticated)');\n                if (wantsJson(req)) {\n                    console.log('[authorizeAdmin]', rid, 'â†’ returning 401 JSON');\n                    return res.status(401).json({\n                        ok: false,\n                        code: 'UNAUTHENTICATED',\n                        error: 'Unauthorized'\n                    });\n                }\n                const cb = encodeURIComponent(safeCallbackUrl(req));\n                console.log('[authorizeAdmin]', rid, 'â†’ redirecting to login');\n                return res.redirect(`${loginPath}?callbackUrl=${cb}`);\n            }\n            // Normalize role (e.g. \"admin\" â†’ \"ADMIN\")\n            const role = String(token.role || 'USER').toUpperCase();\n            console.log('[authorizeAdmin]', rid, 'normalized role:', role);\n            if (role !== ROLES.ADMIN) {\n                console.warn('[authorizeAdmin]', rid, 'role not admin â†’ forbidden');\n                if (wantsJson(req)) {\n                    console.log('[authorizeAdmin]', rid, 'â†’ returning 403 JSON');\n                    return res.status(403).json({\n                        ok: false,\n                        code: 'FORBIDDEN',\n                        error: 'Forbidden'\n                    });\n                }\n                return res.redirect('/403');\n            }\n            // âœ… Authorized\n            req.user = {\n                id: token.sub || null,\n                email: token.email || null,\n                role\n            };\n            console.log('[authorizeAdmin]', rid, 'AUTHORIZED â†’ calling next() | user:', JSON.stringify(req.user), 'in', Date.now() - t0, 'ms');\n            return next(); // <--- this ensures the middleware chain continues\n        } catch (err) {\n            console.error('[authorizeAdmin]', rid, 'ERROR â†’', err?.message || err);\n            if (wantsJson(req)) {\n                console.log('[authorizeAdmin]', rid, 'â†’ returning 401 JSON (token error)');\n                return res.status(401).json({\n                    ok: false,\n                    code: 'TOKEN_ERROR',\n                    error: 'Unauthorized'\n                });\n            }\n            console.log('[authorizeAdmin]', rid, 'â†’ redirecting to login (exception)');\n            return res.redirect(loginPath);\n        }\n    };\n}\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n// Wrapper for standalone Next.js API routes\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nfunction withAdmin(handler, loginPath = '/admin/login') {\n    const mw = authorizeAdmin(loginPath);\n    return async (req, res)=>{\n        const rid = req.rid || '-';\n        console.log('[withAdmin]', rid, 'ENTER â†’ wrapping handler for', req.url);\n        await mw(req, res, async ()=>{\n            console.log('[withAdmin]', rid, 'AUTH OK â†’ executing handler');\n            await handler(req, res);\n            console.log('[withAdmin]', rid, 'HANDLER COMPLETE');\n        });\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL2xpYi9hdXRoL2F1dGhvcml6ZUFkbWluLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUEsNkJBQTZCO0FBQ1k7QUFFbEMsTUFBTUMsUUFBUTtJQUFFQyxPQUFPO0lBQVNDLE1BQU07QUFBTyxFQUFFO0FBRXRELGdEQUFnRDtBQUNoRCxtQkFBbUI7QUFDbkIsZ0RBQWdEO0FBQ2hELFNBQVNDLFVBQVVDLEdBQUc7SUFDcEIsTUFBTUMsTUFBTUQsSUFBSUMsR0FBRyxJQUFJO0lBQ3ZCLE1BQU1DLFNBQVNDLE9BQU9ILElBQUlJLE9BQU8sRUFBRUYsVUFBVSxJQUFJRyxXQUFXO0lBQzVELE1BQU1DLE1BQU1ILE9BQU9ILElBQUlJLE9BQU8sRUFBRSxDQUFDLG1CQUFtQixJQUFJLElBQUlDLFdBQVc7SUFDdkUsT0FBT0osSUFBSU0sVUFBVSxDQUFDLFlBQVlMLE9BQU9NLFFBQVEsQ0FBQyx1QkFBdUJGLFFBQVE7QUFDbkY7QUFFQSxTQUFTRyxnQkFBZ0JULEdBQUc7SUFDMUIsSUFBSTtRQUNGLE1BQU1VLElBQUksSUFBSUMsSUFBSVgsSUFBSUMsR0FBRyxFQUFFLENBQUMsT0FBTyxFQUFFRCxJQUFJSSxPQUFPLENBQUNRLElBQUksSUFBSSxhQUFhO1FBQ3RFLE9BQU9GLEVBQUVHLFFBQVEsR0FBR0gsRUFBRUksTUFBTSxFQUFFLHdCQUF3QjtJQUN4RCxFQUFFLE9BQU07UUFDTixPQUFPO0lBQ1Q7QUFDRjtBQUVBLGdEQUFnRDtBQUNoRCxrQkFBa0I7QUFDbEIsZ0RBQWdEO0FBQ3pDLFNBQVNDLGVBQWVDLFlBQVksY0FBYztJQUN2REMsUUFBUUMsR0FBRyxDQUFDO0lBRVosT0FBTyxlQUFlQyxNQUFNbkIsR0FBRyxFQUFFb0IsR0FBRyxFQUFFQyxJQUFJO1FBQ3hDLE1BQU1DLE1BQU10QixJQUFJc0IsR0FBRyxJQUFJO1FBQ3ZCLE1BQU1DLEtBQUtDLEtBQUtDLEdBQUc7UUFFbkJSLFFBQVFDLEdBQUcsQ0FBQyxvQkFBb0JJLEtBQUssYUFBYXRCLElBQUkwQixNQUFNLEVBQUUxQixJQUFJQyxHQUFHO1FBRXJFLElBQUk7WUFDRmdCLFFBQVFDLEdBQUcsQ0FBQyxvQkFBb0IseUJBQXlCbEIsSUFBSTBCLE1BQU0sRUFBRTFCLElBQUlDLEdBQUc7WUFFNUUsbUNBQW1DO1lBQ25DLE1BQU0wQixRQUFRLE1BQU1oQyx1REFBUUEsQ0FBQztnQkFBRUs7Z0JBQUs0QixRQUFRQyxRQUFRQyxHQUFHLENBQUNDLGVBQWU7WUFBQztZQUN4RWQsUUFBUUMsR0FBRyxDQUFDLG9CQUFvQkksS0FBSyxpQkFBaUJLLFFBQVEsVUFBVSxXQUFXLFNBQVNBLE9BQU9LO1lBRW5HLElBQUksQ0FBQ0wsT0FBTztnQkFDVlYsUUFBUWdCLElBQUksQ0FBQyxvQkFBb0JYLEtBQUs7Z0JBQ3RDLElBQUl2QixVQUFVQyxNQUFNO29CQUNsQmlCLFFBQVFDLEdBQUcsQ0FBQyxvQkFBb0JJLEtBQUs7b0JBQ3JDLE9BQU9GLElBQUljLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7d0JBQzFCQyxJQUFJO3dCQUNKQyxNQUFNO3dCQUNOQyxPQUFPO29CQUNUO2dCQUNGO2dCQUNBLE1BQU1DLEtBQUtDLG1CQUFtQi9CLGdCQUFnQlQ7Z0JBQzlDaUIsUUFBUUMsR0FBRyxDQUFDLG9CQUFvQkksS0FBSztnQkFDckMsT0FBT0YsSUFBSXFCLFFBQVEsQ0FBQyxHQUFHekIsVUFBVSxhQUFhLEVBQUV1QixJQUFJO1lBQ3REO1lBRUEsMENBQTBDO1lBQzFDLE1BQU1QLE9BQU83QixPQUFPd0IsTUFBTUssSUFBSSxJQUFJLFFBQVFVLFdBQVc7WUFDckR6QixRQUFRQyxHQUFHLENBQUMsb0JBQW9CSSxLQUFLLG9CQUFvQlU7WUFFekQsSUFBSUEsU0FBU3BDLE1BQU1DLEtBQUssRUFBRTtnQkFDeEJvQixRQUFRZ0IsSUFBSSxDQUFDLG9CQUFvQlgsS0FBSztnQkFDdEMsSUFBSXZCLFVBQVVDLE1BQU07b0JBQ2xCaUIsUUFBUUMsR0FBRyxDQUFDLG9CQUFvQkksS0FBSztvQkFDckMsT0FBT0YsSUFBSWMsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQzt3QkFDMUJDLElBQUk7d0JBQ0pDLE1BQU07d0JBQ05DLE9BQU87b0JBQ1Q7Z0JBQ0Y7Z0JBQ0EsT0FBT2xCLElBQUlxQixRQUFRLENBQUM7WUFDdEI7WUFFQSxlQUFlO1lBQ2Z6QyxJQUFJMkMsSUFBSSxHQUFHO2dCQUNUQyxJQUFJakIsTUFBTWtCLEdBQUcsSUFBSTtnQkFDakJDLE9BQU9uQixNQUFNbUIsS0FBSyxJQUFJO2dCQUN0QmQ7WUFDRjtZQUVBZixRQUFRQyxHQUFHLENBQ1Qsb0JBQ0FJLEtBQ0EsdUNBQ0F5QixLQUFLQyxTQUFTLENBQUNoRCxJQUFJMkMsSUFBSSxHQUN2QixNQUNBbkIsS0FBS0MsR0FBRyxLQUFLRixJQUNiO1lBR0YsT0FBT0YsUUFBUSxtREFBbUQ7UUFDcEUsRUFBRSxPQUFPNEIsS0FBSztZQUNaaEMsUUFBUXFCLEtBQUssQ0FBQyxvQkFBb0JoQixLQUFLLFdBQVcyQixLQUFLQyxXQUFXRDtZQUNsRSxJQUFJbEQsVUFBVUMsTUFBTTtnQkFDbEJpQixRQUFRQyxHQUFHLENBQUMsb0JBQW9CSSxLQUFLO2dCQUNyQyxPQUFPRixJQUFJYyxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO29CQUMxQkMsSUFBSTtvQkFDSkMsTUFBTTtvQkFDTkMsT0FBTztnQkFDVDtZQUNGO1lBQ0FyQixRQUFRQyxHQUFHLENBQUMsb0JBQW9CSSxLQUFLO1lBQ3JDLE9BQU9GLElBQUlxQixRQUFRLENBQUN6QjtRQUN0QjtJQUNGO0FBQ0Y7QUFFQSxnREFBZ0Q7QUFDaEQsNENBQTRDO0FBQzVDLGdEQUFnRDtBQUN6QyxTQUFTbUMsVUFBVUMsT0FBTyxFQUFFcEMsWUFBWSxjQUFjO0lBQzNELE1BQU1xQyxLQUFLdEMsZUFBZUM7SUFDMUIsT0FBTyxPQUFPaEIsS0FBS29CO1FBQ2pCLE1BQU1FLE1BQU10QixJQUFJc0IsR0FBRyxJQUFJO1FBQ3ZCTCxRQUFRQyxHQUFHLENBQUMsZUFBZUksS0FBSyxnQ0FBZ0N0QixJQUFJQyxHQUFHO1FBQ3ZFLE1BQU1vRCxHQUFHckQsS0FBS29CLEtBQUs7WUFDakJILFFBQVFDLEdBQUcsQ0FBQyxlQUFlSSxLQUFLO1lBQ2hDLE1BQU04QixRQUFRcEQsS0FBS29CO1lBQ25CSCxRQUFRQyxHQUFHLENBQUMsZUFBZUksS0FBSztRQUNsQztJQUNGO0FBQ0YiLCJzb3VyY2VzIjpbIi9Vc2Vycy9lbW9udGF6ZXJpL0RvY3VtZW50cy9wcm9qZWN0cy9zaGVsbC1zdG9yaWVzLXN0dWRpby9saWIvYXV0aC9hdXRob3JpemVBZG1pbi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBsaWIvYXV0aC9hdXRob3JpemVBZG1pbi5qc1xuaW1wb3J0IHsgZ2V0VG9rZW4gfSBmcm9tICduZXh0LWF1dGgvand0JztcblxuZXhwb3J0IGNvbnN0IFJPTEVTID0geyBBRE1JTjogJ0FETUlOJywgVVNFUjogJ1VTRVInIH07XG5cbi8vIOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFxuLy8gSGVscGVyIHV0aWxpdGllc1xuLy8g4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXG5mdW5jdGlvbiB3YW50c0pzb24ocmVxKSB7XG4gIGNvbnN0IHVybCA9IHJlcS51cmwgfHwgJyc7XG4gIGNvbnN0IGFjY2VwdCA9IFN0cmluZyhyZXEuaGVhZGVycz8uYWNjZXB0IHx8ICcnKS50b0xvd2VyQ2FzZSgpO1xuICBjb25zdCB4cncgPSBTdHJpbmcocmVxLmhlYWRlcnM/LlsneC1yZXF1ZXN0ZWQtd2l0aCddIHx8ICcnKS50b0xvd2VyQ2FzZSgpO1xuICByZXR1cm4gdXJsLnN0YXJ0c1dpdGgoJy9hcGkvJykgfHwgYWNjZXB0LmluY2x1ZGVzKCdhcHBsaWNhdGlvbi9qc29uJykgfHwgeHJ3ID09PSAneG1saHR0cHJlcXVlc3QnO1xufVxuXG5mdW5jdGlvbiBzYWZlQ2FsbGJhY2tVcmwocmVxKSB7XG4gIHRyeSB7XG4gICAgY29uc3QgdSA9IG5ldyBVUkwocmVxLnVybCwgYGh0dHA6Ly8ke3JlcS5oZWFkZXJzLmhvc3QgfHwgJ2xvY2FsaG9zdCd9YCk7XG4gICAgcmV0dXJuIHUucGF0aG5hbWUgKyB1LnNlYXJjaDsgLy8gc2FtZS1vcmlnaW4gcGF0aCBvbmx5XG4gIH0gY2F0Y2gge1xuICAgIHJldHVybiAnLyc7XG4gIH1cbn1cblxuLy8g4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXG4vLyBDb3JlIG1pZGRsZXdhcmVcbi8vIOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFxuZXhwb3J0IGZ1bmN0aW9uIGF1dGhvcml6ZUFkbWluKGxvZ2luUGF0aCA9ICcvYWRtaW4vbG9naW4nKSB7XG4gIGNvbnNvbGUubG9nKCdbYXV0aG9yaXplQWRtaW5dIG1pZGRsZXdhcmUgaW5pdGlhbGl6ZWQnKTtcblxuICByZXR1cm4gYXN5bmMgZnVuY3Rpb24gZ3VhcmQocmVxLCByZXMsIG5leHQpIHtcbiAgICBjb25zdCByaWQgPSByZXEucmlkIHx8ICctJztcbiAgICBjb25zdCB0MCA9IERhdGUubm93KCk7XG5cbiAgICBjb25zb2xlLmxvZygnW2F1dGhvcml6ZUFkbWluXScsIHJpZCwgJ0VOVEVSIGZvcicsIHJlcS5tZXRob2QsIHJlcS51cmwpO1xuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnNvbGUubG9nKCdbYXV0aG9yaXplQWRtaW5dJywgJ0VYRUNVVElPTiBFTlRFUkVEIGZvcicsIHJlcS5tZXRob2QsIHJlcS51cmwpO1xuXG4gICAgICAvLyDwn5SRIFRyeSByZWFkaW5nIHRoZSBzZXNzaW9uIHRva2VuXG4gICAgICBjb25zdCB0b2tlbiA9IGF3YWl0IGdldFRva2VuKHsgcmVxLCBzZWNyZXQ6IHByb2Nlc3MuZW52Lk5FWFRBVVRIX1NFQ1JFVCB9KTtcbiAgICAgIGNvbnNvbGUubG9nKCdbYXV0aG9yaXplQWRtaW5dJywgcmlkLCAndG9rZW4gY2hlY2sg4oaSJywgdG9rZW4gPyAnRk9VTkQnIDogJ01JU1NJTkcnLCAncm9sZTonLCB0b2tlbj8ucm9sZSk7XG5cbiAgICAgIGlmICghdG9rZW4pIHtcbiAgICAgICAgY29uc29sZS53YXJuKCdbYXV0aG9yaXplQWRtaW5dJywgcmlkLCAnTk8gVE9LRU4gKHVuYXV0aGVudGljYXRlZCknKTtcbiAgICAgICAgaWYgKHdhbnRzSnNvbihyZXEpKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ1thdXRob3JpemVBZG1pbl0nLCByaWQsICfihpIgcmV0dXJuaW5nIDQwMSBKU09OJyk7XG4gICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcbiAgICAgICAgICAgIG9rOiBmYWxzZSxcbiAgICAgICAgICAgIGNvZGU6ICdVTkFVVEhFTlRJQ0FURUQnLFxuICAgICAgICAgICAgZXJyb3I6ICdVbmF1dGhvcml6ZWQnLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGNiID0gZW5jb2RlVVJJQ29tcG9uZW50KHNhZmVDYWxsYmFja1VybChyZXEpKTtcbiAgICAgICAgY29uc29sZS5sb2coJ1thdXRob3JpemVBZG1pbl0nLCByaWQsICfihpIgcmVkaXJlY3RpbmcgdG8gbG9naW4nKTtcbiAgICAgICAgcmV0dXJuIHJlcy5yZWRpcmVjdChgJHtsb2dpblBhdGh9P2NhbGxiYWNrVXJsPSR7Y2J9YCk7XG4gICAgICB9XG5cbiAgICAgIC8vIE5vcm1hbGl6ZSByb2xlIChlLmcuIFwiYWRtaW5cIiDihpIgXCJBRE1JTlwiKVxuICAgICAgY29uc3Qgcm9sZSA9IFN0cmluZyh0b2tlbi5yb2xlIHx8ICdVU0VSJykudG9VcHBlckNhc2UoKTtcbiAgICAgIGNvbnNvbGUubG9nKCdbYXV0aG9yaXplQWRtaW5dJywgcmlkLCAnbm9ybWFsaXplZCByb2xlOicsIHJvbGUpO1xuXG4gICAgICBpZiAocm9sZSAhPT0gUk9MRVMuQURNSU4pIHtcbiAgICAgICAgY29uc29sZS53YXJuKCdbYXV0aG9yaXplQWRtaW5dJywgcmlkLCAncm9sZSBub3QgYWRtaW4g4oaSIGZvcmJpZGRlbicpO1xuICAgICAgICBpZiAod2FudHNKc29uKHJlcSkpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZygnW2F1dGhvcml6ZUFkbWluXScsIHJpZCwgJ+KGkiByZXR1cm5pbmcgNDAzIEpTT04nKTtcbiAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oe1xuICAgICAgICAgICAgb2s6IGZhbHNlLFxuICAgICAgICAgICAgY29kZTogJ0ZPUkJJRERFTicsXG4gICAgICAgICAgICBlcnJvcjogJ0ZvcmJpZGRlbicsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlcy5yZWRpcmVjdCgnLzQwMycpO1xuICAgICAgfVxuXG4gICAgICAvLyDinIUgQXV0aG9yaXplZFxuICAgICAgcmVxLnVzZXIgPSB7XG4gICAgICAgIGlkOiB0b2tlbi5zdWIgfHwgbnVsbCxcbiAgICAgICAgZW1haWw6IHRva2VuLmVtYWlsIHx8IG51bGwsXG4gICAgICAgIHJvbGUsXG4gICAgICB9O1xuXG4gICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgJ1thdXRob3JpemVBZG1pbl0nLFxuICAgICAgICByaWQsXG4gICAgICAgICdBVVRIT1JJWkVEIOKGkiBjYWxsaW5nIG5leHQoKSB8IHVzZXI6JyxcbiAgICAgICAgSlNPTi5zdHJpbmdpZnkocmVxLnVzZXIpLFxuICAgICAgICAnaW4nLFxuICAgICAgICBEYXRlLm5vdygpIC0gdDAsXG4gICAgICAgICdtcydcbiAgICAgICk7XG5cbiAgICAgIHJldHVybiBuZXh0KCk7IC8vIDwtLS0gdGhpcyBlbnN1cmVzIHRoZSBtaWRkbGV3YXJlIGNoYWluIGNvbnRpbnVlc1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgY29uc29sZS5lcnJvcignW2F1dGhvcml6ZUFkbWluXScsIHJpZCwgJ0VSUk9SIOKGkicsIGVycj8ubWVzc2FnZSB8fCBlcnIpO1xuICAgICAgaWYgKHdhbnRzSnNvbihyZXEpKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdbYXV0aG9yaXplQWRtaW5dJywgcmlkLCAn4oaSIHJldHVybmluZyA0MDEgSlNPTiAodG9rZW4gZXJyb3IpJyk7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7XG4gICAgICAgICAgb2s6IGZhbHNlLFxuICAgICAgICAgIGNvZGU6ICdUT0tFTl9FUlJPUicsXG4gICAgICAgICAgZXJyb3I6ICdVbmF1dGhvcml6ZWQnLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGNvbnNvbGUubG9nKCdbYXV0aG9yaXplQWRtaW5dJywgcmlkLCAn4oaSIHJlZGlyZWN0aW5nIHRvIGxvZ2luIChleGNlcHRpb24pJyk7XG4gICAgICByZXR1cm4gcmVzLnJlZGlyZWN0KGxvZ2luUGF0aCk7XG4gICAgfVxuICB9O1xufVxuXG4vLyDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcbi8vIFdyYXBwZXIgZm9yIHN0YW5kYWxvbmUgTmV4dC5qcyBBUEkgcm91dGVzXG4vLyDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcbmV4cG9ydCBmdW5jdGlvbiB3aXRoQWRtaW4oaGFuZGxlciwgbG9naW5QYXRoID0gJy9hZG1pbi9sb2dpbicpIHtcbiAgY29uc3QgbXcgPSBhdXRob3JpemVBZG1pbihsb2dpblBhdGgpO1xuICByZXR1cm4gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gICAgY29uc3QgcmlkID0gcmVxLnJpZCB8fCAnLSc7XG4gICAgY29uc29sZS5sb2coJ1t3aXRoQWRtaW5dJywgcmlkLCAnRU5URVIg4oaSIHdyYXBwaW5nIGhhbmRsZXIgZm9yJywgcmVxLnVybCk7XG4gICAgYXdhaXQgbXcocmVxLCByZXMsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKCdbd2l0aEFkbWluXScsIHJpZCwgJ0FVVEggT0sg4oaSIGV4ZWN1dGluZyBoYW5kbGVyJyk7XG4gICAgICBhd2FpdCBoYW5kbGVyKHJlcSwgcmVzKTtcbiAgICAgIGNvbnNvbGUubG9nKCdbd2l0aEFkbWluXScsIHJpZCwgJ0hBTkRMRVIgQ09NUExFVEUnKTtcbiAgICB9KTtcbiAgfTtcbn1cblxuXG5cblxuXG4iXSwibmFtZXMiOlsiZ2V0VG9rZW4iLCJST0xFUyIsIkFETUlOIiwiVVNFUiIsIndhbnRzSnNvbiIsInJlcSIsInVybCIsImFjY2VwdCIsIlN0cmluZyIsImhlYWRlcnMiLCJ0b0xvd2VyQ2FzZSIsInhydyIsInN0YXJ0c1dpdGgiLCJpbmNsdWRlcyIsInNhZmVDYWxsYmFja1VybCIsInUiLCJVUkwiLCJob3N0IiwicGF0aG5hbWUiLCJzZWFyY2giLCJhdXRob3JpemVBZG1pbiIsImxvZ2luUGF0aCIsImNvbnNvbGUiLCJsb2ciLCJndWFyZCIsInJlcyIsIm5leHQiLCJyaWQiLCJ0MCIsIkRhdGUiLCJub3ciLCJtZXRob2QiLCJ0b2tlbiIsInNlY3JldCIsInByb2Nlc3MiLCJlbnYiLCJORVhUQVVUSF9TRUNSRVQiLCJyb2xlIiwid2FybiIsInN0YXR1cyIsImpzb24iLCJvayIsImNvZGUiLCJlcnJvciIsImNiIiwiZW5jb2RlVVJJQ29tcG9uZW50IiwicmVkaXJlY3QiLCJ0b1VwcGVyQ2FzZSIsInVzZXIiLCJpZCIsInN1YiIsImVtYWlsIiwiSlNPTiIsInN0cmluZ2lmeSIsImVyciIsIm1lc3NhZ2UiLCJ3aXRoQWRtaW4iLCJoYW5kbGVyIiwibXciXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api-node)/./lib/auth/authorizeAdmin.js\n");

/***/ }),

/***/ "(api-node)/./lib/cacheHelpers.js":
/*!*****************************!*\
  !*** ./lib/cacheHelpers.js ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   clearProductsCache: () => (/* binding */ clearProductsCache)\n/* harmony export */ });\n/* harmony import */ var _redis__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./redis */ \"(api-node)/./lib/redis.js\");\n/* harmony import */ var _redis_formatkey__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./redis/formatkey */ \"(api-node)/./lib/redis/formatkey.js\");\n// lib/cacheHelpers.js\n\n\nasync function clearProductsCache() {\n    try {\n        const redis = await (0,_redis__WEBPACK_IMPORTED_MODULE_0__.getRedisClient)();\n        //const keys = await redis.keys('products:*');\n        //const pattern = safeRedisKey(['products', '*']); // still safe\n        const pattern = `${(0,_redis_formatkey__WEBPACK_IMPORTED_MODULE_1__.safeRedisKey)([\n            'products'\n        ])}:*`; // âœ… FIXED\n        const keys = await redis.keys(pattern);\n        if (keys.length > 0) {\n            await redis.del(...keys);\n            console.log('ðŸ§¹ Redis cache cleared:', keys);\n        }\n    } catch (e) {\n        console.warn('âš ï¸ Redis cache clear failed:', e);\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL2xpYi9jYWNoZUhlbHBlcnMuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsc0JBQXNCO0FBQ21CO0FBQ1E7QUFFMUMsZUFBZUU7SUFDcEIsSUFBSTtRQUNGLE1BQU1DLFFBQVEsTUFBTUgsc0RBQWNBO1FBQ2xDLDhDQUE4QztRQUM5QyxnRUFBZ0U7UUFDaEUsTUFBTUksVUFBVSxHQUFHSCw4REFBWUEsQ0FBQztZQUFDO1NBQVcsRUFBRSxFQUFFLENBQUMsRUFBRyxVQUFVO1FBQzlELE1BQU1JLE9BQU8sTUFBTUYsTUFBTUUsSUFBSSxDQUFDRDtRQUM5QixJQUFJQyxLQUFLQyxNQUFNLEdBQUcsR0FBRztZQUNuQixNQUFNSCxNQUFNSSxHQUFHLElBQUlGO1lBQ25CRyxRQUFRQyxHQUFHLENBQUMsMkJBQTJCSjtRQUN6QztJQUNGLEVBQUUsT0FBT0ssR0FBRztRQUNWRixRQUFRRyxJQUFJLENBQUMsZ0NBQWdDRDtJQUMvQztBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvZW1vbnRhemVyaS9Eb2N1bWVudHMvcHJvamVjdHMvc2hlbGwtc3Rvcmllcy1zdHVkaW8vbGliL2NhY2hlSGVscGVycy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBsaWIvY2FjaGVIZWxwZXJzLmpzXG5pbXBvcnQgeyBnZXRSZWRpc0NsaWVudCB9IGZyb20gJy4vcmVkaXMnO1xuaW1wb3J0IHsgc2FmZVJlZGlzS2V5IH0gZnJvbSAnLi9yZWRpcy9mb3JtYXRrZXknO1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY2xlYXJQcm9kdWN0c0NhY2hlKCkge1xuICB0cnkge1xuICAgIGNvbnN0IHJlZGlzID0gYXdhaXQgZ2V0UmVkaXNDbGllbnQoKTtcbiAgICAvL2NvbnN0IGtleXMgPSBhd2FpdCByZWRpcy5rZXlzKCdwcm9kdWN0czoqJyk7XG4gICAgLy9jb25zdCBwYXR0ZXJuID0gc2FmZVJlZGlzS2V5KFsncHJvZHVjdHMnLCAnKiddKTsgLy8gc3RpbGwgc2FmZVxuICAgIGNvbnN0IHBhdHRlcm4gPSBgJHtzYWZlUmVkaXNLZXkoWydwcm9kdWN0cyddKX06KmA7ICAvLyDinIUgRklYRURcbiAgICBjb25zdCBrZXlzID0gYXdhaXQgcmVkaXMua2V5cyhwYXR0ZXJuKTtcbiAgICBpZiAoa2V5cy5sZW5ndGggPiAwKSB7XG4gICAgICBhd2FpdCByZWRpcy5kZWwoLi4ua2V5cyk7XG4gICAgICBjb25zb2xlLmxvZygn8J+nuSBSZWRpcyBjYWNoZSBjbGVhcmVkOicsIGtleXMpO1xuICAgIH1cbiAgfSBjYXRjaCAoZSkge1xuICAgIGNvbnNvbGUud2Fybign4pqg77iPIFJlZGlzIGNhY2hlIGNsZWFyIGZhaWxlZDonLCBlKTtcbiAgfVxufVxuIl0sIm5hbWVzIjpbImdldFJlZGlzQ2xpZW50Iiwic2FmZVJlZGlzS2V5IiwiY2xlYXJQcm9kdWN0c0NhY2hlIiwicmVkaXMiLCJwYXR0ZXJuIiwia2V5cyIsImxlbmd0aCIsImRlbCIsImNvbnNvbGUiLCJsb2ciLCJlIiwid2FybiJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api-node)/./lib/cacheHelpers.js\n");

/***/ }),

/***/ "(api-node)/./lib/db.js":
/*!*******************!*\
  !*** ./lib/db.js ***!
  \*******************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getAllProductIds: () => (/* binding */ getAllProductIds),\n/* harmony export */   getAllProducts: () => (/* binding */ getAllProducts),\n/* harmony export */   getAllProductsForList: () => (/* binding */ getAllProductsForList),\n/* harmony export */   getAllProductsSummary: () => (/* binding */ getAllProductsForList),\n/* harmony export */   getProductById: () => (/* binding */ getProductById),\n/* harmony export */   getProductByIdWithMedia: () => (/* binding */ getProductWithMediaById),\n/* harmony export */   getProductWithMediaById: () => (/* binding */ getProductWithMediaById),\n/* harmony export */   openDB: () => (/* binding */ openDB)\n/* harmony export */ });\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var sqlite__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! sqlite */ \"sqlite\");\n/* harmony import */ var sqlite3__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! sqlite3 */ \"sqlite3\");\n/* harmony import */ var sqlite3__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(sqlite3__WEBPACK_IMPORTED_MODULE_2__);\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([sqlite__WEBPACK_IMPORTED_MODULE_1__]);\nsqlite__WEBPACK_IMPORTED_MODULE_1__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n// lib/db.js\n\n\n\nconst dbPath = path__WEBPACK_IMPORTED_MODULE_0___default().join(process.cwd(), 'data', 'shells_shop.db');\nconst openDB = ()=>(0,sqlite__WEBPACK_IMPORTED_MODULE_1__.open)({\n        filename: dbPath,\n        driver: (sqlite3__WEBPACK_IMPORTED_MODULE_2___default().Database)\n    });\n// --- Existing helpers (kept for compatibility) ---\nasync function getAllProducts() {\n    const db = await openDB();\n    return db.all('SELECT * FROM products');\n}\nasync function getProductById(id) {\n    const db = await openDB();\n    return db.get('SELECT * FROM products WHERE id = ?', id);\n}\n// --- Public detail page helper: product + full media (only active products) ---\nasync function getProductWithMediaById(id) {\n    const db = await openDB();\n    const product = await db.get(`SELECT id, name, description, price, stock, image_url, image_public_id,\n            category, is_active, is_favorite, created_at, updated_at\n       FROM products\n      WHERE id = ? AND is_active = 1`, id);\n    if (!product) return null;\n    const mediaRows = await db.all(`SELECT id, product_id, kind, public_id, secure_url, format,\n            width, height, duration, sort_order, is_primary, created_at\n       FROM product_media\n      WHERE product_id = ?\n      ORDER BY is_primary DESC, sort_order ASC, id ASC`, id);\n    return {\n        ...product,\n        price: Number(product.price),\n        stock: Number.isFinite(Number(product.stock)) ? Number(product.stock) : null,\n        is_active: Number(product.is_active) === 1,\n        is_favorite: Number(product.is_favorite) === 1,\n        media: mediaRows.map((m)=>({\n                id: m.id,\n                kind: m.kind,\n                secure_url: m.secure_url,\n                public_id: m.public_id,\n                format: m.format,\n                width: Number.isFinite(Number(m.width)) ? Number(m.width) : null,\n                height: Number.isFinite(Number(m.height)) ? Number(m.height) : null,\n                duration: Number.isFinite(Number(m.duration)) ? Number(m.duration) : null,\n                sort_order: Number.isFinite(Number(m.sort_order)) ? Number(m.sort_order) : 0,\n                is_primary: Number(m.is_primary) === 1,\n                created_at: m.created_at\n            }))\n    };\n}\n// --- Listing helper for product cards (active only) with primary media fallback ---\nasync function getAllProductsForList() {\n    const db = await openDB();\n    const rows = await db.all(`\n    SELECT\n      p.id, p.name, p.description, p.price, p.stock, p.image_url,\n      p.category, p.is_active, p.is_favorite, p.created_at,\n      pm.secure_url   AS primary_media_url,\n      pm.kind         AS primary_media_kind,\n      pm.public_id    AS primary_media_public_id\n    FROM products p\n    LEFT JOIN product_media pm\n      ON pm.id = (\n        SELECT id FROM product_media\n        WHERE product_id = p.id\n        ORDER BY is_primary DESC, sort_order ASC, id ASC\n        LIMIT 1\n      )\n    WHERE p.is_active = 1\n    ORDER BY p.created_at DESC\n  `);\n    return rows.map((r)=>({\n            id: r.id,\n            name: r.name,\n            description: r.description,\n            price: Number(r.price),\n            stock: Number.isFinite(Number(r.stock)) ? Number(r.stock) : null,\n            category: r.category,\n            is_active: Number(r.is_active) === 1,\n            is_favorite: Number(r.is_favorite) === 1,\n            created_at: r.created_at,\n            // âœ… reliable image for cards & previews:\n            image_url: r.primary_media_url || r.image_url || null,\n            // Optional richer meta (useful for components that prefer explicit primary media):\n            primaryMedia: r.primary_media_url ? {\n                url: r.primary_media_url,\n                kind: r.primary_media_kind,\n                public_id: r.primary_media_public_id\n            } : null\n        }));\n}\n// --- IDs for getStaticPaths (only active products) ---\nasync function getAllProductIds() {\n    const db = await openDB();\n    const rows = await db.all(`SELECT id FROM products WHERE is_active = 1`);\n    return rows.map((r)=>r.id);\n}\n// --- Aliases to keep your existing imports working ---\n\n\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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V0FBVyxNQUFNO1lBQ3ZDYSxZQUFZRyxFQUFFSCxVQUFVO1lBRXhCLHlDQUF5QztZQUN6Q08sV0FBV0osRUFBRUssaUJBQWlCLElBQUlMLEVBQUVJLFNBQVMsSUFBSTtZQUVqRCxtRkFBbUY7WUFDbkZFLGNBQWNOLEVBQUVLLGlCQUFpQixHQUM3QjtnQkFDRUUsS0FBS1AsRUFBRUssaUJBQWlCO2dCQUN4QmpCLE1BQU1ZLEVBQUVRLGtCQUFrQjtnQkFDMUJsQixXQUFXVSxFQUFFUyx1QkFBdUI7WUFDdEMsSUFDQTtRQUNOO0FBQ0Y7QUFFQSx3REFBd0Q7QUFDakQsZUFBZUM7SUFDcEIsTUFBTXZDLEtBQUssTUFBTUw7SUFDakIsTUFBTWlDLE9BQU8sTUFBTTVCLEdBQUdDLEdBQUcsQ0FBQyxDQUFDLDJDQUEyQyxDQUFDO0lBQ3ZFLE9BQU8yQixLQUFLYixHQUFHLENBQUNjLENBQUFBLElBQUtBLEVBQUUxQixFQUFFO0FBQzNCO0FBRUEsd0RBQXdEO0FBQ0U7QUFDSSIsInNvdXJjZXMiOlsiL1VzZXJzL2Vtb250YXplcmkvRG9jdW1lbnRzL3Byb2plY3RzL3NoZWxsLXN0b3JpZXMtc3R1ZGlvL2xpYi9kYi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBsaWIvZGIuanNcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IHsgb3BlbiB9IGZyb20gJ3NxbGl0ZSc7XG5pbXBvcnQgc3FsaXRlMyBmcm9tICdzcWxpdGUzJztcblxuY29uc3QgZGJQYXRoID0gcGF0aC5qb2luKHByb2Nlc3MuY3dkKCksICdkYXRhJywgJ3NoZWxsc19zaG9wLmRiJyk7XG5leHBvcnQgY29uc3Qgb3BlbkRCID0gKCkgPT4gb3Blbih7IGZpbGVuYW1lOiBkYlBhdGgsIGRyaXZlcjogc3FsaXRlMy5EYXRhYmFzZSB9KTtcblxuLy8gLS0tIEV4aXN0aW5nIGhlbHBlcnMgKGtlcHQgZm9yIGNvbXBhdGliaWxpdHkpIC0tLVxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEFsbFByb2R1Y3RzKCkge1xuICBjb25zdCBkYiA9IGF3YWl0IG9wZW5EQigpO1xuICByZXR1cm4gZGIuYWxsKCdTRUxFQ1QgKiBGUk9NIHByb2R1Y3RzJyk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRQcm9kdWN0QnlJZChpZCkge1xuICBjb25zdCBkYiA9IGF3YWl0IG9wZW5EQigpO1xuICByZXR1cm4gZGIuZ2V0KCdTRUxFQ1QgKiBGUk9NIHByb2R1Y3RzIFdIRVJFIGlkID0gPycsIGlkKTtcbn1cblxuLy8gLS0tIFB1YmxpYyBkZXRhaWwgcGFnZSBoZWxwZXI6IHByb2R1Y3QgKyBmdWxsIG1lZGlhIChvbmx5IGFjdGl2ZSBwcm9kdWN0cykgLS0tXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0UHJvZHVjdFdpdGhNZWRpYUJ5SWQoaWQpIHtcbiAgY29uc3QgZGIgPSBhd2FpdCBvcGVuREIoKTtcblxuICBjb25zdCBwcm9kdWN0ID0gYXdhaXQgZGIuZ2V0KFxuICAgIGBTRUxFQ1QgaWQsIG5hbWUsIGRlc2NyaXB0aW9uLCBwcmljZSwgc3RvY2ssIGltYWdlX3VybCwgaW1hZ2VfcHVibGljX2lkLFxuICAgICAgICAgICAgY2F0ZWdvcnksIGlzX2FjdGl2ZSwgaXNfZmF2b3JpdGUsIGNyZWF0ZWRfYXQsIHVwZGF0ZWRfYXRcbiAgICAgICBGUk9NIHByb2R1Y3RzXG4gICAgICBXSEVSRSBpZCA9ID8gQU5EIGlzX2FjdGl2ZSA9IDFgLFxuICAgIGlkXG4gICk7XG4gIGlmICghcHJvZHVjdCkgcmV0dXJuIG51bGw7XG5cbiAgY29uc3QgbWVkaWFSb3dzID0gYXdhaXQgZGIuYWxsKFxuICAgIGBTRUxFQ1QgaWQsIHByb2R1Y3RfaWQsIGtpbmQsIHB1YmxpY19pZCwgc2VjdXJlX3VybCwgZm9ybWF0LFxuICAgICAgICAgICAgd2lkdGgsIGhlaWdodCwgZHVyYXRpb24sIHNvcnRfb3JkZXIsIGlzX3ByaW1hcnksIGNyZWF0ZWRfYXRcbiAgICAgICBGUk9NIHByb2R1Y3RfbWVkaWFcbiAgICAgIFdIRVJFIHByb2R1Y3RfaWQgPSA/XG4gICAgICBPUkRFUiBCWSBpc19wcmltYXJ5IERFU0MsIHNvcnRfb3JkZXIgQVNDLCBpZCBBU0NgLFxuICAgIGlkXG4gICk7XG5cbiAgcmV0dXJuIHtcbiAgICAuLi5wcm9kdWN0LFxuICAgIHByaWNlOiBOdW1iZXIocHJvZHVjdC5wcmljZSksXG4gICAgc3RvY2s6IE51bWJlci5pc0Zpbml0ZShOdW1iZXIocHJvZHVjdC5zdG9jaykpID8gTnVtYmVyKHByb2R1Y3Quc3RvY2spIDogbnVsbCxcbiAgICBpc19hY3RpdmU6IE51bWJlcihwcm9kdWN0LmlzX2FjdGl2ZSkgPT09IDEsXG4gICAgaXNfZmF2b3JpdGU6IE51bWJlcihwcm9kdWN0LmlzX2Zhdm9yaXRlKSA9PT0gMSxcbiAgICBtZWRpYTogbWVkaWFSb3dzLm1hcChtID0+ICh7XG4gICAgICBpZDogbS5pZCxcbiAgICAgIGtpbmQ6IG0ua2luZCwgICAgICAgICAgICAgICAgIC8vIFwiaW1hZ2VcIiB8IFwidmlkZW9cIlxuICAgICAgc2VjdXJlX3VybDogbS5zZWN1cmVfdXJsLFxuICAgICAgcHVibGljX2lkOiBtLnB1YmxpY19pZCxcbiAgICAgIGZvcm1hdDogbS5mb3JtYXQsXG4gICAgICB3aWR0aDogTnVtYmVyLmlzRmluaXRlKE51bWJlcihtLndpZHRoKSkgPyBOdW1iZXIobS53aWR0aCkgOiBudWxsLFxuICAgICAgaGVpZ2h0OiBOdW1iZXIuaXNGaW5pdGUoTnVtYmVyKG0uaGVpZ2h0KSkgPyBOdW1iZXIobS5oZWlnaHQpIDogbnVsbCxcbiAgICAgIGR1cmF0aW9uOiBOdW1iZXIuaXNGaW5pdGUoTnVtYmVyKG0uZHVyYXRpb24pKSA/IE51bWJlcihtLmR1cmF0aW9uKSA6IG51bGwsXG4gICAgICBzb3J0X29yZGVyOiBOdW1iZXIuaXNGaW5pdGUoTnVtYmVyKG0uc29ydF9vcmRlcikpID8gTnVtYmVyKG0uc29ydF9vcmRlcikgOiAwLFxuICAgICAgaXNfcHJpbWFyeTogTnVtYmVyKG0uaXNfcHJpbWFyeSkgPT09IDEsXG4gICAgICBjcmVhdGVkX2F0OiBtLmNyZWF0ZWRfYXQsXG4gICAgfSkpLFxuICB9O1xufVxuXG4vLyAtLS0gTGlzdGluZyBoZWxwZXIgZm9yIHByb2R1Y3QgY2FyZHMgKGFjdGl2ZSBvbmx5KSB3aXRoIHByaW1hcnkgbWVkaWEgZmFsbGJhY2sgLS0tXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0QWxsUHJvZHVjdHNGb3JMaXN0KCkge1xuICBjb25zdCBkYiA9IGF3YWl0IG9wZW5EQigpO1xuXG4gIGNvbnN0IHJvd3MgPSBhd2FpdCBkYi5hbGwoYFxuICAgIFNFTEVDVFxuICAgICAgcC5pZCwgcC5uYW1lLCBwLmRlc2NyaXB0aW9uLCBwLnByaWNlLCBwLnN0b2NrLCBwLmltYWdlX3VybCxcbiAgICAgIHAuY2F0ZWdvcnksIHAuaXNfYWN0aXZlLCBwLmlzX2Zhdm9yaXRlLCBwLmNyZWF0ZWRfYXQsXG4gICAgICBwbS5zZWN1cmVfdXJsICAgQVMgcHJpbWFyeV9tZWRpYV91cmwsXG4gICAgICBwbS5raW5kICAgICAgICAgQVMgcHJpbWFyeV9tZWRpYV9raW5kLFxuICAgICAgcG0ucHVibGljX2lkICAgIEFTIHByaW1hcnlfbWVkaWFfcHVibGljX2lkXG4gICAgRlJPTSBwcm9kdWN0cyBwXG4gICAgTEVGVCBKT0lOIHByb2R1Y3RfbWVkaWEgcG1cbiAgICAgIE9OIHBtLmlkID0gKFxuICAgICAgICBTRUxFQ1QgaWQgRlJPTSBwcm9kdWN0X21lZGlhXG4gICAgICAgIFdIRVJFIHByb2R1Y3RfaWQgPSBwLmlkXG4gICAgICAgIE9SREVSIEJZIGlzX3ByaW1hcnkgREVTQywgc29ydF9vcmRlciBBU0MsIGlkIEFTQ1xuICAgICAgICBMSU1JVCAxXG4gICAgICApXG4gICAgV0hFUkUgcC5pc19hY3RpdmUgPSAxXG4gICAgT1JERVIgQlkgcC5jcmVhdGVkX2F0IERFU0NcbiAgYCk7XG5cbiAgcmV0dXJuIHJvd3MubWFwKHIgPT4gKHtcbiAgICBpZDogci5pZCxcbiAgICBuYW1lOiByLm5hbWUsXG4gICAgZGVzY3JpcHRpb246IHIuZGVzY3JpcHRpb24sXG4gICAgcHJpY2U6IE51bWJlcihyLnByaWNlKSxcbiAgICBzdG9jazogTnVtYmVyLmlzRmluaXRlKE51bWJlcihyLnN0b2NrKSkgPyBOdW1iZXIoci5zdG9jaykgOiBudWxsLFxuICAgIGNhdGVnb3J5OiByLmNhdGVnb3J5LFxuICAgIGlzX2FjdGl2ZTogTnVtYmVyKHIuaXNfYWN0aXZlKSA9PT0gMSxcbiAgICBpc19mYXZvcml0ZTogTnVtYmVyKHIuaXNfZmF2b3JpdGUpID09PSAxLFxuICAgIGNyZWF0ZWRfYXQ6IHIuY3JlYXRlZF9hdCxcblxuICAgIC8vIOKchSByZWxpYWJsZSBpbWFnZSBmb3IgY2FyZHMgJiBwcmV2aWV3czpcbiAgICBpbWFnZV91cmw6IHIucHJpbWFyeV9tZWRpYV91cmwgfHwgci5pbWFnZV91cmwgfHwgbnVsbCxcblxuICAgIC8vIE9wdGlvbmFsIHJpY2hlciBtZXRhICh1c2VmdWwgZm9yIGNvbXBvbmVudHMgdGhhdCBwcmVmZXIgZXhwbGljaXQgcHJpbWFyeSBtZWRpYSk6XG4gICAgcHJpbWFyeU1lZGlhOiByLnByaW1hcnlfbWVkaWFfdXJsXG4gICAgICA/IHtcbiAgICAgICAgICB1cmw6IHIucHJpbWFyeV9tZWRpYV91cmwsXG4gICAgICAgICAga2luZDogci5wcmltYXJ5X21lZGlhX2tpbmQsICAgICAgICAgICAgLy8gXCJpbWFnZVwiIHwgXCJ2aWRlb1wiXG4gICAgICAgICAgcHVibGljX2lkOiByLnByaW1hcnlfbWVkaWFfcHVibGljX2lkLFxuICAgICAgICB9XG4gICAgICA6IG51bGwsXG4gIH0pKTtcbn1cblxuLy8gLS0tIElEcyBmb3IgZ2V0U3RhdGljUGF0aHMgKG9ubHkgYWN0aXZlIHByb2R1Y3RzKSAtLS1cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBbGxQcm9kdWN0SWRzKCkge1xuICBjb25zdCBkYiA9IGF3YWl0IG9wZW5EQigpO1xuICBjb25zdCByb3dzID0gYXdhaXQgZGIuYWxsKGBTRUxFQ1QgaWQgRlJPTSBwcm9kdWN0cyBXSEVSRSBpc19hY3RpdmUgPSAxYCk7XG4gIHJldHVybiByb3dzLm1hcChyID0+IHIuaWQpO1xufVxuXG4vLyAtLS0gQWxpYXNlcyB0byBrZWVwIHlvdXIgZXhpc3RpbmcgaW1wb3J0cyB3b3JraW5nIC0tLVxuZXhwb3J0IHsgZ2V0QWxsUHJvZHVjdHNGb3JMaXN0IGFzIGdldEFsbFByb2R1Y3RzU3VtbWFyeSB9O1xuZXhwb3J0IHsgZ2V0UHJvZHVjdFdpdGhNZWRpYUJ5SWQgYXMgZ2V0UHJvZHVjdEJ5SWRXaXRoTWVkaWEgfTtcblxuXG4iXSwibmFtZXMiOlsicGF0aCIsIm9wZW4iLCJzcWxpdGUzIiwiZGJQYXRoIiwiam9pbiIsInByb2Nlc3MiLCJjd2QiLCJvcGVuREIiLCJmaWxlbmFtZSIsImRyaXZlciIsIkRhdGFiYXNlIiwiZ2V0QWxsUHJvZHVjdHMiLCJkYiIsImFsbCIsImdldFByb2R1Y3RCeUlkIiwiaWQiLCJnZXQiLCJnZXRQcm9kdWN0V2l0aE1lZGlhQnlJZCIsInByb2R1Y3QiLCJtZWRpYVJvd3MiLCJwcmljZSIsIk51bWJlciIsInN0b2NrIiwiaXNGaW5pdGUiLCJpc19hY3RpdmUiLCJpc19mYXZvcml0ZSIsIm1lZGlhIiwibWFwIiwibSIsImtpbmQiLCJzZWN1cmVfdXJsIiwicHVibGljX2lkIiwiZm9ybWF0Iiwid2lkdGgiLCJoZWlnaHQiLCJkdXJhdGlvbiIsInNvcnRfb3JkZXIiLCJpc19wcmltYXJ5IiwiY3JlYXRlZF9hdCIsImdldEFsbFByb2R1Y3RzRm9yTGlzdCIsInJvd3MiLCJyIiwibmFtZSIsImRlc2NyaXB0aW9uIiwiY2F0ZWdvcnkiLCJpbWFnZV91cmwiLCJwcmltYXJ5X21lZGlhX3VybCIsInByaW1hcnlNZWRpYSIsInVybCIsInByaW1hcnlfbWVkaWFfa2luZCIsInByaW1hcnlfbWVkaWFfcHVibGljX2lkIiwiZ2V0QWxsUHJvZHVjdElkcyIsImdldEFsbFByb2R1Y3RzU3VtbWFyeSIsImdldFByb2R1Y3RCeUlkV2l0aE1lZGlhIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api-node)/./lib/db.js\n");

/***/ }),

/***/ "(api-node)/./lib/middleware/createAdminHandler.js":
/*!**********************************************!*\
  !*** ./lib/middleware/createAdminHandler.js ***!
  \**********************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createAdminHandler: () => (/* binding */ createAdminHandler)\n/* harmony export */ });\n/* harmony import */ var next_connect__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next-connect */ \"next-connect\");\n/* harmony import */ var _lib_auth_authorizeAdmin__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/auth/authorizeAdmin */ \"(api-node)/./lib/auth/authorizeAdmin.js\");\n/* harmony import */ var _lib_middleware_rateLimiter__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/middleware/rateLimiter */ \"(api-node)/./lib/middleware/rateLimiter.js\");\n/* harmony import */ var _requestId__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./requestId */ \"(api-node)/./lib/middleware/requestId.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([next_connect__WEBPACK_IMPORTED_MODULE_0__]);\nnext_connect__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n// lib/middleware/createAdminHandler.js\n\n\n\n\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n// Helper utilities\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nconst isObj = (v)=>v && typeof v === 'object';\nconst toInt = (v, d)=>{\n    const n = Number(v);\n    return Number.isFinite(n) && n >= 0 ? Math.trunc(n) : d;\n};\n// Wrap rate limiter into safe Express middleware form\nfunction wrapRateLimiter(rateLimiterFn, rateLimitOpts) {\n    return async (req, res, next)=>{\n        const rid = req.rid || '-';\n        const t0 = Date.now();\n        console.log('[admin]', rid, 'mw:rateLimiter ENTER', {\n            limit: rateLimitOpts?.limit,\n            window: rateLimitOpts?.window\n        });\n        try {\n            let passed = false;\n            await new Promise((resolve)=>{\n                // signature: (req, res, next, options)\n                rateLimiterFn(req, res, ()=>{\n                    passed = true;\n                    resolve(true);\n                }, rateLimitOpts);\n            });\n            if (res.headersSent) {\n                console.log('[admin]', rid, 'mw:rateLimiter RESPONDED (e.g., 429) in', Date.now() - t0, 'ms');\n                return; // short-circuited by limiter\n            }\n            if (passed) {\n                console.log('[admin]', rid, 'mw:rateLimiter PASS in', Date.now() - t0, 'ms');\n                return next();\n            }\n            // Defensive: continue even if no signal\n            console.warn('[admin]', rid, 'mw:rateLimiter NO-SIGNAL â†’ allowing through in', Date.now() - t0, 'ms');\n            return next();\n        } catch (e) {\n            console.error('[admin]', rid, 'mw:rateLimiter ERROR', e?.message || e);\n            if (!res.headersSent) res.status(429).json({\n                error: 'Rate limit error'\n            });\n        }\n    };\n}\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n// Main factory function\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nfunction createAdminHandler(options = {}) {\n    // Normalize options\n    const rawRL = isObj(options.rateLimit) ? options.rateLimit : {};\n    const rateLimit = {\n        limit: toInt(rawRL.limit, 60),\n        window: toInt(rawRL.window, 60)\n    };\n    // Global error handler\n    const onError = options.onError || ((err, req, res)=>{\n        const rid = req?.rid || '-';\n        const status = Number(err?.statusCode ?? err?.status ?? 500) || 500;\n        const message = typeof err?.message === 'string' && err.message || 'Internal Server Error';\n        if (!res.headersSent) {\n            res.setHeader('Content-Type', 'application/json; charset=utf-8');\n            res.setHeader('Cache-Control', 'no-store');\n        }\n        console.error('âŒ Admin API Error [rid=' + rid + ']:', message, '| detail:', err);\n        res.status(status).json({\n            error: message\n        });\n    });\n    // â€œNo matchâ€ handler\n    const onNoMatch = options.onNoMatch || ((req, res)=>{\n        const rid = req?.rid || '-';\n        console.warn('[admin]', rid, 'onNoMatch', req.method, req.url);\n        res.status(405).json({\n            error: `Method ${req.method} not allowed`\n        });\n    });\n    // Create next-connect handler\n    const handler = (0,next_connect__WEBPACK_IMPORTED_MODULE_0__[\"default\"])({\n        onError,\n        onNoMatch\n    });\n    // Add unique Request ID (FIRST)\n    handler.use({\n        \"createAdminHandler.use\": (req, res, next)=>{\n            const t0 = Date.now();\n            (0,_requestId__WEBPACK_IMPORTED_MODULE_3__.withRequestId)(req, res, {\n                \"createAdminHandler.use\": ()=>{\n                    req._adminStart = t0;\n                    console.log('[admin]', req.rid, 'mw:requestId SET');\n                    next();\n                }\n            }[\"createAdminHandler.use\"]);\n        }\n    }[\"createAdminHandler.use\"]);\n    // Dev logger\n    if (true) {\n        handler.use({\n            \"createAdminHandler.use\": (req, _res, next)=>{\n                const method = String(req.method || '').toUpperCase();\n                if (!req.url?.startsWith('/_next')) {\n                    console.log(`[admin] ${method} ${req.url} [rid=${req.rid}] ENTER`);\n                }\n                next();\n            }\n        }[\"createAdminHandler.use\"]);\n    }\n    // Preflight (OPTIONS)\n    handler.use({\n        \"createAdminHandler.use\": (req, res, next)=>{\n            const rid = req.rid || '-';\n            if (req.method === 'OPTIONS') {\n                res.setHeader('Allow', 'GET,POST,PUT,PATCH,DELETE,OPTIONS');\n                console.log('[admin]', rid, 'mw:preflight 204');\n                return res.status(204).end();\n            }\n            console.log('[admin]', rid, 'mw:preflight SKIP');\n            next();\n        }\n    }[\"createAdminHandler.use\"]);\n    // Default JSON headers\n    handler.use({\n        \"createAdminHandler.use\": (req, res, next)=>{\n            const rid = req.rid || '-';\n            if (!res.getHeader('Content-Type')) {\n                res.setHeader('Content-Type', 'application/json; charset=utf-8');\n            }\n            res.setHeader('Cache-Control', 'no-store');\n            res.setHeader('Vary', 'X-Requested-With');\n            console.log('[admin]', rid, 'mw:headers SET');\n            next();\n        }\n    }[\"createAdminHandler.use\"]);\n    // Rate limiting (skip safe methods; normalize method casing defensively)\n    handler.use({\n        \"createAdminHandler.use\": (req, res, next)=>{\n            const rid = req.rid || '-';\n            const method = String(req.method || '').toUpperCase();\n            if (method === 'GET' || method === 'HEAD' || method === 'OPTIONS') {\n                console.log('[admin]', rid, 'mw:rateLimiter SKIP for', method);\n                return next();\n            }\n            console.log('[admin]', rid, 'mw:rateLimiter APPLY for', method);\n            return wrapRateLimiter(_lib_middleware_rateLimiter__WEBPACK_IMPORTED_MODULE_2__.rateLimiter, rateLimit)(req, res, next);\n        }\n    }[\"createAdminHandler.use\"]);\n    // Authorization guard\n    handler.use({\n        \"createAdminHandler.use\": async (req, res, next)=>{\n            const rid = req.rid || '-';\n            const t0 = Date.now();\n            console.log('[admin]', rid, 'mw:authorize START');\n            try {\n                await (0,_lib_auth_authorizeAdmin__WEBPACK_IMPORTED_MODULE_1__.authorizeAdmin)()(req, res, {\n                    \"createAdminHandler.use\": async ()=>{\n                        console.log('[admin]', rid, 'mw:authorize OK in', Date.now() - t0, 'ms');\n                        next();\n                    }\n                }[\"createAdminHandler.use\"]);\n            } catch (err) {\n                console.log('[admin]', rid, 'mw:authorize ERROR in', Date.now() - t0, 'ms', err?.message || err);\n                const status = Number(err?.status ?? 401) || 401;\n                if (!res.headersSent) {\n                    return res.status(status).json({\n                        error: err?.message || 'Unauthorized'\n                    });\n                }\n            }\n        }\n    }[\"createAdminHandler.use\"]);\n    // Final lifecycle footer (only runs if a route handler calls res.end/json)\n    handler.use({\n        \"createAdminHandler.use\": (req, _res, next)=>{\n            const rid = req.rid || '-';\n            const started = req._adminStart || Date.now();\n            console.log('[admin]', rid, 'mw:chain CONTINUE (route next) chainMs=', Date.now() - started);\n            next();\n        }\n    }[\"createAdminHandler.use\"]);\n    return handler;\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL2xpYi9taWRkbGV3YXJlL2NyZWF0ZUFkbWluSGFuZGxlci5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFBLHVDQUF1QztBQUNUO0FBQzZCO0FBQ0E7QUFDZjtBQUU1QyxnREFBZ0Q7QUFDaEQsbUJBQW1CO0FBQ25CLGdEQUFnRDtBQUNoRCxNQUFNSSxRQUFRLENBQUNDLElBQU1BLEtBQUssT0FBT0EsTUFBTTtBQUN2QyxNQUFNQyxRQUFRLENBQUNELEdBQUdFO0lBQ2hCLE1BQU1DLElBQUlDLE9BQU9KO0lBQ2pCLE9BQU9JLE9BQU9DLFFBQVEsQ0FBQ0YsTUFBTUEsS0FBSyxJQUFJRyxLQUFLQyxLQUFLLENBQUNKLEtBQUtEO0FBQ3hEO0FBRUEsc0RBQXNEO0FBQ3RELFNBQVNNLGdCQUFnQkMsYUFBYSxFQUFFQyxhQUFhO0lBQ25ELE9BQU8sT0FBT0MsS0FBS0MsS0FBS0M7UUFDdEIsTUFBTUMsTUFBTUgsSUFBSUcsR0FBRyxJQUFJO1FBQ3ZCLE1BQU1DLEtBQUtDLEtBQUtDLEdBQUc7UUFDbkJDLFFBQVFDLEdBQUcsQ0FBQyxXQUFXTCxLQUFLLHdCQUF3QjtZQUFFTSxPQUFPVixlQUFlVTtZQUFPQyxRQUFRWCxlQUFlVztRQUFPO1FBRWpILElBQUk7WUFDRixJQUFJQyxTQUFTO1lBQ2IsTUFBTSxJQUFJQyxRQUFRLENBQUNDO2dCQUNqQix1Q0FBdUM7Z0JBQ3ZDZixjQUFjRSxLQUFLQyxLQUFLO29CQUN0QlUsU0FBUztvQkFDVEUsUUFBUTtnQkFDVixHQUFHZDtZQUNMO1lBRUEsSUFBSUUsSUFBSWEsV0FBVyxFQUFFO2dCQUNuQlAsUUFBUUMsR0FBRyxDQUFDLFdBQVdMLEtBQUssMkNBQTJDRSxLQUFLQyxHQUFHLEtBQUtGLElBQUk7Z0JBQ3hGLFFBQVEsNkJBQTZCO1lBQ3ZDO1lBRUEsSUFBSU8sUUFBUTtnQkFDVkosUUFBUUMsR0FBRyxDQUFDLFdBQVdMLEtBQUssMEJBQTBCRSxLQUFLQyxHQUFHLEtBQUtGLElBQUk7Z0JBQ3ZF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QUFXeEIsS0FBS0MsS0FBS0M7UUFDM0Q7O0lBRUEsc0JBQXNCO0lBQ3RCOEIsUUFBUUMsR0FBRztrQ0FBQyxPQUFPakMsS0FBS0MsS0FBS0M7WUFDM0IsTUFBTUMsTUFBTUgsSUFBSUcsR0FBRyxJQUFJO1lBQ3ZCLE1BQU1DLEtBQUtDLEtBQUtDLEdBQUc7WUFDbkJDLFFBQVFDLEdBQUcsQ0FBQyxXQUFXTCxLQUFLO1lBRTVCLElBQUk7Z0JBQ0YsTUFBTWxCLHdFQUFjQSxHQUFHZSxLQUFLQzs4Q0FBSzt3QkFDL0JNLFFBQVFDLEdBQUcsQ0FBQyxXQUFXTCxLQUFLLHNCQUFzQkUsS0FBS0MsR0FBRyxLQUFLRixJQUFJO3dCQUNuRUY7b0JBQ0Y7O1lBQ0YsRUFBRSxPQUFPd0IsS0FBSztnQkFDWm5CLFFBQVFDLEdBQUcsQ0FBQyxXQUFXTCxLQUFLLHlCQUF5QkUsS0FBS0MsR0FBRyxLQUFLRixJQUFJLE1BQU1zQixLQUFLUixXQUFXUTtnQkFDNUYsTUFBTVAsU0FBUzFCLE9BQU9pQyxLQUFLUCxVQUFVLFFBQVE7Z0JBQzdDLElBQUksQ0FBQ2xCLElBQUlhLFdBQVcsRUFBRTtvQkFDcEIsT0FBT2IsSUFBSWtCLE1BQU0sQ0FBQ0EsUUFBUUMsSUFBSSxDQUFDO3dCQUFFSCxPQUFPUyxLQUFLUixXQUFXO29CQUFlO2dCQUN6RTtZQUNGO1FBQ0Y7O0lBRUEsMkVBQTJFO0lBQzNFYyxRQUFRQyxHQUFHO2tDQUFDLENBQUNqQyxLQUFLb0MsTUFBTWxDO1lBQ3RCLE1BQU1DLE1BQU1ILElBQUlHLEdBQUcsSUFBSTtZQUN2QixNQUFNdUMsVUFBVTFDLElBQUlrQyxXQUFXLElBQUk3QixLQUFLQyxHQUFHO1lBQzNDQyxRQUFRQyxHQUFHLENBQUMsV0FBV0wsS0FBSywyQ0FBMkNFLEtBQUtDLEdBQUcsS0FBS29DO1lBQ3BGeEM7UUFDRjs7SUFFQSxPQUFPOEI7QUFDVCIsInNvdXJjZXMiOlsiL1VzZXJzL2Vtb250YXplcmkvRG9jdW1lbnRzL3Byb2plY3RzL3NoZWxsLXN0b3JpZXMtc3R1ZGlvL2xpYi9taWRkbGV3YXJlL2NyZWF0ZUFkbWluSGFuZGxlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBsaWIvbWlkZGxld2FyZS9jcmVhdGVBZG1pbkhhbmRsZXIuanNcbmltcG9ydCBuYyBmcm9tICduZXh0LWNvbm5lY3QnO1xuaW1wb3J0IHsgYXV0aG9yaXplQWRtaW4gfSBmcm9tICdAL2xpYi9hdXRoL2F1dGhvcml6ZUFkbWluJztcbmltcG9ydCB7IHJhdGVMaW1pdGVyIH0gZnJvbSAnQC9saWIvbWlkZGxld2FyZS9yYXRlTGltaXRlcic7XG5pbXBvcnQgeyB3aXRoUmVxdWVzdElkIH0gZnJvbSAnLi9yZXF1ZXN0SWQnO1xuXG4vLyDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcbi8vIEhlbHBlciB1dGlsaXRpZXNcbi8vIOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFxuY29uc3QgaXNPYmogPSAodikgPT4gdiAmJiB0eXBlb2YgdiA9PT0gJ29iamVjdCc7XG5jb25zdCB0b0ludCA9ICh2LCBkKSA9PiB7XG4gIGNvbnN0IG4gPSBOdW1iZXIodik7XG4gIHJldHVybiBOdW1iZXIuaXNGaW5pdGUobikgJiYgbiA+PSAwID8gTWF0aC50cnVuYyhuKSA6IGQ7XG59O1xuXG4vLyBXcmFwIHJhdGUgbGltaXRlciBpbnRvIHNhZmUgRXhwcmVzcyBtaWRkbGV3YXJlIGZvcm1cbmZ1bmN0aW9uIHdyYXBSYXRlTGltaXRlcihyYXRlTGltaXRlckZuLCByYXRlTGltaXRPcHRzKSB7XG4gIHJldHVybiBhc3luYyAocmVxLCByZXMsIG5leHQpID0+IHtcbiAgICBjb25zdCByaWQgPSByZXEucmlkIHx8ICctJztcbiAgICBjb25zdCB0MCA9IERhdGUubm93KCk7XG4gICAgY29uc29sZS5sb2coJ1thZG1pbl0nLCByaWQsICdtdzpyYXRlTGltaXRlciBFTlRFUicsIHsgbGltaXQ6IHJhdGVMaW1pdE9wdHM/LmxpbWl0LCB3aW5kb3c6IHJhdGVMaW1pdE9wdHM/LndpbmRvdyB9KTtcblxuICAgIHRyeSB7XG4gICAgICBsZXQgcGFzc2VkID0gZmFsc2U7XG4gICAgICBhd2FpdCBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAgICAgICAvLyBzaWduYXR1cmU6IChyZXEsIHJlcywgbmV4dCwgb3B0aW9ucylcbiAgICAgICAgcmF0ZUxpbWl0ZXJGbihyZXEsIHJlcywgKCkgPT4ge1xuICAgICAgICAgIHBhc3NlZCA9IHRydWU7XG4gICAgICAgICAgcmVzb2x2ZSh0cnVlKTtcbiAgICAgICAgfSwgcmF0ZUxpbWl0T3B0cyk7XG4gICAgICB9KTtcblxuICAgICAgaWYgKHJlcy5oZWFkZXJzU2VudCkge1xuICAgICAgICBjb25zb2xlLmxvZygnW2FkbWluXScsIHJpZCwgJ213OnJhdGVMaW1pdGVyIFJFU1BPTkRFRCAoZS5nLiwgNDI5KSBpbicsIERhdGUubm93KCkgLSB0MCwgJ21zJyk7XG4gICAgICAgIHJldHVybjsgLy8gc2hvcnQtY2lyY3VpdGVkIGJ5IGxpbWl0ZXJcbiAgICAgIH1cblxuICAgICAgaWYgKHBhc3NlZCkge1xuICAgICAgICBjb25zb2xlLmxvZygnW2FkbWluXScsIHJpZCwgJ213OnJhdGVMaW1pdGVyIFBBU1MgaW4nLCBEYXRlLm5vdygpIC0gdDAsICdtcycpO1xuICAgICAgICByZXR1cm4gbmV4dCgpO1xuICAgICAgfVxuXG4gICAgICAvLyBEZWZlbnNpdmU6IGNvbnRpbnVlIGV2ZW4gaWYgbm8gc2lnbmFsXG4gICAgICBjb25zb2xlLndhcm4oJ1thZG1pbl0nLCByaWQsICdtdzpyYXRlTGltaXRlciBOTy1TSUdOQUwg4oaSIGFsbG93aW5nIHRocm91Z2ggaW4nLCBEYXRlLm5vdygpIC0gdDAsICdtcycpO1xuICAgICAgcmV0dXJuIG5leHQoKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdbYWRtaW5dJywgcmlkLCAnbXc6cmF0ZUxpbWl0ZXIgRVJST1InLCBlPy5tZXNzYWdlIHx8IGUpO1xuICAgICAgaWYgKCFyZXMuaGVhZGVyc1NlbnQpIHJlcy5zdGF0dXMoNDI5KS5qc29uKHsgZXJyb3I6ICdSYXRlIGxpbWl0IGVycm9yJyB9KTtcbiAgICB9XG4gIH07XG59XG5cbi8vIOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFxuLy8gTWFpbiBmYWN0b3J5IGZ1bmN0aW9uXG4vLyDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVBZG1pbkhhbmRsZXIob3B0aW9ucyA9IHt9KSB7XG4gIC8vIE5vcm1hbGl6ZSBvcHRpb25zXG4gIGNvbnN0IHJhd1JMID0gaXNPYmoob3B0aW9ucy5yYXRlTGltaXQpID8gb3B0aW9ucy5yYXRlTGltaXQgOiB7fTtcbiAgY29uc3QgcmF0ZUxpbWl0ID0ge1xuICAgIGxpbWl0OiB0b0ludChyYXdSTC5saW1pdCwgNjApLFxuICAgIHdpbmRvdzogdG9JbnQocmF3Ukwud2luZG93LCA2MCksXG4gIH07XG5cbiAgLy8gR2xvYmFsIGVycm9yIGhhbmRsZXJcbiAgY29uc3Qgb25FcnJvciA9XG4gICAgb3B0aW9ucy5vbkVycm9yIHx8XG4gICAgKChlcnIsIHJlcSwgcmVzKSA9PiB7XG4gICAgICBjb25zdCByaWQgPSByZXE/LnJpZCB8fCAnLSc7XG4gICAgICBjb25zdCBzdGF0dXMgPSBOdW1iZXIoZXJyPy5zdGF0dXNDb2RlID8/IGVycj8uc3RhdHVzID8/IDUwMCkgfHwgNTAwO1xuICAgICAgY29uc3QgbWVzc2FnZSA9XG4gICAgICAgICh0eXBlb2YgZXJyPy5tZXNzYWdlID09PSAnc3RyaW5nJyAmJiBlcnIubWVzc2FnZSkgfHxcbiAgICAgICAgJ0ludGVybmFsIFNlcnZlciBFcnJvcic7XG5cbiAgICAgIGlmICghcmVzLmhlYWRlcnNTZW50KSB7XG4gICAgICAgIHJlcy5zZXRIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uOyBjaGFyc2V0PXV0Zi04Jyk7XG4gICAgICAgIHJlcy5zZXRIZWFkZXIoJ0NhY2hlLUNvbnRyb2wnLCAnbm8tc3RvcmUnKTtcbiAgICAgIH1cblxuICAgICAgY29uc29sZS5lcnJvcign4p2MIEFkbWluIEFQSSBFcnJvciBbcmlkPScgKyByaWQgKyAnXTonLCBtZXNzYWdlLCAnfCBkZXRhaWw6JywgZXJyKTtcbiAgICAgIHJlcy5zdGF0dXMoc3RhdHVzKS5qc29uKHsgZXJyb3I6IG1lc3NhZ2UgfSk7XG4gICAgfSk7XG5cbiAgLy8g4oCcTm8gbWF0Y2jigJ0gaGFuZGxlclxuICBjb25zdCBvbk5vTWF0Y2ggPVxuICAgIG9wdGlvbnMub25Ob01hdGNoIHx8XG4gICAgKChyZXEsIHJlcykgPT4ge1xuICAgICAgY29uc3QgcmlkID0gcmVxPy5yaWQgfHwgJy0nO1xuICAgICAgY29uc29sZS53YXJuKCdbYWRtaW5dJywgcmlkLCAnb25Ob01hdGNoJywgcmVxLm1ldGhvZCwgcmVxLnVybCk7XG4gICAgICByZXMuc3RhdHVzKDQwNSkuanNvbih7IGVycm9yOiBgTWV0aG9kICR7cmVxLm1ldGhvZH0gbm90IGFsbG93ZWRgIH0pO1xuICAgIH0pO1xuXG4gIC8vIENyZWF0ZSBuZXh0LWNvbm5lY3QgaGFuZGxlclxuICBjb25zdCBoYW5kbGVyID0gbmMoeyBvbkVycm9yLCBvbk5vTWF0Y2ggfSk7XG5cbiAgLy8gQWRkIHVuaXF1ZSBSZXF1ZXN0IElEIChGSVJTVClcbiAgaGFuZGxlci51c2UoKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gICAgY29uc3QgdDAgPSBEYXRlLm5vdygpO1xuICAgIHdpdGhSZXF1ZXN0SWQocmVxLCByZXMsICgpID0+IHtcbiAgICAgIHJlcS5fYWRtaW5TdGFydCA9IHQwO1xuICAgICAgY29uc29sZS5sb2coJ1thZG1pbl0nLCByZXEucmlkLCAnbXc6cmVxdWVzdElkIFNFVCcpO1xuICAgICAgbmV4dCgpO1xuICAgIH0pO1xuICB9KTtcblxuICAvLyBEZXYgbG9nZ2VyXG4gIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7XG4gICAgaGFuZGxlci51c2UoKHJlcSwgX3JlcywgbmV4dCkgPT4ge1xuICAgICAgY29uc3QgbWV0aG9kID0gU3RyaW5nKHJlcS5tZXRob2QgfHwgJycpLnRvVXBwZXJDYXNlKCk7XG4gICAgICBpZiAoIXJlcS51cmw/LnN0YXJ0c1dpdGgoJy9fbmV4dCcpKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGBbYWRtaW5dICR7bWV0aG9kfSAke3JlcS51cmx9IFtyaWQ9JHtyZXEucmlkfV0gRU5URVJgKTtcbiAgICAgIH1cbiAgICAgIG5leHQoKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8vIFByZWZsaWdodCAoT1BUSU9OUylcbiAgaGFuZGxlci51c2UoKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gICAgY29uc3QgcmlkID0gcmVxLnJpZCB8fCAnLSc7XG4gICAgaWYgKHJlcS5tZXRob2QgPT09ICdPUFRJT05TJykge1xuICAgICAgcmVzLnNldEhlYWRlcignQWxsb3cnLCAnR0VULFBPU1QsUFVULFBBVENILERFTEVURSxPUFRJT05TJyk7XG4gICAgICBjb25zb2xlLmxvZygnW2FkbWluXScsIHJpZCwgJ213OnByZWZsaWdodCAyMDQnKTtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwNCkuZW5kKCk7XG4gICAgfVxuICAgIGNvbnNvbGUubG9nKCdbYWRtaW5dJywgcmlkLCAnbXc6cHJlZmxpZ2h0IFNLSVAnKTtcbiAgICBuZXh0KCk7XG4gIH0pO1xuXG4gIC8vIERlZmF1bHQgSlNPTiBoZWFkZXJzXG4gIGhhbmRsZXIudXNlKChyZXEsIHJlcywgbmV4dCkgPT4ge1xuICAgIGNvbnN0IHJpZCA9IHJlcS5yaWQgfHwgJy0nO1xuICAgIGlmICghcmVzLmdldEhlYWRlcignQ29udGVudC1UeXBlJykpIHtcbiAgICAgIHJlcy5zZXRIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uOyBjaGFyc2V0PXV0Zi04Jyk7XG4gICAgfVxuICAgIHJlcy5zZXRIZWFkZXIoJ0NhY2hlLUNvbnRyb2wnLCAnbm8tc3RvcmUnKTtcbiAgICByZXMuc2V0SGVhZGVyKCdWYXJ5JywgJ1gtUmVxdWVzdGVkLVdpdGgnKTtcbiAgICBjb25zb2xlLmxvZygnW2FkbWluXScsIHJpZCwgJ213OmhlYWRlcnMgU0VUJyk7XG4gICAgbmV4dCgpO1xuICB9KTtcblxuICAvLyBSYXRlIGxpbWl0aW5nIChza2lwIHNhZmUgbWV0aG9kczsgbm9ybWFsaXplIG1ldGhvZCBjYXNpbmcgZGVmZW5zaXZlbHkpXG4gIGhhbmRsZXIudXNlKChyZXEsIHJlcywgbmV4dCkgPT4ge1xuICAgIGNvbnN0IHJpZCA9IHJlcS5yaWQgfHwgJy0nO1xuICAgIGNvbnN0IG1ldGhvZCA9IFN0cmluZyhyZXEubWV0aG9kIHx8ICcnKS50b1VwcGVyQ2FzZSgpO1xuXG4gICAgaWYgKG1ldGhvZCA9PT0gJ0dFVCcgfHwgbWV0aG9kID09PSAnSEVBRCcgfHwgbWV0aG9kID09PSAnT1BUSU9OUycpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdbYWRtaW5dJywgcmlkLCAnbXc6cmF0ZUxpbWl0ZXIgU0tJUCBmb3InLCBtZXRob2QpO1xuICAgICAgcmV0dXJuIG5leHQoKTtcbiAgICB9XG5cbiAgICBjb25zb2xlLmxvZygnW2FkbWluXScsIHJpZCwgJ213OnJhdGVMaW1pdGVyIEFQUExZIGZvcicsIG1ldGhvZCk7XG4gICAgcmV0dXJuIHdyYXBSYXRlTGltaXRlcihyYXRlTGltaXRlciwgcmF0ZUxpbWl0KShyZXEsIHJlcywgbmV4dCk7XG4gIH0pO1xuXG4gIC8vIEF1dGhvcml6YXRpb24gZ3VhcmRcbiAgaGFuZGxlci51c2UoYXN5bmMgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gICAgY29uc3QgcmlkID0gcmVxLnJpZCB8fCAnLSc7XG4gICAgY29uc3QgdDAgPSBEYXRlLm5vdygpO1xuICAgIGNvbnNvbGUubG9nKCdbYWRtaW5dJywgcmlkLCAnbXc6YXV0aG9yaXplIFNUQVJUJyk7XG5cbiAgICB0cnkge1xuICAgICAgYXdhaXQgYXV0aG9yaXplQWRtaW4oKShyZXEsIHJlcywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZygnW2FkbWluXScsIHJpZCwgJ213OmF1dGhvcml6ZSBPSyBpbicsIERhdGUubm93KCkgLSB0MCwgJ21zJyk7XG4gICAgICAgIG5leHQoKTtcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgY29uc29sZS5sb2coJ1thZG1pbl0nLCByaWQsICdtdzphdXRob3JpemUgRVJST1IgaW4nLCBEYXRlLm5vdygpIC0gdDAsICdtcycsIGVycj8ubWVzc2FnZSB8fCBlcnIpO1xuICAgICAgY29uc3Qgc3RhdHVzID0gTnVtYmVyKGVycj8uc3RhdHVzID8/IDQwMSkgfHwgNDAxO1xuICAgICAgaWYgKCFyZXMuaGVhZGVyc1NlbnQpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoc3RhdHVzKS5qc29uKHsgZXJyb3I6IGVycj8ubWVzc2FnZSB8fCAnVW5hdXRob3JpemVkJyB9KTtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuXG4gIC8vIEZpbmFsIGxpZmVjeWNsZSBmb290ZXIgKG9ubHkgcnVucyBpZiBhIHJvdXRlIGhhbmRsZXIgY2FsbHMgcmVzLmVuZC9qc29uKVxuICBoYW5kbGVyLnVzZSgocmVxLCBfcmVzLCBuZXh0KSA9PiB7XG4gICAgY29uc3QgcmlkID0gcmVxLnJpZCB8fCAnLSc7XG4gICAgY29uc3Qgc3RhcnRlZCA9IHJlcS5fYWRtaW5TdGFydCB8fCBEYXRlLm5vdygpO1xuICAgIGNvbnNvbGUubG9nKCdbYWRtaW5dJywgcmlkLCAnbXc6Y2hhaW4gQ09OVElOVUUgKHJvdXRlIG5leHQpIGNoYWluTXM9JywgRGF0ZS5ub3coKSAtIHN0YXJ0ZWQpO1xuICAgIG5leHQoKTtcbiAgfSk7XG5cbiAgcmV0dXJuIGhhbmRsZXI7XG59XG5cblxuXG4iXSwibmFtZXMiOlsibmMiLCJhdXRob3JpemVBZG1pbiIsInJhdGVMaW1pdGVyIiwid2l0aFJlcXVlc3RJZCIsImlzT2JqIiwidiIsInRvSW50IiwiZCIsIm4iLCJOdW1iZXIiLCJpc0Zpbml0ZSIsIk1hdGgiLCJ0cnVuYyIsIndyYXBSYXRlTGltaXRlciIsInJhdGVMaW1pdGVyRm4iLCJyYXRlTGltaXRPcHRzIiwicmVxIiwicmVzIiwibmV4dCIsInJpZCIsInQwIiwiRGF0ZSIsIm5vdyIsImNvbnNvbGUiLCJsb2ciLCJsaW1pdCIsIndpbmRvdyIsInBhc3NlZCIsIlByb21pc2UiLCJyZXNvbHZlIiwiaGVhZGVyc1NlbnQiLCJ3YXJuIiwiZSIsImVycm9yIiwibWVzc2FnZSIsInN0YXR1cyIsImpzb24iLCJjcmVhdGVBZG1pbkhhbmRsZXIiLCJvcHRpb25zIiwicmF3UkwiLCJyYXRlTGltaXQiLCJvbkVycm9yIiwiZXJyIiwic3RhdHVzQ29kZSIsInNldEhlYWRlciIsIm9uTm9NYXRjaCIsIm1ldGhvZCIsInVybCIsImhhbmRsZXIiLCJ1c2UiLCJfYWRtaW5TdGFydCIsInByb2Nlc3MiLCJfcmVzIiwiU3RyaW5nIiwidG9VcHBlckNhc2UiLCJzdGFydHNXaXRoIiwiZW5kIiwiZ2V0SGVhZGVyIiwic3RhcnRlZCJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api-node)/./lib/middleware/createAdminHandler.js\n");

/***/ }),

/***/ "(api-node)/./lib/middleware/rateLimiter.js":
/*!***************************************!*\
  !*** ./lib/middleware/rateLimiter.js ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   rateLimiter: () => (/* binding */ rateLimiter)\n/* harmony export */ });\n/* harmony import */ var _lib_redis__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/redis */ \"(api-node)/./lib/redis.js\");\n// lib/middleware/rateLimiter.js\n\nasync function rateLimiter(req, res, next, options = {}) {\n    try {\n        const redis = await (0,_lib_redis__WEBPACK_IMPORTED_MODULE_0__.getRedisClient)();\n        const ip = req.headers['x-forwarded-for'] || req.socket.remoteAddress || 'unknown';\n        const key = `rate-limit:${ip}`;\n        const limit = options.limit || 60;\n        const windowSeconds = options.window || 60;\n        const count = await redis.incr(key);\n        if (count === 1) await redis.expire(key, windowSeconds);\n        if (count > limit) {\n            return res.status(429).json({\n                error: 'Too many requests. Please try again later.'\n            });\n        }\n        res.setHeader('X-RateLimit-Limit', limit);\n        res.setHeader('X-RateLimit-Remaining', Math.max(0, limit - count));\n        res.setHeader('X-RateLimit-Reset', windowSeconds);\n        return next();\n    } catch (err) {\n        console.error('âš ï¸ Rate limiter failed, allowing request to proceed:', err);\n        return next(); // âœ… Allow request even if Redis fails\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL2xpYi9taWRkbGV3YXJlL3JhdGVMaW1pdGVyLmpzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsZ0NBQWdDO0FBRWE7QUFFdEMsZUFBZUMsWUFBWUMsR0FBRyxFQUFFQyxHQUFHLEVBQUVDLElBQUksRUFBRUMsVUFBVSxDQUFDLENBQUM7SUFDMUQsSUFBSTtRQUNGLE1BQU1DLFFBQVEsTUFBTU4sMERBQWNBO1FBRWxDLE1BQU1PLEtBQUtMLElBQUlNLE9BQU8sQ0FBQyxrQkFBa0IsSUFBSU4sSUFBSU8sTUFBTSxDQUFDQyxhQUFhLElBQUk7UUFDekUsTUFBTUMsTUFBTSxDQUFDLFdBQVcsRUFBRUosSUFBSTtRQUU5QixNQUFNSyxRQUFRUCxRQUFRTyxLQUFLLElBQUk7UUFDL0IsTUFBTUMsZ0JBQWdCUixRQUFRUyxNQUFNLElBQUk7UUFFeEMsTUFBTUMsUUFBUSxNQUFNVCxNQUFNVSxJQUFJLENBQUNMO1FBRS9CLElBQUlJLFVBQVUsR0FBRyxNQUFNVCxNQUFNVyxNQUFNLENBQUNOLEtBQUtFO1FBQ3pDLElBQUlFLFFBQVFILE9BQU87WUFDakIsT0FBT1QsSUFBSWUsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztnQkFBRUMsT0FBTztZQUE2QztRQUNwRjtRQUVBakIsSUFBSWtCLFNBQVMsQ0FBQyxxQkFBcUJUO1FBQ25DVCxJQUFJa0IsU0FBUyxDQUFDLHlCQUF5QkMsS0FBS0MsR0FBRyxDQUFDLEdBQUdYLFFBQVFHO1FBQzNEWixJQUFJa0IsU0FBUyxDQUFDLHFCQUFxQlI7UUFFbkMsT0FBT1Q7SUFDVCxFQUFFLE9BQU9vQixLQUFLO1FBQ1pDLFFBQVFMLEtBQUssQ0FBQyx3REFBd0RJO1FBQ3RFLE9BQU9wQixRQUFRLHNDQUFzQztJQUN2RDtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvZW1vbnRhemVyaS9Eb2N1bWVudHMvcHJvamVjdHMvc2hlbGwtc3Rvcmllcy1zdHVkaW8vbGliL21pZGRsZXdhcmUvcmF0ZUxpbWl0ZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gbGliL21pZGRsZXdhcmUvcmF0ZUxpbWl0ZXIuanNcblxuaW1wb3J0IHsgZ2V0UmVkaXNDbGllbnQgfSBmcm9tICdAL2xpYi9yZWRpcyc7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiByYXRlTGltaXRlcihyZXEsIHJlcywgbmV4dCwgb3B0aW9ucyA9IHt9KSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlZGlzID0gYXdhaXQgZ2V0UmVkaXNDbGllbnQoKTtcbiAgXG4gICAgICBjb25zdCBpcCA9IHJlcS5oZWFkZXJzWyd4LWZvcndhcmRlZC1mb3InXSB8fCByZXEuc29ja2V0LnJlbW90ZUFkZHJlc3MgfHwgJ3Vua25vd24nO1xuICAgICAgY29uc3Qga2V5ID0gYHJhdGUtbGltaXQ6JHtpcH1gO1xuICAgICAgXG4gICAgICBjb25zdCBsaW1pdCA9IG9wdGlvbnMubGltaXQgfHwgNjA7XG4gICAgICBjb25zdCB3aW5kb3dTZWNvbmRzID0gb3B0aW9ucy53aW5kb3cgfHwgNjA7XG4gIFxuICAgICAgY29uc3QgY291bnQgPSBhd2FpdCByZWRpcy5pbmNyKGtleSk7XG4gIFxuICAgICAgaWYgKGNvdW50ID09PSAxKSBhd2FpdCByZWRpcy5leHBpcmUoa2V5LCB3aW5kb3dTZWNvbmRzKTtcbiAgICAgIGlmIChjb3VudCA+IGxpbWl0KSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQyOSkuanNvbih7IGVycm9yOiAnVG9vIG1hbnkgcmVxdWVzdHMuIFBsZWFzZSB0cnkgYWdhaW4gbGF0ZXIuJyB9KTtcbiAgICAgIH1cbiAgXG4gICAgICByZXMuc2V0SGVhZGVyKCdYLVJhdGVMaW1pdC1MaW1pdCcsIGxpbWl0KTtcbiAgICAgIHJlcy5zZXRIZWFkZXIoJ1gtUmF0ZUxpbWl0LVJlbWFpbmluZycsIE1hdGgubWF4KDAsIGxpbWl0IC0gY291bnQpKTtcbiAgICAgIHJlcy5zZXRIZWFkZXIoJ1gtUmF0ZUxpbWl0LVJlc2V0Jywgd2luZG93U2Vjb25kcyk7XG4gIFxuICAgICAgcmV0dXJuIG5leHQoKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KaoO+4jyBSYXRlIGxpbWl0ZXIgZmFpbGVkLCBhbGxvd2luZyByZXF1ZXN0IHRvIHByb2NlZWQ6JywgZXJyKTtcbiAgICAgIHJldHVybiBuZXh0KCk7IC8vIOKchSBBbGxvdyByZXF1ZXN0IGV2ZW4gaWYgUmVkaXMgZmFpbHNcbiAgICB9XG4gIH1cbiAgIl0sIm5hbWVzIjpbImdldFJlZGlzQ2xpZW50IiwicmF0ZUxpbWl0ZXIiLCJyZXEiLCJyZXMiLCJuZXh0Iiwib3B0aW9ucyIsInJlZGlzIiwiaXAiLCJoZWFkZXJzIiwic29ja2V0IiwicmVtb3RlQWRkcmVzcyIsImtleSIsImxpbWl0Iiwid2luZG93U2Vjb25kcyIsIndpbmRvdyIsImNvdW50IiwiaW5jciIsImV4cGlyZSIsInN0YXR1cyIsImpzb24iLCJlcnJvciIsInNldEhlYWRlciIsIk1hdGgiLCJtYXgiLCJlcnIiLCJjb25zb2xlIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api-node)/./lib/middleware/rateLimiter.js\n");

/***/ }),

/***/ "(api-node)/./lib/middleware/requestId.js":
/*!*************************************!*\
  !*** ./lib/middleware/requestId.js ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   withRequestId: () => (/* binding */ withRequestId)\n/* harmony export */ });\n// lib/middleware/requestId.js\nfunction withRequestId(req, res, next) {\n    // Node 18+: crypto.randomUUID(); fallback if unavailable\n    const rid = typeof crypto?.randomUUID === 'function' ? crypto.randomUUID() : `${Date.now().toString(36)}-${Math.random().toString(16).slice(2, 10)}`;\n    req.rid = rid;\n    res.setHeader('X-Request-Id', rid);\n    next();\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL2xpYi9taWRkbGV3YXJlL3JlcXVlc3RJZC5qcyIsIm1hcHBpbmdzIjoiOzs7O0FBQUEsOEJBQThCO0FBQ3ZCLFNBQVNBLGNBQWNDLEdBQUcsRUFBRUMsR0FBRyxFQUFFQyxJQUFJO0lBQ3hDLHlEQUF5RDtJQUN6RCxNQUFNQyxNQUFNLE9BQVFDLFFBQVFDLGVBQWUsYUFDdkNELE9BQU9DLFVBQVUsS0FDakIsR0FBR0MsS0FBS0MsR0FBRyxHQUFHQyxRQUFRLENBQUMsSUFBSSxDQUFDLEVBQUVDLEtBQUtDLE1BQU0sR0FBR0YsUUFBUSxDQUFDLElBQUlHLEtBQUssQ0FBQyxHQUFHLEtBQUs7SUFFM0VYLElBQUlHLEdBQUcsR0FBR0E7SUFDVkYsSUFBSVcsU0FBUyxDQUFDLGdCQUFnQlQ7SUFDOUJEO0FBQ0YiLCJzb3VyY2VzIjpbIi9Vc2Vycy9lbW9udGF6ZXJpL0RvY3VtZW50cy9wcm9qZWN0cy9zaGVsbC1zdG9yaWVzLXN0dWRpby9saWIvbWlkZGxld2FyZS9yZXF1ZXN0SWQuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gbGliL21pZGRsZXdhcmUvcmVxdWVzdElkLmpzXG5leHBvcnQgZnVuY3Rpb24gd2l0aFJlcXVlc3RJZChyZXEsIHJlcywgbmV4dCkge1xuICAgIC8vIE5vZGUgMTgrOiBjcnlwdG8ucmFuZG9tVVVJRCgpOyBmYWxsYmFjayBpZiB1bmF2YWlsYWJsZVxuICAgIGNvbnN0IHJpZCA9ICh0eXBlb2YgY3J5cHRvPy5yYW5kb21VVUlEID09PSAnZnVuY3Rpb24nKVxuICAgICAgPyBjcnlwdG8ucmFuZG9tVVVJRCgpXG4gICAgICA6IGAke0RhdGUubm93KCkudG9TdHJpbmcoMzYpfS0ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMTYpLnNsaWNlKDIsIDEwKX1gO1xuICBcbiAgICByZXEucmlkID0gcmlkO1xuICAgIHJlcy5zZXRIZWFkZXIoJ1gtUmVxdWVzdC1JZCcsIHJpZCk7XG4gICAgbmV4dCgpO1xuICB9XG4gICJdLCJuYW1lcyI6WyJ3aXRoUmVxdWVzdElkIiwicmVxIiwicmVzIiwibmV4dCIsInJpZCIsImNyeXB0byIsInJhbmRvbVVVSUQiLCJEYXRlIiwibm93IiwidG9TdHJpbmciLCJNYXRoIiwicmFuZG9tIiwic2xpY2UiLCJzZXRIZWFkZXIiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api-node)/./lib/middleware/requestId.js\n");

/***/ }),

/***/ "(api-node)/./lib/productApiUtils.js":
/*!********************************!*\
  !*** ./lib/productApiUtils.js ***!
  \********************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getPaginatedProducts: () => (/* binding */ getPaginatedProducts),\n/* harmony export */   insertProduct: () => (/* binding */ insertProduct),\n/* harmony export */   updateProductStatus: () => (/* binding */ updateProductStatus)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./db */ \"(api-node)/./lib/db.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_db__WEBPACK_IMPORTED_MODULE_0__]);\n_db__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\nasync function insertProduct(product) {\n    const db = await (0,_db__WEBPACK_IMPORTED_MODULE_0__.openDB)();\n    const { name, description, price, stock, image_url, category } = product;\n    return await db.run(`INSERT INTO products (name, description, price, stock, image_url, category)\n     VALUES (?, ?, ?, ?, ?, ?)`, [\n        name,\n        description,\n        price,\n        stock,\n        image_url,\n        category\n    ]);\n}\n// ðŸ§¾ Get Paginated Products\nasync function getPaginatedProducts(page = 1, limit = 20, sortSQL = 'created_at DESC', q = '') {\n    const rid = Math.random().toString(36).slice(2, 8);\n    console.log(`[db] [${rid}] start getPaginatedProducts`, {\n        page,\n        limit,\n        sortSQL,\n        q\n    });\n    const db = await (0,_db__WEBPACK_IMPORTED_MODULE_0__.openDB)();\n    const offset = (page - 1) * limit;\n    const countStart = Date.now();\n    const countResult = await db.get(`SELECT COUNT(*) as count FROM products`);\n    const totalCount = countResult.count;\n    const countMs = Date.now() - countStart;\n    console.log(`[db] [${rid}] count query done in ${countMs}ms total=${totalCount}`);\n    const selectStart = Date.now();\n    const rawproducts = await db.all(`SELECT id, name, description, price, stock, image_url, category, is_favorite, is_active, created_at\n     FROM products\n     ORDER BY ${sortSQL}\n     LIMIT ? OFFSET ?`, [\n        parseInt(limit),\n        parseInt(offset)\n    ]);\n    const selectMs = Date.now() - selectStart;\n    // Normalize\n    const products = rawproducts.map((p)=>({\n            ...p,\n            is_favorite: Number(p.is_favorite || 0)\n        }));\n    console.log(`[db] [${rid}] select done in ${selectMs}ms rows=${products.length}`);\n    return {\n        products,\n        total: totalCount,\n        page: parseInt(page),\n        totalPages: Math.ceil(totalCount / limit)\n    };\n}\nasync function updateProductStatus(id, is_active) {\n    const db = await (0,_db__WEBPACK_IMPORTED_MODULE_0__.openDB)();\n    return db.run(`UPDATE products SET is_active = ? WHERE id = ?`, [\n        is_active,\n        id\n    ]);\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL2xpYi9wcm9kdWN0QXBpVXRpbHMuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUE4QjtBQUV2QixlQUFlQyxjQUFjQyxPQUFPO0lBQ3pDLE1BQU1DLEtBQUssTUFBTUgsMkNBQU1BO0lBQ3ZCLE1BQU0sRUFBRUksSUFBSSxFQUFFQyxXQUFXLEVBQUVDLEtBQUssRUFBRUMsS0FBSyxFQUFFQyxTQUFTLEVBQUVDLFFBQVEsRUFBRSxHQUFHUDtJQUVqRSxPQUFPLE1BQU1DLEdBQUdPLEdBQUcsQ0FDakIsQ0FBQzs4QkFDeUIsQ0FBQyxFQUMzQjtRQUFDTjtRQUFNQztRQUFhQztRQUFPQztRQUFPQztRQUFXQztLQUFTO0FBRTFEO0FBRUEsNEJBQTRCO0FBQ3JCLGVBQWVFLHFCQUFxQkMsT0FBTyxDQUFDLEVBQUVDLFFBQVEsRUFBRSxFQUFFQyxVQUFVLGlCQUFpQixFQUFFQyxJQUFJLEVBQUU7SUFDbEcsTUFBTUMsTUFBTUMsS0FBS0MsTUFBTSxHQUFHQyxRQUFRLENBQUMsSUFBSUMsS0FBSyxDQUFDLEdBQUc7SUFDaERDLFFBQVFDLEdBQUcsQ0FBQyxDQUFDLE1BQU0sRUFBRU4sSUFBSSw0QkFBNEIsQ0FBQyxFQUFFO1FBQUVKO1FBQU1DO1FBQU9DO1FBQVNDO0lBQUU7SUFFbEYsTUFBTVosS0FBSyxNQUFNSCwyQ0FBTUE7SUFDdkIsTUFBTXVCLFNBQVMsQ0FBQ1gsT0FBTyxLQUFLQztJQUM1QixNQUFNVyxhQUFhQyxLQUFLQyxHQUFHO0lBRTNCLE1BQU1DLGNBQWMsTUFBTXhCLEdBQUd5QixHQUFHLENBQUMsQ0FBQyxzQ0FBc0MsQ0FBQztJQUN6RSxNQUFNQyxhQUFhRixZQUFZRyxLQUFLO0lBQ3BDLE1BQU1DLFVBQVVOLEtBQUtDLEdBQUcsS0FBS0Y7SUFFN0JILFFBQVFDLEdBQUcsQ0FBQyxDQUFDLE1BQU0sRUFBRU4sSUFBSSxzQkFBc0IsRUFBRWUsUUFBUSxTQUFTLEVBQUVGLFlBQVk7SUFFaEYsTUFBTUcsY0FBY1AsS0FBS0MsR0FBRztJQUM1QixNQUFNTyxjQUFjLE1BQU05QixHQUFHK0IsR0FBRyxDQUM5QixDQUFDOztjQUVTLEVBQUVwQixRQUFRO3FCQUNILENBQUMsRUFDbEI7UUFBQ3FCLFNBQVN0QjtRQUFRc0IsU0FBU1o7S0FBUTtJQUVyQyxNQUFNYSxXQUFXWCxLQUFLQyxHQUFHLEtBQUtNO0lBRTlCLFlBQVk7SUFDWixNQUFNSyxXQUFXSixZQUFZSyxHQUFHLENBQUMsQ0FBQ0MsSUFBTztZQUN2QyxHQUFHQSxDQUFDO1lBQ0pDLGFBQWFDLE9BQU9GLEVBQUVDLFdBQVcsSUFBSTtRQUN2QztJQUVBbkIsUUFBUUMsR0FBRyxDQUFDLENBQUMsTUFBTSxFQUFFTixJQUFJLGlCQUFpQixFQUFFb0IsU0FBUyxRQUFRLEVBQUVDLFNBQVNLLE1BQU0sRUFBRTtJQUVoRixPQUFPO1FBQ0xMO1FBQ0FNLE9BQU9kO1FBQ1BqQixNQUFNdUIsU0FBU3ZCO1FBQ2ZnQyxZQUFZM0IsS0FBSzRCLElBQUksQ0FBQ2hCLGFBQWFoQjtJQUNyQztBQUNGO0FBRU8sZUFBZWlDLG9CQUFvQkMsRUFBRSxFQUFFQyxTQUFTO0lBQ3JELE1BQU03QyxLQUFLLE1BQU1ILDJDQUFNQTtJQUN2QixPQUFPRyxHQUFHTyxHQUFHLENBQUMsQ0FBQyw4Q0FBOEMsQ0FBQyxFQUFFO1FBQUNzQztRQUFXRDtLQUFHO0FBQ2pGIiwic291cmNlcyI6WyIvVXNlcnMvZW1vbnRhemVyaS9Eb2N1bWVudHMvcHJvamVjdHMvc2hlbGwtc3Rvcmllcy1zdHVkaW8vbGliL3Byb2R1Y3RBcGlVdGlscy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBvcGVuREIgfSBmcm9tICcuL2RiJztcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGluc2VydFByb2R1Y3QocHJvZHVjdCkge1xuICBjb25zdCBkYiA9IGF3YWl0IG9wZW5EQigpO1xuICBjb25zdCB7IG5hbWUsIGRlc2NyaXB0aW9uLCBwcmljZSwgc3RvY2ssIGltYWdlX3VybCwgY2F0ZWdvcnkgfSA9IHByb2R1Y3Q7XG5cbiAgcmV0dXJuIGF3YWl0IGRiLnJ1bihcbiAgICBgSU5TRVJUIElOVE8gcHJvZHVjdHMgKG5hbWUsIGRlc2NyaXB0aW9uLCBwcmljZSwgc3RvY2ssIGltYWdlX3VybCwgY2F0ZWdvcnkpXG4gICAgIFZBTFVFUyAoPywgPywgPywgPywgPywgPylgLFxuICAgIFtuYW1lLCBkZXNjcmlwdGlvbiwgcHJpY2UsIHN0b2NrLCBpbWFnZV91cmwsIGNhdGVnb3J5XVxuICApO1xufVxuXG4vLyDwn6e+IEdldCBQYWdpbmF0ZWQgUHJvZHVjdHNcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRQYWdpbmF0ZWRQcm9kdWN0cyhwYWdlID0gMSwgbGltaXQgPSAyMCwgc29ydFNRTCA9ICdjcmVhdGVkX2F0IERFU0MnLCBxID0gJycpIHtcbiAgY29uc3QgcmlkID0gTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiwgOCk7XG4gIGNvbnNvbGUubG9nKGBbZGJdIFske3JpZH1dIHN0YXJ0IGdldFBhZ2luYXRlZFByb2R1Y3RzYCwgeyBwYWdlLCBsaW1pdCwgc29ydFNRTCwgcSB9KTtcblxuICBjb25zdCBkYiA9IGF3YWl0IG9wZW5EQigpO1xuICBjb25zdCBvZmZzZXQgPSAocGFnZSAtIDEpICogbGltaXQ7XG4gIGNvbnN0IGNvdW50U3RhcnQgPSBEYXRlLm5vdygpO1xuXG4gIGNvbnN0IGNvdW50UmVzdWx0ID0gYXdhaXQgZGIuZ2V0KGBTRUxFQ1QgQ09VTlQoKikgYXMgY291bnQgRlJPTSBwcm9kdWN0c2ApO1xuICBjb25zdCB0b3RhbENvdW50ID0gY291bnRSZXN1bHQuY291bnQ7XG4gIGNvbnN0IGNvdW50TXMgPSBEYXRlLm5vdygpIC0gY291bnRTdGFydDtcblxuICBjb25zb2xlLmxvZyhgW2RiXSBbJHtyaWR9XSBjb3VudCBxdWVyeSBkb25lIGluICR7Y291bnRNc31tcyB0b3RhbD0ke3RvdGFsQ291bnR9YCk7XG5cbiAgY29uc3Qgc2VsZWN0U3RhcnQgPSBEYXRlLm5vdygpO1xuICBjb25zdCByYXdwcm9kdWN0cyA9IGF3YWl0IGRiLmFsbChcbiAgICBgU0VMRUNUIGlkLCBuYW1lLCBkZXNjcmlwdGlvbiwgcHJpY2UsIHN0b2NrLCBpbWFnZV91cmwsIGNhdGVnb3J5LCBpc19mYXZvcml0ZSwgaXNfYWN0aXZlLCBjcmVhdGVkX2F0XG4gICAgIEZST00gcHJvZHVjdHNcbiAgICAgT1JERVIgQlkgJHtzb3J0U1FMfVxuICAgICBMSU1JVCA/IE9GRlNFVCA/YCxcbiAgICBbcGFyc2VJbnQobGltaXQpLCBwYXJzZUludChvZmZzZXQpXVxuICApO1xuICBjb25zdCBzZWxlY3RNcyA9IERhdGUubm93KCkgLSBzZWxlY3RTdGFydDtcblxuICAvLyBOb3JtYWxpemVcbiAgY29uc3QgcHJvZHVjdHMgPSByYXdwcm9kdWN0cy5tYXAoKHApID0+ICh7XG4gICAgLi4ucCxcbiAgICBpc19mYXZvcml0ZTogTnVtYmVyKHAuaXNfZmF2b3JpdGUgfHwgMCksXG4gIH0pKTtcblxuICBjb25zb2xlLmxvZyhgW2RiXSBbJHtyaWR9XSBzZWxlY3QgZG9uZSBpbiAke3NlbGVjdE1zfW1zIHJvd3M9JHtwcm9kdWN0cy5sZW5ndGh9YCk7XG5cbiAgcmV0dXJuIHtcbiAgICBwcm9kdWN0cyxcbiAgICB0b3RhbDogdG90YWxDb3VudCxcbiAgICBwYWdlOiBwYXJzZUludChwYWdlKSxcbiAgICB0b3RhbFBhZ2VzOiBNYXRoLmNlaWwodG90YWxDb3VudCAvIGxpbWl0KSxcbiAgfTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHVwZGF0ZVByb2R1Y3RTdGF0dXMoaWQsIGlzX2FjdGl2ZSkge1xuICBjb25zdCBkYiA9IGF3YWl0IG9wZW5EQigpO1xuICByZXR1cm4gZGIucnVuKGBVUERBVEUgcHJvZHVjdHMgU0VUIGlzX2FjdGl2ZSA9ID8gV0hFUkUgaWQgPSA/YCwgW2lzX2FjdGl2ZSwgaWRdKTtcbn1cbiJdLCJuYW1lcyI6WyJvcGVuREIiLCJpbnNlcnRQcm9kdWN0IiwicHJvZHVjdCIsImRiIiwibmFtZSIsImRlc2NyaXB0aW9uIiwicHJpY2UiLCJzdG9jayIsImltYWdlX3VybCIsImNhdGVnb3J5IiwicnVuIiwiZ2V0UGFnaW5hdGVkUHJvZHVjdHMiLCJwYWdlIiwibGltaXQiLCJzb3J0U1FMIiwicSIsInJpZCIsIk1hdGgiLCJyYW5kb20iLCJ0b1N0cmluZyIsInNsaWNlIiwiY29uc29sZSIsImxvZyIsIm9mZnNldCIsImNvdW50U3RhcnQiLCJEYXRlIiwibm93IiwiY291bnRSZXN1bHQiLCJnZXQiLCJ0b3RhbENvdW50IiwiY291bnQiLCJjb3VudE1zIiwic2VsZWN0U3RhcnQiLCJyYXdwcm9kdWN0cyIsImFsbCIsInBhcnNlSW50Iiwic2VsZWN0TXMiLCJwcm9kdWN0cyIsIm1hcCIsInAiLCJpc19mYXZvcml0ZSIsIk51bWJlciIsImxlbmd0aCIsInRvdGFsIiwidG90YWxQYWdlcyIsImNlaWwiLCJ1cGRhdGVQcm9kdWN0U3RhdHVzIiwiaWQiLCJpc19hY3RpdmUiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api-node)/./lib/productApiUtils.js\n");

/***/ }),

/***/ "(api-node)/./lib/redis.js":
/*!**********************!*\
  !*** ./lib/redis.js ***!
  \**********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getRedisClient: () => (/* binding */ getRedisClient),\n/* harmony export */   redisPromise: () => (/* binding */ redisPromise)\n/* harmony export */ });\n// /lib/redis.js\nlet client = null;\n/** Normalize options like { EX: 60 } -> { ex: 60 } */ function normalizeSetOpts(opts = {}) {\n    if (!opts) return undefined;\n    const ex = opts.ex ?? opts.EX ?? undefined;\n    const px = opts.px ?? opts.PX ?? undefined;\n    const out = {};\n    if (ex != null) out.ex = ex;\n    if (px != null) out.px = px;\n    return Object.keys(out).length ? out : undefined;\n}\n// Wrap Upstash client to match a minimal common API\nfunction wrapUpstash(upstash) {\n    return {\n        get: (k)=>upstash.get(k),\n        set: (k, v, opts)=>upstash.set(k, v, normalizeSetOpts(opts)),\n        del: (k)=>upstash.del(k),\n        incr: (k)=>upstash.incr(k),\n        expire: (k, s)=>upstash.expire(k, s)\n    };\n}\n// Wrap node-redis (TCP) to match the same API\nfunction wrapTcp(nodeClient) {\n    return {\n        get: (k)=>nodeClient.get(k),\n        set: (k, v, opts)=>nodeClient.set(k, v, normalizeSetOpts(opts)),\n        del: (k)=>nodeClient.del(k),\n        incr: (k)=>nodeClient.incr(k),\n        expire: (k, s)=>nodeClient.expire(k, s)\n    };\n}\nasync function getRedisClient() {\n    if (client) return client;\n    // Prefer Upstash REST if present\n    if (process.env.UPSTASH_REDIS_REST_URL && process.env.UPSTASH_REDIS_REST_TOKEN) {\n        const { Redis } = await Promise.resolve(/*! import() */).then(__webpack_require__.bind(__webpack_require__, /*! @upstash/redis */ \"@upstash/redis\"));\n        const upstash = new Redis({\n            url: process.env.UPSTASH_REDIS_REST_URL,\n            token: process.env.UPSTASH_REDIS_REST_TOKEN\n        });\n        client = wrapUpstash(upstash);\n        return client;\n    }\n    // Fallback to TCP Redis via node-redis (requires REDIS_URL)\n    const { createClient } = await Promise.resolve(/*! import() */).then(__webpack_require__.t.bind(__webpack_require__, /*! redis */ \"redis\", 23));\n    const raw = createClient({\n        url: process.env.REDIS_URL || 'redis://localhost:6379',\n        socket: {\n            reconnectStrategy: (retries)=>retries > 5 ? new Error('Max reconnect attempts reached') : 1000\n        }\n    });\n    raw.on('error', (err)=>console.error('âŒ Redis Error:', err));\n    try {\n        await raw.connect();\n        console.log('âœ… Connected to Redis (TCP)');\n    } catch (err) {\n        console.warn('âš ï¸ Redis connection failed:', err.message);\n    }\n    client = wrapTcp(raw);\n    return client;\n}\n// Export a promise you can await where needed (no top-level await)\nconst redisPromise = getRedisClient();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QyxlQUFldkIsaUJBQWlCIiwic291cmNlcyI6WyIvVXNlcnMvZW1vbnRhemVyaS9Eb2N1bWVudHMvcHJvamVjdHMvc2hlbGwtc3Rvcmllcy1zdHVkaW8vbGliL3JlZGlzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIC9saWIvcmVkaXMuanNcblxubGV0IGNsaWVudCA9IG51bGw7XG5cbi8qKiBOb3JtYWxpemUgb3B0aW9ucyBsaWtlIHsgRVg6IDYwIH0gLT4geyBleDogNjAgfSAqL1xuZnVuY3Rpb24gbm9ybWFsaXplU2V0T3B0cyhvcHRzID0ge30pIHtcbiAgaWYgKCFvcHRzKSByZXR1cm4gdW5kZWZpbmVkO1xuICBjb25zdCBleCA9IG9wdHMuZXggPz8gb3B0cy5FWCA/PyB1bmRlZmluZWQ7XG4gIGNvbnN0IHB4ID0gb3B0cy5weCA/PyBvcHRzLlBYID8/IHVuZGVmaW5lZDtcbiAgY29uc3Qgb3V0ID0ge307XG4gIGlmIChleCAhPSBudWxsKSBvdXQuZXggPSBleDtcbiAgaWYgKHB4ICE9IG51bGwpIG91dC5weCA9IHB4O1xuICByZXR1cm4gT2JqZWN0LmtleXMob3V0KS5sZW5ndGggPyBvdXQgOiB1bmRlZmluZWQ7XG59XG5cbi8vIFdyYXAgVXBzdGFzaCBjbGllbnQgdG8gbWF0Y2ggYSBtaW5pbWFsIGNvbW1vbiBBUElcbmZ1bmN0aW9uIHdyYXBVcHN0YXNoKHVwc3Rhc2gpIHtcbiAgcmV0dXJuIHtcbiAgICBnZXQ6IChrKSA9PiB1cHN0YXNoLmdldChrKSxcbiAgICBzZXQ6IChrLCB2LCBvcHRzKSA9PiB1cHN0YXNoLnNldChrLCB2LCBub3JtYWxpemVTZXRPcHRzKG9wdHMpKSxcbiAgICBkZWw6IChrKSA9PiB1cHN0YXNoLmRlbChrKSxcbiAgICBpbmNyOiAoaykgPT4gdXBzdGFzaC5pbmNyKGspLFxuICAgIGV4cGlyZTogKGssIHMpID0+IHVwc3Rhc2guZXhwaXJlKGssIHMpLFxuICB9O1xufVxuXG4vLyBXcmFwIG5vZGUtcmVkaXMgKFRDUCkgdG8gbWF0Y2ggdGhlIHNhbWUgQVBJXG5mdW5jdGlvbiB3cmFwVGNwKG5vZGVDbGllbnQpIHtcbiAgcmV0dXJuIHtcbiAgICBnZXQ6IChrKSA9PiBub2RlQ2xpZW50LmdldChrKSxcbiAgICBzZXQ6IChrLCB2LCBvcHRzKSA9PiBub2RlQ2xpZW50LnNldChrLCB2LCBub3JtYWxpemVTZXRPcHRzKG9wdHMpKSxcbiAgICBkZWw6IChrKSA9PiBub2RlQ2xpZW50LmRlbChrKSxcbiAgICBpbmNyOiAoaykgPT4gbm9kZUNsaWVudC5pbmNyKGspLFxuICAgIGV4cGlyZTogKGssIHMpID0+IG5vZGVDbGllbnQuZXhwaXJlKGssIHMpLFxuICB9O1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0UmVkaXNDbGllbnQoKSB7XG4gIGlmIChjbGllbnQpIHJldHVybiBjbGllbnQ7XG5cbiAgLy8gUHJlZmVyIFVwc3Rhc2ggUkVTVCBpZiBwcmVzZW50XG4gIGlmIChwcm9jZXNzLmVudi5VUFNUQVNIX1JFRElTX1JFU1RfVVJMICYmIHByb2Nlc3MuZW52LlVQU1RBU0hfUkVESVNfUkVTVF9UT0tFTikge1xuICAgIGNvbnN0IHsgUmVkaXMgfSA9IGF3YWl0IGltcG9ydCgnQHVwc3Rhc2gvcmVkaXMnKTtcbiAgICBjb25zdCB1cHN0YXNoID0gbmV3IFJlZGlzKHtcbiAgICAgIHVybDogcHJvY2Vzcy5lbnYuVVBTVEFTSF9SRURJU19SRVNUX1VSTCxcbiAgICAgIHRva2VuOiBwcm9jZXNzLmVudi5VUFNUQVNIX1JFRElTX1JFU1RfVE9LRU4sXG4gICAgfSk7XG4gICAgY2xpZW50ID0gd3JhcFVwc3Rhc2godXBzdGFzaCk7XG4gICAgcmV0dXJuIGNsaWVudDtcbiAgfVxuXG4gIC8vIEZhbGxiYWNrIHRvIFRDUCBSZWRpcyB2aWEgbm9kZS1yZWRpcyAocmVxdWlyZXMgUkVESVNfVVJMKVxuICBjb25zdCB7IGNyZWF0ZUNsaWVudCB9ID0gYXdhaXQgaW1wb3J0KCdyZWRpcycpO1xuXG4gIGNvbnN0IHJhdyA9IGNyZWF0ZUNsaWVudCh7XG4gICAgdXJsOiBwcm9jZXNzLmVudi5SRURJU19VUkwgfHwgJ3JlZGlzOi8vbG9jYWxob3N0OjYzNzknLFxuICAgIHNvY2tldDoge1xuICAgICAgcmVjb25uZWN0U3RyYXRlZ3k6IChyZXRyaWVzKSA9PiAocmV0cmllcyA+IDUgPyBuZXcgRXJyb3IoJ01heCByZWNvbm5lY3QgYXR0ZW1wdHMgcmVhY2hlZCcpIDogMTAwMCksXG4gICAgfSxcbiAgfSk7XG5cbiAgcmF3Lm9uKCdlcnJvcicsIChlcnIpID0+IGNvbnNvbGUuZXJyb3IoJ+KdjCBSZWRpcyBFcnJvcjonLCBlcnIpKTtcblxuICB0cnkge1xuICAgIGF3YWl0IHJhdy5jb25uZWN0KCk7XG4gICAgY29uc29sZS5sb2coJ+KchSBDb25uZWN0ZWQgdG8gUmVkaXMgKFRDUCknKTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgY29uc29sZS53YXJuKCfimqDvuI8gUmVkaXMgY29ubmVjdGlvbiBmYWlsZWQ6JywgZXJyLm1lc3NhZ2UpO1xuICB9XG5cbiAgY2xpZW50ID0gd3JhcFRjcChyYXcpO1xuICByZXR1cm4gY2xpZW50O1xufVxuXG4vLyBFeHBvcnQgYSBwcm9taXNlIHlvdSBjYW4gYXdhaXQgd2hlcmUgbmVlZGVkIChubyB0b3AtbGV2ZWwgYXdhaXQpXG5leHBvcnQgY29uc3QgcmVkaXNQcm9taXNlID0gZ2V0UmVkaXNDbGllbnQoKTtcblxuXG5cblxuIl0sIm5hbWVzIjpbImNsaWVudCIsIm5vcm1hbGl6ZVNldE9wdHMiLCJvcHRzIiwidW5kZWZpbmVkIiwiZXgiLCJFWCIsInB4IiwiUFgiLCJvdXQiLCJPYmplY3QiLCJrZXlzIiwibGVuZ3RoIiwid3JhcFVwc3Rhc2giLCJ1cHN0YXNoIiwiZ2V0IiwiayIsInNldCIsInYiLCJkZWwiLCJpbmNyIiwiZXhwaXJlIiwicyIsIndyYXBUY3AiLCJub2RlQ2xpZW50IiwiZ2V0UmVkaXNDbGllbnQiLCJwcm9jZXNzIiwiZW52IiwiVVBTVEFTSF9SRURJU19SRVNUX1VSTCIsIlVQU1RBU0hfUkVESVNfUkVTVF9UT0tFTiIsIlJlZGlzIiwidXJsIiwidG9rZW4iLCJjcmVhdGVDbGllbnQiLCJyYXciLCJSRURJU19VUkwiLCJzb2NrZXQiLCJyZWNvbm5lY3RTdHJhdGVneSIsInJldHJpZXMiLCJFcnJvciIsIm9uIiwiZXJyIiwiY29uc29sZSIsImVycm9yIiwiY29ubmVjdCIsImxvZyIsIndhcm4iLCJtZXNzYWdlIiwicmVkaXNQcm9taXNlIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api-node)/./lib/redis.js\n");

/***/ }),

/***/ "(api-node)/./lib/redis/formatkey.js":
/*!********************************!*\
  !*** ./lib/redis/formatkey.js ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   safeRedisKey: () => (/* binding */ safeRedisKey)\n/* harmony export */ });\n// lib/redis/formatKey.js\n/**\n * Safely formats an array of strings or values into a sanitized Redis key.\n * It removes dangerous characters and limits each segment to 64 characters.\n * @param {string[]} parts - Array of key segments\n * @returns {string} - Safe Redis key\n */ function safeRedisKey(parts = []) {\n    return parts.map((p)=>String(p || '').trim().replace(/[^a-zA-Z0-9:_-]/g, '') // remove unsafe characters\n        .slice(0, 64) // limit each part\n    ).join(':');\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL2xpYi9yZWRpcy9mb3JtYXRrZXkuanMiLCJtYXBwaW5ncyI6Ijs7OztBQUFBLHlCQUF5QjtBQUV6Qjs7Ozs7Q0FLQyxHQUNNLFNBQVNBLGFBQWFDLFFBQVEsRUFBRTtJQUNuQyxPQUFPQSxNQUNKQyxHQUFHLENBQUNDLENBQUFBLElBQ0hDLE9BQU9ELEtBQUssSUFDVEUsSUFBSSxHQUNKQyxPQUFPLENBQUMsb0JBQW9CLElBQUksMkJBQTJCO1NBQzNEQyxLQUFLLENBQUMsR0FBRyxJQUF1QixrQkFBa0I7TUFFdERDLElBQUksQ0FBQztBQUNWIiwic291cmNlcyI6WyIvVXNlcnMvZW1vbnRhemVyaS9Eb2N1bWVudHMvcHJvamVjdHMvc2hlbGwtc3Rvcmllcy1zdHVkaW8vbGliL3JlZGlzL2Zvcm1hdGtleS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBsaWIvcmVkaXMvZm9ybWF0S2V5LmpzXG5cbi8qKlxuICogU2FmZWx5IGZvcm1hdHMgYW4gYXJyYXkgb2Ygc3RyaW5ncyBvciB2YWx1ZXMgaW50byBhIHNhbml0aXplZCBSZWRpcyBrZXkuXG4gKiBJdCByZW1vdmVzIGRhbmdlcm91cyBjaGFyYWN0ZXJzIGFuZCBsaW1pdHMgZWFjaCBzZWdtZW50IHRvIDY0IGNoYXJhY3RlcnMuXG4gKiBAcGFyYW0ge3N0cmluZ1tdfSBwYXJ0cyAtIEFycmF5IG9mIGtleSBzZWdtZW50c1xuICogQHJldHVybnMge3N0cmluZ30gLSBTYWZlIFJlZGlzIGtleVxuICovXG5leHBvcnQgZnVuY3Rpb24gc2FmZVJlZGlzS2V5KHBhcnRzID0gW10pIHtcbiAgICByZXR1cm4gcGFydHNcbiAgICAgIC5tYXAocCA9PlxuICAgICAgICBTdHJpbmcocCB8fCAnJylcbiAgICAgICAgICAudHJpbSgpXG4gICAgICAgICAgLnJlcGxhY2UoL1teYS16QS1aMC05Ol8tXS9nLCAnJykgLy8gcmVtb3ZlIHVuc2FmZSBjaGFyYWN0ZXJzXG4gICAgICAgICAgLnNsaWNlKDAsIDY0KSAgICAgICAgICAgICAgICAgICAgLy8gbGltaXQgZWFjaCBwYXJ0XG4gICAgICApXG4gICAgICAuam9pbignOicpO1xuICB9XG4gIFxuICAiXSwibmFtZXMiOlsic2FmZVJlZGlzS2V5IiwicGFydHMiLCJtYXAiLCJwIiwiU3RyaW5nIiwidHJpbSIsInJlcGxhY2UiLCJzbGljZSIsImpvaW4iXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api-node)/./lib/redis/formatkey.js\n");

/***/ }),

/***/ "(api-node)/./lib/utils/sanitizeProductFields.js":
/*!********************************************!*\
  !*** ./lib/utils/sanitizeProductFields.js ***!
  \********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   sanitizeProductFields: () => (/* binding */ sanitizeProductFields)\n/* harmony export */ });\n/* harmony import */ var sanitize_html__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! sanitize-html */ \"sanitize-html\");\n/* harmony import */ var sanitize_html__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(sanitize_html__WEBPACK_IMPORTED_MODULE_0__);\n// lib/sanitize/sanitizeProductFields.js\n\nfunction sanitizeProductFields(input) {\n    return {\n        name: sanitizeText(input.name),\n        description: sanitize_html__WEBPACK_IMPORTED_MODULE_0___default()(input.description || '', {\n            allowedTags: [],\n            allowedAttributes: {}\n        }),\n        price: sanitizeNumber(input.price),\n        stock: sanitizeInteger(input.stock),\n        image_url: sanitizeUrl(input.image_url),\n        image_public_id: sanitizeText(input.image_public_id),\n        category: sanitizeText(input.category),\n        is_active: input.is_active === 1 ? 1 : 0,\n        is_favorite: input.is_favorite === 1 ? 1 : 0\n    };\n}\nfunction sanitizeText(text) {\n    return String(text || '').trim().slice(0, 255);\n}\nfunction sanitizeNumber(value) {\n    const num = parseFloat(value);\n    return isNaN(num) || num < 0 ? 0 : num;\n}\nfunction sanitizeInteger(value) {\n    const int = parseInt(value, 10);\n    return isNaN(int) || int < 0 ? 0 : int;\n}\nfunction sanitizeUrl(url) {\n    try {\n        const u = new URL(url);\n        return u.href;\n    } catch  {\n        return '';\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL2xpYi91dGlscy9zYW5pdGl6ZVByb2R1Y3RGaWVsZHMuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsd0NBQXdDO0FBQ0M7QUFFbEMsU0FBU0Msc0JBQXNCQyxLQUFLO0lBQ3pDLE9BQU87UUFDTEMsTUFBTUMsYUFBYUYsTUFBTUMsSUFBSTtRQUM3QkUsYUFBYUwsb0RBQVlBLENBQUNFLE1BQU1HLFdBQVcsSUFBSSxJQUFJO1lBQ2pEQyxhQUFhLEVBQUU7WUFDZkMsbUJBQW1CLENBQUM7UUFDdEI7UUFDQUMsT0FBT0MsZUFBZVAsTUFBTU0sS0FBSztRQUNqQ0UsT0FBT0MsZ0JBQWdCVCxNQUFNUSxLQUFLO1FBQ2xDRSxXQUFXQyxZQUFZWCxNQUFNVSxTQUFTO1FBQ3RDRSxpQkFBaUJWLGFBQWFGLE1BQU1ZLGVBQWU7UUFDbkRDLFVBQVVYLGFBQWFGLE1BQU1hLFFBQVE7UUFDckNDLFdBQVdkLE1BQU1jLFNBQVMsS0FBSyxJQUFJLElBQUk7UUFDdkNDLGFBQWFmLE1BQU1lLFdBQVcsS0FBSyxJQUFJLElBQUk7SUFDN0M7QUFDRjtBQUVBLFNBQVNiLGFBQWFjLElBQUk7SUFDeEIsT0FBT0MsT0FBT0QsUUFBUSxJQUFJRSxJQUFJLEdBQUdDLEtBQUssQ0FBQyxHQUFHO0FBQzVDO0FBRUEsU0FBU1osZUFBZWEsS0FBSztJQUMzQixNQUFNQyxNQUFNQyxXQUFXRjtJQUN2QixPQUFPRyxNQUFNRixRQUFRQSxNQUFNLElBQUksSUFBSUE7QUFDckM7QUFFQSxTQUFTWixnQkFBZ0JXLEtBQUs7SUFDNUIsTUFBTUksTUFBTUMsU0FBU0wsT0FBTztJQUM1QixPQUFPRyxNQUFNQyxRQUFRQSxNQUFNLElBQUksSUFBSUE7QUFDckM7QUFFQSxTQUFTYixZQUFZZSxHQUFHO0lBQ3RCLElBQUk7UUFDRixNQUFNQyxJQUFJLElBQUlDLElBQUlGO1FBQ2xCLE9BQU9DLEVBQUVFLElBQUk7SUFDZixFQUFFLE9BQU07UUFDTixPQUFPO0lBQ1Q7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL2Vtb250YXplcmkvRG9jdW1lbnRzL3Byb2plY3RzL3NoZWxsLXN0b3JpZXMtc3R1ZGlvL2xpYi91dGlscy9zYW5pdGl6ZVByb2R1Y3RGaWVsZHMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gbGliL3Nhbml0aXplL3Nhbml0aXplUHJvZHVjdEZpZWxkcy5qc1xuaW1wb3J0IHNhbml0aXplSHRtbCBmcm9tICdzYW5pdGl6ZS1odG1sJztcblxuZXhwb3J0IGZ1bmN0aW9uIHNhbml0aXplUHJvZHVjdEZpZWxkcyhpbnB1dCkge1xuICByZXR1cm4ge1xuICAgIG5hbWU6IHNhbml0aXplVGV4dChpbnB1dC5uYW1lKSxcbiAgICBkZXNjcmlwdGlvbjogc2FuaXRpemVIdG1sKGlucHV0LmRlc2NyaXB0aW9uIHx8ICcnLCB7XG4gICAgICBhbGxvd2VkVGFnczogW10sXG4gICAgICBhbGxvd2VkQXR0cmlidXRlczoge30sXG4gICAgfSksXG4gICAgcHJpY2U6IHNhbml0aXplTnVtYmVyKGlucHV0LnByaWNlKSxcbiAgICBzdG9jazogc2FuaXRpemVJbnRlZ2VyKGlucHV0LnN0b2NrKSxcbiAgICBpbWFnZV91cmw6IHNhbml0aXplVXJsKGlucHV0LmltYWdlX3VybCksXG4gICAgaW1hZ2VfcHVibGljX2lkOiBzYW5pdGl6ZVRleHQoaW5wdXQuaW1hZ2VfcHVibGljX2lkKSxcbiAgICBjYXRlZ29yeTogc2FuaXRpemVUZXh0KGlucHV0LmNhdGVnb3J5KSxcbiAgICBpc19hY3RpdmU6IGlucHV0LmlzX2FjdGl2ZSA9PT0gMSA/IDEgOiAwLFxuICAgIGlzX2Zhdm9yaXRlOiBpbnB1dC5pc19mYXZvcml0ZSA9PT0gMSA/IDEgOiAwLFxuICB9O1xufVxuXG5mdW5jdGlvbiBzYW5pdGl6ZVRleHQodGV4dCkge1xuICByZXR1cm4gU3RyaW5nKHRleHQgfHwgJycpLnRyaW0oKS5zbGljZSgwLCAyNTUpO1xufVxuXG5mdW5jdGlvbiBzYW5pdGl6ZU51bWJlcih2YWx1ZSkge1xuICBjb25zdCBudW0gPSBwYXJzZUZsb2F0KHZhbHVlKTtcbiAgcmV0dXJuIGlzTmFOKG51bSkgfHwgbnVtIDwgMCA/IDAgOiBudW07XG59XG5cbmZ1bmN0aW9uIHNhbml0aXplSW50ZWdlcih2YWx1ZSkge1xuICBjb25zdCBpbnQgPSBwYXJzZUludCh2YWx1ZSwgMTApO1xuICByZXR1cm4gaXNOYU4oaW50KSB8fCBpbnQgPCAwID8gMCA6IGludDtcbn1cblxuZnVuY3Rpb24gc2FuaXRpemVVcmwodXJsKSB7XG4gIHRyeSB7XG4gICAgY29uc3QgdSA9IG5ldyBVUkwodXJsKTtcbiAgICByZXR1cm4gdS5ocmVmO1xuICB9IGNhdGNoIHtcbiAgICByZXR1cm4gJyc7XG4gIH1cbn1cblxuIl0sIm5hbWVzIjpbInNhbml0aXplSHRtbCIsInNhbml0aXplUHJvZHVjdEZpZWxkcyIsImlucHV0IiwibmFtZSIsInNhbml0aXplVGV4dCIsImRlc2NyaXB0aW9uIiwiYWxsb3dlZFRhZ3MiLCJhbGxvd2VkQXR0cmlidXRlcyIsInByaWNlIiwic2FuaXRpemVOdW1iZXIiLCJzdG9jayIsInNhbml0aXplSW50ZWdlciIsImltYWdlX3VybCIsInNhbml0aXplVXJsIiwiaW1hZ2VfcHVibGljX2lkIiwiY2F0ZWdvcnkiLCJpc19hY3RpdmUiLCJpc19mYXZvcml0ZSIsInRleHQiLCJTdHJpbmciLCJ0cmltIiwic2xpY2UiLCJ2YWx1ZSIsIm51bSIsInBhcnNlRmxvYXQiLCJpc05hTiIsImludCIsInBhcnNlSW50IiwidXJsIiwidSIsIlVSTCIsImhyZWYiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api-node)/./lib/utils/sanitizeProductFields.js\n");

/***/ }),

/***/ "(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fadmin%2Fmanage_products&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fadmin%2Fmanage_products%2Findex.js&middlewareConfigBase64=e30%3D!":
/*!************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fadmin%2Fmanage_products&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fadmin%2Fmanage_products%2Findex.js&middlewareConfigBase64=e30%3D! ***!
  \************************************************************************************************************************************************************************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   handler: () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_api_utils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/api-utils */ \"(api-node)/./node_modules/next/dist/server/api-utils/index.js\");\n/* harmony import */ var next_dist_server_api_utils__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_api_utils__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/route-kind */ \"(api-node)/./node_modules/next/dist/server/route-kind.js\");\n/* harmony import */ var next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/route-modules/pages-api/module.compiled */ \"(api-node)/./node_modules/next/dist/server/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api-node)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_admin_manage_products_index_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./pages/api/admin/manage_products/index.js */ \"(api-node)/./pages/api/admin/manage_products/index.js\");\n/* harmony import */ var next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! next/dist/server/lib/trace/tracer */ \"(api-node)/./node_modules/next/dist/server/lib/trace/tracer.js\");\n/* harmony import */ var next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_5__);\n/* harmony import */ var next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! next/dist/server/lib/trace/constants */ \"(api-node)/./node_modules/next/dist/server/lib/trace/constants.js\");\n/* harmony import */ var next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_6___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_6__);\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_pages_api_admin_manage_products_index_js__WEBPACK_IMPORTED_MODULE_4__]);\n_pages_api_admin_manage_products_index_js__WEBPACK_IMPORTED_MODULE_4__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\n// Import the userland code.\n\n\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_3__.hoist)(_pages_api_admin_manage_products_index_js__WEBPACK_IMPORTED_MODULE_4__, 'default'));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_3__.hoist)(_pages_api_admin_manage_products_index_js__WEBPACK_IMPORTED_MODULE_4__, 'config');\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_2__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/admin/manage_products\",\n        pathname: \"/api/admin/manage_products\",\n        // The following aren't used in production.\n        bundlePath: '',\n        filename: ''\n    },\n    userland: _pages_api_admin_manage_products_index_js__WEBPACK_IMPORTED_MODULE_4__,\n    distDir: \".next\" || 0,\n    relativeProjectDir:  false || ''\n});\nasync function handler(req, res, ctx) {\n    let srcPage = \"/api/admin/manage_products\";\n    // turbopack doesn't normalize `/index` in the page name\n    // so we need to to process dynamic routes properly\n    // TODO: fix turbopack providing differing value from webpack\n    if (false) {}\n    const prepareResult = await routeModule.prepare(req, res, {\n        srcPage\n    });\n    if (!prepareResult) {\n        res.statusCode = 400;\n        res.end('Bad Request');\n        ctx.waitUntil == null ? void 0 : ctx.waitUntil.call(ctx, Promise.resolve());\n        return;\n    }\n    const { query, params, prerenderManifest, routerServerContext } = prepareResult;\n    try {\n        const method = req.method || 'GET';\n        const tracer = (0,next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_5__.getTracer)();\n        const activeSpan = tracer.getActiveScopeSpan();\n        const onRequestError = routeModule.instrumentationOnRequestError.bind(routeModule);\n        const invokeRouteModule = async (span)=>routeModule.render(req, res, {\n                query: {\n                    ...query,\n                    ...params\n                },\n                params,\n                allowedRevalidateHeaderKeys: [],\n                multiZoneDraftMode: Boolean(false),\n                trustHostHeader: false,\n                // TODO: get this from from runtime env so manifest\n                // doesn't need to load\n                previewProps: prerenderManifest.preview,\n                propagateError: false,\n                dev: routeModule.isDev,\n                page: \"/api/admin/manage_products\",\n                internalRevalidate: routerServerContext == null ? void 0 : routerServerContext.revalidate,\n                onError: (...args)=>onRequestError(req, ...args)\n            }).finally(()=>{\n                if (!span) return;\n                span.setAttributes({\n                    'http.status_code': res.statusCode,\n                    'next.rsc': false\n                });\n                const rootSpanAttributes = tracer.getRootSpanAttributes();\n                // We were unable to get attributes, probably OTEL is not enabled\n                if (!rootSpanAttributes) {\n                    return;\n                }\n                if (rootSpanAttributes.get('next.span_type') !== next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_6__.BaseServerSpan.handleRequest) {\n                    console.warn(`Unexpected root span type '${rootSpanAttributes.get('next.span_type')}'. Please report this Next.js issue https://github.com/vercel/next.js`);\n                    return;\n                }\n                const route = rootSpanAttributes.get('next.route');\n                if (route) {\n                    const name = `${method} ${route}`;\n                    span.setAttributes({\n                        'next.route': route,\n                        'http.route': route,\n                        'next.span_name': name\n                    });\n                    span.updateName(name);\n                } else {\n                    span.updateName(`${method} ${req.url}`);\n                }\n            });\n        // TODO: activeSpan code path is for when wrapped by\n        // next-server can be removed when this is no longer used\n        if (activeSpan) {\n            await invokeRouteModule(activeSpan);\n        } else {\n            await tracer.withPropagatedContext(req.headers, ()=>tracer.trace(next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_6__.BaseServerSpan.handleRequest, {\n                    spanName: `${method} ${req.url}`,\n                    kind: next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_5__.SpanKind.SERVER,\n                    attributes: {\n                        'http.method': method,\n                        'http.target': req.url\n                    }\n                }, invokeRouteModule));\n        }\n    } catch (err) {\n        // we re-throw in dev to show the error overlay\n        if (routeModule.isDev) {\n            throw err;\n        }\n        // this is technically an invariant as error handling\n        // should be done inside of api-resolver onError\n        (0,next_dist_server_api_utils__WEBPACK_IMPORTED_MODULE_0__.sendError)(res, 500, 'Internal Server Error');\n    } finally{\n        // We don't allow any waitUntil work in pages API routes currently\n        // so if callback is present return with resolved promise since no\n        // pending work\n        ctx.waitUntil == null ? void 0 : ctx.waitUntil.call(ctx, Promise.resolve());\n    }\n}\n\n//# sourceMappingURL=pages-api.js.map\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL25vZGVfbW9kdWxlcy9uZXh0L2Rpc3QvYnVpbGQvd2VicGFjay9sb2FkZXJzL25leHQtcm91dGUtbG9hZGVyL2luZGV4LmpzP2tpbmQ9UEFHRVNfQVBJJnBhZ2U9JTJGYXBpJTJGYWRtaW4lMkZtYW5hZ2VfcHJvZHVjdHMmcHJlZmVycmVkUmVnaW9uPSZhYnNvbHV0ZVBhZ2VQYXRoPS4lMkZwYWdlcyUyRmFwaSUyRmFkbWluJTJGbWFuYWdlX3Byb2R1Y3RzJTJGaW5kZXguanMmbWlkZGxld2FyZUNvbmZpZ0Jhc2U2ND1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQXVEO0FBQ0M7QUFDdUM7QUFDckM7QUFDMUQ7QUFDdUU7QUFDQztBQUNGO0FBQ3RFO0FBQ0EsaUVBQWUsd0VBQUssQ0FBQyxzRUFBUSxZQUFZLEVBQUM7QUFDMUM7QUFDTyxlQUFlLHdFQUFLLENBQUMsc0VBQVE7QUFDcEM7QUFDQSx3QkFBd0IseUdBQW1CO0FBQzNDO0FBQ0EsY0FBYyxrRUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLFlBQVk7QUFDWixhQUFhLE9BQW9DLElBQUksQ0FBRTtBQUN2RCx3QkFBd0IsTUFBdUM7QUFDL0QsQ0FBQztBQUNNO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRLEtBQXFCLEVBQUUsRUFFMUI7QUFDTDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksd0RBQXdEO0FBQ3BFO0FBQ0E7QUFDQSx1QkFBdUIsNEVBQVM7QUFDaEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0EsNkNBQTZDLEVBQTZDO0FBQzFGLDRDQUE0QyxLQUF3QztBQUNwRixpQ0FBaUMsS0FBb0M7QUFDckU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUVBQWlFLGdGQUFjO0FBQy9FLCtEQUErRCx5Q0FBeUM7QUFDeEc7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQ0FBb0MsUUFBUSxFQUFFLE1BQU07QUFDcEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQSxrQkFBa0I7QUFDbEIsdUNBQXVDLFFBQVEsRUFBRSxRQUFRO0FBQ3pEO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWLDZFQUE2RSxnRkFBYztBQUMzRixpQ0FBaUMsUUFBUSxFQUFFLFFBQVE7QUFDbkQsMEJBQTBCLHVFQUFRO0FBQ2xDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVEscUVBQVM7QUFDakIsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSIsInNvdXJjZXMiOlsiIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHNlbmRFcnJvciB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2FwaS11dGlsc1wiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgUGFnZXNBUElSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL3JvdXRlLW1vZHVsZXMvcGFnZXMtYXBpL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgaG9pc3QgfSBmcm9tIFwibmV4dC9kaXN0L2J1aWxkL3RlbXBsYXRlcy9oZWxwZXJzXCI7XG4vLyBJbXBvcnQgdGhlIHVzZXJsYW5kIGNvZGUuXG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiLi9wYWdlcy9hcGkvYWRtaW4vbWFuYWdlX3Byb2R1Y3RzL2luZGV4LmpzXCI7XG5pbXBvcnQgeyBnZXRUcmFjZXIsIFNwYW5LaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3RyYWNlL3RyYWNlclwiO1xuaW1wb3J0IHsgQmFzZVNlcnZlclNwYW4gfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9saWIvdHJhY2UvY29uc3RhbnRzXCI7XG4vLyBSZS1leHBvcnQgdGhlIGhhbmRsZXIgKHNob3VsZCBiZSB0aGUgZGVmYXVsdCBleHBvcnQpLlxuZXhwb3J0IGRlZmF1bHQgaG9pc3QodXNlcmxhbmQsICdkZWZhdWx0Jyk7XG4vLyBSZS1leHBvcnQgY29uZmlnLlxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IGhvaXN0KHVzZXJsYW5kLCAnY29uZmlnJyk7XG4vLyBDcmVhdGUgYW5kIGV4cG9ydCB0aGUgcm91dGUgbW9kdWxlIHRoYXQgd2lsbCBiZSBjb25zdW1lZC5cbmNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IFBhZ2VzQVBJUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLlBBR0VTX0FQSSxcbiAgICAgICAgcGFnZTogXCIvYXBpL2FkbWluL21hbmFnZV9wcm9kdWN0c1wiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL2FkbWluL21hbmFnZV9wcm9kdWN0c1wiLFxuICAgICAgICAvLyBUaGUgZm9sbG93aW5nIGFyZW4ndCB1c2VkIGluIHByb2R1Y3Rpb24uXG4gICAgICAgIGJ1bmRsZVBhdGg6ICcnLFxuICAgICAgICBmaWxlbmFtZTogJydcbiAgICB9LFxuICAgIHVzZXJsYW5kLFxuICAgIGRpc3REaXI6IHByb2Nlc3MuZW52Ll9fTkVYVF9SRUxBVElWRV9ESVNUX0RJUiB8fCAnJyxcbiAgICByZWxhdGl2ZVByb2plY3REaXI6IHByb2Nlc3MuZW52Ll9fTkVYVF9SRUxBVElWRV9QUk9KRUNUX0RJUiB8fCAnJ1xufSk7XG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gaGFuZGxlcihyZXEsIHJlcywgY3R4KSB7XG4gICAgbGV0IHNyY1BhZ2UgPSBcIi9hcGkvYWRtaW4vbWFuYWdlX3Byb2R1Y3RzXCI7XG4gICAgLy8gdHVyYm9wYWNrIGRvZXNuJ3Qgbm9ybWFsaXplIGAvaW5kZXhgIGluIHRoZSBwYWdlIG5hbWVcbiAgICAvLyBzbyB3ZSBuZWVkIHRvIHRvIHByb2Nlc3MgZHluYW1pYyByb3V0ZXMgcHJvcGVybHlcbiAgICAvLyBUT0RPOiBmaXggdHVyYm9wYWNrIHByb3ZpZGluZyBkaWZmZXJpbmcgdmFsdWUgZnJvbSB3ZWJwYWNrXG4gICAgaWYgKHByb2Nlc3MuZW52LlRVUkJPUEFDSykge1xuICAgICAgICBzcmNQYWdlID0gc3JjUGFnZS5yZXBsYWNlKC9cXC9pbmRleCQvLCAnJykgfHwgJy8nO1xuICAgIH1cbiAgICBjb25zdCBwcmVwYXJlUmVzdWx0ID0gYXdhaXQgcm91dGVNb2R1bGUucHJlcGFyZShyZXEsIHJlcywge1xuICAgICAgICBzcmNQYWdlXG4gICAgfSk7XG4gICAgaWYgKCFwcmVwYXJlUmVzdWx0KSB7XG4gICAgICAgIHJlcy5zdGF0dXNDb2RlID0gNDAwO1xuICAgICAgICByZXMuZW5kKCdCYWQgUmVxdWVzdCcpO1xuICAgICAgICBjdHgud2FpdFVudGlsID09IG51bGwgPyB2b2lkIDAgOiBjdHgud2FpdFVudGlsLmNhbGwoY3R4LCBQcm9taXNlLnJlc29sdmUoKSk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgeyBxdWVyeSwgcGFyYW1zLCBwcmVyZW5kZXJNYW5pZmVzdCwgcm91dGVyU2VydmVyQ29udGV4dCB9ID0gcHJlcGFyZVJlc3VsdDtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBtZXRob2QgPSByZXEubWV0aG9kIHx8ICdHRVQnO1xuICAgICAgICBjb25zdCB0cmFjZXIgPSBnZXRUcmFjZXIoKTtcbiAgICAgICAgY29uc3QgYWN0aXZlU3BhbiA9IHRyYWNlci5nZXRBY3RpdmVTY29wZVNwYW4oKTtcbiAgICAgICAgY29uc3Qgb25SZXF1ZXN0RXJyb3IgPSByb3V0ZU1vZHVsZS5pbnN0cnVtZW50YXRpb25PblJlcXVlc3RFcnJvci5iaW5kKHJvdXRlTW9kdWxlKTtcbiAgICAgICAgY29uc3QgaW52b2tlUm91dGVNb2R1bGUgPSBhc3luYyAoc3Bhbik9PnJvdXRlTW9kdWxlLnJlbmRlcihyZXEsIHJlcywge1xuICAgICAgICAgICAgICAgIHF1ZXJ5OiB7XG4gICAgICAgICAgICAgICAgICAgIC4uLnF1ZXJ5LFxuICAgICAgICAgICAgICAgICAgICAuLi5wYXJhbXNcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHBhcmFtcyxcbiAgICAgICAgICAgICAgICBhbGxvd2VkUmV2YWxpZGF0ZUhlYWRlcktleXM6IHByb2Nlc3MuZW52Ll9fTkVYVF9BTExPV0VEX1JFVkFMSURBVEVfSEVBREVSUyxcbiAgICAgICAgICAgICAgICBtdWx0aVpvbmVEcmFmdE1vZGU6IEJvb2xlYW4ocHJvY2Vzcy5lbnYuX19ORVhUX01VTFRJX1pPTkVfRFJBRlRfTU9ERSksXG4gICAgICAgICAgICAgICAgdHJ1c3RIb3N0SGVhZGVyOiBwcm9jZXNzLmVudi5fX05FWFRfVFJVU1RfSE9TVF9IRUFERVIsXG4gICAgICAgICAgICAgICAgLy8gVE9ETzogZ2V0IHRoaXMgZnJvbSBmcm9tIHJ1bnRpbWUgZW52IHNvIG1hbmlmZXN0XG4gICAgICAgICAgICAgICAgLy8gZG9lc24ndCBuZWVkIHRvIGxvYWRcbiAgICAgICAgICAgICAgICBwcmV2aWV3UHJvcHM6IHByZXJlbmRlck1hbmlmZXN0LnByZXZpZXcsXG4gICAgICAgICAgICAgICAgcHJvcGFnYXRlRXJyb3I6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGRldjogcm91dGVNb2R1bGUuaXNEZXYsXG4gICAgICAgICAgICAgICAgcGFnZTogXCIvYXBpL2FkbWluL21hbmFnZV9wcm9kdWN0c1wiLFxuICAgICAgICAgICAgICAgIGludGVybmFsUmV2YWxpZGF0ZTogcm91dGVyU2VydmVyQ29udGV4dCA9PSBudWxsID8gdm9pZCAwIDogcm91dGVyU2VydmVyQ29udGV4dC5yZXZhbGlkYXRlLFxuICAgICAgICAgICAgICAgIG9uRXJyb3I6ICguLi5hcmdzKT0+b25SZXF1ZXN0RXJyb3IocmVxLCAuLi5hcmdzKVxuICAgICAgICAgICAgfSkuZmluYWxseSgoKT0+e1xuICAgICAgICAgICAgICAgIGlmICghc3BhbikgcmV0dXJuO1xuICAgICAgICAgICAgICAgIHNwYW4uc2V0QXR0cmlidXRlcyh7XG4gICAgICAgICAgICAgICAgICAgICdodHRwLnN0YXR1c19jb2RlJzogcmVzLnN0YXR1c0NvZGUsXG4gICAgICAgICAgICAgICAgICAgICduZXh0LnJzYyc6IGZhbHNlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgY29uc3Qgcm9vdFNwYW5BdHRyaWJ1dGVzID0gdHJhY2VyLmdldFJvb3RTcGFuQXR0cmlidXRlcygpO1xuICAgICAgICAgICAgICAgIC8vIFdlIHdlcmUgdW5hYmxlIHRvIGdldCBhdHRyaWJ1dGVzLCBwcm9iYWJseSBPVEVMIGlzIG5vdCBlbmFibGVkXG4gICAgICAgICAgICAgICAgaWYgKCFyb290U3BhbkF0dHJpYnV0ZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAocm9vdFNwYW5BdHRyaWJ1dGVzLmdldCgnbmV4dC5zcGFuX3R5cGUnKSAhPT0gQmFzZVNlcnZlclNwYW4uaGFuZGxlUmVxdWVzdCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oYFVuZXhwZWN0ZWQgcm9vdCBzcGFuIHR5cGUgJyR7cm9vdFNwYW5BdHRyaWJ1dGVzLmdldCgnbmV4dC5zcGFuX3R5cGUnKX0nLiBQbGVhc2UgcmVwb3J0IHRoaXMgTmV4dC5qcyBpc3N1ZSBodHRwczovL2dpdGh1Yi5jb20vdmVyY2VsL25leHQuanNgKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb25zdCByb3V0ZSA9IHJvb3RTcGFuQXR0cmlidXRlcy5nZXQoJ25leHQucm91dGUnKTtcbiAgICAgICAgICAgICAgICBpZiAocm91dGUpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbmFtZSA9IGAke21ldGhvZH0gJHtyb3V0ZX1gO1xuICAgICAgICAgICAgICAgICAgICBzcGFuLnNldEF0dHJpYnV0ZXMoe1xuICAgICAgICAgICAgICAgICAgICAgICAgJ25leHQucm91dGUnOiByb3V0ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICdodHRwLnJvdXRlJzogcm91dGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAnbmV4dC5zcGFuX25hbWUnOiBuYW1lXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBzcGFuLnVwZGF0ZU5hbWUobmFtZSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgc3Bhbi51cGRhdGVOYW1lKGAke21ldGhvZH0gJHtyZXEudXJsfWApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAvLyBUT0RPOiBhY3RpdmVTcGFuIGNvZGUgcGF0aCBpcyBmb3Igd2hlbiB3cmFwcGVkIGJ5XG4gICAgICAgIC8vIG5leHQtc2VydmVyIGNhbiBiZSByZW1vdmVkIHdoZW4gdGhpcyBpcyBubyBsb25nZXIgdXNlZFxuICAgICAgICBpZiAoYWN0aXZlU3Bhbikge1xuICAgICAgICAgICAgYXdhaXQgaW52b2tlUm91dGVNb2R1bGUoYWN0aXZlU3Bhbik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBhd2FpdCB0cmFjZXIud2l0aFByb3BhZ2F0ZWRDb250ZXh0KHJlcS5oZWFkZXJzLCAoKT0+dHJhY2VyLnRyYWNlKEJhc2VTZXJ2ZXJTcGFuLmhhbmRsZVJlcXVlc3QsIHtcbiAgICAgICAgICAgICAgICAgICAgc3Bhbk5hbWU6IGAke21ldGhvZH0gJHtyZXEudXJsfWAsXG4gICAgICAgICAgICAgICAgICAgIGtpbmQ6IFNwYW5LaW5kLlNFUlZFUixcbiAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgJ2h0dHAubWV0aG9kJzogbWV0aG9kLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ2h0dHAudGFyZ2V0JzogcmVxLnVybFxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSwgaW52b2tlUm91dGVNb2R1bGUpKTtcbiAgICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAvLyB3ZSByZS10aHJvdyBpbiBkZXYgdG8gc2hvdyB0aGUgZXJyb3Igb3ZlcmxheVxuICAgICAgICBpZiAocm91dGVNb2R1bGUuaXNEZXYpIHtcbiAgICAgICAgICAgIHRocm93IGVycjtcbiAgICAgICAgfVxuICAgICAgICAvLyB0aGlzIGlzIHRlY2huaWNhbGx5IGFuIGludmFyaWFudCBhcyBlcnJvciBoYW5kbGluZ1xuICAgICAgICAvLyBzaG91bGQgYmUgZG9uZSBpbnNpZGUgb2YgYXBpLXJlc29sdmVyIG9uRXJyb3JcbiAgICAgICAgc2VuZEVycm9yKHJlcywgNTAwLCAnSW50ZXJuYWwgU2VydmVyIEVycm9yJyk7XG4gICAgfSBmaW5hbGx5e1xuICAgICAgICAvLyBXZSBkb24ndCBhbGxvdyBhbnkgd2FpdFVudGlsIHdvcmsgaW4gcGFnZXMgQVBJIHJvdXRlcyBjdXJyZW50bHlcbiAgICAgICAgLy8gc28gaWYgY2FsbGJhY2sgaXMgcHJlc2VudCByZXR1cm4gd2l0aCByZXNvbHZlZCBwcm9taXNlIHNpbmNlIG5vXG4gICAgICAgIC8vIHBlbmRpbmcgd29ya1xuICAgICAgICBjdHgud2FpdFVudGlsID09IG51bGwgPyB2b2lkIDAgOiBjdHgud2FpdFVudGlsLmNhbGwoY3R4LCBQcm9taXNlLnJlc29sdmUoKSk7XG4gICAgfVxufVxuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1wYWdlcy1hcGkuanMubWFwXG4iXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fadmin%2Fmanage_products&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fadmin%2Fmanage_products%2Findex.js&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api-node)/./pages/api/admin/manage_products/index.js":
/*!**************************************************!*\
  !*** ./pages/api/admin/manage_products/index.js ***!
  \**************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _lib_middleware_createAdminHandler__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/middleware/createAdminHandler */ \"(api-node)/./lib/middleware/createAdminHandler.js\");\n/* harmony import */ var _lib_productApiUtils__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/productApiUtils */ \"(api-node)/./lib/productApiUtils.js\");\n/* harmony import */ var _lib_cacheHelpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/cacheHelpers */ \"(api-node)/./lib/cacheHelpers.js\");\n/* harmony import */ var _lib_adminApiHandlers_getPaginatedProductsHandler__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/adminApiHandlers/getPaginatedProductsHandler */ \"(api-node)/./lib/adminApiHandlers/getPaginatedProductsHandler.js\");\n/* harmony import */ var _lib_api__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/lib/api */ \"(api-node)/./lib/api.js\");\n/* harmony import */ var _lib_utils_sanitizeProductFields__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @/lib/utils/sanitizeProductFields */ \"(api-node)/./lib/utils/sanitizeProductFields.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_lib_middleware_createAdminHandler__WEBPACK_IMPORTED_MODULE_0__, _lib_productApiUtils__WEBPACK_IMPORTED_MODULE_1__, _lib_adminApiHandlers_getPaginatedProductsHandler__WEBPACK_IMPORTED_MODULE_3__]);\n([_lib_middleware_createAdminHandler__WEBPACK_IMPORTED_MODULE_0__, _lib_productApiUtils__WEBPACK_IMPORTED_MODULE_1__, _lib_adminApiHandlers_getPaginatedProductsHandler__WEBPACK_IMPORTED_MODULE_3__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n// pages/api/admin/manage_products/index.js\n\n\n\n\n\n\n\nconst handler = (0,_lib_middleware_createAdminHandler__WEBPACK_IMPORTED_MODULE_0__.createAdminHandler)({\n    rateLimit: {\n        limit: 60,\n        window: 60\n    } // Optional: customize rate limit per route\n});\n// ðŸ§¾ GET: Paginated Products\n// pages/api/admin/manage_products/index.js\nhandler.get(async (req, res)=>{\n    console.log('[DEBUG] reached handler.get for /api/admin/manage_products');\n    console.log('[admin]', req.rid, 'handler.get START', req.url);\n    const t0 = Date.now();\n    try {\n        await (0,_lib_adminApiHandlers_getPaginatedProductsHandler__WEBPACK_IMPORTED_MODULE_3__.handleGetPaginatedProducts)(req, res);\n    } finally{\n        console.log('[admin]', req.rid, 'handler.get END in', Date.now() - t0, 'ms');\n    }\n});\n// âž• POST: Create Product\nhandler.post(async (req, res)=>{\n    const rawProduct = req.body;\n    const sanitized = (0,_lib_utils_sanitizeProductFields__WEBPACK_IMPORTED_MODULE_5__.sanitizeProductFields)(rawProduct);\n    const validationError = (0,_lib_api__WEBPACK_IMPORTED_MODULE_4__.validateProductData)(sanitized);\n    if (validationError) {\n        return (0,_lib_api__WEBPACK_IMPORTED_MODULE_4__.sendErrorResponse)(res, 400, validationError);\n    }\n    try {\n        const result = await (0,_lib_productApiUtils__WEBPACK_IMPORTED_MODULE_1__.insertProduct)(sanitized);\n        const product = {\n            id: result.lastID,\n            ...sanitized\n        };\n        await (0,_lib_cacheHelpers__WEBPACK_IMPORTED_MODULE_2__.clearProductsCache)();\n        return (0,_lib_api__WEBPACK_IMPORTED_MODULE_4__.sendSuccessResponse)(res, 201, 'Product created successfully', {\n            product\n        });\n    } catch (err) {\n        console.error('âŒ Insert Error:', err);\n        return (0,_lib_api__WEBPACK_IMPORTED_MODULE_4__.sendErrorResponse)(res, 500, 'Failed to create product');\n    }\n});\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (handler);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL3BhZ2VzL2FwaS9hZG1pbi9tYW5hZ2VfcHJvZHVjdHMvaW5kZXguanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7OztBQUFBLDJDQUEyQztBQUM4QjtBQUNuQjtBQUNFO0FBQ3dDO0FBQ2xEO0FBQzRCO0FBQ0w7QUFFckUsTUFBTVEsVUFBVVIsc0ZBQWtCQSxDQUFDO0lBQ2pDUyxXQUFXO1FBQUVDLE9BQU87UUFBSUMsUUFBUTtJQUFHLEVBQUUsMkNBQTJDO0FBQ2xGO0FBRUEsNkJBQTZCO0FBQzdCLDJDQUEyQztBQUMzQ0gsUUFBUUksR0FBRyxDQUFDLE9BQU9DLEtBQUtDO0lBQ3RCQyxRQUFRQyxHQUFHLENBQUM7SUFDWkQsUUFBUUMsR0FBRyxDQUFDLFdBQVdILElBQUlJLEdBQUcsRUFBRSxxQkFBcUJKLElBQUlLLEdBQUc7SUFDNUQsTUFBTUMsS0FBS0MsS0FBS0MsR0FBRztJQUNuQixJQUFJO1FBQ0YsTUFBTWxCLDZHQUEwQkEsQ0FBQ1UsS0FBS0M7SUFDeEMsU0FBVTtRQUNSQyxRQUFRQyxHQUFHLENBQUMsV0FBV0gsSUFBSUksR0FBRyxFQUFFLHNCQUFzQkcsS0FBS0MsR0FBRyxLQUFLRixJQUFJO0lBQ3pFO0FBQ0Y7QUFHQSx5QkFBeUI7QUFDekJYLFFBQVFjLElBQUksQ0FBQyxPQUFPVCxLQUFLQztJQUN2QixNQUFNUyxhQUFhVixJQUFJVyxJQUFJO0lBRTNCLE1BQU1DLFlBQVlwQix1RkFBcUJBLENBQUNrQjtJQUN4QyxNQUFNRyxrQkFBa0JwQiw2REFBbUJBLENBQUNtQjtJQUU1QyxJQUFJQyxpQkFBaUI7UUFDbkIsT0FBT3RCLDJEQUFpQkEsQ0FBQ1UsS0FBSyxLQUFLWTtJQUNyQztJQUVBLElBQUk7UUFDRixNQUFNQyxTQUFTLE1BQU0xQixtRUFBYUEsQ0FBQ3dCO1FBQ25DLE1BQU1HLFVBQVU7WUFBRUMsSUFBSUYsT0FBT0csTUFBTTtZQUFFLEdBQUdMLFNBQVM7UUFBQztRQUVsRCxNQUFNdkIscUVBQWtCQTtRQUV4QixPQUFPSyw2REFBbUJBLENBQUNPLEtBQUssS0FBSyxnQ0FBZ0M7WUFBRWM7UUFBUTtJQUNqRixFQUFFLE9BQU9HLEtBQUs7UUFDWmhCLFFBQVFpQixLQUFLLENBQUMsbUJBQW1CRDtRQUNqQyxPQUFPM0IsMkRBQWlCQSxDQUFDVSxLQUFLLEtBQUs7SUFDckM7QUFDRjtBQUVBLGlFQUFlTixPQUFPQSxFQUFDIiwic291cmNlcyI6WyIvVXNlcnMvZW1vbnRhemVyaS9Eb2N1bWVudHMvcHJvamVjdHMvc2hlbGwtc3Rvcmllcy1zdHVkaW8vcGFnZXMvYXBpL2FkbWluL21hbmFnZV9wcm9kdWN0cy9pbmRleC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBwYWdlcy9hcGkvYWRtaW4vbWFuYWdlX3Byb2R1Y3RzL2luZGV4LmpzXG5pbXBvcnQgeyBjcmVhdGVBZG1pbkhhbmRsZXIgfSBmcm9tICdAL2xpYi9taWRkbGV3YXJlL2NyZWF0ZUFkbWluSGFuZGxlcic7XG5pbXBvcnQgeyBpbnNlcnRQcm9kdWN0IH0gZnJvbSAnQC9saWIvcHJvZHVjdEFwaVV0aWxzJztcbmltcG9ydCB7IGNsZWFyUHJvZHVjdHNDYWNoZSB9IGZyb20gJ0AvbGliL2NhY2hlSGVscGVycyc7XG5pbXBvcnQgeyBoYW5kbGVHZXRQYWdpbmF0ZWRQcm9kdWN0cyB9IGZyb20gJ0AvbGliL2FkbWluQXBpSGFuZGxlcnMvZ2V0UGFnaW5hdGVkUHJvZHVjdHNIYW5kbGVyJztcbmltcG9ydCB7IHNlbmRFcnJvclJlc3BvbnNlIH0gZnJvbSAnQC9saWIvYXBpJztcbmltcG9ydCB7IHNhbml0aXplUHJvZHVjdEZpZWxkcyB9IGZyb20gJ0AvbGliL3V0aWxzL3Nhbml0aXplUHJvZHVjdEZpZWxkcyc7XG5pbXBvcnQgeyB2YWxpZGF0ZVByb2R1Y3REYXRhLCBzZW5kU3VjY2Vzc1Jlc3BvbnNlIH0gZnJvbSAnQC9saWIvYXBpJztcblxuY29uc3QgaGFuZGxlciA9IGNyZWF0ZUFkbWluSGFuZGxlcih7XG4gIHJhdGVMaW1pdDogeyBsaW1pdDogNjAsIHdpbmRvdzogNjAgfSAvLyBPcHRpb25hbDogY3VzdG9taXplIHJhdGUgbGltaXQgcGVyIHJvdXRlXG59KTtcblxuLy8g8J+nviBHRVQ6IFBhZ2luYXRlZCBQcm9kdWN0c1xuLy8gcGFnZXMvYXBpL2FkbWluL21hbmFnZV9wcm9kdWN0cy9pbmRleC5qc1xuaGFuZGxlci5nZXQoYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIGNvbnNvbGUubG9nKCdbREVCVUddIHJlYWNoZWQgaGFuZGxlci5nZXQgZm9yIC9hcGkvYWRtaW4vbWFuYWdlX3Byb2R1Y3RzJyk7XG4gIGNvbnNvbGUubG9nKCdbYWRtaW5dJywgcmVxLnJpZCwgJ2hhbmRsZXIuZ2V0IFNUQVJUJywgcmVxLnVybCk7XG4gIGNvbnN0IHQwID0gRGF0ZS5ub3coKTtcbiAgdHJ5IHtcbiAgICBhd2FpdCBoYW5kbGVHZXRQYWdpbmF0ZWRQcm9kdWN0cyhyZXEsIHJlcyk7XG4gIH0gZmluYWxseSB7XG4gICAgY29uc29sZS5sb2coJ1thZG1pbl0nLCByZXEucmlkLCAnaGFuZGxlci5nZXQgRU5EIGluJywgRGF0ZS5ub3coKSAtIHQwLCAnbXMnKTtcbiAgfVxufSk7XG5cblxuLy8g4p6VIFBPU1Q6IENyZWF0ZSBQcm9kdWN0XG5oYW5kbGVyLnBvc3QoYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIGNvbnN0IHJhd1Byb2R1Y3QgPSByZXEuYm9keTtcblxuICBjb25zdCBzYW5pdGl6ZWQgPSBzYW5pdGl6ZVByb2R1Y3RGaWVsZHMocmF3UHJvZHVjdCk7XG4gIGNvbnN0IHZhbGlkYXRpb25FcnJvciA9IHZhbGlkYXRlUHJvZHVjdERhdGEoc2FuaXRpemVkKTtcblxuICBpZiAodmFsaWRhdGlvbkVycm9yKSB7XG4gICAgcmV0dXJuIHNlbmRFcnJvclJlc3BvbnNlKHJlcywgNDAwLCB2YWxpZGF0aW9uRXJyb3IpO1xuICB9XG5cbiAgdHJ5IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBpbnNlcnRQcm9kdWN0KHNhbml0aXplZCk7XG4gICAgY29uc3QgcHJvZHVjdCA9IHsgaWQ6IHJlc3VsdC5sYXN0SUQsIC4uLnNhbml0aXplZCB9O1xuXG4gICAgYXdhaXQgY2xlYXJQcm9kdWN0c0NhY2hlKCk7XG5cbiAgICByZXR1cm4gc2VuZFN1Y2Nlc3NSZXNwb25zZShyZXMsIDIwMSwgJ1Byb2R1Y3QgY3JlYXRlZCBzdWNjZXNzZnVsbHknLCB7IHByb2R1Y3QgfSk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBJbnNlcnQgRXJyb3I6JywgZXJyKTtcbiAgICByZXR1cm4gc2VuZEVycm9yUmVzcG9uc2UocmVzLCA1MDAsICdGYWlsZWQgdG8gY3JlYXRlIHByb2R1Y3QnKTtcbiAgfVxufSk7XG5cbmV4cG9ydCBkZWZhdWx0IGhhbmRsZXI7XG5cblxuXG5cblxuXG5cblxuIl0sIm5hbWVzIjpbImNyZWF0ZUFkbWluSGFuZGxlciIsImluc2VydFByb2R1Y3QiLCJjbGVhclByb2R1Y3RzQ2FjaGUiLCJoYW5kbGVHZXRQYWdpbmF0ZWRQcm9kdWN0cyIsInNlbmRFcnJvclJlc3BvbnNlIiwic2FuaXRpemVQcm9kdWN0RmllbGRzIiwidmFsaWRhdGVQcm9kdWN0RGF0YSIsInNlbmRTdWNjZXNzUmVzcG9uc2UiLCJoYW5kbGVyIiwicmF0ZUxpbWl0IiwibGltaXQiLCJ3aW5kb3ciLCJnZXQiLCJyZXEiLCJyZXMiLCJjb25zb2xlIiwibG9nIiwicmlkIiwidXJsIiwidDAiLCJEYXRlIiwibm93IiwicG9zdCIsInJhd1Byb2R1Y3QiLCJib2R5Iiwic2FuaXRpemVkIiwidmFsaWRhdGlvbkVycm9yIiwicmVzdWx0IiwicHJvZHVjdCIsImlkIiwibGFzdElEIiwiZXJyIiwiZXJyb3IiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api-node)/./pages/api/admin/manage_products/index.js\n");

/***/ }),

/***/ "@upstash/redis":
/*!*********************************!*\
  !*** external "@upstash/redis" ***!
  \*********************************/
/***/ ((module) => {

module.exports = import("@upstash/redis");;

/***/ }),

/***/ "next-auth/jwt":
/*!********************************!*\
  !*** external "next-auth/jwt" ***!
  \********************************/
/***/ ((module) => {

module.exports = require("next-auth/jwt");

/***/ }),

/***/ "next-connect":
/*!*******************************!*\
  !*** external "next-connect" ***!
  \*******************************/
/***/ ((module) => {

module.exports = import("next-connect");;

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "redis":
/*!************************!*\
  !*** external "redis" ***!
  \************************/
/***/ ((module) => {

module.exports = require("redis");

/***/ }),

/***/ "sanitize-html":
/*!********************************!*\
  !*** external "sanitize-html" ***!
  \********************************/
/***/ ((module) => {

module.exports = require("sanitize-html");

/***/ }),

/***/ "sqlite":
/*!*************************!*\
  !*** external "sqlite" ***!
  \*************************/
/***/ ((module) => {

module.exports = import("sqlite");;

/***/ }),

/***/ "sqlite3":
/*!**************************!*\
  !*** external "sqlite3" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("sqlite3");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fadmin%2Fmanage_products&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fadmin%2Fmanage_products%2Findex.js&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();