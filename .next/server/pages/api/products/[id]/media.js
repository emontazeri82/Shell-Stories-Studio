"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/products/[id]/media";
exports.ids = ["pages/api/products/[id]/media"];
exports.modules = {

/***/ "(api-node)/./lib/api.js":
/*!********************!*\
  !*** ./lib/api.js ***!
  \********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   __utils: () => (/* binding */ __utils),\n/* harmony export */   searchProducts: () => (/* binding */ searchProducts),\n/* harmony export */   sendErrorResponse: () => (/* binding */ sendErrorResponse),\n/* harmony export */   sendSuccessResponse: () => (/* binding */ sendSuccessResponse),\n/* harmony export */   validateProductData: () => (/* binding */ validateProductData)\n/* harmony export */ });\n// lib/api.js\n/** ---------------------------\n * Small, reuseable utilities\n * --------------------------*/ const isFiniteNumber = (v)=>typeof v === 'number' && Number.isFinite(v);\nconst isHttpUrl = (s)=>{\n    if (typeof s !== 'string' || s.trim() === '') return false;\n    try {\n        const u = new URL(s);\n        return u.protocol === 'http:' || u.protocol === 'https:';\n    } catch  {\n        return false;\n    }\n};\n/** -------------------------------------------------------\n * Standardized JSON responses (never leak HTML to clients)\n * ------------------------------------------------------*/ const sendSuccessResponse = (res, statusCode, message, data = {})=>{\n    // Ensure we always spread a plain object (avoid null/array surprises)\n    const payload = data && typeof data === 'object' && !Array.isArray(data) ? data : {};\n    res.status(statusCode).json({\n        success: true,\n        message,\n        ...payload\n    });\n};\nconst sendErrorResponse = (res, statusCode, message, error = null)=>{\n    // Normalize non-serializable errors\n    let errOut = error;\n    if (error instanceof Error) {\n        errOut = {\n            name: error.name,\n            message: error.message,\n            stack:  true ? error.stack : 0\n        };\n    } else if (error && typeof error === 'object') {\n        try {\n            JSON.stringify(error);\n        } catch  {\n            errOut = String(error);\n        }\n    }\n    res.status(statusCode).json({\n        success: false,\n        message,\n        error: errOut\n    });\n};\n/** -------------------------------------------------------\n * Product payload validation (partial-safe, used for PATCH)\n * Pass only fields you intend to change.\n * Returns `null` when valid, or a string message on error.\n * ------------------------------------------------------*/ const validateProductData = (data)=>{\n    // Guard against non-objects\n    if (!data || typeof data !== 'object') return 'Payload must be an object';\n    const { name, description, price, stock, image_url, category, is_active, is_favorite } = data;\n    // name: optional, if present must be non-empty <= 100\n    if (name !== undefined) {\n        if (typeof name !== 'string' || name.trim().length === 0) {\n            return 'Name must be a non-empty string';\n        }\n        if (name.length > 100) return 'Name is too long (max 100 chars)';\n    }\n    // description: optional string <= 1000\n    if (description !== undefined) {\n        if (typeof description !== 'string') return 'Description must be a string';\n        if (description.length > 1000) return 'Description is too long (max 1000 chars)';\n    }\n    // price: number > 0\n    if (price !== undefined) {\n        if (!isFiniteNumber(price) || price <= 0) return 'Price must be a positive number';\n    }\n    // stock: number >= 0 (integers preferred; DB has CHECK >= 0)\n    if (stock !== undefined) {\n        if (!isFiniteNumber(stock) || stock < 0) return 'Stock must be a non-negative number';\n    }\n    // image_url: allow empty/omitted; if present and non-empty must be http(s)\n    if (image_url !== undefined) {\n        if (image_url === '' || image_url === null) {\n        // allow blank (main image can come from media gallery)\n        } else if (!isHttpUrl(image_url)) {\n            return 'Image URL must be a valid http(s) URL';\n        }\n    }\n    // category: optional string <= 50\n    if (category !== undefined) {\n        if (typeof category !== 'string' || category.length > 50) {\n            return 'Category must be a string under 50 characters';\n        }\n    }\n    // is_active: must be 0 or 1 (null permitted if you intentionally clear it)\n    if (is_active !== undefined) {\n        if (![\n            0,\n            1,\n            null\n        ].includes(is_active)) return 'is_active must be 0, 1, or null';\n    }\n    // is_favorite: must be 0 or 1\n    if (is_favorite !== undefined) {\n        if (![\n            0,\n            1\n        ].includes(is_favorite)) return 'is_favorite must be 0 or 1';\n    }\n    return null; // âœ… valid\n};\n/** -------------------------------------------------------\n * Server-only search helper (lazy imports so client bundles are safe)\n * ------------------------------------------------------*/ const searchProducts = async (query)=>{\n    const { open } = await Promise.resolve(/*! import() */).then(__webpack_require__.bind(__webpack_require__, /*! sqlite */ \"sqlite\"));\n    const sqlite3 = (await Promise.resolve(/*! import() */).then(__webpack_require__.t.bind(__webpack_require__, /*! sqlite3 */ \"sqlite3\", 23))).default;\n    const path = (await Promise.resolve(/*! import() */).then(__webpack_require__.t.bind(__webpack_require__, /*! path */ \"path\", 23))).default;\n    const dbPath = path.join(process.cwd(), 'data', 'shells_shop.db');\n    const db = await open({\n        filename: dbPath,\n        driver: sqlite3.Database\n    });\n    try {\n        // Use parameterized LIKE to avoid injection; wrap in % on both sides\n        const q = String(query ?? '').trim();\n        if (!q) return [];\n        return await db.all(`SELECT * FROM products\n       WHERE name LIKE ? OR description LIKE ?\n       ORDER BY id DESC`, [\n            `%${q}%`,\n            `%${q}%`\n        ]);\n    } catch (err) {\n        console.error('âŒ searchProducts failed:', err);\n        throw new Error('Failed to search products');\n    } finally{\n        try {\n            await db.close();\n        } catch  {}\n    }\n};\n// (Optionally) export the tiny helpers if you want to reuse elsewhere:\nconst __utils = {\n    isFiniteNumber,\n    isHttpUrl\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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S0FBSztRQUNaQyxRQUFRcEMsS0FBSyxDQUFDLDRCQUE0Qm1DO1FBQzFDLE1BQU0sSUFBSWpDLE1BQU07SUFDbEIsU0FBVTtRQUNSLElBQUk7WUFBRSxNQUFNMkIsR0FBR1EsS0FBSztRQUFJLEVBQUUsT0FBTSxDQUFDO0lBQ25DO0FBQ0YsRUFBRTtBQUVGLHVFQUF1RTtBQUNoRSxNQUFNQyxVQUFVO0lBQUU1RDtJQUFnQkk7QUFBVSxFQUFFIiwic291cmNlcyI6WyIvVXNlcnMvZW1vbnRhemVyaS9Eb2N1bWVudHMvcHJvamVjdHMvc2hlbGwtc3Rvcmllcy1zdHVkaW8vbGliL2FwaS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBsaWIvYXBpLmpzXG5cbi8qKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAqIFNtYWxsLCByZXVzZWFibGUgdXRpbGl0aWVzXG4gKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5jb25zdCBpc0Zpbml0ZU51bWJlciA9ICh2KSA9PiB0eXBlb2YgdiA9PT0gJ251bWJlcicgJiYgTnVtYmVyLmlzRmluaXRlKHYpO1xuY29uc3QgaXNIdHRwVXJsID0gKHMpID0+IHtcbiAgaWYgKHR5cGVvZiBzICE9PSAnc3RyaW5nJyB8fCBzLnRyaW0oKSA9PT0gJycpIHJldHVybiBmYWxzZTtcbiAgdHJ5IHtcbiAgICBjb25zdCB1ID0gbmV3IFVSTChzKTtcbiAgICByZXR1cm4gdS5wcm90b2NvbCA9PT0gJ2h0dHA6JyB8fCB1LnByb3RvY29sID09PSAnaHR0cHM6JztcbiAgfSBjYXRjaCB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG59O1xuXG4vKiogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICogU3RhbmRhcmRpemVkIEpTT04gcmVzcG9uc2VzIChuZXZlciBsZWFrIEhUTUwgdG8gY2xpZW50cylcbiAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5leHBvcnQgY29uc3Qgc2VuZFN1Y2Nlc3NSZXNwb25zZSA9IChyZXMsIHN0YXR1c0NvZGUsIG1lc3NhZ2UsIGRhdGEgPSB7fSkgPT4ge1xuICAvLyBFbnN1cmUgd2UgYWx3YXlzIHNwcmVhZCBhIHBsYWluIG9iamVjdCAoYXZvaWQgbnVsbC9hcnJheSBzdXJwcmlzZXMpXG4gIGNvbnN0IHBheWxvYWQgPSAoZGF0YSAmJiB0eXBlb2YgZGF0YSA9PT0gJ29iamVjdCcgJiYgIUFycmF5LmlzQXJyYXkoZGF0YSkpID8gZGF0YSA6IHt9O1xuICByZXMuc3RhdHVzKHN0YXR1c0NvZGUpLmpzb24oe1xuICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgbWVzc2FnZSxcbiAgICAuLi5wYXlsb2FkLFxuICB9KTtcbn07XG5cbmV4cG9ydCBjb25zdCBzZW5kRXJyb3JSZXNwb25zZSA9IChyZXMsIHN0YXR1c0NvZGUsIG1lc3NhZ2UsIGVycm9yID0gbnVsbCkgPT4ge1xuICAvLyBOb3JtYWxpemUgbm9uLXNlcmlhbGl6YWJsZSBlcnJvcnNcbiAgbGV0IGVyck91dCA9IGVycm9yO1xuICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBFcnJvcikge1xuICAgIGVyck91dCA9IHsgbmFtZTogZXJyb3IubmFtZSwgbWVzc2FnZTogZXJyb3IubWVzc2FnZSwgc3RhY2s6IHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnID8gZXJyb3Iuc3RhY2sgOiB1bmRlZmluZWQgfTtcbiAgfSBlbHNlIGlmIChlcnJvciAmJiB0eXBlb2YgZXJyb3IgPT09ICdvYmplY3QnKSB7XG4gICAgdHJ5IHsgSlNPTi5zdHJpbmdpZnkoZXJyb3IpOyB9IGNhdGNoIHsgZXJyT3V0ID0gU3RyaW5nKGVycm9yKTsgfVxuICB9XG4gIHJlcy5zdGF0dXMoc3RhdHVzQ29kZSkuanNvbih7XG4gICAgc3VjY2VzczogZmFsc2UsXG4gICAgbWVzc2FnZSxcbiAgICBlcnJvcjogZXJyT3V0LFxuICB9KTtcbn07XG5cbi8qKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gKiBQcm9kdWN0IHBheWxvYWQgdmFsaWRhdGlvbiAocGFydGlhbC1zYWZlLCB1c2VkIGZvciBQQVRDSClcbiAqIFBhc3Mgb25seSBmaWVsZHMgeW91IGludGVuZCB0byBjaGFuZ2UuXG4gKiBSZXR1cm5zIGBudWxsYCB3aGVuIHZhbGlkLCBvciBhIHN0cmluZyBtZXNzYWdlIG9uIGVycm9yLlxuICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cbmV4cG9ydCBjb25zdCB2YWxpZGF0ZVByb2R1Y3REYXRhID0gKGRhdGEpID0+IHtcbiAgLy8gR3VhcmQgYWdhaW5zdCBub24tb2JqZWN0c1xuICBpZiAoIWRhdGEgfHwgdHlwZW9mIGRhdGEgIT09ICdvYmplY3QnKSByZXR1cm4gJ1BheWxvYWQgbXVzdCBiZSBhbiBvYmplY3QnO1xuXG4gIGNvbnN0IHtcbiAgICBuYW1lLFxuICAgIGRlc2NyaXB0aW9uLFxuICAgIHByaWNlLFxuICAgIHN0b2NrLFxuICAgIGltYWdlX3VybCxcbiAgICBjYXRlZ29yeSxcbiAgICBpc19hY3RpdmUsXG4gICAgaXNfZmF2b3JpdGUsXG4gIH0gPSBkYXRhO1xuXG4gIC8vIG5hbWU6IG9wdGlvbmFsLCBpZiBwcmVzZW50IG11c3QgYmUgbm9uLWVtcHR5IDw9IDEwMFxuICBpZiAobmFtZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgaWYgKHR5cGVvZiBuYW1lICE9PSAnc3RyaW5nJyB8fCBuYW1lLnRyaW0oKS5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiAnTmFtZSBtdXN0IGJlIGEgbm9uLWVtcHR5IHN0cmluZyc7XG4gICAgfVxuICAgIGlmIChuYW1lLmxlbmd0aCA+IDEwMCkgcmV0dXJuICdOYW1lIGlzIHRvbyBsb25nIChtYXggMTAwIGNoYXJzKSc7XG4gIH1cblxuICAvLyBkZXNjcmlwdGlvbjogb3B0aW9uYWwgc3RyaW5nIDw9IDEwMDBcbiAgaWYgKGRlc2NyaXB0aW9uICE9PSB1bmRlZmluZWQpIHtcbiAgICBpZiAodHlwZW9mIGRlc2NyaXB0aW9uICE9PSAnc3RyaW5nJykgcmV0dXJuICdEZXNjcmlwdGlvbiBtdXN0IGJlIGEgc3RyaW5nJztcbiAgICBpZiAoZGVzY3JpcHRpb24ubGVuZ3RoID4gMTAwMCkgcmV0dXJuICdEZXNjcmlwdGlvbiBpcyB0b28gbG9uZyAobWF4IDEwMDAgY2hhcnMpJztcbiAgfVxuXG4gIC8vIHByaWNlOiBudW1iZXIgPiAwXG4gIGlmIChwcmljZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgaWYgKCFpc0Zpbml0ZU51bWJlcihwcmljZSkgfHwgcHJpY2UgPD0gMCkgcmV0dXJuICdQcmljZSBtdXN0IGJlIGEgcG9zaXRpdmUgbnVtYmVyJztcbiAgfVxuXG4gIC8vIHN0b2NrOiBudW1iZXIgPj0gMCAoaW50ZWdlcnMgcHJlZmVycmVkOyBEQiBoYXMgQ0hFQ0sgPj0gMClcbiAgaWYgKHN0b2NrICE9PSB1bmRlZmluZWQpIHtcbiAgICBpZiAoIWlzRmluaXRlTnVtYmVyKHN0b2NrKSB8fCBzdG9jayA8IDApIHJldHVybiAnU3RvY2sgbXVzdCBiZSBhIG5vbi1uZWdhdGl2ZSBudW1iZXInO1xuICB9XG5cbiAgLy8gaW1hZ2VfdXJsOiBhbGxvdyBlbXB0eS9vbWl0dGVkOyBpZiBwcmVzZW50IGFuZCBub24tZW1wdHkgbXVzdCBiZSBodHRwKHMpXG4gIGlmIChpbWFnZV91cmwgIT09IHVuZGVmaW5lZCkge1xuICAgIGlmIChpbWFnZV91cmwgPT09ICcnIHx8IGltYWdlX3VybCA9PT0gbnVsbCkge1xuICAgICAgLy8gYWxsb3cgYmxhbmsgKG1haW4gaW1hZ2UgY2FuIGNvbWUgZnJvbSBtZWRpYSBnYWxsZXJ5KVxuICAgIH0gZWxzZSBpZiAoIWlzSHR0cFVybChpbWFnZV91cmwpKSB7XG4gICAgICByZXR1cm4gJ0ltYWdlIFVSTCBtdXN0IGJlIGEgdmFsaWQgaHR0cChzKSBVUkwnO1xuICAgIH1cbiAgfVxuXG4gIC8vIGNhdGVnb3J5OiBvcHRpb25hbCBzdHJpbmcgPD0gNTBcbiAgaWYgKGNhdGVnb3J5ICE9PSB1bmRlZmluZWQpIHtcbiAgICBpZiAodHlwZW9mIGNhdGVnb3J5ICE9PSAnc3RyaW5nJyB8fCBjYXRlZ29yeS5sZW5ndGggPiA1MCkge1xuICAgICAgcmV0dXJuICdDYXRlZ29yeSBtdXN0IGJlIGEgc3RyaW5nIHVuZGVyIDUwIGNoYXJhY3RlcnMnO1xuICAgIH1cbiAgfVxuXG4gIC8vIGlzX2FjdGl2ZTogbXVzdCBiZSAwIG9yIDEgKG51bGwgcGVybWl0dGVkIGlmIHlvdSBpbnRlbnRpb25hbGx5IGNsZWFyIGl0KVxuICBpZiAoaXNfYWN0aXZlICE9PSB1bmRlZmluZWQpIHtcbiAgICBpZiAoIVswLCAxLCBudWxsXS5pbmNsdWRlcyhpc19hY3RpdmUpKSByZXR1cm4gJ2lzX2FjdGl2ZSBtdXN0IGJlIDAsIDEsIG9yIG51bGwnO1xuICB9XG5cbiAgLy8gaXNfZmF2b3JpdGU6IG11c3QgYmUgMCBvciAxXG4gIGlmIChpc19mYXZvcml0ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgaWYgKCFbMCwgMV0uaW5jbHVkZXMoaXNfZmF2b3JpdGUpKSByZXR1cm4gJ2lzX2Zhdm9yaXRlIG11c3QgYmUgMCBvciAxJztcbiAgfVxuXG4gIHJldHVybiBudWxsOyAvLyDinIUgdmFsaWRcbn07XG5cbi8qKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gKiBTZXJ2ZXItb25seSBzZWFyY2ggaGVscGVyIChsYXp5IGltcG9ydHMgc28gY2xpZW50IGJ1bmRsZXMgYXJlIHNhZmUpXG4gKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuZXhwb3J0IGNvbnN0IHNlYXJjaFByb2R1Y3RzID0gYXN5bmMgKHF1ZXJ5KSA9PiB7XG4gIGNvbnN0IHsgb3BlbiB9ID0gYXdhaXQgaW1wb3J0KCdzcWxpdGUnKTtcbiAgY29uc3Qgc3FsaXRlMyA9IChhd2FpdCBpbXBvcnQoJ3NxbGl0ZTMnKSkuZGVmYXVsdDtcbiAgY29uc3QgcGF0aCA9IChhd2FpdCBpbXBvcnQoJ3BhdGgnKSkuZGVmYXVsdDtcblxuICBjb25zdCBkYlBhdGggPSBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgJ2RhdGEnLCAnc2hlbGxzX3Nob3AuZGInKTtcbiAgY29uc3QgZGIgPSBhd2FpdCBvcGVuKHsgZmlsZW5hbWU6IGRiUGF0aCwgZHJpdmVyOiBzcWxpdGUzLkRhdGFiYXNlIH0pO1xuXG4gIHRyeSB7XG4gICAgLy8gVXNlIHBhcmFtZXRlcml6ZWQgTElLRSB0byBhdm9pZCBpbmplY3Rpb247IHdyYXAgaW4gJSBvbiBib3RoIHNpZGVzXG4gICAgY29uc3QgcSA9IFN0cmluZyhxdWVyeSA/PyAnJykudHJpbSgpO1xuICAgIGlmICghcSkgcmV0dXJuIFtdO1xuICAgIHJldHVybiBhd2FpdCBkYi5hbGwoXG4gICAgICBgU0VMRUNUICogRlJPTSBwcm9kdWN0c1xuICAgICAgIFdIRVJFIG5hbWUgTElLRSA/IE9SIGRlc2NyaXB0aW9uIExJS0UgP1xuICAgICAgIE9SREVSIEJZIGlkIERFU0NgLFxuICAgICAgW2AlJHtxfSVgLCBgJSR7cX0lYF1cbiAgICApO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBjb25zb2xlLmVycm9yKCfinYwgc2VhcmNoUHJvZHVjdHMgZmFpbGVkOicsIGVycik7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgdG8gc2VhcmNoIHByb2R1Y3RzJyk7XG4gIH0gZmluYWxseSB7XG4gICAgdHJ5IHsgYXdhaXQgZGIuY2xvc2UoKTsgfSBjYXRjaCB7fVxuICB9XG59O1xuXG4vLyAoT3B0aW9uYWxseSkgZXhwb3J0IHRoZSB0aW55IGhlbHBlcnMgaWYgeW91IHdhbnQgdG8gcmV1c2UgZWxzZXdoZXJlOlxuZXhwb3J0IGNvbnN0IF9fdXRpbHMgPSB7IGlzRmluaXRlTnVtYmVyLCBpc0h0dHBVcmwgfTtcblxuIl0sIm5hbWVzIjpbImlzRmluaXRlTnVtYmVyIiwidiIsIk51bWJlciIsImlzRmluaXRlIiwiaXNIdHRwVXJsIiwicyIsInRyaW0iLCJ1IiwiVVJMIiwicHJvdG9jb2wiLCJzZW5kU3VjY2Vzc1Jlc3BvbnNlIiwicmVzIiwic3RhdHVzQ29kZSIsIm1lc3NhZ2UiLCJkYXRhIiwicGF5bG9hZCIsIkFycmF5IiwiaXNBcnJheSIsInN0YXR1cyIsImpzb24iLCJzdWNjZXNzIiwic2VuZEVycm9yUmVzcG9uc2UiLCJlcnJvciIsImVyck91dCIsIkVycm9yIiwibmFtZSIsInN0YWNrIiwicHJvY2VzcyIsInVuZGVmaW5lZCIsIkpTT04iLCJzdHJpbmdpZnkiLCJTdHJpbmciLCJ2YWxpZGF0ZVByb2R1Y3REYXRhIiwiZGVzY3JpcHRpb24iLCJwcmljZSIsInN0b2NrIiwiaW1hZ2VfdXJsIiwiY2F0ZWdvcnkiLCJpc19hY3RpdmUiLCJpc19mYXZvcml0ZSIsImxlbmd0aCIsImluY2x1ZGVzIiwic2VhcmNoUHJvZHVjdHMiLCJxdWVyeSIsIm9wZW4iLCJzcWxpdGUzIiwiZGVmYXVsdCIsInBhdGgiLCJkYlBhdGgiLCJqb2luIiwiY3dkIiwiZGIiLCJmaWxlbmFtZSIsImRyaXZlciIsIkRhdGFiYXNlIiwicSIsImFsbCIsImVyciIsImNvbnNvbGUiLCJjbG9zZSIsIl9fdXRpbHMiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api-node)/./lib/api.js\n");

/***/ }),

/***/ "(api-node)/./lib/auth/authorizeAdmin.js":
/*!************************************!*\
  !*** ./lib/auth/authorizeAdmin.js ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ROLES: () => (/* binding */ ROLES),\n/* harmony export */   authorizeAdmin: () => (/* binding */ authorizeAdmin),\n/* harmony export */   withAdmin: () => (/* binding */ withAdmin)\n/* harmony export */ });\n/* harmony import */ var next_auth_jwt__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next-auth/jwt */ \"next-auth/jwt\");\n/* harmony import */ var next_auth_jwt__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_auth_jwt__WEBPACK_IMPORTED_MODULE_0__);\n// lib/auth/authorizeAdmin.js\n\nconst ROLES = {\n    ADMIN: 'ADMIN',\n    USER: 'USER'\n};\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n// Helper utilities\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nfunction wantsJson(req) {\n    const url = req.url || '';\n    const accept = String(req.headers?.accept || '').toLowerCase();\n    const xrw = String(req.headers?.['x-requested-with'] || '').toLowerCase();\n    return url.startsWith('/api/') || accept.includes('application/json') || xrw === 'xmlhttprequest';\n}\nfunction safeCallbackUrl(req) {\n    try {\n        const u = new URL(req.url, `http://${req.headers.host || 'localhost'}`);\n        return u.pathname + u.search; // same-origin path only\n    } catch  {\n        return '/';\n    }\n}\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n// Core middleware\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nfunction authorizeAdmin(loginPath = '/admin/login') {\n    console.log('[authorizeAdmin] middleware initialized');\n    return async function guard(req, res, next) {\n        const rid = req.rid || '-';\n        const t0 = Date.now();\n        console.log('[authorizeAdmin]', rid, 'ENTER for', req.method, req.url);\n        try {\n            console.log('[authorizeAdmin]', 'EXECUTION ENTERED for', req.method, req.url);\n            // ðŸ”‘ Try reading the session token\n            const token = await (0,next_auth_jwt__WEBPACK_IMPORTED_MODULE_0__.getToken)({\n                req,\n                secret: process.env.NEXTAUTH_SECRET\n            });\n            console.log('[authorizeAdmin]', rid, 'token check â†’', token ? 'FOUND' : 'MISSING', 'role:', token?.role);\n            if (!token) {\n                console.warn('[authorizeAdmin]', rid, 'NO TOKEN (unauthenticated)');\n                if (wantsJson(req)) {\n                    console.log('[authorizeAdmin]', rid, 'â†’ returning 401 JSON');\n                    return res.status(401).json({\n                        ok: false,\n                        code: 'UNAUTHENTICATED',\n                        error: 'Unauthorized'\n                    });\n                }\n                const cb = encodeURIComponent(safeCallbackUrl(req));\n                console.log('[authorizeAdmin]', rid, 'â†’ redirecting to login');\n                return res.redirect(`${loginPath}?callbackUrl=${cb}`);\n            }\n            // Normalize role (e.g. \"admin\" â†’ \"ADMIN\")\n            const role = String(token.role || 'USER').toUpperCase();\n            console.log('[authorizeAdmin]', rid, 'normalized role:', role);\n            if (role !== ROLES.ADMIN) {\n                console.warn('[authorizeAdmin]', rid, 'role not admin â†’ forbidden');\n                if (wantsJson(req)) {\n                    console.log('[authorizeAdmin]', rid, 'â†’ returning 403 JSON');\n                    return res.status(403).json({\n                        ok: false,\n                        code: 'FORBIDDEN',\n                        error: 'Forbidden'\n                    });\n                }\n                return res.redirect('/403');\n            }\n            // âœ… Authorized\n            req.user = {\n                id: token.sub || null,\n                email: token.email || null,\n                role\n            };\n            console.log('[authorizeAdmin]', rid, 'AUTHORIZED â†’ calling next() | user:', JSON.stringify(req.user), 'in', Date.now() - t0, 'ms');\n            return next(); // <--- this ensures the middleware chain continues\n        } catch (err) {\n            console.error('[authorizeAdmin]', rid, 'ERROR â†’', err?.message || err);\n            if (wantsJson(req)) {\n                console.log('[authorizeAdmin]', rid, 'â†’ returning 401 JSON (token error)');\n                return res.status(401).json({\n                    ok: false,\n                    code: 'TOKEN_ERROR',\n                    error: 'Unauthorized'\n                });\n            }\n            console.log('[authorizeAdmin]', rid, 'â†’ redirecting to login (exception)');\n            return res.redirect(loginPath);\n        }\n    };\n}\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n// Wrapper for standalone Next.js API routes\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nfunction withAdmin(handler, loginPath = '/admin/login') {\n    const mw = authorizeAdmin(loginPath);\n    return async (req, res)=>{\n        const rid = req.rid || '-';\n        console.log('[withAdmin]', rid, 'ENTER â†’ wrapping handler for', req.url);\n        await mw(req, res, async ()=>{\n            console.log('[withAdmin]', rid, 'AUTH OK â†’ executing handler');\n            await handler(req, res);\n            console.log('[withAdmin]', rid, 'HANDLER COMPLETE');\n        });\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RCxHQUFHckQsS0FBS29CLEtBQUs7WUFDakJILFFBQVFDLEdBQUcsQ0FBQyxlQUFlSSxLQUFLO1lBQ2hDLE1BQU04QixRQUFRcEQsS0FBS29CO1lBQ25CSCxRQUFRQyxHQUFHLENBQUMsZUFBZUksS0FBSztRQUNsQztJQUNGO0FBQ0YiLCJzb3VyY2VzIjpbIi9Vc2Vycy9lbW9udGF6ZXJpL0RvY3VtZW50cy9wcm9qZWN0cy9zaGVsbC1zdG9yaWVzLXN0dWRpby9saWIvYXV0aC9hdXRob3JpemVBZG1pbi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBsaWIvYXV0aC9hdXRob3JpemVBZG1pbi5qc1xuaW1wb3J0IHsgZ2V0VG9rZW4gfSBmcm9tICduZXh0LWF1dGgvand0JztcblxuZXhwb3J0IGNvbnN0IFJPTEVTID0geyBBRE1JTjogJ0FETUlOJywgVVNFUjogJ1VTRVInIH07XG5cbi8vIOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFxuLy8gSGVscGVyIHV0aWxpdGllc1xuLy8g4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXG5mdW5jdGlvbiB3YW50c0pzb24ocmVxKSB7XG4gIGNvbnN0IHVybCA9IHJlcS51cmwgfHwgJyc7XG4gIGNvbnN0IGFjY2VwdCA9IFN0cmluZyhyZXEuaGVhZGVycz8uYWNjZXB0IHx8ICcnKS50b0xvd2VyQ2FzZSgpO1xuICBjb25zdCB4cncgPSBTdHJpbmcocmVxLmhlYWRlcnM/LlsneC1yZXF1ZXN0ZWQtd2l0aCddIHx8ICcnKS50b0xvd2VyQ2FzZSgpO1xuICByZXR1cm4gdXJsLnN0YXJ0c1dpdGgoJy9hcGkvJykgfHwgYWNjZXB0LmluY2x1ZGVzKCdhcHBsaWNhdGlvbi9qc29uJykgfHwgeHJ3ID09PSAneG1saHR0cHJlcXVlc3QnO1xufVxuXG5mdW5jdGlvbiBzYWZlQ2FsbGJhY2tVcmwocmVxKSB7XG4gIHRyeSB7XG4gICAgY29uc3QgdSA9IG5ldyBVUkwocmVxLnVybCwgYGh0dHA6Ly8ke3JlcS5oZWFkZXJzLmhvc3QgfHwgJ2xvY2FsaG9zdCd9YCk7XG4gICAgcmV0dXJuIHUucGF0aG5hbWUgKyB1LnNlYXJjaDsgLy8gc2FtZS1vcmlnaW4gcGF0aCBvbmx5XG4gIH0gY2F0Y2gge1xuICAgIHJldHVybiAnLyc7XG4gIH1cbn1cblxuLy8g4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXG4vLyBDb3JlIG1pZGRsZXdhcmVcbi8vIOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFxuZXhwb3J0IGZ1bmN0aW9uIGF1dGhvcml6ZUFkbWluKGxvZ2luUGF0aCA9ICcvYWRtaW4vbG9naW4nKSB7XG4gIGNvbnNvbGUubG9nKCdbYXV0aG9yaXplQWRtaW5dIG1pZGRsZXdhcmUgaW5pdGlhbGl6ZWQnKTtcblxuICByZXR1cm4gYXN5bmMgZnVuY3Rpb24gZ3VhcmQocmVxLCByZXMsIG5leHQpIHtcbiAgICBjb25zdCByaWQgPSByZXEucmlkIHx8ICctJztcbiAgICBjb25zdCB0MCA9IERhdGUubm93KCk7XG5cbiAgICBjb25zb2xlLmxvZygnW2F1dGhvcml6ZUFkbWluXScsIHJpZCwgJ0VOVEVSIGZvcicsIHJlcS5tZXRob2QsIHJlcS51cmwpO1xuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnNvbGUubG9nKCdbYXV0aG9yaXplQWRtaW5dJywgJ0VYRUNVVElPTiBFTlRFUkVEIGZvcicsIHJlcS5tZXRob2QsIHJlcS51cmwpO1xuXG4gICAgICAvLyDwn5SRIFRyeSByZWFkaW5nIHRoZSBzZXNzaW9uIHRva2VuXG4gICAgICBjb25zdCB0b2tlbiA9IGF3YWl0IGdldFRva2VuKHsgcmVxLCBzZWNyZXQ6IHByb2Nlc3MuZW52Lk5FWFRBVVRIX1NFQ1JFVCB9KTtcbiAgICAgIGNvbnNvbGUubG9nKCdbYXV0aG9yaXplQWRtaW5dJywgcmlkLCAndG9rZW4gY2hlY2sg4oaSJywgdG9rZW4gPyAnRk9VTkQnIDogJ01JU1NJTkcnLCAncm9sZTonLCB0b2tlbj8ucm9sZSk7XG5cbiAgICAgIGlmICghdG9rZW4pIHtcbiAgICAgICAgY29uc29sZS53YXJuKCdbYXV0aG9yaXplQWRtaW5dJywgcmlkLCAnTk8gVE9LRU4gKHVuYXV0aGVudGljYXRlZCknKTtcbiAgICAgICAgaWYgKHdhbnRzSnNvbihyZXEpKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ1thdXRob3JpemVBZG1pbl0nLCByaWQsICfihpIgcmV0dXJuaW5nIDQwMSBKU09OJyk7XG4gICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcbiAgICAgICAgICAgIG9rOiBmYWxzZSxcbiAgICAgICAgICAgIGNvZGU6ICdVTkFVVEhFTlRJQ0FURUQnLFxuICAgICAgICAgICAgZXJyb3I6ICdVbmF1dGhvcml6ZWQnLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGNiID0gZW5jb2RlVVJJQ29tcG9uZW50KHNhZmVDYWxsYmFja1VybChyZXEpKTtcbiAgICAgICAgY29uc29sZS5sb2coJ1thdXRob3JpemVBZG1pbl0nLCByaWQsICfihpIgcmVkaXJlY3RpbmcgdG8gbG9naW4nKTtcbiAgICAgICAgcmV0dXJuIHJlcy5yZWRpcmVjdChgJHtsb2dpblBhdGh9P2NhbGxiYWNrVXJsPSR7Y2J9YCk7XG4gICAgICB9XG5cbiAgICAgIC8vIE5vcm1hbGl6ZSByb2xlIChlLmcuIFwiYWRtaW5cIiDihpIgXCJBRE1JTlwiKVxuICAgICAgY29uc3Qgcm9sZSA9IFN0cmluZyh0b2tlbi5yb2xlIHx8ICdVU0VSJykudG9VcHBlckNhc2UoKTtcbiAgICAgIGNvbnNvbGUubG9nKCdbYXV0aG9yaXplQWRtaW5dJywgcmlkLCAnbm9ybWFsaXplZCByb2xlOicsIHJvbGUpO1xuXG4gICAgICBpZiAocm9sZSAhPT0gUk9MRVMuQURNSU4pIHtcbiAgICAgICAgY29uc29sZS53YXJuKCdbYXV0aG9yaXplQWRtaW5dJywgcmlkLCAncm9sZSBub3QgYWRtaW4g4oaSIGZvcmJpZGRlbicpO1xuICAgICAgICBpZiAod2FudHNKc29uKHJlcSkpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZygnW2F1dGhvcml6ZUFkbWluXScsIHJpZCwgJ+KGkiByZXR1cm5pbmcgNDAzIEpTT04nKTtcbiAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oe1xuICAgICAgICAgICAgb2s6IGZhbHNlLFxuICAgICAgICAgICAgY29kZTogJ0ZPUkJJRERFTicsXG4gICAgICAgICAgICBlcnJvcjogJ0ZvcmJpZGRlbicsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlcy5yZWRpcmVjdCgnLzQwMycpO1xuICAgICAgfVxuXG4gICAgICAvLyDinIUgQXV0aG9yaXplZFxuICAgICAgcmVxLnVzZXIgPSB7XG4gICAgICAgIGlkOiB0b2tlbi5zdWIgfHwgbnVsbCxcbiAgICAgICAgZW1haWw6IHRva2VuLmVtYWlsIHx8IG51bGwsXG4gICAgICAgIHJvbGUsXG4gICAgICB9O1xuXG4gICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgJ1thdXRob3JpemVBZG1pbl0nLFxuICAgICAgICByaWQsXG4gICAgICAgICdBVVRIT1JJWkVEIOKGkiBjYWxsaW5nIG5leHQoKSB8IHVzZXI6JyxcbiAgICAgICAgSlNPTi5zdHJpbmdpZnkocmVxLnVzZXIpLFxuICAgICAgICAnaW4nLFxuICAgICAgICBEYXRlLm5vdygpIC0gdDAsXG4gICAgICAgICdtcydcbiAgICAgICk7XG5cbiAgICAgIHJldHVybiBuZXh0KCk7IC8vIDwtLS0gdGhpcyBlbnN1cmVzIHRoZSBtaWRkbGV3YXJlIGNoYWluIGNvbnRpbnVlc1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgY29uc29sZS5lcnJvcignW2F1dGhvcml6ZUFkbWluXScsIHJpZCwgJ0VSUk9SIOKGkicsIGVycj8ubWVzc2FnZSB8fCBlcnIpO1xuICAgICAgaWYgKHdhbnRzSnNvbihyZXEpKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdbYXV0aG9yaXplQWRtaW5dJywgcmlkLCAn4oaSIHJldHVybmluZyA0MDEgSlNPTiAodG9rZW4gZXJyb3IpJyk7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7XG4gICAgICAgICAgb2s6IGZhbHNlLFxuICAgICAgICAgIGNvZGU6ICdUT0tFTl9FUlJPUicsXG4gICAgICAgICAgZXJyb3I6ICdVbmF1dGhvcml6ZWQnLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGNvbnNvbGUubG9nKCdbYXV0aG9yaXplQWRtaW5dJywgcmlkLCAn4oaSIHJlZGlyZWN0aW5nIHRvIGxvZ2luIChleGNlcHRpb24pJyk7XG4gICAgICByZXR1cm4gcmVzLnJlZGlyZWN0KGxvZ2luUGF0aCk7XG4gICAgfVxuICB9O1xufVxuXG4vLyDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcbi8vIFdyYXBwZXIgZm9yIHN0YW5kYWxvbmUgTmV4dC5qcyBBUEkgcm91dGVzXG4vLyDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcbmV4cG9ydCBmdW5jdGlvbiB3aXRoQWRtaW4oaGFuZGxlciwgbG9naW5QYXRoID0gJy9hZG1pbi9sb2dpbicpIHtcbiAgY29uc3QgbXcgPSBhdXRob3JpemVBZG1pbihsb2dpblBhdGgpO1xuICByZXR1cm4gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gICAgY29uc3QgcmlkID0gcmVxLnJpZCB8fCAnLSc7XG4gICAgY29uc29sZS5sb2coJ1t3aXRoQWRtaW5dJywgcmlkLCAnRU5URVIg4oaSIHdyYXBwaW5nIGhhbmRsZXIgZm9yJywgcmVxLnVybCk7XG4gICAgYXdhaXQgbXcocmVxLCByZXMsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKCdbd2l0aEFkbWluXScsIHJpZCwgJ0FVVEggT0sg4oaSIGV4ZWN1dGluZyBoYW5kbGVyJyk7XG4gICAgICBhd2FpdCBoYW5kbGVyKHJlcSwgcmVzKTtcbiAgICAgIGNvbnNvbGUubG9nKCdbd2l0aEFkbWluXScsIHJpZCwgJ0hBTkRMRVIgQ09NUExFVEUnKTtcbiAgICB9KTtcbiAgfTtcbn1cblxuXG5cblxuXG4iXSwibmFtZXMiOlsiZ2V0VG9rZW4iLCJST0xFUyIsIkFETUlOIiwiVVNFUiIsIndhbnRzSnNvbiIsInJlcSIsInVybCIsImFjY2VwdCIsIlN0cmluZyIsImhlYWRlcnMiLCJ0b0xvd2VyQ2FzZSIsInhydyIsInN0YXJ0c1dpdGgiLCJpbmNsdWRlcyIsInNhZmVDYWxsYmFja1VybCIsInUiLCJVUkwiLCJob3N0IiwicGF0aG5hbWUiLCJzZWFyY2giLCJhdXRob3JpemVBZG1pbiIsImxvZ2luUGF0aCIsImNvbnNvbGUiLCJsb2ciLCJndWFyZCIsInJlcyIsIm5leHQiLCJyaWQiLCJ0MCIsIkRhdGUiLCJub3ciLCJtZXRob2QiLCJ0b2tlbiIsInNlY3JldCIsInByb2Nlc3MiLCJlbnYiLCJORVhUQVVUSF9TRUNSRVQiLCJyb2xlIiwid2FybiIsInN0YXR1cyIsImpzb24iLCJvayIsImNvZGUiLCJlcnJvciIsImNiIiwiZW5jb2RlVVJJQ29tcG9uZW50IiwicmVkaXJlY3QiLCJ0b1VwcGVyQ2FzZSIsInVzZXIiLCJpZCIsInN1YiIsImVtYWlsIiwiSlNPTiIsInN0cmluZ2lmeSIsImVyciIsIm1lc3NhZ2UiLCJ3aXRoQWRtaW4iLCJoYW5kbGVyIiwibXciXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api-node)/./lib/auth/authorizeAdmin.js\n");

/***/ }),

/***/ "(api-node)/./lib/middleware/createAdminHandler.js":
/*!**********************************************!*\
  !*** ./lib/middleware/createAdminHandler.js ***!
  \**********************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createAdminHandler: () => (/* binding */ createAdminHandler)\n/* harmony export */ });\n/* harmony import */ var next_connect__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next-connect */ \"next-connect\");\n/* harmony import */ var _lib_auth_authorizeAdmin__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/auth/authorizeAdmin */ \"(api-node)/./lib/auth/authorizeAdmin.js\");\n/* harmony import */ var _lib_middleware_rateLimiter__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/middleware/rateLimiter */ \"(api-node)/./lib/middleware/rateLimiter.js\");\n/* harmony import */ var _requestId__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./requestId */ \"(api-node)/./lib/middleware/requestId.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([next_connect__WEBPACK_IMPORTED_MODULE_0__]);\nnext_connect__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n// lib/middleware/createAdminHandler.js\n\n\n\n\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n// Helper utilities\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nconst isObj = (v)=>v && typeof v === 'object';\nconst toInt = (v, d)=>{\n    const n = Number(v);\n    return Number.isFinite(n) && n >= 0 ? Math.trunc(n) : d;\n};\n// Wrap rate limiter into safe Express middleware form\nfunction wrapRateLimiter(rateLimiterFn, rateLimitOpts) {\n    return async (req, res, next)=>{\n        const rid = req.rid || '-';\n        const t0 = Date.now();\n        console.log('[admin]', rid, 'mw:rateLimiter ENTER', {\n            limit: rateLimitOpts?.limit,\n            window: rateLimitOpts?.window\n        });\n        try {\n            let passed = false;\n            await new Promise((resolve)=>{\n                // signature: (req, res, next, options)\n                rateLimiterFn(req, res, ()=>{\n                    passed = true;\n                    resolve(true);\n                }, rateLimitOpts);\n            });\n            if (res.headersSent) {\n                console.log('[admin]', rid, 'mw:rateLimiter RESPONDED (e.g., 429) in', Date.now() - t0, 'ms');\n                return; // short-circuited by limiter\n            }\n            if (passed) {\n                console.log('[admin]', rid, 'mw:rateLimiter PASS in', Date.now() - t0, 'ms');\n                return next();\n            }\n            // Defensive: continue even if no signal\n            console.warn('[admin]', rid, 'mw:rateLimiter NO-SIGNAL â†’ allowing through in', Date.now() - t0, 'ms');\n            return next();\n        } catch (e) {\n            console.error('[admin]', rid, 'mw:rateLimiter ERROR', e?.message || e);\n            if (!res.headersSent) res.status(429).json({\n                error: 'Rate limit error'\n            });\n        }\n    };\n}\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n// Main factory function\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nfunction createAdminHandler(options = {}) {\n    // Normalize options\n    const rawRL = isObj(options.rateLimit) ? options.rateLimit : {};\n    const rateLimit = {\n        limit: toInt(rawRL.limit, 60),\n        window: toInt(rawRL.window, 60)\n    };\n    // Global error handler\n    const onError = options.onError || ((err, req, res)=>{\n        const rid = req?.rid || '-';\n        const status = Number(err?.statusCode ?? err?.status ?? 500) || 500;\n        const message = typeof err?.message === 'string' && err.message || 'Internal Server Error';\n        if (!res.headersSent) {\n            res.setHeader('Content-Type', 'application/json; charset=utf-8');\n            res.setHeader('Cache-Control', 'no-store');\n        }\n        console.error('âŒ Admin API Error [rid=' + rid + ']:', message, '| detail:', err);\n        res.status(status).json({\n            error: message\n        });\n    });\n    // â€œNo matchâ€ handler\n    const onNoMatch = options.onNoMatch || ((req, res)=>{\n        const rid = req?.rid || '-';\n        console.warn('[admin]', rid, 'onNoMatch', req.method, req.url);\n        res.status(405).json({\n            error: `Method ${req.method} not allowed`\n        });\n    });\n    // Create next-connect handler\n    const handler = (0,next_connect__WEBPACK_IMPORTED_MODULE_0__[\"default\"])({\n        onError,\n        onNoMatch\n    });\n    // Add unique Request ID (FIRST)\n    handler.use({\n        \"createAdminHandler.use\": (req, res, next)=>{\n            const t0 = Date.now();\n            (0,_requestId__WEBPACK_IMPORTED_MODULE_3__.withRequestId)(req, res, {\n                \"createAdminHandler.use\": ()=>{\n                    req._adminStart = t0;\n                    console.log('[admin]', req.rid, 'mw:requestId SET');\n                    next();\n                }\n            }[\"createAdminHandler.use\"]);\n        }\n    }[\"createAdminHandler.use\"]);\n    // Dev logger\n    if (true) {\n        handler.use({\n            \"createAdminHandler.use\": (req, _res, next)=>{\n                const method = String(req.method || '').toUpperCase();\n                if (!req.url?.startsWith('/_next')) {\n                    console.log(`[admin] ${method} ${req.url} [rid=${req.rid}] ENTER`);\n                }\n                next();\n            }\n        }[\"createAdminHandler.use\"]);\n    }\n    // Preflight (OPTIONS)\n    handler.use({\n        \"createAdminHandler.use\": (req, res, next)=>{\n            const rid = req.rid || '-';\n            if (req.method === 'OPTIONS') {\n                res.setHeader('Allow', 'GET,POST,PUT,PATCH,DELETE,OPTIONS');\n                console.log('[admin]', rid, 'mw:preflight 204');\n                return res.status(204).end();\n            }\n            console.log('[admin]', rid, 'mw:preflight SKIP');\n            next();\n        }\n    }[\"createAdminHandler.use\"]);\n    // Default JSON headers\n    handler.use({\n        \"createAdminHandler.use\": (req, res, next)=>{\n            const rid = req.rid || '-';\n            if (!res.getHeader('Content-Type')) {\n                res.setHeader('Content-Type', 'application/json; charset=utf-8');\n            }\n            res.setHeader('Cache-Control', 'no-store');\n            res.setHeader('Vary', 'X-Requested-With');\n            console.log('[admin]', rid, 'mw:headers SET');\n            next();\n        }\n    }[\"createAdminHandler.use\"]);\n    // Rate limiting (skip safe methods; normalize method casing defensively)\n    handler.use({\n        \"createAdminHandler.use\": (req, res, next)=>{\n            const rid = req.rid || '-';\n            const method = String(req.method || '').toUpperCase();\n            if (method === 'GET' || method === 'HEAD' || method === 'OPTIONS') {\n                console.log('[admin]', rid, 'mw:rateLimiter SKIP for', method);\n                return next();\n            }\n            console.log('[admin]', rid, 'mw:rateLimiter APPLY for', method);\n            return wrapRateLimiter(_lib_middleware_rateLimiter__WEBPACK_IMPORTED_MODULE_2__.rateLimiter, rateLimit)(req, res, next);\n        }\n    }[\"createAdminHandler.use\"]);\n    // Authorization guard\n    handler.use({\n        \"createAdminHandler.use\": async (req, res, next)=>{\n            const rid = req.rid || '-';\n            const t0 = Date.now();\n            console.log('[admin]', rid, 'mw:authorize START');\n            try {\n                await (0,_lib_auth_authorizeAdmin__WEBPACK_IMPORTED_MODULE_1__.authorizeAdmin)()(req, res, {\n                    \"createAdminHandler.use\": async ()=>{\n                        console.log('[admin]', rid, 'mw:authorize OK in', Date.now() - t0, 'ms');\n                        next();\n                    }\n                }[\"createAdminHandler.use\"]);\n            } catch (err) {\n                console.log('[admin]', rid, 'mw:authorize ERROR in', Date.now() - t0, 'ms', err?.message || err);\n                const status = Number(err?.status ?? 401) || 401;\n                if (!res.headersSent) {\n                    return res.status(status).json({\n                        error: err?.message || 'Unauthorized'\n                    });\n                }\n            }\n        }\n    }[\"createAdminHandler.use\"]);\n    // Final lifecycle footer (only runs if a route handler calls res.end/json)\n    handler.use({\n        \"createAdminHandler.use\": (req, _res, next)=>{\n            const rid = req.rid || '-';\n            const started = req._adminStart || Date.now();\n            console.log('[admin]', rid, 'mw:chain CONTINUE (route next) chainMs=', Date.now() - started);\n            next();\n        }\n    }[\"createAdminHandler.use\"]);\n    return handler;\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL2xpYi9taWRkbGV3YXJlL2NyZWF0ZUFkbWluSGFuZGxlci5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFBLHVDQUF1QztBQUNUO0FBQzZCO0FBQ0E7QUFDZjtBQUU1QyxnREFBZ0Q7QUFDaEQsbUJBQW1CO0FBQ25CLGdEQUFnRDtBQUNoRCxNQUFNSSxRQUFRLENBQUNDLElBQU1BLEtBQUssT0FBT0EsTUFBTTtBQUN2QyxNQUFNQyxRQUFRLENBQUNELEdBQUdFO0lBQ2hCLE1BQU1DLElBQUlDLE9BQU9KO0lBQ2pCLE9BQU9JLE9BQU9DLFFBQVEsQ0FBQ0YsTUFBTUEsS0FBSyxJQUFJRyxLQUFLQyxLQUFLLENBQUNKLEtBQUtEO0FBQ3hEO0FBRUEsc0RBQXNEO0FBQ3RELFNBQVNNLGdCQUFnQkMsYUFBYSxFQUFFQyxhQUFhO0lBQ25ELE9BQU8sT0FBT0MsS0FBS0MsS0FBS0M7UUFDdEIsTUFBTUMsTUFBTUgsSUFBSUcsR0FBRyxJQUFJO1FBQ3ZCLE1BQU1DLEtBQUtDLEtBQUtDLEdBQUc7UUFDbkJDLFFBQVFDLEdBQUcsQ0FBQyxXQUFXTCxLQUFLLHdCQUF3QjtZQUFFTSxPQUFPVixlQUFlVTtZQUFPQyxRQUFRWCxlQUFlVztRQUFPO1FBRWpILElBQUk7WUFDRixJQUFJQyxTQUFTO1lBQ2IsTUFBTSxJQUFJQyxRQUFRLENBQUNDO2dCQUNqQix1Q0FBdUM7Z0JBQ3ZDZixjQUFjRSxLQUFLQyxLQUFLO29CQUN0QlUsU0FBUztvQkFDVEUsUUFBUTtnQkFDVixHQUFHZDtZQUNMO1lBRUEsSUFBSUUsSUFBSWEsV0FBVyxFQUFFO2dCQUNuQlAsUUFBUUMsR0FBRyxDQUFDLFdBQVdMLEtBQUssMkNBQTJDRSxLQUFLQyxHQUFHLEtBQUtGLElBQUk7Z0JBQ3hGLFFBQVEsNkJBQTZCO1lBQ3ZDO1lBRUEsSUFBSU8sUUFBUTtnQkFDVkosUUFBUUMsR0FBRyxDQUFDLFdBQVdMLEtBQUssMEJBQTBCRSxLQUFLQyxHQUFHLEtBQUtGLElBQUk7Z0JBQ3ZF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QUFXeEIsS0FBS0MsS0FBS0M7UUFDM0Q7O0lBRUEsc0JBQXNCO0lBQ3RCOEIsUUFBUUMsR0FBRztrQ0FBQyxPQUFPakMsS0FBS0MsS0FBS0M7WUFDM0IsTUFBTUMsTUFBTUgsSUFBSUcsR0FBRyxJQUFJO1lBQ3ZCLE1BQU1DLEtBQUtDLEtBQUtDLEdBQUc7WUFDbkJDLFFBQVFDLEdBQUcsQ0FBQyxXQUFXTCxLQUFLO1lBRTVCLElBQUk7Z0JBQ0YsTUFBTWxCLHdFQUFjQSxHQUFHZSxLQUFLQzs4Q0FBSzt3QkFDL0JNLFFBQVFDLEdBQUcsQ0FBQyxXQUFXTCxLQUFLLHNCQUFzQkUsS0FBS0MsR0FBRyxLQUFLRixJQUFJO3dCQUNuRUY7b0JBQ0Y7O1lBQ0YsRUFBRSxPQUFPd0IsS0FBSztnQkFDWm5CLFFBQVFDLEdBQUcsQ0FBQyxXQUFXTCxLQUFLLHlCQUF5QkUsS0FBS0MsR0FBRyxLQUFLRixJQUFJLE1BQU1zQixLQUFLUixXQUFXUTtnQkFDNUYsTUFBTVAsU0FBUzFCLE9BQU9pQyxLQUFLUCxVQUFVLFFBQVE7Z0JBQzdDLElBQUksQ0FBQ2xCLElBQUlhLFdBQVcsRUFBRTtvQkFDcEIsT0FBT2IsSUFBSWtCLE1BQU0sQ0FBQ0EsUUFBUUMsSUFBSSxDQUFDO3dCQUFFSCxPQUFPUyxLQUFLUixXQUFXO29CQUFlO2dCQUN6RTtZQUNGO1FBQ0Y7O0lBRUEsMkVBQTJFO0lBQzNFYyxRQUFRQyxHQUFHO2tDQUFDLENBQUNqQyxLQUFLb0MsTUFBTWxDO1lBQ3RCLE1BQU1DLE1BQU1ILElBQUlHLEdBQUcsSUFBSTtZQUN2QixNQUFNdUMsVUFBVTFDLElBQUlrQyxXQUFXLElBQUk3QixLQUFLQyxHQUFHO1lBQzNDQyxRQUFRQyxHQUFHLENBQUMsV0FBV0wsS0FBSywyQ0FBMkNFLEtBQUtDLEdBQUcsS0FBS29DO1lBQ3BGeEM7UUFDRjs7SUFFQSxPQUFPOEI7QUFDVCIsInNvdXJjZXMiOlsiL1VzZXJzL2Vtb250YXplcmkvRG9jdW1lbnRzL3Byb2plY3RzL3NoZWxsLXN0b3JpZXMtc3R1ZGlvL2xpYi9taWRkbGV3YXJlL2NyZWF0ZUFkbWluSGFuZGxlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBsaWIvbWlkZGxld2FyZS9jcmVhdGVBZG1pbkhhbmRsZXIuanNcbmltcG9ydCBuYyBmcm9tICduZXh0LWNvbm5lY3QnO1xuaW1wb3J0IHsgYXV0aG9yaXplQWRtaW4gfSBmcm9tICdAL2xpYi9hdXRoL2F1dGhvcml6ZUFkbWluJztcbmltcG9ydCB7IHJhdGVMaW1pdGVyIH0gZnJvbSAnQC9saWIvbWlkZGxld2FyZS9yYXRlTGltaXRlcic7XG5pbXBvcnQgeyB3aXRoUmVxdWVzdElkIH0gZnJvbSAnLi9yZXF1ZXN0SWQnO1xuXG4vLyDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcbi8vIEhlbHBlciB1dGlsaXRpZXNcbi8vIOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFxuY29uc3QgaXNPYmogPSAodikgPT4gdiAmJiB0eXBlb2YgdiA9PT0gJ29iamVjdCc7XG5jb25zdCB0b0ludCA9ICh2LCBkKSA9PiB7XG4gIGNvbnN0IG4gPSBOdW1iZXIodik7XG4gIHJldHVybiBOdW1iZXIuaXNGaW5pdGUobikgJiYgbiA+PSAwID8gTWF0aC50cnVuYyhuKSA6IGQ7XG59O1xuXG4vLyBXcmFwIHJhdGUgbGltaXRlciBpbnRvIHNhZmUgRXhwcmVzcyBtaWRkbGV3YXJlIGZvcm1cbmZ1bmN0aW9uIHdyYXBSYXRlTGltaXRlcihyYXRlTGltaXRlckZuLCByYXRlTGltaXRPcHRzKSB7XG4gIHJldHVybiBhc3luYyAocmVxLCByZXMsIG5leHQpID0+IHtcbiAgICBjb25zdCByaWQgPSByZXEucmlkIHx8ICctJztcbiAgICBjb25zdCB0MCA9IERhdGUubm93KCk7XG4gICAgY29uc29sZS5sb2coJ1thZG1pbl0nLCByaWQsICdtdzpyYXRlTGltaXRlciBFTlRFUicsIHsgbGltaXQ6IHJhdGVMaW1pdE9wdHM/LmxpbWl0LCB3aW5kb3c6IHJhdGVMaW1pdE9wdHM/LndpbmRvdyB9KTtcblxuICAgIHRyeSB7XG4gICAgICBsZXQgcGFzc2VkID0gZmFsc2U7XG4gICAgICBhd2FpdCBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAgICAgICAvLyBzaWduYXR1cmU6IChyZXEsIHJlcywgbmV4dCwgb3B0aW9ucylcbiAgICAgICAgcmF0ZUxpbWl0ZXJGbihyZXEsIHJlcywgKCkgPT4ge1xuICAgICAgICAgIHBhc3NlZCA9IHRydWU7XG4gICAgICAgICAgcmVzb2x2ZSh0cnVlKTtcbiAgICAgICAgfSwgcmF0ZUxpbWl0T3B0cyk7XG4gICAgICB9KTtcblxuICAgICAgaWYgKHJlcy5oZWFkZXJzU2VudCkge1xuICAgICAgICBjb25zb2xlLmxvZygnW2FkbWluXScsIHJpZCwgJ213OnJhdGVMaW1pdGVyIFJFU1BPTkRFRCAoZS5nLiwgNDI5KSBpbicsIERhdGUubm93KCkgLSB0MCwgJ21zJyk7XG4gICAgICAgIHJldHVybjsgLy8gc2hvcnQtY2lyY3VpdGVkIGJ5IGxpbWl0ZXJcbiAgICAgIH1cblxuICAgICAgaWYgKHBhc3NlZCkge1xuICAgICAgICBjb25zb2xlLmxvZygnW2FkbWluXScsIHJpZCwgJ213OnJhdGVMaW1pdGVyIFBBU1MgaW4nLCBEYXRlLm5vdygpIC0gdDAsICdtcycpO1xuICAgICAgICByZXR1cm4gbmV4dCgpO1xuICAgICAgfVxuXG4gICAgICAvLyBEZWZlbnNpdmU6IGNvbnRpbnVlIGV2ZW4gaWYgbm8gc2lnbmFsXG4gICAgICBjb25zb2xlLndhcm4oJ1thZG1pbl0nLCByaWQsICdtdzpyYXRlTGltaXRlciBOTy1TSUdOQUwg4oaSIGFsbG93aW5nIHRocm91Z2ggaW4nLCBEYXRlLm5vdygpIC0gdDAsICdtcycpO1xuICAgICAgcmV0dXJuIG5leHQoKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdbYWRtaW5dJywgcmlkLCAnbXc6cmF0ZUxpbWl0ZXIgRVJST1InLCBlPy5tZXNzYWdlIHx8IGUpO1xuICAgICAgaWYgKCFyZXMuaGVhZGVyc1NlbnQpIHJlcy5zdGF0dXMoNDI5KS5qc29uKHsgZXJyb3I6ICdSYXRlIGxpbWl0IGVycm9yJyB9KTtcbiAgICB9XG4gIH07XG59XG5cbi8vIOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFxuLy8gTWFpbiBmYWN0b3J5IGZ1bmN0aW9uXG4vLyDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVBZG1pbkhhbmRsZXIob3B0aW9ucyA9IHt9KSB7XG4gIC8vIE5vcm1hbGl6ZSBvcHRpb25zXG4gIGNvbnN0IHJhd1JMID0gaXNPYmoob3B0aW9ucy5yYXRlTGltaXQpID8gb3B0aW9ucy5yYXRlTGltaXQgOiB7fTtcbiAgY29uc3QgcmF0ZUxpbWl0ID0ge1xuICAgIGxpbWl0OiB0b0ludChyYXdSTC5saW1pdCwgNjApLFxuICAgIHdpbmRvdzogdG9JbnQocmF3Ukwud2luZG93LCA2MCksXG4gIH07XG5cbiAgLy8gR2xvYmFsIGVycm9yIGhhbmRsZXJcbiAgY29uc3Qgb25FcnJvciA9XG4gICAgb3B0aW9ucy5vbkVycm9yIHx8XG4gICAgKChlcnIsIHJlcSwgcmVzKSA9PiB7XG4gICAgICBjb25zdCByaWQgPSByZXE/LnJpZCB8fCAnLSc7XG4gICAgICBjb25zdCBzdGF0dXMgPSBOdW1iZXIoZXJyPy5zdGF0dXNDb2RlID8/IGVycj8uc3RhdHVzID8/IDUwMCkgfHwgNTAwO1xuICAgICAgY29uc3QgbWVzc2FnZSA9XG4gICAgICAgICh0eXBlb2YgZXJyPy5tZXNzYWdlID09PSAnc3RyaW5nJyAmJiBlcnIubWVzc2FnZSkgfHxcbiAgICAgICAgJ0ludGVybmFsIFNlcnZlciBFcnJvcic7XG5cbiAgICAgIGlmICghcmVzLmhlYWRlcnNTZW50KSB7XG4gICAgICAgIHJlcy5zZXRIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uOyBjaGFyc2V0PXV0Zi04Jyk7XG4gICAgICAgIHJlcy5zZXRIZWFkZXIoJ0NhY2hlLUNvbnRyb2wnLCAnbm8tc3RvcmUnKTtcbiAgICAgIH1cblxuICAgICAgY29uc29sZS5lcnJvcign4p2MIEFkbWluIEFQSSBFcnJvciBbcmlkPScgKyByaWQgKyAnXTonLCBtZXNzYWdlLCAnfCBkZXRhaWw6JywgZXJyKTtcbiAgICAgIHJlcy5zdGF0dXMoc3RhdHVzKS5qc29uKHsgZXJyb3I6IG1lc3NhZ2UgfSk7XG4gICAgfSk7XG5cbiAgLy8g4oCcTm8gbWF0Y2jigJ0gaGFuZGxlclxuICBjb25zdCBvbk5vTWF0Y2ggPVxuICAgIG9wdGlvbnMub25Ob01hdGNoIHx8XG4gICAgKChyZXEsIHJlcykgPT4ge1xuICAgICAgY29uc3QgcmlkID0gcmVxPy5yaWQgfHwgJy0nO1xuICAgICAgY29uc29sZS53YXJuKCdbYWRtaW5dJywgcmlkLCAnb25Ob01hdGNoJywgcmVxLm1ldGhvZCwgcmVxLnVybCk7XG4gICAgICByZXMuc3RhdHVzKDQwNSkuanNvbih7IGVycm9yOiBgTWV0aG9kICR7cmVxLm1ldGhvZH0gbm90IGFsbG93ZWRgIH0pO1xuICAgIH0pO1xuXG4gIC8vIENyZWF0ZSBuZXh0LWNvbm5lY3QgaGFuZGxlclxuICBjb25zdCBoYW5kbGVyID0gbmMoeyBvbkVycm9yLCBvbk5vTWF0Y2ggfSk7XG5cbiAgLy8gQWRkIHVuaXF1ZSBSZXF1ZXN0IElEIChGSVJTVClcbiAgaGFuZGxlci51c2UoKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gICAgY29uc3QgdDAgPSBEYXRlLm5vdygpO1xuICAgIHdpdGhSZXF1ZXN0SWQocmVxLCByZXMsICgpID0+IHtcbiAgICAgIHJlcS5fYWRtaW5TdGFydCA9IHQwO1xuICAgICAgY29uc29sZS5sb2coJ1thZG1pbl0nLCByZXEucmlkLCAnbXc6cmVxdWVzdElkIFNFVCcpO1xuICAgICAgbmV4dCgpO1xuICAgIH0pO1xuICB9KTtcblxuICAvLyBEZXYgbG9nZ2VyXG4gIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7XG4gICAgaGFuZGxlci51c2UoKHJlcSwgX3JlcywgbmV4dCkgPT4ge1xuICAgICAgY29uc3QgbWV0aG9kID0gU3RyaW5nKHJlcS5tZXRob2QgfHwgJycpLnRvVXBwZXJDYXNlKCk7XG4gICAgICBpZiAoIXJlcS51cmw/LnN0YXJ0c1dpdGgoJy9fbmV4dCcpKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGBbYWRtaW5dICR7bWV0aG9kfSAke3JlcS51cmx9IFtyaWQ9JHtyZXEucmlkfV0gRU5URVJgKTtcbiAgICAgIH1cbiAgICAgIG5leHQoKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8vIFByZWZsaWdodCAoT1BUSU9OUylcbiAgaGFuZGxlci51c2UoKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gICAgY29uc3QgcmlkID0gcmVxLnJpZCB8fCAnLSc7XG4gICAgaWYgKHJlcS5tZXRob2QgPT09ICdPUFRJT05TJykge1xuICAgICAgcmVzLnNldEhlYWRlcignQWxsb3cnLCAnR0VULFBPU1QsUFVULFBBVENILERFTEVURSxPUFRJT05TJyk7XG4gICAgICBjb25zb2xlLmxvZygnW2FkbWluXScsIHJpZCwgJ213OnByZWZsaWdodCAyMDQnKTtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwNCkuZW5kKCk7XG4gICAgfVxuICAgIGNvbnNvbGUubG9nKCdbYWRtaW5dJywgcmlkLCAnbXc6cHJlZmxpZ2h0IFNLSVAnKTtcbiAgICBuZXh0KCk7XG4gIH0pO1xuXG4gIC8vIERlZmF1bHQgSlNPTiBoZWFkZXJzXG4gIGhhbmRsZXIudXNlKChyZXEsIHJlcywgbmV4dCkgPT4ge1xuICAgIGNvbnN0IHJpZCA9IHJlcS5yaWQgfHwgJy0nO1xuICAgIGlmICghcmVzLmdldEhlYWRlcignQ29udGVudC1UeXBlJykpIHtcbiAgICAgIHJlcy5zZXRIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uOyBjaGFyc2V0PXV0Zi04Jyk7XG4gICAgfVxuICAgIHJlcy5zZXRIZWFkZXIoJ0NhY2hlLUNvbnRyb2wnLCAnbm8tc3RvcmUnKTtcbiAgICByZXMuc2V0SGVhZGVyKCdWYXJ5JywgJ1gtUmVxdWVzdGVkLVdpdGgnKTtcbiAgICBjb25zb2xlLmxvZygnW2FkbWluXScsIHJpZCwgJ213OmhlYWRlcnMgU0VUJyk7XG4gICAgbmV4dCgpO1xuICB9KTtcblxuICAvLyBSYXRlIGxpbWl0aW5nIChza2lwIHNhZmUgbWV0aG9kczsgbm9ybWFsaXplIG1ldGhvZCBjYXNpbmcgZGVmZW5zaXZlbHkpXG4gIGhhbmRsZXIudXNlKChyZXEsIHJlcywgbmV4dCkgPT4ge1xuICAgIGNvbnN0IHJpZCA9IHJlcS5yaWQgfHwgJy0nO1xuICAgIGNvbnN0IG1ldGhvZCA9IFN0cmluZyhyZXEubWV0aG9kIHx8ICcnKS50b1VwcGVyQ2FzZSgpO1xuXG4gICAgaWYgKG1ldGhvZCA9PT0gJ0dFVCcgfHwgbWV0aG9kID09PSAnSEVBRCcgfHwgbWV0aG9kID09PSAnT1BUSU9OUycpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdbYWRtaW5dJywgcmlkLCAnbXc6cmF0ZUxpbWl0ZXIgU0tJUCBmb3InLCBtZXRob2QpO1xuICAgICAgcmV0dXJuIG5leHQoKTtcbiAgICB9XG5cbiAgICBjb25zb2xlLmxvZygnW2FkbWluXScsIHJpZCwgJ213OnJhdGVMaW1pdGVyIEFQUExZIGZvcicsIG1ldGhvZCk7XG4gICAgcmV0dXJuIHdyYXBSYXRlTGltaXRlcihyYXRlTGltaXRlciwgcmF0ZUxpbWl0KShyZXEsIHJlcywgbmV4dCk7XG4gIH0pO1xuXG4gIC8vIEF1dGhvcml6YXRpb24gZ3VhcmRcbiAgaGFuZGxlci51c2UoYXN5bmMgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gICAgY29uc3QgcmlkID0gcmVxLnJpZCB8fCAnLSc7XG4gICAgY29uc3QgdDAgPSBEYXRlLm5vdygpO1xuICAgIGNvbnNvbGUubG9nKCdbYWRtaW5dJywgcmlkLCAnbXc6YXV0aG9yaXplIFNUQVJUJyk7XG5cbiAgICB0cnkge1xuICAgICAgYXdhaXQgYXV0aG9yaXplQWRtaW4oKShyZXEsIHJlcywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZygnW2FkbWluXScsIHJpZCwgJ213OmF1dGhvcml6ZSBPSyBpbicsIERhdGUubm93KCkgLSB0MCwgJ21zJyk7XG4gICAgICAgIG5leHQoKTtcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgY29uc29sZS5sb2coJ1thZG1pbl0nLCByaWQsICdtdzphdXRob3JpemUgRVJST1IgaW4nLCBEYXRlLm5vdygpIC0gdDAsICdtcycsIGVycj8ubWVzc2FnZSB8fCBlcnIpO1xuICAgICAgY29uc3Qgc3RhdHVzID0gTnVtYmVyKGVycj8uc3RhdHVzID8/IDQwMSkgfHwgNDAxO1xuICAgICAgaWYgKCFyZXMuaGVhZGVyc1NlbnQpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoc3RhdHVzKS5qc29uKHsgZXJyb3I6IGVycj8ubWVzc2FnZSB8fCAnVW5hdXRob3JpemVkJyB9KTtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuXG4gIC8vIEZpbmFsIGxpZmVjeWNsZSBmb290ZXIgKG9ubHkgcnVucyBpZiBhIHJvdXRlIGhhbmRsZXIgY2FsbHMgcmVzLmVuZC9qc29uKVxuICBoYW5kbGVyLnVzZSgocmVxLCBfcmVzLCBuZXh0KSA9PiB7XG4gICAgY29uc3QgcmlkID0gcmVxLnJpZCB8fCAnLSc7XG4gICAgY29uc3Qgc3RhcnRlZCA9IHJlcS5fYWRtaW5TdGFydCB8fCBEYXRlLm5vdygpO1xuICAgIGNvbnNvbGUubG9nKCdbYWRtaW5dJywgcmlkLCAnbXc6Y2hhaW4gQ09OVElOVUUgKHJvdXRlIG5leHQpIGNoYWluTXM9JywgRGF0ZS5ub3coKSAtIHN0YXJ0ZWQpO1xuICAgIG5leHQoKTtcbiAgfSk7XG5cbiAgcmV0dXJuIGhhbmRsZXI7XG59XG5cblxuXG4iXSwibmFtZXMiOlsibmMiLCJhdXRob3JpemVBZG1pbiIsInJhdGVMaW1pdGVyIiwid2l0aFJlcXVlc3RJZCIsImlzT2JqIiwidiIsInRvSW50IiwiZCIsIm4iLCJOdW1iZXIiLCJpc0Zpbml0ZSIsIk1hdGgiLCJ0cnVuYyIsIndyYXBSYXRlTGltaXRlciIsInJhdGVMaW1pdGVyRm4iLCJyYXRlTGltaXRPcHRzIiwicmVxIiwicmVzIiwibmV4dCIsInJpZCIsInQwIiwiRGF0ZSIsIm5vdyIsImNvbnNvbGUiLCJsb2ciLCJsaW1pdCIsIndpbmRvdyIsInBhc3NlZCIsIlByb21pc2UiLCJyZXNvbHZlIiwiaGVhZGVyc1NlbnQiLCJ3YXJuIiwiZSIsImVycm9yIiwibWVzc2FnZSIsInN0YXR1cyIsImpzb24iLCJjcmVhdGVBZG1pbkhhbmRsZXIiLCJvcHRpb25zIiwicmF3UkwiLCJyYXRlTGltaXQiLCJvbkVycm9yIiwiZXJyIiwic3RhdHVzQ29kZSIsInNldEhlYWRlciIsIm9uTm9NYXRjaCIsIm1ldGhvZCIsInVybCIsImhhbmRsZXIiLCJ1c2UiLCJfYWRtaW5TdGFydCIsInByb2Nlc3MiLCJfcmVzIiwiU3RyaW5nIiwidG9VcHBlckNhc2UiLCJzdGFydHNXaXRoIiwiZW5kIiwiZ2V0SGVhZGVyIiwic3RhcnRlZCJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api-node)/./lib/middleware/createAdminHandler.js\n");

/***/ }),

/***/ "(api-node)/./lib/middleware/rateLimiter.js":
/*!***************************************!*\
  !*** ./lib/middleware/rateLimiter.js ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   rateLimiter: () => (/* binding */ rateLimiter)\n/* harmony export */ });\n/* harmony import */ var _lib_redis__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/redis */ \"(api-node)/./lib/redis.js\");\n// lib/middleware/rateLimiter.js\n\nasync function rateLimiter(req, res, next, options = {}) {\n    try {\n        const redis = await (0,_lib_redis__WEBPACK_IMPORTED_MODULE_0__.getRedisClient)();\n        const ip = req.headers['x-forwarded-for'] || req.socket.remoteAddress || 'unknown';\n        const key = `rate-limit:${ip}`;\n        const limit = options.limit || 60;\n        const windowSeconds = options.window || 60;\n        const count = await redis.incr(key);\n        if (count === 1) await redis.expire(key, windowSeconds);\n        if (count > limit) {\n            return res.status(429).json({\n                error: 'Too many requests. Please try again later.'\n            });\n        }\n        res.setHeader('X-RateLimit-Limit', limit);\n        res.setHeader('X-RateLimit-Remaining', Math.max(0, limit - count));\n        res.setHeader('X-RateLimit-Reset', windowSeconds);\n        return next();\n    } catch (err) {\n        console.error('âš ï¸ Rate limiter failed, allowing request to proceed:', err);\n        return next(); // âœ… Allow request even if Redis fails\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL2xpYi9taWRkbGV3YXJlL3JhdGVMaW1pdGVyLmpzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsZ0NBQWdDO0FBRWE7QUFFdEMsZUFBZUMsWUFBWUMsR0FBRyxFQUFFQyxHQUFHLEVBQUVDLElBQUksRUFBRUMsVUFBVSxDQUFDLENBQUM7SUFDMUQsSUFBSTtRQUNGLE1BQU1DLFFBQVEsTUFBTU4sMERBQWNBO1FBRWxDLE1BQU1PLEtBQUtMLElBQUlNLE9BQU8sQ0FBQyxrQkFBa0IsSUFBSU4sSUFBSU8sTUFBTSxDQUFDQyxhQUFhLElBQUk7UUFDekUsTUFBTUMsTUFBTSxDQUFDLFdBQVcsRUFBRUosSUFBSTtRQUU5QixNQUFNSyxRQUFRUCxRQUFRTyxLQUFLLElBQUk7UUFDL0IsTUFBTUMsZ0JBQWdCUixRQUFRUyxNQUFNLElBQUk7UUFFeEMsTUFBTUMsUUFBUSxNQUFNVCxNQUFNVSxJQUFJLENBQUNMO1FBRS9CLElBQUlJLFVBQVUsR0FBRyxNQUFNVCxNQUFNVyxNQUFNLENBQUNOLEtBQUtFO1FBQ3pDLElBQUlFLFFBQVFILE9BQU87WUFDakIsT0FBT1QsSUFBSWUsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztnQkFBRUMsT0FBTztZQUE2QztRQUNwRjtRQUVBakIsSUFBSWtCLFNBQVMsQ0FBQyxxQkFBcUJUO1FBQ25DVCxJQUFJa0IsU0FBUyxDQUFDLHlCQUF5QkMsS0FBS0MsR0FBRyxDQUFDLEdBQUdYLFFBQVFHO1FBQzNEWixJQUFJa0IsU0FBUyxDQUFDLHFCQUFxQlI7UUFFbkMsT0FBT1Q7SUFDVCxFQUFFLE9BQU9vQixLQUFLO1FBQ1pDLFFBQVFMLEtBQUssQ0FBQyx3REFBd0RJO1FBQ3RFLE9BQU9wQixRQUFRLHNDQUFzQztJQUN2RDtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvZW1vbnRhemVyaS9Eb2N1bWVudHMvcHJvamVjdHMvc2hlbGwtc3Rvcmllcy1zdHVkaW8vbGliL21pZGRsZXdhcmUvcmF0ZUxpbWl0ZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gbGliL21pZGRsZXdhcmUvcmF0ZUxpbWl0ZXIuanNcblxuaW1wb3J0IHsgZ2V0UmVkaXNDbGllbnQgfSBmcm9tICdAL2xpYi9yZWRpcyc7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiByYXRlTGltaXRlcihyZXEsIHJlcywgbmV4dCwgb3B0aW9ucyA9IHt9KSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlZGlzID0gYXdhaXQgZ2V0UmVkaXNDbGllbnQoKTtcbiAgXG4gICAgICBjb25zdCBpcCA9IHJlcS5oZWFkZXJzWyd4LWZvcndhcmRlZC1mb3InXSB8fCByZXEuc29ja2V0LnJlbW90ZUFkZHJlc3MgfHwgJ3Vua25vd24nO1xuICAgICAgY29uc3Qga2V5ID0gYHJhdGUtbGltaXQ6JHtpcH1gO1xuICAgICAgXG4gICAgICBjb25zdCBsaW1pdCA9IG9wdGlvbnMubGltaXQgfHwgNjA7XG4gICAgICBjb25zdCB3aW5kb3dTZWNvbmRzID0gb3B0aW9ucy53aW5kb3cgfHwgNjA7XG4gIFxuICAgICAgY29uc3QgY291bnQgPSBhd2FpdCByZWRpcy5pbmNyKGtleSk7XG4gIFxuICAgICAgaWYgKGNvdW50ID09PSAxKSBhd2FpdCByZWRpcy5leHBpcmUoa2V5LCB3aW5kb3dTZWNvbmRzKTtcbiAgICAgIGlmIChjb3VudCA+IGxpbWl0KSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQyOSkuanNvbih7IGVycm9yOiAnVG9vIG1hbnkgcmVxdWVzdHMuIFBsZWFzZSB0cnkgYWdhaW4gbGF0ZXIuJyB9KTtcbiAgICAgIH1cbiAgXG4gICAgICByZXMuc2V0SGVhZGVyKCdYLVJhdGVMaW1pdC1MaW1pdCcsIGxpbWl0KTtcbiAgICAgIHJlcy5zZXRIZWFkZXIoJ1gtUmF0ZUxpbWl0LVJlbWFpbmluZycsIE1hdGgubWF4KDAsIGxpbWl0IC0gY291bnQpKTtcbiAgICAgIHJlcy5zZXRIZWFkZXIoJ1gtUmF0ZUxpbWl0LVJlc2V0Jywgd2luZG93U2Vjb25kcyk7XG4gIFxuICAgICAgcmV0dXJuIG5leHQoKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KaoO+4jyBSYXRlIGxpbWl0ZXIgZmFpbGVkLCBhbGxvd2luZyByZXF1ZXN0IHRvIHByb2NlZWQ6JywgZXJyKTtcbiAgICAgIHJldHVybiBuZXh0KCk7IC8vIOKchSBBbGxvdyByZXF1ZXN0IGV2ZW4gaWYgUmVkaXMgZmFpbHNcbiAgICB9XG4gIH1cbiAgIl0sIm5hbWVzIjpbImdldFJlZGlzQ2xpZW50IiwicmF0ZUxpbWl0ZXIiLCJyZXEiLCJyZXMiLCJuZXh0Iiwib3B0aW9ucyIsInJlZGlzIiwiaXAiLCJoZWFkZXJzIiwic29ja2V0IiwicmVtb3RlQWRkcmVzcyIsImtleSIsImxpbWl0Iiwid2luZG93U2Vjb25kcyIsIndpbmRvdyIsImNvdW50IiwiaW5jciIsImV4cGlyZSIsInN0YXR1cyIsImpzb24iLCJlcnJvciIsInNldEhlYWRlciIsIk1hdGgiLCJtYXgiLCJlcnIiLCJjb25zb2xlIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api-node)/./lib/middleware/rateLimiter.js\n");

/***/ }),

/***/ "(api-node)/./lib/middleware/requestId.js":
/*!*************************************!*\
  !*** ./lib/middleware/requestId.js ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   withRequestId: () => (/* binding */ withRequestId)\n/* harmony export */ });\n// lib/middleware/requestId.js\nfunction withRequestId(req, res, next) {\n    // Node 18+: crypto.randomUUID(); fallback if unavailable\n    const rid = typeof crypto?.randomUUID === 'function' ? crypto.randomUUID() : `${Date.now().toString(36)}-${Math.random().toString(16).slice(2, 10)}`;\n    req.rid = rid;\n    res.setHeader('X-Request-Id', rid);\n    next();\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL2xpYi9taWRkbGV3YXJlL3JlcXVlc3RJZC5qcyIsIm1hcHBpbmdzIjoiOzs7O0FBQUEsOEJBQThCO0FBQ3ZCLFNBQVNBLGNBQWNDLEdBQUcsRUFBRUMsR0FBRyxFQUFFQyxJQUFJO0lBQ3hDLHlEQUF5RDtJQUN6RCxNQUFNQyxNQUFNLE9BQVFDLFFBQVFDLGVBQWUsYUFDdkNELE9BQU9DLFVBQVUsS0FDakIsR0FBR0MsS0FBS0MsR0FBRyxHQUFHQyxRQUFRLENBQUMsSUFBSSxDQUFDLEVBQUVDLEtBQUtDLE1BQU0sR0FBR0YsUUFBUSxDQUFDLElBQUlHLEtBQUssQ0FBQyxHQUFHLEtBQUs7SUFFM0VYLElBQUlHLEdBQUcsR0FBR0E7SUFDVkYsSUFBSVcsU0FBUyxDQUFDLGdCQUFnQlQ7SUFDOUJEO0FBQ0YiLCJzb3VyY2VzIjpbIi9Vc2Vycy9lbW9udGF6ZXJpL0RvY3VtZW50cy9wcm9qZWN0cy9zaGVsbC1zdG9yaWVzLXN0dWRpby9saWIvbWlkZGxld2FyZS9yZXF1ZXN0SWQuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gbGliL21pZGRsZXdhcmUvcmVxdWVzdElkLmpzXG5leHBvcnQgZnVuY3Rpb24gd2l0aFJlcXVlc3RJZChyZXEsIHJlcywgbmV4dCkge1xuICAgIC8vIE5vZGUgMTgrOiBjcnlwdG8ucmFuZG9tVVVJRCgpOyBmYWxsYmFjayBpZiB1bmF2YWlsYWJsZVxuICAgIGNvbnN0IHJpZCA9ICh0eXBlb2YgY3J5cHRvPy5yYW5kb21VVUlEID09PSAnZnVuY3Rpb24nKVxuICAgICAgPyBjcnlwdG8ucmFuZG9tVVVJRCgpXG4gICAgICA6IGAke0RhdGUubm93KCkudG9TdHJpbmcoMzYpfS0ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMTYpLnNsaWNlKDIsIDEwKX1gO1xuICBcbiAgICByZXEucmlkID0gcmlkO1xuICAgIHJlcy5zZXRIZWFkZXIoJ1gtUmVxdWVzdC1JZCcsIHJpZCk7XG4gICAgbmV4dCgpO1xuICB9XG4gICJdLCJuYW1lcyI6WyJ3aXRoUmVxdWVzdElkIiwicmVxIiwicmVzIiwibmV4dCIsInJpZCIsImNyeXB0byIsInJhbmRvbVVVSUQiLCJEYXRlIiwibm93IiwidG9TdHJpbmciLCJNYXRoIiwicmFuZG9tIiwic2xpY2UiLCJzZXRIZWFkZXIiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api-node)/./lib/middleware/requestId.js\n");

/***/ }),

/***/ "(api-node)/./lib/redis.js":
/*!**********************!*\
  !*** ./lib/redis.js ***!
  \**********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getRedisClient: () => (/* binding */ getRedisClient),\n/* harmony export */   redisPromise: () => (/* binding */ redisPromise)\n/* harmony export */ });\n// /lib/redis.js\nlet client = null;\n/** Normalize options like { EX: 60 } -> { ex: 60 } */ function normalizeSetOpts(opts = {}) {\n    if (!opts) return undefined;\n    const ex = opts.ex ?? opts.EX ?? undefined;\n    const px = opts.px ?? opts.PX ?? undefined;\n    const out = {};\n    if (ex != null) out.ex = ex;\n    if (px != null) out.px = px;\n    return Object.keys(out).length ? out : undefined;\n}\n// Wrap Upstash client to match a minimal common API\nfunction wrapUpstash(upstash) {\n    return {\n        get: (k)=>upstash.get(k),\n        set: (k, v, opts)=>upstash.set(k, v, normalizeSetOpts(opts)),\n        del: (k)=>upstash.del(k),\n        incr: (k)=>upstash.incr(k),\n        expire: (k, s)=>upstash.expire(k, s)\n    };\n}\n// Wrap node-redis (TCP) to match the same API\nfunction wrapTcp(nodeClient) {\n    return {\n        get: (k)=>nodeClient.get(k),\n        set: (k, v, opts)=>nodeClient.set(k, v, normalizeSetOpts(opts)),\n        del: (k)=>nodeClient.del(k),\n        incr: (k)=>nodeClient.incr(k),\n        expire: (k, s)=>nodeClient.expire(k, s)\n    };\n}\nasync function getRedisClient() {\n    if (client) return client;\n    // Prefer Upstash REST if present\n    if (process.env.UPSTASH_REDIS_REST_URL && process.env.UPSTASH_REDIS_REST_TOKEN) {\n        const { Redis } = await Promise.resolve(/*! import() */).then(__webpack_require__.bind(__webpack_require__, /*! @upstash/redis */ \"@upstash/redis\"));\n        const upstash = new Redis({\n            url: process.env.UPSTASH_REDIS_REST_URL,\n            token: process.env.UPSTASH_REDIS_REST_TOKEN\n        });\n        client = wrapUpstash(upstash);\n        return client;\n    }\n    // Fallback to TCP Redis via node-redis (requires REDIS_URL)\n    const { createClient } = await Promise.resolve(/*! import() */).then(__webpack_require__.t.bind(__webpack_require__, /*! redis */ \"redis\", 23));\n    const raw = createClient({\n        url: process.env.REDIS_URL || 'redis://localhost:6379',\n        socket: {\n            reconnectStrategy: (retries)=>retries > 5 ? new Error('Max reconnect attempts reached') : 1000\n        }\n    });\n    raw.on('error', (err)=>console.error('âŒ Redis Error:', err));\n    try {\n        await raw.connect();\n        console.log('âœ… Connected to Redis (TCP)');\n    } catch (err) {\n        console.warn('âš ï¸ Redis connection failed:', err.message);\n    }\n    client = wrapTcp(raw);\n    return client;\n}\n// Export a promise you can await where needed (no top-level await)\nconst redisPromise = getRedisClient();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QyxlQUFldkIsaUJBQWlCIiwic291cmNlcyI6WyIvVXNlcnMvZW1vbnRhemVyaS9Eb2N1bWVudHMvcHJvamVjdHMvc2hlbGwtc3Rvcmllcy1zdHVkaW8vbGliL3JlZGlzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIC9saWIvcmVkaXMuanNcblxubGV0IGNsaWVudCA9IG51bGw7XG5cbi8qKiBOb3JtYWxpemUgb3B0aW9ucyBsaWtlIHsgRVg6IDYwIH0gLT4geyBleDogNjAgfSAqL1xuZnVuY3Rpb24gbm9ybWFsaXplU2V0T3B0cyhvcHRzID0ge30pIHtcbiAgaWYgKCFvcHRzKSByZXR1cm4gdW5kZWZpbmVkO1xuICBjb25zdCBleCA9IG9wdHMuZXggPz8gb3B0cy5FWCA/PyB1bmRlZmluZWQ7XG4gIGNvbnN0IHB4ID0gb3B0cy5weCA/PyBvcHRzLlBYID8/IHVuZGVmaW5lZDtcbiAgY29uc3Qgb3V0ID0ge307XG4gIGlmIChleCAhPSBudWxsKSBvdXQuZXggPSBleDtcbiAgaWYgKHB4ICE9IG51bGwpIG91dC5weCA9IHB4O1xuICByZXR1cm4gT2JqZWN0LmtleXMob3V0KS5sZW5ndGggPyBvdXQgOiB1bmRlZmluZWQ7XG59XG5cbi8vIFdyYXAgVXBzdGFzaCBjbGllbnQgdG8gbWF0Y2ggYSBtaW5pbWFsIGNvbW1vbiBBUElcbmZ1bmN0aW9uIHdyYXBVcHN0YXNoKHVwc3Rhc2gpIHtcbiAgcmV0dXJuIHtcbiAgICBnZXQ6IChrKSA9PiB1cHN0YXNoLmdldChrKSxcbiAgICBzZXQ6IChrLCB2LCBvcHRzKSA9PiB1cHN0YXNoLnNldChrLCB2LCBub3JtYWxpemVTZXRPcHRzKG9wdHMpKSxcbiAgICBkZWw6IChrKSA9PiB1cHN0YXNoLmRlbChrKSxcbiAgICBpbmNyOiAoaykgPT4gdXBzdGFzaC5pbmNyKGspLFxuICAgIGV4cGlyZTogKGssIHMpID0+IHVwc3Rhc2guZXhwaXJlKGssIHMpLFxuICB9O1xufVxuXG4vLyBXcmFwIG5vZGUtcmVkaXMgKFRDUCkgdG8gbWF0Y2ggdGhlIHNhbWUgQVBJXG5mdW5jdGlvbiB3cmFwVGNwKG5vZGVDbGllbnQpIHtcbiAgcmV0dXJuIHtcbiAgICBnZXQ6IChrKSA9PiBub2RlQ2xpZW50LmdldChrKSxcbiAgICBzZXQ6IChrLCB2LCBvcHRzKSA9PiBub2RlQ2xpZW50LnNldChrLCB2LCBub3JtYWxpemVTZXRPcHRzKG9wdHMpKSxcbiAgICBkZWw6IChrKSA9PiBub2RlQ2xpZW50LmRlbChrKSxcbiAgICBpbmNyOiAoaykgPT4gbm9kZUNsaWVudC5pbmNyKGspLFxuICAgIGV4cGlyZTogKGssIHMpID0+IG5vZGVDbGllbnQuZXhwaXJlKGssIHMpLFxuICB9O1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0UmVkaXNDbGllbnQoKSB7XG4gIGlmIChjbGllbnQpIHJldHVybiBjbGllbnQ7XG5cbiAgLy8gUHJlZmVyIFVwc3Rhc2ggUkVTVCBpZiBwcmVzZW50XG4gIGlmIChwcm9jZXNzLmVudi5VUFNUQVNIX1JFRElTX1JFU1RfVVJMICYmIHByb2Nlc3MuZW52LlVQU1RBU0hfUkVESVNfUkVTVF9UT0tFTikge1xuICAgIGNvbnN0IHsgUmVkaXMgfSA9IGF3YWl0IGltcG9ydCgnQHVwc3Rhc2gvcmVkaXMnKTtcbiAgICBjb25zdCB1cHN0YXNoID0gbmV3IFJlZGlzKHtcbiAgICAgIHVybDogcHJvY2Vzcy5lbnYuVVBTVEFTSF9SRURJU19SRVNUX1VSTCxcbiAgICAgIHRva2VuOiBwcm9jZXNzLmVudi5VUFNUQVNIX1JFRElTX1JFU1RfVE9LRU4sXG4gICAgfSk7XG4gICAgY2xpZW50ID0gd3JhcFVwc3Rhc2godXBzdGFzaCk7XG4gICAgcmV0dXJuIGNsaWVudDtcbiAgfVxuXG4gIC8vIEZhbGxiYWNrIHRvIFRDUCBSZWRpcyB2aWEgbm9kZS1yZWRpcyAocmVxdWlyZXMgUkVESVNfVVJMKVxuICBjb25zdCB7IGNyZWF0ZUNsaWVudCB9ID0gYXdhaXQgaW1wb3J0KCdyZWRpcycpO1xuXG4gIGNvbnN0IHJhdyA9IGNyZWF0ZUNsaWVudCh7XG4gICAgdXJsOiBwcm9jZXNzLmVudi5SRURJU19VUkwgfHwgJ3JlZGlzOi8vbG9jYWxob3N0OjYzNzknLFxuICAgIHNvY2tldDoge1xuICAgICAgcmVjb25uZWN0U3RyYXRlZ3k6IChyZXRyaWVzKSA9PiAocmV0cmllcyA+IDUgPyBuZXcgRXJyb3IoJ01heCByZWNvbm5lY3QgYXR0ZW1wdHMgcmVhY2hlZCcpIDogMTAwMCksXG4gICAgfSxcbiAgfSk7XG5cbiAgcmF3Lm9uKCdlcnJvcicsIChlcnIpID0+IGNvbnNvbGUuZXJyb3IoJ+KdjCBSZWRpcyBFcnJvcjonLCBlcnIpKTtcblxuICB0cnkge1xuICAgIGF3YWl0IHJhdy5jb25uZWN0KCk7XG4gICAgY29uc29sZS5sb2coJ+KchSBDb25uZWN0ZWQgdG8gUmVkaXMgKFRDUCknKTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgY29uc29sZS53YXJuKCfimqDvuI8gUmVkaXMgY29ubmVjdGlvbiBmYWlsZWQ6JywgZXJyLm1lc3NhZ2UpO1xuICB9XG5cbiAgY2xpZW50ID0gd3JhcFRjcChyYXcpO1xuICByZXR1cm4gY2xpZW50O1xufVxuXG4vLyBFeHBvcnQgYSBwcm9taXNlIHlvdSBjYW4gYXdhaXQgd2hlcmUgbmVlZGVkIChubyB0b3AtbGV2ZWwgYXdhaXQpXG5leHBvcnQgY29uc3QgcmVkaXNQcm9taXNlID0gZ2V0UmVkaXNDbGllbnQoKTtcblxuXG5cblxuIl0sIm5hbWVzIjpbImNsaWVudCIsIm5vcm1hbGl6ZVNldE9wdHMiLCJvcHRzIiwidW5kZWZpbmVkIiwiZXgiLCJFWCIsInB4IiwiUFgiLCJvdXQiLCJPYmplY3QiLCJrZXlzIiwibGVuZ3RoIiwid3JhcFVwc3Rhc2giLCJ1cHN0YXNoIiwiZ2V0IiwiayIsInNldCIsInYiLCJkZWwiLCJpbmNyIiwiZXhwaXJlIiwicyIsIndyYXBUY3AiLCJub2RlQ2xpZW50IiwiZ2V0UmVkaXNDbGllbnQiLCJwcm9jZXNzIiwiZW52IiwiVVBTVEFTSF9SRURJU19SRVNUX1VSTCIsIlVQU1RBU0hfUkVESVNfUkVTVF9UT0tFTiIsIlJlZGlzIiwidXJsIiwidG9rZW4iLCJjcmVhdGVDbGllbnQiLCJyYXciLCJSRURJU19VUkwiLCJzb2NrZXQiLCJyZWNvbm5lY3RTdHJhdGVneSIsInJldHJpZXMiLCJFcnJvciIsIm9uIiwiZXJyIiwiY29uc29sZSIsImVycm9yIiwiY29ubmVjdCIsImxvZyIsIndhcm4iLCJtZXNzYWdlIiwicmVkaXNQcm9taXNlIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api-node)/./lib/redis.js\n");

/***/ }),

/***/ "(api-node)/./lib/redis/formatkey.js":
/*!********************************!*\
  !*** ./lib/redis/formatkey.js ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   safeRedisKey: () => (/* binding */ safeRedisKey)\n/* harmony export */ });\n// lib/redis/formatKey.js\n/**\n * Safely formats an array of strings or values into a sanitized Redis key.\n * It removes dangerous characters and limits each segment to 64 characters.\n * @param {string[]} parts - Array of key segments\n * @returns {string} - Safe Redis key\n */ function safeRedisKey(parts = []) {\n    return parts.map((p)=>String(p || '').trim().replace(/[^a-zA-Z0-9:_-]/g, '') // remove unsafe characters\n        .slice(0, 64) // limit each part\n    ).join(':');\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL2xpYi9yZWRpcy9mb3JtYXRrZXkuanMiLCJtYXBwaW5ncyI6Ijs7OztBQUFBLHlCQUF5QjtBQUV6Qjs7Ozs7Q0FLQyxHQUNNLFNBQVNBLGFBQWFDLFFBQVEsRUFBRTtJQUNuQyxPQUFPQSxNQUNKQyxHQUFHLENBQUNDLENBQUFBLElBQ0hDLE9BQU9ELEtBQUssSUFDVEUsSUFBSSxHQUNKQyxPQUFPLENBQUMsb0JBQW9CLElBQUksMkJBQTJCO1NBQzNEQyxLQUFLLENBQUMsR0FBRyxJQUF1QixrQkFBa0I7TUFFdERDLElBQUksQ0FBQztBQUNWIiwic291cmNlcyI6WyIvVXNlcnMvZW1vbnRhemVyaS9Eb2N1bWVudHMvcHJvamVjdHMvc2hlbGwtc3Rvcmllcy1zdHVkaW8vbGliL3JlZGlzL2Zvcm1hdGtleS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBsaWIvcmVkaXMvZm9ybWF0S2V5LmpzXG5cbi8qKlxuICogU2FmZWx5IGZvcm1hdHMgYW4gYXJyYXkgb2Ygc3RyaW5ncyBvciB2YWx1ZXMgaW50byBhIHNhbml0aXplZCBSZWRpcyBrZXkuXG4gKiBJdCByZW1vdmVzIGRhbmdlcm91cyBjaGFyYWN0ZXJzIGFuZCBsaW1pdHMgZWFjaCBzZWdtZW50IHRvIDY0IGNoYXJhY3RlcnMuXG4gKiBAcGFyYW0ge3N0cmluZ1tdfSBwYXJ0cyAtIEFycmF5IG9mIGtleSBzZWdtZW50c1xuICogQHJldHVybnMge3N0cmluZ30gLSBTYWZlIFJlZGlzIGtleVxuICovXG5leHBvcnQgZnVuY3Rpb24gc2FmZVJlZGlzS2V5KHBhcnRzID0gW10pIHtcbiAgICByZXR1cm4gcGFydHNcbiAgICAgIC5tYXAocCA9PlxuICAgICAgICBTdHJpbmcocCB8fCAnJylcbiAgICAgICAgICAudHJpbSgpXG4gICAgICAgICAgLnJlcGxhY2UoL1teYS16QS1aMC05Ol8tXS9nLCAnJykgLy8gcmVtb3ZlIHVuc2FmZSBjaGFyYWN0ZXJzXG4gICAgICAgICAgLnNsaWNlKDAsIDY0KSAgICAgICAgICAgICAgICAgICAgLy8gbGltaXQgZWFjaCBwYXJ0XG4gICAgICApXG4gICAgICAuam9pbignOicpO1xuICB9XG4gIFxuICAiXSwibmFtZXMiOlsic2FmZVJlZGlzS2V5IiwicGFydHMiLCJtYXAiLCJwIiwiU3RyaW5nIiwidHJpbSIsInJlcGxhY2UiLCJzbGljZSIsImpvaW4iXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api-node)/./lib/redis/formatkey.js\n");

/***/ }),

/***/ "(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fproducts%2F%5Bid%5D%2Fmedia&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fproducts%2F%5Bid%5D%2Fmedia%2Findex.js&middlewareConfigBase64=e30%3D!":
/*!********************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fproducts%2F%5Bid%5D%2Fmedia&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fproducts%2F%5Bid%5D%2Fmedia%2Findex.js&middlewareConfigBase64=e30%3D! ***!
  \********************************************************************************************************************************************************************************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   handler: () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_api_utils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/api-utils */ \"(api-node)/./node_modules/next/dist/server/api-utils/index.js\");\n/* harmony import */ var next_dist_server_api_utils__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_api_utils__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/route-kind */ \"(api-node)/./node_modules/next/dist/server/route-kind.js\");\n/* harmony import */ var next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/route-modules/pages-api/module.compiled */ \"(api-node)/./node_modules/next/dist/server/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api-node)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_products_id_media_index_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./pages/api/products/[id]/media/index.js */ \"(api-node)/./pages/api/products/[id]/media/index.js\");\n/* harmony import */ var next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! next/dist/server/lib/trace/tracer */ \"(api-node)/./node_modules/next/dist/server/lib/trace/tracer.js\");\n/* harmony import */ var next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_5__);\n/* harmony import */ var next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! next/dist/server/lib/trace/constants */ \"(api-node)/./node_modules/next/dist/server/lib/trace/constants.js\");\n/* harmony import */ var next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_6___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_6__);\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_pages_api_products_id_media_index_js__WEBPACK_IMPORTED_MODULE_4__]);\n_pages_api_products_id_media_index_js__WEBPACK_IMPORTED_MODULE_4__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\n// Import the userland code.\n\n\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_3__.hoist)(_pages_api_products_id_media_index_js__WEBPACK_IMPORTED_MODULE_4__, 'default'));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_3__.hoist)(_pages_api_products_id_media_index_js__WEBPACK_IMPORTED_MODULE_4__, 'config');\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_2__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/products/[id]/media\",\n        pathname: \"/api/products/[id]/media\",\n        // The following aren't used in production.\n        bundlePath: '',\n        filename: ''\n    },\n    userland: _pages_api_products_id_media_index_js__WEBPACK_IMPORTED_MODULE_4__,\n    distDir: \".next\" || 0,\n    relativeProjectDir:  false || ''\n});\nasync function handler(req, res, ctx) {\n    let srcPage = \"/api/products/[id]/media\";\n    // turbopack doesn't normalize `/index` in the page name\n    // so we need to to process dynamic routes properly\n    // TODO: fix turbopack providing differing value from webpack\n    if (false) {}\n    const prepareResult = await routeModule.prepare(req, res, {\n        srcPage\n    });\n    if (!prepareResult) {\n        res.statusCode = 400;\n        res.end('Bad Request');\n        ctx.waitUntil == null ? void 0 : ctx.waitUntil.call(ctx, Promise.resolve());\n        return;\n    }\n    const { query, params, prerenderManifest, routerServerContext } = prepareResult;\n    try {\n        const method = req.method || 'GET';\n        const tracer = (0,next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_5__.getTracer)();\n        const activeSpan = tracer.getActiveScopeSpan();\n        const onRequestError = routeModule.instrumentationOnRequestError.bind(routeModule);\n        const invokeRouteModule = async (span)=>routeModule.render(req, res, {\n                query: {\n                    ...query,\n                    ...params\n                },\n                params,\n                allowedRevalidateHeaderKeys: [],\n                multiZoneDraftMode: Boolean(false),\n                trustHostHeader: false,\n                // TODO: get this from from runtime env so manifest\n                // doesn't need to load\n                previewProps: prerenderManifest.preview,\n                propagateError: false,\n                dev: routeModule.isDev,\n                page: \"/api/products/[id]/media\",\n                internalRevalidate: routerServerContext == null ? void 0 : routerServerContext.revalidate,\n                onError: (...args)=>onRequestError(req, ...args)\n            }).finally(()=>{\n                if (!span) return;\n                span.setAttributes({\n                    'http.status_code': res.statusCode,\n                    'next.rsc': false\n                });\n                const rootSpanAttributes = tracer.getRootSpanAttributes();\n                // We were unable to get attributes, probably OTEL is not enabled\n                if (!rootSpanAttributes) {\n                    return;\n                }\n                if (rootSpanAttributes.get('next.span_type') !== next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_6__.BaseServerSpan.handleRequest) {\n                    console.warn(`Unexpected root span type '${rootSpanAttributes.get('next.span_type')}'. Please report this Next.js issue https://github.com/vercel/next.js`);\n                    return;\n                }\n                const route = rootSpanAttributes.get('next.route');\n                if (route) {\n                    const name = `${method} ${route}`;\n                    span.setAttributes({\n                        'next.route': route,\n                        'http.route': route,\n                        'next.span_name': name\n                    });\n                    span.updateName(name);\n                } else {\n                    span.updateName(`${method} ${req.url}`);\n                }\n            });\n        // TODO: activeSpan code path is for when wrapped by\n        // next-server can be removed when this is no longer used\n        if (activeSpan) {\n            await invokeRouteModule(activeSpan);\n        } else {\n            await tracer.withPropagatedContext(req.headers, ()=>tracer.trace(next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_6__.BaseServerSpan.handleRequest, {\n                    spanName: `${method} ${req.url}`,\n                    kind: next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_5__.SpanKind.SERVER,\n                    attributes: {\n                        'http.method': method,\n                        'http.target': req.url\n                    }\n                }, invokeRouteModule));\n        }\n    } catch (err) {\n        // we re-throw in dev to show the error overlay\n        if (routeModule.isDev) {\n            throw err;\n        }\n        // this is technically an invariant as error handling\n        // should be done inside of api-resolver onError\n        (0,next_dist_server_api_utils__WEBPACK_IMPORTED_MODULE_0__.sendError)(res, 500, 'Internal Server Error');\n    } finally{\n        // We don't allow any waitUntil work in pages API routes currently\n        // so if callback is present return with resolved promise since no\n        // pending work\n        ctx.waitUntil == null ? void 0 : ctx.waitUntil.call(ctx, Promise.resolve());\n    }\n}\n\n//# sourceMappingURL=pages-api.js.map\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL25vZGVfbW9kdWxlcy9uZXh0L2Rpc3QvYnVpbGQvd2VicGFjay9sb2FkZXJzL25leHQtcm91dGUtbG9hZGVyL2luZGV4LmpzP2tpbmQ9UEFHRVNfQVBJJnBhZ2U9JTJGYXBpJTJGcHJvZHVjdHMlMkYlNUJpZCU1RCUyRm1lZGlhJnByZWZlcnJlZFJlZ2lvbj0mYWJzb2x1dGVQYWdlUGF0aD0uJTJGcGFnZXMlMkZhcGklMkZwcm9kdWN0cyUyRiU1QmlkJTVEJTJGbWVkaWElMkZpbmRleC5qcyZtaWRkbGV3YXJlQ29uZmlnQmFzZTY0PWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBdUQ7QUFDQztBQUN1QztBQUNyQztBQUMxRDtBQUNxRTtBQUNHO0FBQ0Y7QUFDdEU7QUFDQSxpRUFBZSx3RUFBSyxDQUFDLGtFQUFRLFlBQVksRUFBQztBQUMxQztBQUNPLGVBQWUsd0VBQUssQ0FBQyxrRUFBUTtBQUNwQztBQUNBLHdCQUF3Qix5R0FBbUI7QUFDM0M7QUFDQSxjQUFjLGtFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsWUFBWTtBQUNaLGFBQWEsT0FBb0MsSUFBSSxDQUFFO0FBQ3ZELHdCQUF3QixNQUF1QztBQUMvRCxDQUFDO0FBQ007QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVEsS0FBcUIsRUFBRSxFQUUxQjtBQUNMO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSx3REFBd0Q7QUFDcEU7QUFDQTtBQUNBLHVCQUF1Qiw0RUFBUztBQUNoQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQSw2Q0FBNkMsRUFBNkM7QUFDMUYsNENBQTRDLEtBQXdDO0FBQ3BGLGlDQUFpQyxLQUFvQztBQUNyRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpRUFBaUUsZ0ZBQWM7QUFDL0UsK0RBQStELHlDQUF5QztBQUN4RztBQUNBO0FBQ0E7QUFDQTtBQUNBLG9DQUFvQyxRQUFRLEVBQUUsTUFBTTtBQUNwRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBLGtCQUFrQjtBQUNsQix1Q0FBdUMsUUFBUSxFQUFFLFFBQVE7QUFDekQ7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1YsNkVBQTZFLGdGQUFjO0FBQzNGLGlDQUFpQyxRQUFRLEVBQUUsUUFBUTtBQUNuRCwwQkFBMEIsdUVBQVE7QUFDbEM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUSxxRUFBUztBQUNqQixNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBIiwic291cmNlcyI6WyIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgc2VuZEVycm9yIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvYXBpLXV0aWxzXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBQYWdlc0FQSVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvcm91dGUtbW9kdWxlcy9wYWdlcy1hcGkvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBob2lzdCB9IGZyb20gXCJuZXh0L2Rpc3QvYnVpbGQvdGVtcGxhdGVzL2hlbHBlcnNcIjtcbi8vIEltcG9ydCB0aGUgdXNlcmxhbmQgY29kZS5cbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIuL3BhZ2VzL2FwaS9wcm9kdWN0cy9baWRdL21lZGlhL2luZGV4LmpzXCI7XG5pbXBvcnQgeyBnZXRUcmFjZXIsIFNwYW5LaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3RyYWNlL3RyYWNlclwiO1xuaW1wb3J0IHsgQmFzZVNlcnZlclNwYW4gfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9saWIvdHJhY2UvY29uc3RhbnRzXCI7XG4vLyBSZS1leHBvcnQgdGhlIGhhbmRsZXIgKHNob3VsZCBiZSB0aGUgZGVmYXVsdCBleHBvcnQpLlxuZXhwb3J0IGRlZmF1bHQgaG9pc3QodXNlcmxhbmQsICdkZWZhdWx0Jyk7XG4vLyBSZS1leHBvcnQgY29uZmlnLlxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IGhvaXN0KHVzZXJsYW5kLCAnY29uZmlnJyk7XG4vLyBDcmVhdGUgYW5kIGV4cG9ydCB0aGUgcm91dGUgbW9kdWxlIHRoYXQgd2lsbCBiZSBjb25zdW1lZC5cbmNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IFBhZ2VzQVBJUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLlBBR0VTX0FQSSxcbiAgICAgICAgcGFnZTogXCIvYXBpL3Byb2R1Y3RzL1tpZF0vbWVkaWFcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9wcm9kdWN0cy9baWRdL21lZGlhXCIsXG4gICAgICAgIC8vIFRoZSBmb2xsb3dpbmcgYXJlbid0IHVzZWQgaW4gcHJvZHVjdGlvbi5cbiAgICAgICAgYnVuZGxlUGF0aDogJycsXG4gICAgICAgIGZpbGVuYW1lOiAnJ1xuICAgIH0sXG4gICAgdXNlcmxhbmQsXG4gICAgZGlzdERpcjogcHJvY2Vzcy5lbnYuX19ORVhUX1JFTEFUSVZFX0RJU1RfRElSIHx8ICcnLFxuICAgIHJlbGF0aXZlUHJvamVjdERpcjogcHJvY2Vzcy5lbnYuX19ORVhUX1JFTEFUSVZFX1BST0pFQ1RfRElSIHx8ICcnXG59KTtcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBoYW5kbGVyKHJlcSwgcmVzLCBjdHgpIHtcbiAgICBsZXQgc3JjUGFnZSA9IFwiL2FwaS9wcm9kdWN0cy9baWRdL21lZGlhXCI7XG4gICAgLy8gdHVyYm9wYWNrIGRvZXNuJ3Qgbm9ybWFsaXplIGAvaW5kZXhgIGluIHRoZSBwYWdlIG5hbWVcbiAgICAvLyBzbyB3ZSBuZWVkIHRvIHRvIHByb2Nlc3MgZHluYW1pYyByb3V0ZXMgcHJvcGVybHlcbiAgICAvLyBUT0RPOiBmaXggdHVyYm9wYWNrIHByb3ZpZGluZyBkaWZmZXJpbmcgdmFsdWUgZnJvbSB3ZWJwYWNrXG4gICAgaWYgKHByb2Nlc3MuZW52LlRVUkJPUEFDSykge1xuICAgICAgICBzcmNQYWdlID0gc3JjUGFnZS5yZXBsYWNlKC9cXC9pbmRleCQvLCAnJykgfHwgJy8nO1xuICAgIH1cbiAgICBjb25zdCBwcmVwYXJlUmVzdWx0ID0gYXdhaXQgcm91dGVNb2R1bGUucHJlcGFyZShyZXEsIHJlcywge1xuICAgICAgICBzcmNQYWdlXG4gICAgfSk7XG4gICAgaWYgKCFwcmVwYXJlUmVzdWx0KSB7XG4gICAgICAgIHJlcy5zdGF0dXNDb2RlID0gNDAwO1xuICAgICAgICByZXMuZW5kKCdCYWQgUmVxdWVzdCcpO1xuICAgICAgICBjdHgud2FpdFVudGlsID09IG51bGwgPyB2b2lkIDAgOiBjdHgud2FpdFVudGlsLmNhbGwoY3R4LCBQcm9taXNlLnJlc29sdmUoKSk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgeyBxdWVyeSwgcGFyYW1zLCBwcmVyZW5kZXJNYW5pZmVzdCwgcm91dGVyU2VydmVyQ29udGV4dCB9ID0gcHJlcGFyZVJlc3VsdDtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBtZXRob2QgPSByZXEubWV0aG9kIHx8ICdHRVQnO1xuICAgICAgICBjb25zdCB0cmFjZXIgPSBnZXRUcmFjZXIoKTtcbiAgICAgICAgY29uc3QgYWN0aXZlU3BhbiA9IHRyYWNlci5nZXRBY3RpdmVTY29wZVNwYW4oKTtcbiAgICAgICAgY29uc3Qgb25SZXF1ZXN0RXJyb3IgPSByb3V0ZU1vZHVsZS5pbnN0cnVtZW50YXRpb25PblJlcXVlc3RFcnJvci5iaW5kKHJvdXRlTW9kdWxlKTtcbiAgICAgICAgY29uc3QgaW52b2tlUm91dGVNb2R1bGUgPSBhc3luYyAoc3Bhbik9PnJvdXRlTW9kdWxlLnJlbmRlcihyZXEsIHJlcywge1xuICAgICAgICAgICAgICAgIHF1ZXJ5OiB7XG4gICAgICAgICAgICAgICAgICAgIC4uLnF1ZXJ5LFxuICAgICAgICAgICAgICAgICAgICAuLi5wYXJhbXNcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHBhcmFtcyxcbiAgICAgICAgICAgICAgICBhbGxvd2VkUmV2YWxpZGF0ZUhlYWRlcktleXM6IHByb2Nlc3MuZW52Ll9fTkVYVF9BTExPV0VEX1JFVkFMSURBVEVfSEVBREVSUyxcbiAgICAgICAgICAgICAgICBtdWx0aVpvbmVEcmFmdE1vZGU6IEJvb2xlYW4ocHJvY2Vzcy5lbnYuX19ORVhUX01VTFRJX1pPTkVfRFJBRlRfTU9ERSksXG4gICAgICAgICAgICAgICAgdHJ1c3RIb3N0SGVhZGVyOiBwcm9jZXNzLmVudi5fX05FWFRfVFJVU1RfSE9TVF9IRUFERVIsXG4gICAgICAgICAgICAgICAgLy8gVE9ETzogZ2V0IHRoaXMgZnJvbSBmcm9tIHJ1bnRpbWUgZW52IHNvIG1hbmlmZXN0XG4gICAgICAgICAgICAgICAgLy8gZG9lc24ndCBuZWVkIHRvIGxvYWRcbiAgICAgICAgICAgICAgICBwcmV2aWV3UHJvcHM6IHByZXJlbmRlck1hbmlmZXN0LnByZXZpZXcsXG4gICAgICAgICAgICAgICAgcHJvcGFnYXRlRXJyb3I6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGRldjogcm91dGVNb2R1bGUuaXNEZXYsXG4gICAgICAgICAgICAgICAgcGFnZTogXCIvYXBpL3Byb2R1Y3RzL1tpZF0vbWVkaWFcIixcbiAgICAgICAgICAgICAgICBpbnRlcm5hbFJldmFsaWRhdGU6IHJvdXRlclNlcnZlckNvbnRleHQgPT0gbnVsbCA/IHZvaWQgMCA6IHJvdXRlclNlcnZlckNvbnRleHQucmV2YWxpZGF0ZSxcbiAgICAgICAgICAgICAgICBvbkVycm9yOiAoLi4uYXJncyk9Pm9uUmVxdWVzdEVycm9yKHJlcSwgLi4uYXJncylcbiAgICAgICAgICAgIH0pLmZpbmFsbHkoKCk9PntcbiAgICAgICAgICAgICAgICBpZiAoIXNwYW4pIHJldHVybjtcbiAgICAgICAgICAgICAgICBzcGFuLnNldEF0dHJpYnV0ZXMoe1xuICAgICAgICAgICAgICAgICAgICAnaHR0cC5zdGF0dXNfY29kZSc6IHJlcy5zdGF0dXNDb2RlLFxuICAgICAgICAgICAgICAgICAgICAnbmV4dC5yc2MnOiBmYWxzZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGNvbnN0IHJvb3RTcGFuQXR0cmlidXRlcyA9IHRyYWNlci5nZXRSb290U3BhbkF0dHJpYnV0ZXMoKTtcbiAgICAgICAgICAgICAgICAvLyBXZSB3ZXJlIHVuYWJsZSB0byBnZXQgYXR0cmlidXRlcywgcHJvYmFibHkgT1RFTCBpcyBub3QgZW5hYmxlZFxuICAgICAgICAgICAgICAgIGlmICghcm9vdFNwYW5BdHRyaWJ1dGVzKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHJvb3RTcGFuQXR0cmlidXRlcy5nZXQoJ25leHQuc3Bhbl90eXBlJykgIT09IEJhc2VTZXJ2ZXJTcGFuLmhhbmRsZVJlcXVlc3QpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKGBVbmV4cGVjdGVkIHJvb3Qgc3BhbiB0eXBlICcke3Jvb3RTcGFuQXR0cmlidXRlcy5nZXQoJ25leHQuc3Bhbl90eXBlJyl9Jy4gUGxlYXNlIHJlcG9ydCB0aGlzIE5leHQuanMgaXNzdWUgaHR0cHM6Ly9naXRodWIuY29tL3ZlcmNlbC9uZXh0LmpzYCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29uc3Qgcm91dGUgPSByb290U3BhbkF0dHJpYnV0ZXMuZ2V0KCduZXh0LnJvdXRlJyk7XG4gICAgICAgICAgICAgICAgaWYgKHJvdXRlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG5hbWUgPSBgJHttZXRob2R9ICR7cm91dGV9YDtcbiAgICAgICAgICAgICAgICAgICAgc3Bhbi5zZXRBdHRyaWJ1dGVzKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICduZXh0LnJvdXRlJzogcm91dGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAnaHR0cC5yb3V0ZSc6IHJvdXRlLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ25leHQuc3Bhbl9uYW1lJzogbmFtZVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgc3Bhbi51cGRhdGVOYW1lKG5hbWUpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHNwYW4udXBkYXRlTmFtZShgJHttZXRob2R9ICR7cmVxLnVybH1gKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgLy8gVE9ETzogYWN0aXZlU3BhbiBjb2RlIHBhdGggaXMgZm9yIHdoZW4gd3JhcHBlZCBieVxuICAgICAgICAvLyBuZXh0LXNlcnZlciBjYW4gYmUgcmVtb3ZlZCB3aGVuIHRoaXMgaXMgbm8gbG9uZ2VyIHVzZWRcbiAgICAgICAgaWYgKGFjdGl2ZVNwYW4pIHtcbiAgICAgICAgICAgIGF3YWl0IGludm9rZVJvdXRlTW9kdWxlKGFjdGl2ZVNwYW4pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgYXdhaXQgdHJhY2VyLndpdGhQcm9wYWdhdGVkQ29udGV4dChyZXEuaGVhZGVycywgKCk9PnRyYWNlci50cmFjZShCYXNlU2VydmVyU3Bhbi5oYW5kbGVSZXF1ZXN0LCB7XG4gICAgICAgICAgICAgICAgICAgIHNwYW5OYW1lOiBgJHttZXRob2R9ICR7cmVxLnVybH1gLFxuICAgICAgICAgICAgICAgICAgICBraW5kOiBTcGFuS2luZC5TRVJWRVIsXG4gICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZXM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICdodHRwLm1ldGhvZCc6IG1ldGhvZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICdodHRwLnRhcmdldCc6IHJlcS51cmxcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sIGludm9rZVJvdXRlTW9kdWxlKSk7XG4gICAgICAgIH1cbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgLy8gd2UgcmUtdGhyb3cgaW4gZGV2IHRvIHNob3cgdGhlIGVycm9yIG92ZXJsYXlcbiAgICAgICAgaWYgKHJvdXRlTW9kdWxlLmlzRGV2KSB7XG4gICAgICAgICAgICB0aHJvdyBlcnI7XG4gICAgICAgIH1cbiAgICAgICAgLy8gdGhpcyBpcyB0ZWNobmljYWxseSBhbiBpbnZhcmlhbnQgYXMgZXJyb3IgaGFuZGxpbmdcbiAgICAgICAgLy8gc2hvdWxkIGJlIGRvbmUgaW5zaWRlIG9mIGFwaS1yZXNvbHZlciBvbkVycm9yXG4gICAgICAgIHNlbmRFcnJvcihyZXMsIDUwMCwgJ0ludGVybmFsIFNlcnZlciBFcnJvcicpO1xuICAgIH0gZmluYWxseXtcbiAgICAgICAgLy8gV2UgZG9uJ3QgYWxsb3cgYW55IHdhaXRVbnRpbCB3b3JrIGluIHBhZ2VzIEFQSSByb3V0ZXMgY3VycmVudGx5XG4gICAgICAgIC8vIHNvIGlmIGNhbGxiYWNrIGlzIHByZXNlbnQgcmV0dXJuIHdpdGggcmVzb2x2ZWQgcHJvbWlzZSBzaW5jZSBub1xuICAgICAgICAvLyBwZW5kaW5nIHdvcmtcbiAgICAgICAgY3R4LndhaXRVbnRpbCA9PSBudWxsID8gdm9pZCAwIDogY3R4LndhaXRVbnRpbC5jYWxsKGN0eCwgUHJvbWlzZS5yZXNvbHZlKCkpO1xuICAgIH1cbn1cblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cGFnZXMtYXBpLmpzLm1hcFxuIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fproducts%2F%5Bid%5D%2Fmedia&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fproducts%2F%5Bid%5D%2Fmedia%2Findex.js&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api-node)/./pages/api/products/[id]/media/index.js":
/*!************************************************!*\
  !*** ./pages/api/products/[id]/media/index.js ***!
  \************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var sqlite__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! sqlite */ \"sqlite\");\n/* harmony import */ var sqlite3__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! sqlite3 */ \"sqlite3\");\n/* harmony import */ var sqlite3__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(sqlite3__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _lib_middleware_createAdminHandler__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/middleware/createAdminHandler */ \"(api-node)/./lib/middleware/createAdminHandler.js\");\n/* harmony import */ var _lib_api__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/lib/api */ \"(api-node)/./lib/api.js\");\n/* harmony import */ var _lib_redis__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @/lib/redis */ \"(api-node)/./lib/redis.js\");\n/* harmony import */ var _lib_redis_formatkey__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @/lib/redis/formatkey */ \"(api-node)/./lib/redis/formatkey.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([sqlite__WEBPACK_IMPORTED_MODULE_1__, _lib_middleware_createAdminHandler__WEBPACK_IMPORTED_MODULE_3__]);\n([sqlite__WEBPACK_IMPORTED_MODULE_1__, _lib_middleware_createAdminHandler__WEBPACK_IMPORTED_MODULE_3__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n// pages/api/admin/products/[id]/media/index.js\n\n\n\n\n\n\n\n// ---------- DB ----------\nconst dbPath = path__WEBPACK_IMPORTED_MODULE_0___default().join(process.cwd(), \"data\", \"shells_shop.db\");\nconst openDB = ()=>(0,sqlite__WEBPACK_IMPORTED_MODULE_1__.open)({\n        filename: dbPath,\n        driver: (sqlite3__WEBPACK_IMPORTED_MODULE_2___default().Database)\n    });\n// ---------- Debug ----------\nconst DEBUG = process.env.DEBUG_MEDIA === \"1\";\nconst t0 = ()=>typeof performance !== \"undefined\" ? performance.now() : Date.now();\nconst took = (s)=>`${Math.round((typeof performance !== \"undefined\" ? performance.now() : Date.now()) - s)}ms`;\nconst head = (v, n = 180)=>{\n    try {\n        if (typeof v === \"string\") return v.slice(0, n).replace(/\\n/g, \"âŽ\");\n        return JSON.stringify(v)?.slice(0, n);\n    } catch  {\n        return String(v).slice(0, n);\n    }\n};\nconst dbg = (...a)=>DEBUG && console.log(...a);\n// ---------- helpers ----------\nconst isPosInt = (v)=>Number.isInteger(v) && v > 0;\nconst clampLen = (s, n)=>typeof s === \"string\" ? s.slice(0, n) : s;\nconst KIND_SET = new Set([\n    \"image\",\n    \"video\"\n]);\nconst isHTTPSUrl = (s)=>{\n    try {\n        const u = new URL(String(s));\n        return u.protocol === \"https:\";\n    } catch  {\n        return false;\n    }\n};\nasync function invalidateProductsCache() {\n    const start = t0();\n    try {\n        const redis = await (0,_lib_redis__WEBPACK_IMPORTED_MODULE_5__.getRedisClient)();\n        const pattern = `${(0,_lib_redis_formatkey__WEBPACK_IMPORTED_MODULE_6__.safeRedisKey)([\n            \"products\"\n        ])}:*`;\n        const keys = await redis.keys(pattern);\n        if (keys.length) await redis.del(...keys);\n        dbg(`[media] cache invalidated ${keys.length} keys in ${took(start)}`);\n    } catch (e) {\n        console.warn(\"âš ï¸ Redis cache invalidation skipped:\", e?.message || e);\n    }\n}\n// Admin-protected handler (auth + rate limit inside, returns JSON on 401)\nconst handler = (0,_lib_middleware_createAdminHandler__WEBPACK_IMPORTED_MODULE_3__.createAdminHandler)({\n    rateLimit: {\n        limit: 60,\n        window: 60\n    }\n});\n// ========== GET /api/admin/products/:id/media  -> { items: [...] } ==========\nhandler.get(async (req, res)=>{\n    const start = t0();\n    res.setHeader(\"Content-Type\", \"application/json; charset=utf-8\");\n    res.setHeader(\"Cache-Control\", \"no-store\");\n    const productId = Number(req.query.id);\n    if (!isPosInt(productId)) {\n        return (0,_lib_api__WEBPACK_IMPORTED_MODULE_4__.sendErrorResponse)(res, 400, \"Invalid product id\");\n    }\n    try {\n        const db = await openDB();\n        const rows = await db.all(`SELECT id, product_id, kind, public_id, secure_url, format,\n              width, height, duration, sort_order, is_primary, created_at\n         FROM product_media\n        WHERE product_id = ?\n        ORDER BY is_primary DESC, sort_order ASC, id ASC`, productId);\n        const items = rows.map((m)=>({\n                id: m.id,\n                product_id: m.product_id,\n                kind: m.kind,\n                public_id: m.public_id,\n                secure_url: m.secure_url,\n                format: m.format,\n                width: m.width != null ? Number(m.width) : null,\n                height: m.height != null ? Number(m.height) : null,\n                duration: m.duration != null ? Number(m.duration) : null,\n                sort_order: m.sort_order != null ? Number(m.sort_order) : 0,\n                is_primary: Number(m.is_primary) === 1,\n                created_at: m.created_at\n            }));\n        dbg(`[media][GET] pid=${productId} rows=${rows.length} first=${head(items[0])} in ${took(start)}`);\n        return (0,_lib_api__WEBPACK_IMPORTED_MODULE_4__.sendSuccessResponse)(res, 200, \"OK\", {\n            items\n        });\n    } catch (err) {\n        console.error(\"âŒ Load media failed:\", err);\n        return (0,_lib_api__WEBPACK_IMPORTED_MODULE_4__.sendErrorResponse)(res, 500, \"Failed to load media\");\n    }\n});\n// ========== POST /api/admin/products/:id/media ==========\n/**\n * Body:\n * {\n *   public_id, secure_url, kind('image'|'video'),\n *   format?, width?, height?, duration?, sort_order?, is_primary?\n * }\n */ handler.post(async (req, res)=>{\n    const start = t0();\n    res.setHeader(\"Content-Type\", \"application/json; charset=utf-8\");\n    res.setHeader(\"Cache-Control\", \"no-store\");\n    const productId = Number(req.query.id);\n    if (!isPosInt(productId)) {\n        return (0,_lib_api__WEBPACK_IMPORTED_MODULE_4__.sendErrorResponse)(res, 400, \"Invalid product id\");\n    }\n    const { public_id, secure_url, kind, format = null, width = null, height = null, duration = null, sort_order, is_primary = 0 } = req.body || {};\n    // sanitize inputs\n    const k = String(kind || \"\").toLowerCase();\n    const pubId = clampLen(public_id, 255);\n    const url = clampLen(secure_url, 2048);\n    const fmt = format ? clampLen(String(format), 32) : null;\n    const w = width != null ? Number(width) : null;\n    const h = height != null ? Number(height) : null;\n    const d = duration != null ? Number(duration) : null;\n    const makePrimary = Number(is_primary) === 1 || is_primary === true;\n    if (!pubId || !url || !KIND_SET.has(k)) {\n        return (0,_lib_api__WEBPACK_IMPORTED_MODULE_4__.sendErrorResponse)(res, 400, \"public_id, secure_url and kind ('image'|'video') are required\");\n    }\n    if (!isHTTPSUrl(url)) {\n        return (0,_lib_api__WEBPACK_IMPORTED_MODULE_4__.sendErrorResponse)(res, 400, \"secure_url must be a valid https URL\");\n    }\n    if (w != null && (!Number.isFinite(w) || w < 0)) {\n        return (0,_lib_api__WEBPACK_IMPORTED_MODULE_4__.sendErrorResponse)(res, 400, \"width must be a non-negative number\");\n    }\n    if (h != null && (!Number.isFinite(h) || h < 0)) {\n        return (0,_lib_api__WEBPACK_IMPORTED_MODULE_4__.sendErrorResponse)(res, 400, \"height must be a non-negative number\");\n    }\n    if (d != null && (!Number.isFinite(d) || d < 0)) {\n        return (0,_lib_api__WEBPACK_IMPORTED_MODULE_4__.sendErrorResponse)(res, 400, \"duration must be a non-negative number\");\n    }\n    let db;\n    try {\n        db = await openDB();\n        await db.exec(\"BEGIN\");\n        // ensure product exists\n        const p = await db.get(`SELECT id FROM products WHERE id = ?`, productId);\n        if (!p) {\n            await db.exec(\"ROLLBACK\");\n            return (0,_lib_api__WEBPACK_IMPORTED_MODULE_4__.sendErrorResponse)(res, 404, \"Product not found\");\n        }\n        // determine sort order (append if not provided)\n        let order = Number.isFinite(Number(sort_order)) ? Number(sort_order) : NaN;\n        if (!Number.isFinite(order) || order < 0) {\n            const max = await db.get(`SELECT COALESCE(MAX(sort_order), -1) AS max_order\n           FROM product_media\n          WHERE product_id = ?`, productId);\n            order = Number(max?.max_order ?? -1) + 1;\n        }\n        if (makePrimary) {\n            await db.run(`UPDATE product_media SET is_primary = 0 WHERE product_id = ?`, productId);\n        }\n        const result = await db.run(`INSERT INTO product_media\n         (product_id, kind, public_id, secure_url, format, width, height, duration, sort_order, is_primary)\n       VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)`, productId, k, pubId, url, fmt, w != null ? w : null, h != null ? h : null, d != null ? d : null, order, makePrimary ? 1 : 0);\n        await db.exec(\"COMMIT\");\n        await invalidateProductsCache();\n        dbg(`[media][POST] pid=${productId} id=${result.lastID} primary=${makePrimary} sort=${order} in ${took(start)}`);\n        return (0,_lib_api__WEBPACK_IMPORTED_MODULE_4__.sendSuccessResponse)(res, 201, \"Media created\", {\n            id: result.lastID\n        });\n    } catch (err) {\n        try {\n            if (db) await db.exec(\"ROLLBACK\");\n        } catch  {}\n        console.error(\"âŒ Create media failed:\", err);\n        return (0,_lib_api__WEBPACK_IMPORTED_MODULE_4__.sendErrorResponse)(res, 500, \"Failed to create media\");\n    }\n});\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (handler);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL3BhZ2VzL2FwaS9wcm9kdWN0cy9baWRdL21lZGlhL2luZGV4LmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSwrQ0FBK0M7QUFDdkI7QUFDTTtBQUNBO0FBQzJDO0FBQ047QUFDdEI7QUFDUTtBQUVyRCwyQkFBMkI7QUFDM0IsTUFBTVEsU0FBU1IsZ0RBQVMsQ0FBQ1UsUUFBUUMsR0FBRyxJQUFJLFFBQVE7QUFDaEQsTUFBTUMsU0FBUyxJQUFNWCw0Q0FBSUEsQ0FBQztRQUFFWSxVQUFVTDtRQUFRTSxRQUFRWix5REFBZ0I7SUFBQztBQUV2RSw4QkFBOEI7QUFDOUIsTUFBTWMsUUFBUU4sUUFBUU8sR0FBRyxDQUFDQyxXQUFXLEtBQUs7QUFDMUMsTUFBTUMsS0FBSyxJQUFPLE9BQU9DLGdCQUFnQixjQUFjQSxZQUFZQyxHQUFHLEtBQUtDLEtBQUtELEdBQUc7QUFDbkYsTUFBTUUsT0FBTyxDQUFDQyxJQUNaLEdBQUdDLEtBQUtDLEtBQUssQ0FBQyxDQUFDLE9BQU9OLGdCQUFnQixjQUFjQSxZQUFZQyxHQUFHLEtBQUtDLEtBQUtELEdBQUcsRUFBQyxJQUFLRyxHQUFHLEVBQUUsQ0FBQztBQUM5RixNQUFNRyxPQUFPLENBQUNDLEdBQUdDLElBQUksR0FBRztJQUN0QixJQUFJO1FBQ0YsSUFBSSxPQUFPRCxNQUFNLFVBQVUsT0FBT0EsRUFBRUUsS0FBSyxDQUFDLEdBQUdELEdBQUdFLE9BQU8sQ0FBQyxPQUFPO1FBQy9ELE9BQU9DLEtBQUtDLFNBQVMsQ0FBQ0wsSUFBSUUsTUFBTSxHQUFHRDtJQUNyQyxFQUFFLE9BQU07UUFDTixPQUFPSyxPQUFPTixHQUFHRSxLQUFLLENBQUMsR0FBR0Q7SUFDNUI7QUFDRjtBQUNBLE1BQU1NLE1BQU0sQ0FBQyxHQUFHQyxJQUFNcEIsU0FBU3FCLFFBQVFDLEdBQUcsSUFBSUY7QUFFOUMsZ0NBQWdDO0FBQ2hDLE1BQU1HLFdBQVcsQ0FBQ1gsSUFBTVksT0FBT0MsU0FBUyxDQUFDYixNQUFN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QUFhLENBQUMsS0FBSztRQUN6QztRQUVBLElBQUlSLGFBQWE7WUFDZixNQUFNN0IsR0FBR3NDLEdBQUcsQ0FBQyxDQUFDLDREQUE0RCxDQUFDLEVBQUV6QztRQUMvRTtRQUVBLE1BQU0wQyxTQUFTLE1BQU12QyxHQUFHc0MsR0FBRyxDQUN6QixDQUFDOzs0Q0FFcUMsQ0FBQyxFQUN2Q3pDLFdBQ0F3QixHQUNBRSxPQUNBQyxLQUNBQyxLQUNBQyxLQUFLLE9BQU9BLElBQUksTUFDaEJDLEtBQUssT0FBT0EsSUFBSSxNQUNoQkMsS0FBSyxPQUFPQSxJQUFJLE1BQ2hCTSxPQUNBTCxjQUFjLElBQUk7UUFHcEIsTUFBTTdCLEdBQUdnQyxJQUFJLENBQUM7UUFDZCxNQUFNckQ7UUFFTmQsSUFDRSxDQUFDLGtCQUFrQixFQUFFZ0MsVUFBVSxJQUFJLEVBQUUwQyxPQUFPQyxNQUFNLENBQUMsU0FBUyxFQUFFWCxZQUFZLE1BQU0sRUFBRUssTUFBTSxJQUFJLEVBQUVqRixLQUM1RjJCLFFBQ0M7UUFFTCxPQUFPN0MsNkRBQW1CQSxDQUFDNEQsS0FBSyxLQUFLLGlCQUFpQjtZQUFFSSxJQUFJd0MsT0FBT0MsTUFBTTtRQUFDO0lBQzVFLEVBQUUsT0FBT3ZCLEtBQUs7UUFDWixJQUFJO1lBQ0YsSUFBSWpCLElBQUksTUFBTUEsR0FBR2dDLElBQUksQ0FBQztRQUN4QixFQUFFLE9BQU0sQ0FBQztRQUNUakUsUUFBUW1ELEtBQUssQ0FBQywwQkFBMEJEO1FBQ3hDLE9BQU9uRiwyREFBaUJBLENBQUM2RCxLQUFLLEtBQUs7SUFDckM7QUFDRjtBQUVBLGlFQUFlTixPQUFPQSxFQUFDIiwic291cmNlcyI6WyIvVXNlcnMvZW1vbnRhemVyaS9Eb2N1bWVudHMvcHJvamVjdHMvc2hlbGwtc3Rvcmllcy1zdHVkaW8vcGFnZXMvYXBpL3Byb2R1Y3RzL1tpZF0vbWVkaWEvaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gcGFnZXMvYXBpL2FkbWluL3Byb2R1Y3RzL1tpZF0vbWVkaWEvaW5kZXguanNcbmltcG9ydCBwYXRoIGZyb20gXCJwYXRoXCI7XG5pbXBvcnQgeyBvcGVuIH0gZnJvbSBcInNxbGl0ZVwiO1xuaW1wb3J0IHNxbGl0ZTMgZnJvbSBcInNxbGl0ZTNcIjtcbmltcG9ydCB7IGNyZWF0ZUFkbWluSGFuZGxlciB9IGZyb20gXCJAL2xpYi9taWRkbGV3YXJlL2NyZWF0ZUFkbWluSGFuZGxlclwiO1xuaW1wb3J0IHsgc2VuZEVycm9yUmVzcG9uc2UsIHNlbmRTdWNjZXNzUmVzcG9uc2UgfSBmcm9tIFwiQC9saWIvYXBpXCI7XG5pbXBvcnQgeyBnZXRSZWRpc0NsaWVudCB9IGZyb20gXCJAL2xpYi9yZWRpc1wiO1xuaW1wb3J0IHsgc2FmZVJlZGlzS2V5IH0gZnJvbSBcIkAvbGliL3JlZGlzL2Zvcm1hdGtleVwiO1xuXG4vLyAtLS0tLS0tLS0tIERCIC0tLS0tLS0tLS1cbmNvbnN0IGRiUGF0aCA9IHBhdGguam9pbihwcm9jZXNzLmN3ZCgpLCBcImRhdGFcIiwgXCJzaGVsbHNfc2hvcC5kYlwiKTtcbmNvbnN0IG9wZW5EQiA9ICgpID0+IG9wZW4oeyBmaWxlbmFtZTogZGJQYXRoLCBkcml2ZXI6IHNxbGl0ZTMuRGF0YWJhc2UgfSk7XG5cbi8vIC0tLS0tLS0tLS0gRGVidWcgLS0tLS0tLS0tLVxuY29uc3QgREVCVUcgPSBwcm9jZXNzLmVudi5ERUJVR19NRURJQSA9PT0gXCIxXCI7XG5jb25zdCB0MCA9ICgpID0+ICh0eXBlb2YgcGVyZm9ybWFuY2UgIT09IFwidW5kZWZpbmVkXCIgPyBwZXJmb3JtYW5jZS5ub3coKSA6IERhdGUubm93KCkpO1xuY29uc3QgdG9vayA9IChzKSA9PlxuICBgJHtNYXRoLnJvdW5kKCh0eXBlb2YgcGVyZm9ybWFuY2UgIT09IFwidW5kZWZpbmVkXCIgPyBwZXJmb3JtYW5jZS5ub3coKSA6IERhdGUubm93KCkpIC0gcyl9bXNgO1xuY29uc3QgaGVhZCA9ICh2LCBuID0gMTgwKSA9PiB7XG4gIHRyeSB7XG4gICAgaWYgKHR5cGVvZiB2ID09PSBcInN0cmluZ1wiKSByZXR1cm4gdi5zbGljZSgwLCBuKS5yZXBsYWNlKC9cXG4vZywgXCLij45cIik7XG4gICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KHYpPy5zbGljZSgwLCBuKTtcbiAgfSBjYXRjaCB7XG4gICAgcmV0dXJuIFN0cmluZyh2KS5zbGljZSgwLCBuKTtcbiAgfVxufTtcbmNvbnN0IGRiZyA9ICguLi5hKSA9PiBERUJVRyAmJiBjb25zb2xlLmxvZyguLi5hKTtcblxuLy8gLS0tLS0tLS0tLSBoZWxwZXJzIC0tLS0tLS0tLS1cbmNvbnN0IGlzUG9zSW50ID0gKHYpID0+IE51bWJlci5pc0ludGVnZXIodikgJiYgdiA+IDA7XG5jb25zdCBjbGFtcExlbiA9IChzLCBuKSA9PiAodHlwZW9mIHMgPT09IFwic3RyaW5nXCIgPyBzLnNsaWNlKDAsIG4pIDogcyk7XG5jb25zdCBLSU5EX1NFVCA9IG5ldyBTZXQoW1wiaW1hZ2VcIiwgXCJ2aWRlb1wiXSk7XG5jb25zdCBpc0hUVFBTVXJsID0gKHMpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB1ID0gbmV3IFVSTChTdHJpbmcocykpO1xuICAgIHJldHVybiB1LnByb3RvY29sID09PSBcImh0dHBzOlwiO1xuICB9IGNhdGNoIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbn07XG5cbmFzeW5jIGZ1bmN0aW9uIGludmFsaWRhdGVQcm9kdWN0c0NhY2hlKCkge1xuICBjb25zdCBzdGFydCA9IHQwKCk7XG4gIHRyeSB7XG4gICAgY29uc3QgcmVkaXMgPSBhd2FpdCBnZXRSZWRpc0NsaWVudCgpO1xuICAgIGNvbnN0IHBhdHRlcm4gPSBgJHtzYWZlUmVkaXNLZXkoW1wicHJvZHVjdHNcIl0pfToqYDtcbiAgICBjb25zdCBrZXlzID0gYXdhaXQgcmVkaXMua2V5cyhwYXR0ZXJuKTtcbiAgICBpZiAoa2V5cy5sZW5ndGgpIGF3YWl0IHJlZGlzLmRlbCguLi5rZXlzKTtcbiAgICBkYmcoYFttZWRpYV0gY2FjaGUgaW52YWxpZGF0ZWQgJHtrZXlzLmxlbmd0aH0ga2V5cyBpbiAke3Rvb2soc3RhcnQpfWApO1xuICB9IGNhdGNoIChlKSB7XG4gICAgY29uc29sZS53YXJuKFwi4pqg77iPIFJlZGlzIGNhY2hlIGludmFsaWRhdGlvbiBza2lwcGVkOlwiLCBlPy5tZXNzYWdlIHx8IGUpO1xuICB9XG59XG5cbi8vIEFkbWluLXByb3RlY3RlZCBoYW5kbGVyIChhdXRoICsgcmF0ZSBsaW1pdCBpbnNpZGUsIHJldHVybnMgSlNPTiBvbiA0MDEpXG5jb25zdCBoYW5kbGVyID0gY3JlYXRlQWRtaW5IYW5kbGVyKHsgcmF0ZUxpbWl0OiB7IGxpbWl0OiA2MCwgd2luZG93OiA2MCB9IH0pO1xuXG4vLyA9PT09PT09PT09IEdFVCAvYXBpL2FkbWluL3Byb2R1Y3RzLzppZC9tZWRpYSAgLT4geyBpdGVtczogWy4uLl0gfSA9PT09PT09PT09XG5oYW5kbGVyLmdldChhc3luYyAocmVxLCByZXMpID0+IHtcbiAgY29uc3Qgc3RhcnQgPSB0MCgpO1xuICByZXMuc2V0SGVhZGVyKFwiQ29udGVudC1UeXBlXCIsIFwiYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD11dGYtOFwiKTtcbiAgcmVzLnNldEhlYWRlcihcIkNhY2hlLUNvbnRyb2xcIiwgXCJuby1zdG9yZVwiKTtcblxuICBjb25zdCBwcm9kdWN0SWQgPSBOdW1iZXIocmVxLnF1ZXJ5LmlkKTtcbiAgaWYgKCFpc1Bvc0ludChwcm9kdWN0SWQpKSB7XG4gICAgcmV0dXJuIHNlbmRFcnJvclJlc3BvbnNlKHJlcywgNDAwLCBcIkludmFsaWQgcHJvZHVjdCBpZFwiKTtcbiAgfVxuXG4gIHRyeSB7XG4gICAgY29uc3QgZGIgPSBhd2FpdCBvcGVuREIoKTtcbiAgICBjb25zdCByb3dzID0gYXdhaXQgZGIuYWxsKFxuICAgICAgYFNFTEVDVCBpZCwgcHJvZHVjdF9pZCwga2luZCwgcHVibGljX2lkLCBzZWN1cmVfdXJsLCBmb3JtYXQsXG4gICAgICAgICAgICAgIHdpZHRoLCBoZWlnaHQsIGR1cmF0aW9uLCBzb3J0X29yZGVyLCBpc19wcmltYXJ5LCBjcmVhdGVkX2F0XG4gICAgICAgICBGUk9NIHByb2R1Y3RfbWVkaWFcbiAgICAgICAgV0hFUkUgcHJvZHVjdF9pZCA9ID9cbiAgICAgICAgT1JERVIgQlkgaXNfcHJpbWFyeSBERVNDLCBzb3J0X29yZGVyIEFTQywgaWQgQVNDYCxcbiAgICAgIHByb2R1Y3RJZFxuICAgICk7XG5cbiAgICBjb25zdCBpdGVtcyA9IHJvd3MubWFwKChtKSA9PiAoe1xuICAgICAgaWQ6IG0uaWQsXG4gICAgICBwcm9kdWN0X2lkOiBtLnByb2R1Y3RfaWQsXG4gICAgICBraW5kOiBtLmtpbmQsXG4gICAgICBwdWJsaWNfaWQ6IG0ucHVibGljX2lkLFxuICAgICAgc2VjdXJlX3VybDogbS5zZWN1cmVfdXJsLFxuICAgICAgZm9ybWF0OiBtLmZvcm1hdCxcbiAgICAgIHdpZHRoOiBtLndpZHRoICE9IG51bGwgPyBOdW1iZXIobS53aWR0aCkgOiBudWxsLFxuICAgICAgaGVpZ2h0OiBtLmhlaWdodCAhPSBudWxsID8gTnVtYmVyKG0uaGVpZ2h0KSA6IG51bGwsXG4gICAgICBkdXJhdGlvbjogbS5kdXJhdGlvbiAhPSBudWxsID8gTnVtYmVyKG0uZHVyYXRpb24pIDogbnVsbCxcbiAgICAgIHNvcnRfb3JkZXI6IG0uc29ydF9vcmRlciAhPSBudWxsID8gTnVtYmVyKG0uc29ydF9vcmRlcikgOiAwLFxuICAgICAgaXNfcHJpbWFyeTogTnVtYmVyKG0uaXNfcHJpbWFyeSkgPT09IDEsXG4gICAgICBjcmVhdGVkX2F0OiBtLmNyZWF0ZWRfYXQsXG4gICAgfSkpO1xuXG4gICAgZGJnKGBbbWVkaWFdW0dFVF0gcGlkPSR7cHJvZHVjdElkfSByb3dzPSR7cm93cy5sZW5ndGh9IGZpcnN0PSR7aGVhZChpdGVtc1swXSl9IGluICR7dG9vayhzdGFydCl9YCk7XG4gICAgcmV0dXJuIHNlbmRTdWNjZXNzUmVzcG9uc2UocmVzLCAyMDAsIFwiT0tcIiwgeyBpdGVtcyB9KTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgY29uc29sZS5lcnJvcihcIuKdjCBMb2FkIG1lZGlhIGZhaWxlZDpcIiwgZXJyKTtcbiAgICByZXR1cm4gc2VuZEVycm9yUmVzcG9uc2UocmVzLCA1MDAsIFwiRmFpbGVkIHRvIGxvYWQgbWVkaWFcIik7XG4gIH1cbn0pO1xuXG4vLyA9PT09PT09PT09IFBPU1QgL2FwaS9hZG1pbi9wcm9kdWN0cy86aWQvbWVkaWEgPT09PT09PT09PVxuLyoqXG4gKiBCb2R5OlxuICoge1xuICogICBwdWJsaWNfaWQsIHNlY3VyZV91cmwsIGtpbmQoJ2ltYWdlJ3wndmlkZW8nKSxcbiAqICAgZm9ybWF0Pywgd2lkdGg/LCBoZWlnaHQ/LCBkdXJhdGlvbj8sIHNvcnRfb3JkZXI/LCBpc19wcmltYXJ5P1xuICogfVxuICovXG5oYW5kbGVyLnBvc3QoYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIGNvbnN0IHN0YXJ0ID0gdDAoKTtcbiAgcmVzLnNldEhlYWRlcihcIkNvbnRlbnQtVHlwZVwiLCBcImFwcGxpY2F0aW9uL2pzb247IGNoYXJzZXQ9dXRmLThcIik7XG4gIHJlcy5zZXRIZWFkZXIoXCJDYWNoZS1Db250cm9sXCIsIFwibm8tc3RvcmVcIik7XG5cbiAgY29uc3QgcHJvZHVjdElkID0gTnVtYmVyKHJlcS5xdWVyeS5pZCk7XG4gIGlmICghaXNQb3NJbnQocHJvZHVjdElkKSkge1xuICAgIHJldHVybiBzZW5kRXJyb3JSZXNwb25zZShyZXMsIDQwMCwgXCJJbnZhbGlkIHByb2R1Y3QgaWRcIik7XG4gIH1cblxuICBjb25zdCB7XG4gICAgcHVibGljX2lkLFxuICAgIHNlY3VyZV91cmwsXG4gICAga2luZCxcbiAgICBmb3JtYXQgPSBudWxsLFxuICAgIHdpZHRoID0gbnVsbCxcbiAgICBoZWlnaHQgPSBudWxsLFxuICAgIGR1cmF0aW9uID0gbnVsbCxcbiAgICBzb3J0X29yZGVyLFxuICAgIGlzX3ByaW1hcnkgPSAwLFxuICB9ID0gcmVxLmJvZHkgfHwge307XG5cbiAgLy8gc2FuaXRpemUgaW5wdXRzXG4gIGNvbnN0IGsgPSBTdHJpbmcoa2luZCB8fCBcIlwiKS50b0xvd2VyQ2FzZSgpO1xuICBjb25zdCBwdWJJZCA9IGNsYW1wTGVuKHB1YmxpY19pZCwgMjU1KTtcbiAgY29uc3QgdXJsID0gY2xhbXBMZW4oc2VjdXJlX3VybCwgMjA0OCk7XG4gIGNvbnN0IGZtdCA9IGZvcm1hdCA/IGNsYW1wTGVuKFN0cmluZyhmb3JtYXQpLCAzMikgOiBudWxsO1xuICBjb25zdCB3ID0gd2lkdGggIT0gbnVsbCA/IE51bWJlcih3aWR0aCkgOiBudWxsO1xuICBjb25zdCBoID0gaGVpZ2h0ICE9IG51bGwgPyBOdW1iZXIoaGVpZ2h0KSA6IG51bGw7XG4gIGNvbnN0IGQgPSBkdXJhdGlvbiAhPSBudWxsID8gTnVtYmVyKGR1cmF0aW9uKSA6IG51bGw7XG4gIGNvbnN0IG1ha2VQcmltYXJ5ID0gTnVtYmVyKGlzX3ByaW1hcnkpID09PSAxIHx8IGlzX3ByaW1hcnkgPT09IHRydWU7XG5cbiAgaWYgKCFwdWJJZCB8fCAhdXJsIHx8ICFLSU5EX1NFVC5oYXMoaykpIHtcbiAgICByZXR1cm4gc2VuZEVycm9yUmVzcG9uc2UoXG4gICAgICByZXMsXG4gICAgICA0MDAsXG4gICAgICBcInB1YmxpY19pZCwgc2VjdXJlX3VybCBhbmQga2luZCAoJ2ltYWdlJ3wndmlkZW8nKSBhcmUgcmVxdWlyZWRcIlxuICAgICk7XG4gIH1cbiAgaWYgKCFpc0hUVFBTVXJsKHVybCkpIHtcbiAgICByZXR1cm4gc2VuZEVycm9yUmVzcG9uc2UocmVzLCA0MDAsIFwic2VjdXJlX3VybCBtdXN0IGJlIGEgdmFsaWQgaHR0cHMgVVJMXCIpO1xuICB9XG4gIGlmICh3ICE9IG51bGwgJiYgKCFOdW1iZXIuaXNGaW5pdGUodykgfHwgdyA8IDApKSB7XG4gICAgcmV0dXJuIHNlbmRFcnJvclJlc3BvbnNlKHJlcywgNDAwLCBcIndpZHRoIG11c3QgYmUgYSBub24tbmVnYXRpdmUgbnVtYmVyXCIpO1xuICB9XG4gIGlmIChoICE9IG51bGwgJiYgKCFOdW1iZXIuaXNGaW5pdGUoaCkgfHwgaCA8IDApKSB7XG4gICAgcmV0dXJuIHNlbmRFcnJvclJlc3BvbnNlKHJlcywgNDAwLCBcImhlaWdodCBtdXN0IGJlIGEgbm9uLW5lZ2F0aXZlIG51bWJlclwiKTtcbiAgfVxuICBpZiAoZCAhPSBudWxsICYmICghTnVtYmVyLmlzRmluaXRlKGQpIHx8IGQgPCAwKSkge1xuICAgIHJldHVybiBzZW5kRXJyb3JSZXNwb25zZShyZXMsIDQwMCwgXCJkdXJhdGlvbiBtdXN0IGJlIGEgbm9uLW5lZ2F0aXZlIG51bWJlclwiKTtcbiAgfVxuXG4gIGxldCBkYjtcbiAgdHJ5IHtcbiAgICBkYiA9IGF3YWl0IG9wZW5EQigpO1xuICAgIGF3YWl0IGRiLmV4ZWMoXCJCRUdJTlwiKTtcblxuICAgIC8vIGVuc3VyZSBwcm9kdWN0IGV4aXN0c1xuICAgIGNvbnN0IHAgPSBhd2FpdCBkYi5nZXQoYFNFTEVDVCBpZCBGUk9NIHByb2R1Y3RzIFdIRVJFIGlkID0gP2AsIHByb2R1Y3RJZCk7XG4gICAgaWYgKCFwKSB7XG4gICAgICBhd2FpdCBkYi5leGVjKFwiUk9MTEJBQ0tcIik7XG4gICAgICByZXR1cm4gc2VuZEVycm9yUmVzcG9uc2UocmVzLCA0MDQsIFwiUHJvZHVjdCBub3QgZm91bmRcIik7XG4gICAgfVxuXG4gICAgLy8gZGV0ZXJtaW5lIHNvcnQgb3JkZXIgKGFwcGVuZCBpZiBub3QgcHJvdmlkZWQpXG4gICAgbGV0IG9yZGVyID0gTnVtYmVyLmlzRmluaXRlKE51bWJlcihzb3J0X29yZGVyKSkgPyBOdW1iZXIoc29ydF9vcmRlcikgOiBOYU47XG4gICAgaWYgKCFOdW1iZXIuaXNGaW5pdGUob3JkZXIpIHx8IG9yZGVyIDwgMCkge1xuICAgICAgY29uc3QgbWF4ID0gYXdhaXQgZGIuZ2V0KFxuICAgICAgICBgU0VMRUNUIENPQUxFU0NFKE1BWChzb3J0X29yZGVyKSwgLTEpIEFTIG1heF9vcmRlclxuICAgICAgICAgICBGUk9NIHByb2R1Y3RfbWVkaWFcbiAgICAgICAgICBXSEVSRSBwcm9kdWN0X2lkID0gP2AsXG4gICAgICAgIHByb2R1Y3RJZFxuICAgICAgKTtcbiAgICAgIG9yZGVyID0gTnVtYmVyKG1heD8ubWF4X29yZGVyID8/IC0xKSArIDE7XG4gICAgfVxuXG4gICAgaWYgKG1ha2VQcmltYXJ5KSB7XG4gICAgICBhd2FpdCBkYi5ydW4oYFVQREFURSBwcm9kdWN0X21lZGlhIFNFVCBpc19wcmltYXJ5ID0gMCBXSEVSRSBwcm9kdWN0X2lkID0gP2AsIHByb2R1Y3RJZCk7XG4gICAgfVxuXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGIucnVuKFxuICAgICAgYElOU0VSVCBJTlRPIHByb2R1Y3RfbWVkaWFcbiAgICAgICAgIChwcm9kdWN0X2lkLCBraW5kLCBwdWJsaWNfaWQsIHNlY3VyZV91cmwsIGZvcm1hdCwgd2lkdGgsIGhlaWdodCwgZHVyYXRpb24sIHNvcnRfb3JkZXIsIGlzX3ByaW1hcnkpXG4gICAgICAgVkFMVUVTICg/LCA/LCA/LCA/LCA/LCA/LCA/LCA/LCA/LCA/KWAsXG4gICAgICBwcm9kdWN0SWQsXG4gICAgICBrLFxuICAgICAgcHViSWQsXG4gICAgICB1cmwsXG4gICAgICBmbXQsXG4gICAgICB3ICE9IG51bGwgPyB3IDogbnVsbCxcbiAgICAgIGggIT0gbnVsbCA/IGggOiBudWxsLFxuICAgICAgZCAhPSBudWxsID8gZCA6IG51bGwsXG4gICAgICBvcmRlcixcbiAgICAgIG1ha2VQcmltYXJ5ID8gMSA6IDBcbiAgICApO1xuXG4gICAgYXdhaXQgZGIuZXhlYyhcIkNPTU1JVFwiKTtcbiAgICBhd2FpdCBpbnZhbGlkYXRlUHJvZHVjdHNDYWNoZSgpO1xuXG4gICAgZGJnKFxuICAgICAgYFttZWRpYV1bUE9TVF0gcGlkPSR7cHJvZHVjdElkfSBpZD0ke3Jlc3VsdC5sYXN0SUR9IHByaW1hcnk9JHttYWtlUHJpbWFyeX0gc29ydD0ke29yZGVyfSBpbiAke3Rvb2soXG4gICAgICAgIHN0YXJ0XG4gICAgICApfWBcbiAgICApO1xuICAgIHJldHVybiBzZW5kU3VjY2Vzc1Jlc3BvbnNlKHJlcywgMjAxLCBcIk1lZGlhIGNyZWF0ZWRcIiwgeyBpZDogcmVzdWx0Lmxhc3RJRCB9KTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgdHJ5IHtcbiAgICAgIGlmIChkYikgYXdhaXQgZGIuZXhlYyhcIlJPTExCQUNLXCIpO1xuICAgIH0gY2F0Y2gge31cbiAgICBjb25zb2xlLmVycm9yKFwi4p2MIENyZWF0ZSBtZWRpYSBmYWlsZWQ6XCIsIGVycik7XG4gICAgcmV0dXJuIHNlbmRFcnJvclJlc3BvbnNlKHJlcywgNTAwLCBcIkZhaWxlZCB0byBjcmVhdGUgbWVkaWFcIik7XG4gIH1cbn0pO1xuXG5leHBvcnQgZGVmYXVsdCBoYW5kbGVyO1xuXG5cblxuXG5cbiJdLCJuYW1lcyI6WyJwYXRoIiwib3BlbiIsInNxbGl0ZTMiLCJjcmVhdGVBZG1pbkhhbmRsZXIiLCJzZW5kRXJyb3JSZXNwb25zZSIsInNlbmRTdWNjZXNzUmVzcG9uc2UiLCJnZXRSZWRpc0NsaWVudCIsInNhZmVSZWRpc0tleSIsImRiUGF0aCIsImpvaW4iLCJwcm9jZXNzIiwiY3dkIiwib3BlbkRCIiwiZmlsZW5hbWUiLCJkcml2ZXIiLCJEYXRhYmFzZSIsIkRFQlVHIiwiZW52IiwiREVCVUdfTUVESUEiLCJ0MCIsInBlcmZvcm1hbmNlIiwibm93IiwiRGF0ZSIsInRvb2siLCJzIiwiTWF0aCIsInJvdW5kIiwiaGVhZCIsInYiLCJuIiwic2xpY2UiLCJyZXBsYWNlIiwiSlNPTiIsInN0cmluZ2lmeSIsIlN0cmluZyIsImRiZyIsImEiLCJjb25zb2xlIiwibG9nIiwiaXNQb3NJbnQiLCJOdW1iZXIiLCJpc0ludGVnZXIiLCJjbGFtcExlbiIsIktJTkRfU0VUIiwiU2V0IiwiaXNIVFRQU1VybCIsInUiLCJVUkwiLCJwcm90b2NvbCIsImludmFsaWRhdGVQcm9kdWN0c0NhY2hlIiwic3RhcnQiLCJyZWRpcyIsInBhdHRlcm4iLCJrZXlzIiwibGVuZ3RoIiwiZGVsIiwiZSIsIndhcm4iLCJtZXNzYWdlIiwiaGFuZGxlciIsInJhdGVMaW1pdCIsImxpbWl0Iiwid2luZG93IiwiZ2V0IiwicmVxIiwicmVzIiwic2V0SGVhZGVyIiwicHJvZHVjdElkIiwicXVlcnkiLCJpZCIsImRiIiwicm93cyIsImFsbCIsIml0ZW1zIiwibWFwIiwibSIsInByb2R1Y3RfaWQiLCJraW5kIiwicHVibGljX2lkIiwic2VjdXJlX3VybCIsImZvcm1hdCIsIndpZHRoIiwiaGVpZ2h0IiwiZHVyYXRpb24iLCJzb3J0X29yZGVyIiwiaXNfcHJpbWFyeSIsImNyZWF0ZWRfYXQiLCJlcnIiLCJlcnJvciIsInBvc3QiLCJib2R5IiwiayIsInRvTG93ZXJDYXNlIiwicHViSWQiLCJ1cmwiLCJmbXQiLCJ3IiwiaCIsImQiLCJtYWtlUHJpbWFyeSIsImhhcyIsImlzRmluaXRlIiwiZXhlYyIsInAiLCJvcmRlciIsIk5hTiIsIm1heCIsIm1heF9vcmRlciIsInJ1biIsInJlc3VsdCIsImxhc3RJRCJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api-node)/./pages/api/products/[id]/media/index.js\n");

/***/ }),

/***/ "@upstash/redis":
/*!*********************************!*\
  !*** external "@upstash/redis" ***!
  \*********************************/
/***/ ((module) => {

module.exports = import("@upstash/redis");;

/***/ }),

/***/ "next-auth/jwt":
/*!********************************!*\
  !*** external "next-auth/jwt" ***!
  \********************************/
/***/ ((module) => {

module.exports = require("next-auth/jwt");

/***/ }),

/***/ "next-connect":
/*!*******************************!*\
  !*** external "next-connect" ***!
  \*******************************/
/***/ ((module) => {

module.exports = import("next-connect");;

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "redis":
/*!************************!*\
  !*** external "redis" ***!
  \************************/
/***/ ((module) => {

module.exports = require("redis");

/***/ }),

/***/ "sqlite":
/*!*************************!*\
  !*** external "sqlite" ***!
  \*************************/
/***/ ((module) => {

module.exports = import("sqlite");;

/***/ }),

/***/ "sqlite3":
/*!**************************!*\
  !*** external "sqlite3" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("sqlite3");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fproducts%2F%5Bid%5D%2Fmedia&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fproducts%2F%5Bid%5D%2Fmedia%2Findex.js&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();